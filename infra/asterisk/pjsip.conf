;
; Asterisk PJSIP Configuration for ProSaaS AI Call Center
; SIP trunk configuration for DID provider integration
;

[global]
type=global
max_forwards=70
keep_alive_interval=90
endpoint_identifier_order=ip,username,anonymous

;==================================
; TRANSPORT - SIP/UDP
;==================================
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
; IMPORTANT: If server is behind NAT, uncomment and set your public IP:
; external_media_address=YOUR_PUBLIC_IP_HERE
; external_signaling_address=YOUR_PUBLIC_IP_HERE
; For most VPS with public IP (like 213.199.43.223), these are optional
; If calls connect but have no audio, set these to your public IP

;==================================
; SIP TRUNK (DIDWW Provider)
;==================================
; DIDWW uses IP-based authentication ONLY
; No SIP registration, no username/password
; Inbound: SIP INVITE from DIDWW to our server IP
; Outbound: We initiate toward DIDWW SIP endpoints

[didww]
type=endpoint
transport=transport-udp
context=from-trunk
disallow=all
allow=ulaw
aors=didww
; CRITICAL: direct_media=no ensures RTP goes through our Media Gateway
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
trust_id_inbound=yes
trust_id_outbound=yes
send_pai=yes
send_rpid=yes
dtmf_mode=rfc4733

[didww]
type=aor
; Static contact for outbound calls to DIDWW (hardcoded - no ENV vars)
contact=sip:sip.didww.com:5060
qualify_frequency=60

[didww-identify]
type=identify
endpoint=didww
; Match DIDWW source IPs (hardcoded - no ENV vars)
; Primary IP from logs: 46.19.210.14
match=46.19.210.14
; Additional known DIDWW IPs
match=89.105.196.76
match=80.93.48.76
match=89.105.205.76

;==================================
; INTERNAL - Backend/Media Gateway
;==================================
[backend]
type=endpoint
context=from-internal
disallow=all
allow=ulaw
aors=backend

[backend]
type=aor
contact=sip:backend@127.0.0.1:5061
