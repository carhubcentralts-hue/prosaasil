;
; Asterisk PJSIP Configuration for ProSaaS AI Call Center
; SIP trunk configuration for DID provider integration
;

[global]
type=global
max_forwards=70
keep_alive_interval=90
endpoint_identifier_order=ip,username,anonymous

;==================================
; TRANSPORT - SIP/UDP
;==================================
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
external_media_address=${EXTERNAL_IP}
external_signaling_address=${EXTERNAL_IP}

;==================================
; SIP TRUNK (DIDWW Provider)
;==================================
; DIDWW uses IP-based authentication ONLY
; No SIP registration, no username/password
; Inbound: SIP INVITE from DIDWW to our server IP
; Outbound: We initiate toward DIDWW SIP endpoints

[didww]
type=endpoint
context=from-trunk
disallow=all
allow=ulaw
; CRITICAL: direct_media=no ensures RTP goes through our Media Gateway
direct_media=no
trust_id_inbound=yes
trust_id_outbound=yes
send_pai=yes
send_rpid=yes
dtmf_mode=rfc4733
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
; No auth section - IP-based authentication only
aors=didww

[didww]
type=aor
; Static contact for outbound calls to DIDWW
contact=sip:${DIDWW_SIP_HOST}:${DIDWW_SIP_PORT:-5060}
qualify_frequency=60

[didww]
type=identify
endpoint=didww
; Match DIDWW source IPs (supports multiple IPs)
match=${DIDWW_IP_1}
match=${DIDWW_IP_2:-0.0.0.0}
match=${DIDWW_IP_3:-0.0.0.0}

;==================================
; INTERNAL - Backend/Media Gateway
;==================================
[backend]
type=endpoint
context=from-internal
disallow=all
allow=ulaw
aors=backend

[backend]
type=aor
contact=sip:backend@127.0.0.1:5061
