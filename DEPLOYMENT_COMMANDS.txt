ðŸš€ DEPLOYMENT COMMANDS for AgentLocator 73 - PRODUCTION READY

## Build Command:
pip install --no-cache-dir -r requirements.txt

## Run Command:
bash -lc './start_all.sh'

## Environment Variables (SET IN DEPLOYMENT, NOT WORKSPACE):
PUBLIC_BASE_URL=https://ai-crmd.replit.app
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...
TWILIO_WA_FROM=whatsapp:+1...
OPENAI_API_KEY=sk-...
GOOGLE_APPLICATION_CREDENTIALS=/tmp/gcp-credentials.json
GCP_CREDENTIALS_JSON={"type":"service_account",...}
DATABASE_URL=postgresql://...

# WhatsApp Configuration:
ENABLE_WA_TWILIO=true
ENABLE_WA_BAILEYS=true
WA_BAILEYS_PORT=8000
WA_SHARED_SECRET=<random-secret-key>
WA_SESSION_DIR=./baileys-bridge/session
WA_PROVIDER_PRIORITY=baileys,twilio
PYTHON_WEBHOOK_URL=http://127.0.0.1:5000/webhook/whatsapp/baileys

# Version tracking:
DEPLOY_ID=RPLT-$(date +%Y%m%d-%H%M)
GIT_COMMIT=AgentLocator-73-ProductionReady
BUILD_TIME=$(date -u +%Y-%m-%dT%H:%MZ)

## Health Check Path:
/ (returns "ok" in <50ms)

## GO/NO-GO Verification Checklist:

# 1. Health endpoints
curl https://ai-crmd.replit.app/
curl https://ai-crmd.replit.app/healthz
curl https://ai-crmd.replit.app/readyz
curl -s https://ai-crmd.replit.app/version | jq

# 2. TwiML structure
curl -s https://ai-crmd.replit.app/webhook/incoming_call | grep "Connect.*Stream.*statusCallback"

# 3. Static files
curl -I https://ai-crmd.replit.app/static/tts/greeting_he.mp3
curl -I https://ai-crmd.replit.app/static/tts/fallback_he.mp3

# 4. WhatsApp webhooks
curl -X POST https://ai-crmd.replit.app/webhook/whatsapp/twilio -d "From=whatsapp:+1234&Body=test" -H "Content-Type: application/x-www-form-urlencoded"

# 5. API endpoints
curl -s https://ai-crmd.replit.app/api/threads
curl -X POST https://ai-crmd.replit.app/api/whatsapp/send -H "Content-Type: application/json" -d '{"to":"whatsapp:+1234","text":"test","provider":"auto"}'

# 6. Baileys bridge (internal)
curl -s http://127.0.0.1:8000/healthz

## Expected Results:
âœ… Phone calls: Bidirectional Hebrew conversations + watchdog fallback + turn metrics
âœ… WhatsApp: Both Twilio and Baileys providers with unified CRM storage  
âœ… PayPal/Tranzila: Graceful 501 when missing credentials (no 500 errors)
âœ… CRM: Unified threads and messages with full API endpoints
âœ… Health: All endpoints (/, /healthz, /readyz, /version) responding <50ms
âœ… Security: Twilio signature validation on all webhooks
âœ… Static files: greeting_he.mp3 and fallback_he.mp3 accessible
âœ… WebSocket: Real-time media streams with proper Connect->Stream TwiML

## PRODUCTION CHECKLIST:

ðŸ”§ **Required ENV Variables (CRITICAL)**:
- TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, TWILIO_WA_FROM
- OPENAI_API_KEY, GCP_CREDENTIALS_JSON (or GOOGLE_APPLICATION_CREDENTIALS)
- DATABASE_URL (PostgreSQL)
- PUBLIC_BASE_URL (https://your-domain.replit.app)

ðŸŸ¢ **Optional ENV (WhatsApp + Payments)**:
- WA_SHARED_SECRET, ENABLE_WA_BAILEYS=true
- PAYPAL_CLIENT_ID, PAYPAL_SECRET (for payments)

ðŸ“ž **Live Test Sequence**:
1. Call phone number â†’ Hear Hebrew greeting â†’ Speak Hebrew â†’ Get AI response
2. Send WhatsApp â†’ See webhook hit â†’ Response stored in DB
3. Check /api/threads â†’ See unified conversation data
4. Test payments â†’ Get 501 if no PayPal keys (not 500)