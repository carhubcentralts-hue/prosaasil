{% extends "base.html" %}

{% block title %}××™×¤×•×¡ ×¡×™×¡××” - ××§×¡×™××•×¡ × ×“×œ×´×Ÿ{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-200 flex items-center justify-center p-4">
    <div class="bg-white/95 backdrop-blur-sm border border-white/20 rounded-3xl p-8 w-full max-w-md shadow-2xl">
        <div class="text-center mb-8">
            <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-700 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <span class="text-white text-2xl font-semibold">ğŸ”‘</span>
            </div>
            <h1 class="text-2xl font-bold text-slate-800 mb-2">×¡×™×¡××” ×—×“×©×”</h1>
            <p class="text-slate-600">×”×–×Ÿ ××ª ×”×¡×™×¡××” ×”×—×“×©×” ×©×œ×š</p>
        </div>

        <form id="resetForm" class="space-y-6">
            <input type="hidden" name="token" value="{{ token }}">
            <div id="message" class="hidden p-4 rounded-xl text-center text-sm"></div>
            
            <div>
                <label for="password" class="block text-sm font-medium text-slate-700 mb-2">
                    ×¡×™×¡××” ×—×“×©×”
                </label>
                <input
                    type="password"
                    id="password"
                    name="password"
                    required
                    minlength="6"
                    class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 text-right"
                    placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                />
            </div>

            <div>
                <label for="confirmPassword" class="block text-sm font-medium text-slate-700 mb-2">
                    ××™××•×ª ×¡×™×¡××”
                </label>
                <input
                    type="password"
                    id="confirmPassword"
                    name="confirmPassword"
                    required
                    minlength="6"
                    class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 text-right"
                    placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                />
            </div>

            <div class="space-y-4">
                <button
                    type="submit"
                    id="submitButton"
                    class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 px-4 rounded-xl font-medium hover:from-green-700 hover:to-green-800 transition-all duration-200 transform hover:scale-[1.02] shadow-lg"
                >
                    ×¢×“×›×Ÿ ×¡×™×¡××”
                </button>
                
                <a
                    href="/login"
                    class="block w-full text-center text-slate-600 py-2 px-4 rounded-xl font-medium hover:bg-slate-100 transition-all duration-200"
                >
                    ×—×–×¨×” ×œ×”×ª×—×‘×¨×•×ª
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('resetForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    const button = document.getElementById('submitButton');
    const messageDiv = document.getElementById('message');
    
    if (password !== confirmPassword) {
        messageDiv.className = 'bg-red-50 border border-red-200 text-red-700 p-4 rounded-xl text-center text-sm';
        messageDiv.textContent = '×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª';
        messageDiv.classList.remove('hidden');
        return;
    }
    
    button.textContent = '××¢×“×›×Ÿ...';
    button.disabled = true;
    messageDiv.classList.add('hidden');
    
    try {
        const formData = new FormData(e.target);
        const result = await apiCall('/api/auth/reset', {
            method: 'POST',
            body: JSON.stringify({
                token: formData.get('token'),
                password: password
            })
        });
        
        messageDiv.className = 'bg-green-50 border border-green-200 text-green-700 p-4 rounded-xl text-center text-sm';
        messageDiv.textContent = '×”×¡×™×¡××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”';
        messageDiv.classList.remove('hidden');
        
        setTimeout(() => {
            window.location.href = '/login';
        }, 2000);
        
    } catch (error) {
        messageDiv.className = 'bg-red-50 border border-red-200 text-red-700 p-4 rounded-xl text-center text-sm';
        messageDiv.textContent = '×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¡×™×¡××”';
        messageDiv.classList.remove('hidden');
    }
    
    button.textContent = '×¢×“×›×Ÿ ×¡×™×¡××”';
    button.disabled = false;
});
</script>
{% endblock %}