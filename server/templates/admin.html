{% extends "layout.html" %}

{% block content %}
<div class="space-y-6">
    <!-- Page Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">×“×©×‘×•×¨×“ ×× ×”×œ</h1>
            <p class="text-gray-600 mt-1">× ×™×”×•×œ ××¢×¨×›×ª ×›×•×œ×œ - ×¢×¡×§×™×, ××©×ª××©×™× ×•×—×™×•×‘</p>
        </div>
        <button class="flex items-center px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors"
                hx-get="/ui/admin/overview" hx-target="#kpis" hx-swap="outerHTML">
            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            ğŸ”„ ×¨×¢× ×Ÿ × ×ª×•× ×™×
        </button>
    </div>

    <!-- KPIs Section -->
    <div id="kpis" hx-get="/ui/admin/overview" hx-trigger="load, every 10s" hx-swap="outerHTML">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Today Calls -->
            <div class="kpi-card rounded-2xl p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-blue-100 rounded-xl">
                        <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                        </svg>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">×©×™×—×•×ª ×”×™×•×</p>
                        <p class="text-2xl font-semibold text-gray-900">{{ counters.today_calls or 0 }}</p>
                    </div>
                </div>
            </div>

            <!-- Active Tenants -->
            <div class="kpi-card rounded-2xl p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-green-100 rounded-xl">
                        <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-1a1 1 0 00-1-1H9a1 1 0 00-1 1v1a1 1 0 01-1 1H4a1 1 0 110-2V4z"/>
                        </svg>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">×¢×¡×§×™× ×¤×¢×™×œ×™×</p>
                        <p class="text-2xl font-semibold text-gray-900">{{ counters.tenants_active or 0 }}</p>
                    </div>
                </div>
            </div>

            <!-- WhatsApp Unread -->
            <div class="kpi-card rounded-2xl p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-green-100 rounded-xl">
                        <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">×”×•×“×¢×•×ª ×•×•×˜×¡××¤</p>
                        <p class="text-2xl font-semibold text-gray-900">{{ counters.whatsapp_unread or 0 }}</p>
                    </div>
                </div>
            </div>

            <!-- Pending Users -->
            <div class="kpi-card rounded-2xl p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-yellow-100 rounded-xl">
                        <svg class="w-6 h-6 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">××©×ª××©×™× ×××ª×™× ×™×</p>
                        <p class="text-2xl font-semibold text-gray-900">{{ counters.users_pending or 0 }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tenants Management Section -->
    <div class="card-professional rounded-2xl p-6">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h2 class="text-xl font-semibold text-gray-900">× ×™×”×•×œ ×¢×¡×§×™×</h2>
                <p class="text-gray-600 text-sm">× ×™×”×•×œ ×›×œ ×”×œ×§×•×—×•×ª ×”×¢×¡×§×™×™× ×‘××¢×¨×›×ª</p>
            </div>
            <div class="flex items-center gap-3">
                <input type="text" id="tenantSearch" placeholder="×—×¤×© ×¢×¡×§..." 
                       class="px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       oninput="searchTenants()">
                <button class="px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors flex items-center"
                        hx-get="/ui/admin/tenants/new" hx-target="#modal" hx-swap="innerHTML">
                    <svg class="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"/>
                    </svg>
                    â• ×”×•×¡×£ ×¢×¡×§
                </button>
            </div>
        </div>
        
        <div id="tenantsTable" hx-get="/ui/admin/tenants?q=" hx-trigger="load, every 15s" hx-swap="outerHTML">
            <!-- Loading state -->
            <div class="flex justify-center py-8">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            </div>
        </div>
    </div>

    <!-- Users Management Section -->
    <div class="card-professional rounded-2xl p-6">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h2 class="text-xl font-semibold text-gray-900">× ×™×”×•×œ ××©×ª××©×™×</h2>
                <p class="text-gray-600 text-sm">× ×™×”×•×œ ×›×œ ×”××©×ª××©×™× ×‘××¢×¨×›×ª</p>
            </div>
            <div class="flex items-center gap-3">
                <input type="text" id="userSearch" placeholder="×—×¤×© ××©×ª××©..." 
                       class="px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       oninput="searchUsers()">
                <select id="roleFilter" class="px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        onchange="searchUsers()">
                    <option value="">×›×œ ×”×ª×¤×§×™×“×™×</option>
                    <option value="admin">×× ×”×œ ××¢×¨×›×ª</option>
                    <option value="manager">×× ×”×œ ×¢×¡×§</option>
                    <option value="agent">×¡×•×›×Ÿ</option>
                </select>
                <button class="px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors flex items-center"
                        hx-get="/ui/admin/users/new" hx-target="#modal" hx-swap="innerHTML">
                    <svg class="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6z"/>
                    </svg>
                    â• ××©×ª××© ×—×“×©
                </button>
            </div>
        </div>
        
        <div id="usersTable" hx-get="/ui/admin/users?q=&business_id=&role=" hx-trigger="load, every 15s" hx-swap="outerHTML">
            <!-- Loading state -->
            <div class="flex justify-center py-8">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            </div>
        </div>
    </div>

    <!-- Billing & Systems Status -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Billing Status -->
        <div class="card-professional rounded-2xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">×¡×˜×˜×•×¡ ×—×™×•×‘</h3>
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <span class="text-gray-600">PayPal</span>
                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">×¤×¢×™×œ</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-gray-600">Tranzila</span>
                    <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs">×œ× ××•×’×“×¨</span>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="card-professional rounded-2xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">×¤×¢×™×œ×•×ª ××—×¨×•× ×”</h3>
            <div class="space-y-3 text-sm">
                <div class="flex items-center">
                    <div class="w-2 h-2 bg-green-500 rounded-full ml-3"></div>
                    <span class="text-gray-600">×¢×¡×§ ×—×“×© × ×¨×©×</span>
                </div>
                <div class="flex items-center">
                    <div class="w-2 h-2 bg-blue-500 rounded-full ml-3"></div>
                    <span class="text-gray-600">×©×™×—×” ×—×“×©×” ×”×ª×§×‘×œ×”</span>
                </div>
                <div class="flex items-center">
                    <div class="w-2 h-2 bg-yellow-500 rounded-full ml-3"></div>
                    <span class="text-gray-600">×—×©×‘×•× ×™×ª × ×•×¦×¨×”</span>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card-professional rounded-2xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">×¤×¢×•×œ×•×ª ××”×™×¨×•×ª</h3>
            <div class="space-y-3">
                <button class="w-full flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors text-sm"
                        hx-get="/ui/admin/tenants/new" hx-target="#modal" hx-swap="innerHTML">
                    <svg class="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-1a1 1 0 00-1-1H9a1 1 0 00-1 1v1a1 1 0 01-1 1H4a1 1 0 110-2V4z"/>
                    </svg>
                    ×¢×¡×§ ×—×“×©
                </button>
                <button class="w-full flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors text-sm"
                        hx-get="/ui/admin/users/new" hx-target="#modal" hx-swap="innerHTML">
                    <svg class="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6z"/>
                    </svg>
                    ××©×ª××© ×—×“×©
                </button>
                <button class="w-full flex items-center justify-center px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors text-sm"
                        onclick="loadBilling()">
                    <svg class="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4z"/>
                    </svg>
                    × ×™×”×•×œ ×—×™×•×‘
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Search functions
    function searchTenants() {
        const q = document.getElementById('tenantSearch')?.value || '';
        htmx.ajax('GET', `/ui/admin/tenants?q=${encodeURIComponent(q)}`, { 
            target: '#tenantsTable', 
            swap: 'outerHTML' 
        });
    }
    
    function searchUsers() {
        const q = document.getElementById('userSearch')?.value || '';
        const bid = document.getElementById('businessSelect')?.value || '';
        const role = document.getElementById('roleFilter')?.value || '';
        htmx.ajax('GET', `/ui/admin/users?q=${encodeURIComponent(q)}&business_id=${bid}&role=${role}`, { 
            target: '#usersTable', 
            swap: 'outerHTML' 
        });
    }
</script>
{% endblock %}