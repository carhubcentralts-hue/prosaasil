{% extends "layout.html" %}

{% block content %}
<div class="space-y-6">
    <!-- KPI Cards for Business -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white rounded-xl shadow-sm p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">×©×™×—×•×ª ×”×™×•×</p>
                    <p class="text-2xl font-bold text-gray-900">{{ counters.get('today_calls', 0) }}</p>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                    <span class="text-2xl">ğŸ“</span>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">××©×ª××©×™ ×”×¢×¡×§</p>
                    <p class="text-2xl font-bold text-gray-900">{{ counters.get('biz_users_count', 0) }}</p>
                </div>
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                    <span class="text-2xl">ğŸ‘¥</span>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">WhatsApp ×œ× × ×§×¨××•</p>
                    <p class="text-2xl font-bold text-gray-900">{{ counters.get('whatsapp_unread', 0) }}</p>
                </div>
                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                    <span class="text-2xl">ğŸ’¬</span>
                </div>
            </div>
        </div>
    </div>

    <!-- WhatsApp Section -->
    <section id="whatsapp" class="space-y-2">
        <div class="flex items-center gap-2">
            <h2 class="font-semibold">WhatsApp CRM</h2>
            <button class="btn-primary"
                    hx-get="/ui/biz/whatsapp/compose" hx-target="#modal" hx-swap="innerHTML">âœï¸ ×©×œ×— ×”×•×“×¢×”</button>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
            <div class="animate-pulse space-y-4">
                <div class="h-4 bg-gray-200 rounded w-full"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                <div class="h-4 bg-gray-200 rounded w-1/2"></div>
            </div>
        </div>
    </section>

    <!-- Users Section -->
    <section id="users" class="space-y-2">
        <div class="flex items-center gap-2">
            <h2 class="font-semibold">× ×™×”×•×œ ××©×ª××©×™×</h2>
            <button class="btn-primary"
                    hx-get="/ui/biz/users/new" hx-target="#modal" hx-swap="innerHTML">â• ××©×ª××© ×—×“×©</button>
            <input id="uq" placeholder="×—×™×¤×•×© ××©×ª××©×™×" class="ml-auto px-3 py-2 border rounded-xl" oninput="loadUsersBiz()"/>
        </div>
        <div id="usersTable"
             hx-get="/ui/biz/users" 
             hx-trigger="load" 
             hx-swap="innerHTML"></div>
    </section>

    <!-- Calls Section -->
    <section id="calls" class="space-y-2">
        <div class="flex items-center gap-2">
            <h2 class="font-semibold">×©×™×—×•×ª ××—×¨×•× ×•×ª</h2>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
            <div class="animate-pulse space-y-4">
                <div class="h-4 bg-gray-200 rounded w-full"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                <div class="h-4 bg-gray-200 rounded w-1/2"></div>
            </div>
        </div>
    </section>

    <!-- Customers Section -->
    <section id="customers" class="space-y-2">
        <div class="flex items-center gap-2">
            <h2 class="font-semibold">×œ×§×•×—×•×ª</h2>
            <button class="btn-primary"
                    hx-get="/ui/biz/customers/new" hx-target="#modal" hx-swap="innerHTML">â• ×œ×§×•×— ×—×“×©</button>
        </div>
        <div class="bg-white rounded-xl shadow-sm p-6">
            <div class="animate-pulse space-y-4">
                <div class="h-4 bg-gray-200 rounded w-full"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                <div class="h-4 bg-gray-200 rounded w-1/2"></div>
            </div>
        </div>
    </section>
</div>

<script>
// Load functions for HTMX tables
function loadUsersBiz(){
  const q = document.getElementById('uq').value || '';
  const u = new URL('/ui/biz/users', location.origin);
  u.searchParams.set('q', q);
  htmx.ajax('GET', u.toString(), { target:'#usersTable', swap:'innerHTML' });
}

// Action functions for business users
function editUser(userId) {
  htmx.ajax('GET', `/ui/biz/users/${userId}/edit`, { target:'#modal', swap:'innerHTML' });
}

function changeUserPassword(userId) {
  htmx.ajax('GET', `/ui/biz/users/${userId}/password`, { target:'#modal', swap:'innerHTML' });
}

// Auto-load tables on page load
window.addEventListener('load', function(){ 
  loadUsersBiz();
  setInterval(loadUsersBiz, 15000);
});
</script>
{% endblock %}