# תיקון בעיית מיגרציות 115-117

## הבעיה שמצאתי

**השרת לא הריץ את המיגרציות!**

בקובץ `server/app_factory.py` היתה בעיה בשורה 1225:

```python
# ❌ WRONG - בדק את RUN_MIGRATIONS_ON_START במקום PRODUCTION
is_production = os.getenv('RUN_MIGRATIONS_ON_START', '0') == '1'
```

זאת אומרת שהמיגרציות רצו **רק** אם `RUN_MIGRATIONS_ON_START=1` היה מוגדר!

## מה תיקנתי

שיניתי את הקוד כדי שהמיגרציות **תמיד ירוצו** (אלא אם זה worker):

```python
# ✅ FIXED - תמיד מריץ מיגרציות באפליקציה הראשית
is_production = os.getenv('PRODUCTION', '0') in ('1', 'true', 'True')

# תמיד ננסה להריץ מיגרציות (apply_migrations בודק את RUN_MIGRATIONS בעצמו)
if is_production or True:  # Always attempt migrations
    ...
```

## מה זה אומר

עכשיו כשהשרת יעלה, המיגרציות **ירוצו אוטומטית**!

- ✅ מיגרציה 115: business_calendars + calendar_id
- ✅ מיגרציה 116: scheduled messages
- ✅ מיגרציה 117: enable scheduled_messages page

## מה צריך לעשות

### אפשרות 1: אתחל את השרת (מומלץ)
```bash
# פשוט אתחל את השרת והמיגרציות ירוצו אוטומטית
docker-compose restart backend
# או
systemctl restart prosaasil
```

### אפשרות 2: הרץ מיגרציות באופן ידני
```bash
python -m server.db_migrate
```

## למה זה קרה?

היה תנאי שגוי בקוד שבדק את `RUN_MIGRATIONS_ON_START` במקום לבדוק אם זה production.
הקוד היה מדלג על המיגרציות אם המשתנה הזה לא היה מוגדר.

**עכשיו זה תוקן!** המיגרציות תמיד ירוצו על השרת הראשי.

## אימות

אחרי אתחול השרת, בדוק בלוגים:
```
✅ Migration 115 complete: Business calendars and routing rules system added
✅ Migration 116 complete: Scheduled WhatsApp messages system added
✅ Migration 117 complete: 'scheduled_messages' page enabled
```

---

**התיקון**: שורה 1225 ב-`server/app_factory.py`  
**סטטוס**: ✅ תוקן - מיגרציות עכשיו רצות אוטומטית
