# ×ª×™×¢×•×“: ××¢×¨×›×ª ×”×¢×¨×•×ª ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª AI

## ×¡×™×›×•× ×”×©×™× ×•×™×™×

×”××¢×¨×›×ª ×©×•×“×¨×’×” ×œ×¡×¤×§ ×©× ×™ ×¡×•×’×™× × ×¤×¨×“×™× ×©×œ ×”×¢×¨×•×ª ×¢× ×”×ª××§×“×•×ª ×‘×©×™×¨×•×ª ×œ×§×•×—×•×ª:

### 1. ×¤×™×¦×•×œ ×˜××‘ ×”×”×¢×¨×•×ª ×œ×©× ×™ ×˜××‘×™×

#### ×˜××‘ "×©×™×¨×•×ª ×œ×§×•×—×•×ª AI" (AI Customer Service)
- **××˜×¨×”**: ×”×¢×¨×•×ª ×©×”-AI ×¨×•××” ×•××©×ª××© ×‘×”×Ÿ ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª
- **×ª×•×›×Ÿ**:
  - âœ… ×¡×™×›×•××™ ×©×™×—×•×ª AI ××•×˜×•××˜×™×™× (×›×—×•×œ)
  - âœ… ×”×¢×¨×•×ª ×™×“× ×™×•×ª ×©×œ ×”×¢×¡×§ (×™×¨×•×§) - **×—×“×©!**
  - âŒ ×œ×œ× ××¤×©×¨×•×ª ×œ×”×¢×œ××ª ×§×‘×¦×™× (×˜×§×¡×˜ ×‘×œ×‘×“)
- **×™×™×—×•×“×™×•×ª**: ×›×œ ×”×¢×¨×” ×›××Ÿ ×’×œ×•×™×” ×œ-AI ×‘×©×™×—×•×ª ×”×‘××•×ª

#### ×˜××‘ "×”×¢×¨×•×ª ×—×•×¤×©×™×•×ª" (Free Notes)
- **××˜×¨×”**: ×”×¢×¨×•×ª ×›×œ×œ×™×•×ª ×¢× ×§×‘×¦×™× ××¦×•×¨×¤×™×
- **×ª×•×›×Ÿ**:
  - âœ… ×”×¢×¨×•×ª ×™×“× ×™×•×ª ×‘×œ×‘×“
  - âœ… ××¤×©×¨×•×ª ×œ×”×¢×œ×•×ª ×§×‘×¦×™× (×ª××•× ×•×ª, ××¡××›×™×, ××•×“×™×•)
  - âŒ ×œ× ×’×œ×•×™ ×œ-AI

### 2. ×©×™×¤×•×¨ ×¡×™×›×•××™ ×”×©×™×—×•×ª ×œ-AI

**×œ×¤× ×™**: ×¡×™×›×•× ×¤×©×•×˜ ×©×œ 500 ×ª×•×•×™× ×¨××©×•× ×™×
**××—×¨×™**: ×¡×™×›×•× ××ª×§×“× ×××•×§×“ ×©×™×¨×•×ª ×œ×§×•×—×•×ª

#### ×¤×•×¨××˜ ×”×¡×™×›×•× ×”×—×“×©:
```
ğŸ“ ×¡×™×›×•× ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª - 18/01/2026 15:47

ğŸ’¬ [×¡×™×›×•× ××¨×•×›×– ×©×œ ×”×©×™×—×”]
ğŸ¯ [×›×•×•× ×ª ×”×œ×§×•×— - ×¨×•×¦×” ×œ×§×‘×•×¢ ×¤×’×™×©×” / ××¢×•× ×™×™×Ÿ / ×œ× ××¢×•× ×™×™×Ÿ]
ğŸ“‹ ×”××©×š: [×”×¤×¢×•×œ×” ×”×‘××” ×”××•××œ×¦×ª]
ğŸ˜Š ×¡× ×˜×™×× ×˜: [×—×™×•×‘×™ / ×©×œ×™×œ×™]

â±ï¸ 120 ×©× ×™×•×ª
```

#### ××™×“×¢ ××•×‘× ×” (Structured Data):
```json
{
  "call_duration": 120,
  "call_direction": "inbound",
  "call_sid": "CA123...",
  "intent": "meeting_request",
  "sentiment": "positive",
  "next_action": "×ª×™××•× ×¤×’×™×©×” ×“×—×•×£"
}
```

### 3. ××¤×©×¨×•×ª ×œ×”×•×¡×¤×ª ×”×¢×¨×•×ª ×™×“× ×™×•×ª ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª

**×ª×›×•× ×” ×—×“×©×”**: ×”×¢×¡×§ ×™×›×•×œ ×œ×”×•×¡×™×£ ×”×¢×¨×•×ª ××©×œ×• ×‘×˜××‘ AI

**×“×•×’×××•×ª ×œ×©×™××•×©**:
- "×œ×§×•×— ××¢×“×™×£ ×¤×’×™×©×•×ª ×‘×‘×•×§×¨"
- "VIP - ×˜×™×¤×•×œ ××™×•×—×“ × ×“×¨×©"
- "××œ×¨×’×™×” ×œ×—×ª×•×œ×™× - ×—×©×•×‘!"
- "×“×™×‘×¨ ×¢×œ ×™×œ×“×™× - ×™×© ×©× ×™ ×‘× ×™×"

**×”×™×ª×¨×•× ×•×ª**:
- ×”-AI ×¨×•××” ×”×¢×¨×•×ª ××œ×• ×‘×©×™×—×•×ª ×”×‘××•×ª
- ××¡×•×× ×•×ª ×‘×™×¨×•×§: "ğŸ“ ×”×¢×¨×” ×™×“× ×™×ª (×’×œ×•×™×” ×œ-AI)"
- × ×™×ª×Ÿ ×œ×¢×¨×•×š ×•×œ××—×•×§ (×¨×§ ×”×¢×¨×•×ª ×™×“× ×™×•×ª, ×œ× AI)
- ×œ×œ× ×§×‘×¦×™× - ×˜×§×¡×˜ ×‘×œ×‘×“ ×œ×©××™×¨×” ×¢×œ ×‘×™×¦×•×¢×™×

## ×§×‘×¦×™× ×©×”×©×ª× ×•

### Frontend
- `client/src/pages/Leads/LeadDetailPage.tsx`
  - ×”×•×¡×¤×ª ×˜××‘ "×©×™×¨×•×ª ×œ×§×•×—×•×ª AI"
  - ×©×™× ×•×™ ×˜××‘ "×”×¢×¨×•×ª" ×œ"×”×¢×¨×•×ª ×—×•×¤×©×™×•×ª"
  - ×§×•××¤×•× × ×˜×” ×—×“×©×”: `AINotesTab`
  - ×¢×“×›×•×Ÿ `NotesTab` ×œ×¡×™× ×•×Ÿ ×”×¢×¨×•×ª ×™×“× ×™×•×ª ×‘×œ×‘×“
  - ×¡×˜×™×™×œ×™× ×’ ×©×•× ×” ×œ×›×œ ×¡×•×’ ×”×¢×¨×”

### Backend
- `server/tasks_recording.py`
  - ×©×™×¤×•×¨ ×™×¦×™×¨×ª ×¡×™×›×•× ×©×™×—×” ×¢×‘×•×¨ ×”×¢×¨×•×ª
  - ×”×•×¡×¤×ª × ×™×ª×•×— ×›×•×•× ×”, ×¡× ×˜×™×× ×˜ ×•×¤×¢×•×œ×” ×”×‘××”
  - ×©××™×¨×ª structured_data ×œ××¢×§×‘ ×˜×•×‘ ×™×•×ª×¨
  
- `server/media_ws_ai.py`
  - ×¢×“×›×•×Ÿ ×¡×™×›×•× ×–×× ×™ ×‘×–××Ÿ ×©×™×—×”
  - ×”×•×¡×¤×ª ×”×¢×¨×” ×¢×œ ×¡×™×›×•× ××¤×•×¨×˜ ×©×™×ª×•×•×¡×£

## ××™×š ×–×” ×¢×•×‘×“?

### ×–×¨×™××ª ×™×¦×™×¨×ª ×¡×™×›×•× ×©×™×—×”

1. **×‘××”×œ×š ×”×©×™×—×”** (`media_ws_ai.py`):
   - × ×•×¦×¨ ×¡×™×›×•× ×–×× ×™ ×§×¦×¨ (300 ×ª×•×•×™×)
   - × ×©××¨ ×›×”×¢×¨×ª `call_summary`

2. **××—×¨×™ ×”×©×™×—×”** (`tasks_recording.py`):
   - ×”-Offline Worker ××¢×‘×“ ××ª ×”×”×§×œ×˜×”
   - ×™×•×¦×¨ ×ª××œ×™×œ Whisper ××™×›×•×ª×™
   - ×× ×ª×— ×¢× `generate_conversation_summary`
   - ×™×•×¦×¨ ×¡×™×›×•× ×××•×§×“ ×©×™×¨×•×ª ×œ×§×•×—×•×ª
   - ×©×•××¨ ×¢× structured_data ××œ×

3. **×‘×©×™×—×” ×”×‘××”** (`tools_crm_context.py`):
   - ×”-AI ××•×©×š ××ª ×›×œ ×”×”×¢×¨×•×ª ××”×œ×™×“
   - ×¨×•××” ×¡×™×›×•××™ ×©×™×—×•×ª ×§×•×“××•×ª
   - ×¨×•××” ×”×¢×¨×•×ª ×™×“× ×™×•×ª ×©×œ ×”×¢×¡×§
   - ××©×ª××© ×‘××™×“×¢ ×œ×©×™×¨×•×ª ×˜×•×‘ ×™×•×ª×¨

## ×“×•×’××” ×œ××¡×š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ×˜××‘×™×:                                  â”‚
â”‚ [×¡×§×™×¨×”] [×•×•××˜×¡××¤] [×©×™×—×•×ª] [××™×™×œ]      â”‚
â”‚ [×¤×’×™×©×•×ª] [××©×™××•×ª]                      â”‚
â”‚ â–º [×©×™×¨×•×ª ×œ×§×•×—×•×ª AI] [×”×¢×¨×•×ª ×—×•×¤×©×™×•×ª]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“± ×©×™×¨×•×ª ×œ×§×•×—×•×ª AI                     â”‚
â”‚ ğŸ’¡ ×”×¢×¨×•×ª ×›××Ÿ ×’×œ×•×™×•×ª ×œ-AI               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœï¸ ×”×•×¡×£ ×”×¢×¨×” ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª            â”‚
â”‚ [AI ×™×¨××” ××ª ×–×”]                        â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ×œ×§×•×— ××¢×“×™×£ ×¤×’×™×©×•×ª ×‘×‘×•×§×¨...         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          [×”×•×¡×£ ×”×¢×¨×” +] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ ×”×¢×¨×” ×™×“× ×™×ª (×’×œ×•×™×” ×œ-AI)            â”‚
â”‚ ×œ×§×•×— VIP - ×˜×™×¤×•×œ ××™×•×—×“                 â”‚
â”‚                           18/01 15:30    â”‚
â”‚                     [âœï¸ ×¢×¨×•×š] [ğŸ—‘ï¸ ××—×§] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ ×¡×™×›×•× ×©×™×—×” (AI)                     â”‚
â”‚ ×ª×•×¦××”: appointment_set                 â”‚
â”‚                                         â”‚
â”‚ ğŸ’¬ ×”×œ×§×•×— ××¢×•× ×™×™×Ÿ ×‘×“×™×¨×ª 3 ×—×“×¨×™×...    â”‚
â”‚ ğŸ¯ ×¨×•×¦×” ×œ×§×‘×•×¢ ×¤×’×™×©×”                   â”‚
â”‚ ğŸ“‹ ×”××©×š: ×ª×™××•× ×¤×’×™×©×” ×“×—×•×£              â”‚
â”‚ ğŸ˜Š ×¡× ×˜×™×× ×˜: positive                   â”‚
â”‚                                         â”‚
â”‚ â±ï¸ 120 ×©× ×™×•×ª                           â”‚
â”‚                           18/01 15:25    â”‚
â”‚            ×œ× × ×™×ª×Ÿ ×œ×¢×¨×•×š ×”×¢×¨×•×ª AI      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ×‘×“×™×§×•×ª × ×“×¨×©×•×ª

- [ ] ×¤×ª×™×—×ª ×“×£ ×œ×™×“ ×•×‘×“×™×§×ª ×©× ×™ ×”×˜××‘×™×
- [ ] ×”×•×¡×¤×ª ×”×¢×¨×” ×™×“× ×™×ª ×‘×˜××‘ AI
- [ ] ×•×™×“×•× ×©××™×Ÿ ×›×¤×ª×•×¨ ×”×¢×œ××ª ×§×‘×¦×™× ×‘×˜××‘ AI
- [ ] ×”×•×¡×¤×ª ×”×¢×¨×” ×¢× ×§×•×‘×¥ ×‘×˜××‘ ×”×¢×¨×•×ª ×—×•×¤×©×™×•×ª
- [ ] ×¡×™××•×œ×¦×™×™×ª ×©×™×—×” × ×›× ×¡×ª ×•×‘×“×™×§×ª ×”×¡×™×›×•× ×©× ×•×¦×¨
- [ ] ×•×™×“×•× ×©×”×¢×¨×•×ª ×™×“× ×™×•×ª ×‘×˜××‘ AI ×’×œ×•×™×•×ª ×œ-AI ×‘×©×™×—×” ×”×‘××”

## ×”×¢×¨×•×ª ×˜×›× ×™×•×ª

### ×¡×™× ×•×Ÿ ×”×¢×¨×•×ª
```typescript
// AI Tab - shows AI summaries + manual notes without files
const aiNotes = response.notes.filter(note => 
  note.note_type === 'call_summary' || 
  note.note_type === 'system' ||
  (note.note_type === 'manual' && (!note.attachments || note.attachments.length === 0))
);

// Free Notes Tab - shows only manual notes (with or without files)
const manualNotes = response.notes.filter(note => 
  !note.note_type || note.note_type === 'manual'
);
```

### AI Context Retrieval
```python
# In tools_crm_context.py
notes_query = LeadNote.query.filter_by(
    lead_id=input.lead_id,
    tenant_id=input.business_id
).order_by(LeadNote.created_at.desc()).limit(10)

# Returns ALL notes - manual and AI-generated
# This means manual notes in AI tab ARE visible to the AI
```

## ×¡×™×›×•×

×”××¢×¨×›×ª ×¢×›×©×™×• ××¡×¤×§×ª:
1. âœ… ×©× ×™ ×˜××‘×™× × ×¤×¨×“×™× ×¢× ××˜×¨×•×ª ×‘×¨×•×¨×•×ª
2. âœ… ×¡×™×›×•××™ ×©×™×—×•×ª ××©×•×¤×¨×™× ×××•×§×“×™ ×©×™×¨×•×ª ×œ×§×•×—×•×ª
3. âœ… ××¤×©×¨×•×ª ×œ×¢×¡×§ ×œ×”×•×¡×™×£ ×”×§×©×¨ ×™×“× ×™ ×œ-AI
4. âœ… ×”×¤×¨×“×” ×‘×™×Ÿ ×”×¢×¨×•×ª ×¢× ×§×‘×¦×™× ×œ×”×¢×¨×•×ª ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª
5. âœ… ×›×œ ×”×¢×¨×” ××¡×•×× ×ª ×‘×‘×™×¨×•×¨ - AI ××• ×™×“× ×™×ª
