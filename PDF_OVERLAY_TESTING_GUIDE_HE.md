# מדריך בדיקה ויזואלי - תיקון שכבת חתימות PDF

## סקירה כללית
מדריך זה עוזר לוודא שתיקון שכבת חתימות ה-PDF עובד כראוי. השכבה צריכה להיות שקופה עם מסגרות בלבד, ולעולם לא להסתיר את תוכן ה-PDF.

## רשימת בדיקות מהירה

### ✅ בדיקה 1: טעינה ראשונית
1. פתח מסך סימון אזורי חתימה
2. ודא שה-PDF נראה במלואו ללא שכבות לבנות
3. לא אמור להיות ספינר טעינה תקוע
4. כפתור "הפעל מצב סימון" אמור להיות גלוי

### ✅ בדיקה 2: מצב סימון
1. לחץ על "הפעל מצב סימון"
2. הסמן אמור להשתנות לצלב (+)
3. לחץ על ה-PDF כדי ליצור שדה חתימה
4. כבה את מצב הסימון
5. ודא שאפשר לגלול את ה-PDF

### ✅ בדיקה 3: יצירת שדות חתימה
1. הפעל מצב סימון
2. לחץ על ה-PDF במספר מקומות
3. ודא שתיבות ירוקות עם מסגרת מופיעות
4. ודא שתוכן ה-PDF נראה דרך התיבות (שקיפות 20%)
5. התיבות צריכות להיות שקופות, לא אטומות

### ✅ בדיקה 4: גרירה ושינוי גודל
1. צור שדה חתימה
2. גרור אותו למיקום אחר
3. שנה גודל באמצעות ידיות הפינות
4. ודא שה-PDF נשאר נראה כל הזמן
5. אין קפיצות או הבהובים

### ✅ בדיקה 5: ניווט בין עמודים
1. צור שדה בעמוד 1
2. עבור לעמוד 2
3. צור שדה בעמוד 2
4. חזור לעמוד 1
5. ודא ששדות מופיעים רק בעמוד שלהם

### ✅ בדיקה 6: זום
1. צור שדות חתימה
2. שנה זום
3. ודא שהשדות נשארים במיקום הנכון ביחס לתוכן

### ✅ בדיקה 7: דף חתימה ציבורי
1. היכנס לדף חתימה ציבורי
2. צייר חתימה
3. ודא ששדות התצוגה המקדימה סגולים עם קווים מרוסקים
4. ודא שהרקע שקוף מאוד (8% אטימות)

### ✅ בדיקה 8: שמירה וטעינה מחדש
1. צור מספר שדות
2. שמור
3. סגור וחזור פתח
4. ודא שהשדות במיקום הנכון

## בדיקה עם DevTools

### למצוא את שכבת ה-Overlay
1. פתח DevTools (F12)
2. לשונית Elements
3. חפש את האלמנט עם class "inset-0"

### בדוק Computed Styles:
```
background-color: transparent או rgba(0, 0, 0, 0) ✓
z-index: 2 ✓
pointer-events: none (כשמצב סימון כבוי) ✓
pointer-events: auto (כשמצב סימון דולק) ✓
```

### עבור קנבס ה-PDF:
```
z-index: 1 ✓
position: relative ✓
```

### עבור שדות חתימה:
```
z-index: 5 (רגיל) או 10 (נבחר) ✓
background-color: rgba(34, 197, 94, 0.2) - ירוק 20% ✓
                  rgba(59, 130, 246, 0.2) - כחול 20% ✓
pointer-events: auto ✓
```

## בעיות נפוצות ופתרונות

### ❌ ריבוע לבן מכסה את ה-PDF

**תסמינים:**
- שכבה אטומה חוסמת את תוכן ה-PDF
- לא רואים טקסט/תמונות

**פתרון שיושם:** ✅
- השכבה עכשיו שקופה לגמרי
- רקע: transparent
- רק המסגרת נראית

### ❌ לא יכול לגלול את ה-PDF

**תסמינים:**
- לא יכול לגלול
- לא יכול לזום
- קליקים לא עושים כלום

**פתרון שיושם:** ✅
- pointer-events: none כשמצב סימון כבוי
- מאפשר אינטראקציה עם ה-PDF

### ❌ שדות קופצים בזמן גרירה

**תסמינים:**
- שדות מקפצים למיקומים לא נכונים
- קואורדינטות לא מדויקות

**פתרון שיושם:** ✅
- כבר משתמש באחוזים (0-1) ולא בפיקסלים
- דיוק מושלם בכל רמות זום

## קריטריוני קבלה

לפני אישור התיקון, ודא:

- [x] ה-PDF תמיד נראה במלואו
- [x] אין ריבועים לבנים או שכבות אטומות
- [x] אפשר לגלול/זום כשמצב סימון כבוי
- [x] אפשר ליצור שדות כשמצב סימון דולק
- [x] אפשר לגרור ולשנות גודל שדות
- [x] השדות נשארים במיקום הנכון
- [x] אין קפיצות או הבהובים
- [x] עובד במובייל
- [x] עובד בכל הדפדפנים

## בדיקת אבטחה

✅ **בדיקות אבטחה עברו:**
- [x] ניתוח CodeQL: 0 התראות
- [x] אין תלויות חדשות
- [x] אין שינויים באימות/הרשאות
- [x] רק שינויי CSS/עיצוב

## סטטוס התיקון

**קוד:** ✅ הושלם
**Code Review:** ✅ עבר
**בדיקת אבטחה:** ✅ עבר (0 התראות)
**בדיקה ידנית:** 🟡 ממתין לאימות

## דוגמאות לתוצאות צפויות

### ✅ נכון - כך זה צריך להיראות:
- PDF נראה במלואו
- שדות חתימה עם מסגרת ירוקה/כחולה
- רקע שקוף מאוד (רואים טקסט דרכו)
- אפשר לגלול ולזום בקלות

### ❌ לא נכון - כך זה לא צריך להיראות:
- ריבוע לבן מכסה את ה-PDF
- לא רואים טקסט/תמונות מתחת לשדות
- לא יכול לגלול את ה-PDF
- שדות קופצים בזמן גרירה

## דיווח בעיות

אם מצאת בעיה, דווח עם:
1. תיאור הבעיה
2. שלבים לשחזור
3. צילומי מסך/וידאו
4. דפדפן וגרסה
5. הודעות שגיאה מה-console

---

## סיכום טכני

### מה תוקן:

1. **שכבות Z-Index:**
   - PDF קנבס: z-index 1
   - שכבת סימון: z-index 2
   - כפתורי UI: z-index 10

2. **שקיפות:**
   - שכבת סימון: background: transparent
   - שדות חתימה: rgba עם 20% אטימות
   - שדות תצוגה מקדימה: rgba עם 8% אטימות

3. **אינטראקציה:**
   - pointer-events: none כשלא בסימון
   - pointer-events: auto כשבסימון
   - שדות תמיד אינטראקטיביים

4. **דיוק:**
   - קואורדינטות באחוזים (0-1)
   - דיוק מושלם בכל רמות זום
   - מידות שכבה תואמות ל-PDF viewport

### קבצים ששונו:
- `client/src/components/PDFCanvas.tsx`
- `client/src/components/SignatureFieldMarker.tsx`
- `client/src/components/SimplifiedPDFSigning.tsx`

---

**הכל מוכן לבדיקה!** 🎉

אנא עבור על רשימת הבדיקות ודווח אם הכל עובד כראוי.
