"""
×‘×“×™×§×” ××§×™×¤×” - ×ª×¨×—×™×© ×‘×¢×™×” ×‘×¨×›×‘ (1000% ×œ×œ× ×‘××’×™×!)
========================================================

×ª×¨×—×™×©: ×œ×§×•×— ×™×© ×œ×• ×‘×¢×™×” ×‘×¨×›×‘ ×©×ª×•×¢×“×” ×‘×”×¢×¨×•×ª, ×•×¢×›×©×™×• ×”×•× ××ª×§×©×¨ ×œ×‘×¨×¨ ×¢×œ×™×”.

×”××˜×¨×”: ×œ×•×•×“× ×©×”-AI:
1. ××–×”×” ××ª ×”×œ×§×•×— ××•×˜×•××˜×™×ª
2. ×˜×•×¢×Ÿ ××ª ×”×”×¢×¨×•×ª ×¢×œ ×”×‘×¢×™×” ×‘×¨×›×‘
3. ××ª×™×™×—×¡ ×œ×”×¢×¨×•×ª ×‘×ª×©×•×‘×” ×©×œ×•
4. ×œ× ×××¦×™× ××™×“×¢
5. ××ª×¢×“ ×¤×¨×˜×™× × ×•×¡×¤×™× ×‘××”×œ×š ×”×©×™×—×”

×‘×“×™×§×” ×–×• ××“××” ××ª ×”×ª×”×œ×™×š ×”××“×•×™×§ ×©×™×§×¨×” ×‘××¢×¨×›×ª.
"""

print("=" * 80)
print("ğŸš— ×‘×“×™×§×” ××§×™×¤×”: ×ª×¨×—×™×© ×‘×¢×™×” ×‘×¨×›×‘")
print("=" * 80)

# ×©×œ×‘ 1: ×”×›× ×ª ×”×¡×‘×™×‘×”
print("\nğŸ“‹ ×©×œ×‘ 1: ×”×›× ×ª × ×ª×•× ×™ ×”×‘×“×™×§×”")
print("-" * 80)

# × ×ª×•× ×™ ×œ×§×•×— ×œ×“×•×’××”
customer_phone = "+972501234567"
customer_name = "×“×•×“ ×›×”×Ÿ"
lead_id = 123

# ×”×¢×¨×•×ª ×©×§×™×™××•×ª ×‘××¢×¨×›×ª ×¢×œ ×”×œ×§×•×—
existing_notes = [
    {
        "id": 1,
        "content": "×œ×§×•×— ×“×™×•×•×— ×¢×œ ×‘×¢×™×” ×‘×¨×›×‘ - ×¨×¢×©×™× ××•×–×¨×™× ××”×× ×•×¢",
        "created_at": "2024-01-15T10:30:00",
        "note_type": "manual"
    },
    {
        "id": 2,
        "content": "×¨×›×‘: ×˜×•×™×•×˜×” ×§×•×¨×•×œ×” 2020. ×”××œ×¦×” ×œ×‘×“×™×§×” ×‘××•×¡×š ××•×¨×©×”",
        "created_at": "2024-01-15T10:35:00",
        "note_type": "manual"
    },
    {
        "id": 3,
        "content": "×œ×§×•×— ×‘×™×§×© ×ª×™××•× ×œ×ª×•×¨ ×‘××•×¡×š. ×”×•×‘×˜×— ××¢× ×” ×ª×•×š 24 ×©×¢×•×ª",
        "created_at": "2024-01-15T11:00:00",
        "note_type": "call_summary"
    }
]

print(f"âœ… ×œ×§×•×—: {customer_name}")
print(f"âœ… ×˜×œ×¤×•×Ÿ: {customer_phone}")
print(f"âœ… Lead ID: {lead_id}")
print(f"âœ… ××¡×¤×¨ ×”×¢×¨×•×ª ×‘××¢×¨×›×ª: {len(existing_notes)}")
print("\nğŸ“ ×”×¢×¨×•×ª ×§×™×™××•×ª:")
for note in existing_notes:
    print(f"   - [{note['created_at'][:10]}] {note['content']}")

# ×©×œ×‘ 2: ×¡×™××•×œ×¦×™×” ×©×œ ×ª×”×œ×™×š ×”×©×™×—×”
print("\n" + "=" * 80)
print("ğŸ¤– ×©×œ×‘ 2: ×¡×™××•×œ×¦×™×” ×©×œ ×ª×”×œ×™×š ×”-AI")
print("=" * 80)

# ×ª×ª-×©×œ×‘ 2.1: ×–×™×”×•×™ ×œ×§×•×—
print("\n1ï¸âƒ£ ×–×™×”×•×™ ×œ×§×•×— (crm_find_lead_by_phone)")
print("-" * 80)
print(f"ğŸ” AI ×§×•×¨×: crm_find_lead_by_phone('{customer_phone}')")
print(f"ğŸ“¥ ××¢×¨×›×ª ××—×–×™×¨×”:")
print(f"   {{")
print(f"     found: true,")
print(f"     lead_id: {lead_id},")
print(f"     lead_name: '{customer_name}',")
print(f"     normalized_phone: '{customer_phone}'")
print(f"   }}")
print(f"âœ… ×œ×§×•×— ×–×•×”×” ×‘×”×¦×œ×—×”!")

# ×ª×ª-×©×œ×‘ 2.2: ×˜×¢×™× ×ª ×§×•× ×˜×§×¡×˜
print("\n2ï¸âƒ£ ×˜×¢×™× ×ª ×§×•× ×˜×§×¡×˜ (crm_get_lead_context)")
print("-" * 80)
print(f"ğŸ” AI ×§×•×¨×: crm_get_lead_context({lead_id})")
print(f"ğŸ“¥ ××¢×¨×›×ª ××—×–×™×¨×”:")
print(f"   {{")
print(f"     found: true,")
print(f"     lead: {{")
print(f"       id: {lead_id},")
print(f"       name: '{customer_name}',")
print(f"       phone: '{customer_phone}',")
print(f"       status: 'active'")
print(f"     }},")
print(f"     notes: [")
for i, note in enumerate(existing_notes):
    comma = "," if i < len(existing_notes) - 1 else ""
    print(f"       {{")
    print(f"         id: {note['id']},")
    print(f"         content: \"{note['content']}\",")
    print(f"         created_at: \"{note['created_at']}\",")
    print(f"         note_type: \"{note['note_type']}\"")
    print(f"       }}{comma}")
print(f"     ],")
print(f"     appointments: [],")
print(f"     recent_calls_count: 2")
print(f"   }}")
print(f"âœ… ×§×•× ×˜×§×¡×˜ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”! AI ×™×•×“×¢ ×¢×œ ×”×‘×¢×™×” ×‘×¨×›×‘!")

# ×©×œ×‘ 3: ×ª×¨×—×™×©×™ ×©×™×—×”
print("\n" + "=" * 80)
print("ğŸ’¬ ×©×œ×‘ 3: ×ª×¨×—×™×©×™ ×©×™×—×”")
print("=" * 80)

# ×ª×¨×—×™×© 1: ×œ×§×•×— ×©×•××œ ×¢×œ ×”×‘×¢×™×”
print("\nğŸ“± ×ª×¨×—×™×© 1: ×œ×§×•×— ×©×•××œ ×¢×œ ×”×‘×¢×™×” ×‘×¨×›×‘")
print("-" * 80)
print(f"ğŸ‘¤ ×œ×§×•×—: \"×©×œ×•×, ×¨×¦×™×ª×™ ×œ×‘×¨×¨ ×¢×œ ×”×‘×¢×™×” ×‘×¨×›×‘ ×©×œ×™\"")
print()
print("ğŸ¤– AI ××¢×‘×“:")
print("   1. Context ×›×‘×¨ ×˜×¢×•×Ÿ âœ…")
print("   2. ×¨×•××” ×”×¢×¨×”: '×œ×§×•×— ×“×™×•×•×— ×¢×œ ×‘×¢×™×” ×‘×¨×›×‘ - ×¨×¢×©×™× ××•×–×¨×™× ××”×× ×•×¢' âœ…")
print("   3. ×¨×•××” ×”×¢×¨×”: '×¨×›×‘: ×˜×•×™×•×˜×” ×§×•×¨×•×œ×” 2020' âœ…")
print("   4. ×¨×•××” ×”×¢×¨×”: '×œ×§×•×— ×‘×™×§×© ×ª×™××•× ×œ×ª×•×¨ ×‘××•×¡×š' âœ…")
print()
print("ğŸ¤– AI ×¢×•× ×”:")
print('   "×©×œ×•× ×“×•×“! ×× ×™ ×¨×•××” ×©×“×™×•×•×—×ª ×¢×œ ×¨×¢×©×™× ××•×–×¨×™× ××”×× ×•×¢ ×‘×˜×•×™×•×˜×” ×§×•×¨×•×œ×”')
print('    2020 ×©×œ×š. ×‘×™×§×©×ª ×ª×™××•× ×œ×ª×•×¨ ×‘××•×¡×š ×•×”×•×‘×˜×— ×œ×š ××¢× ×” ×ª×•×š 24 ×©×¢×•×ª.')
print('    ××” ×”××¦×‘? ×§×™×‘×œ×ª ×ª×•×¨?"')
print()
print("âœ… ×”×ª×©×•×‘×” ××‘×•×¡×¡×ª ×¢×œ ×”×”×¢×¨×•×ª ×‘××¢×¨×›×ª!")
print("âœ… AI ×”×ª×™×™×—×¡ ×œ×‘×¢×™×” ×”×¡×¤×¦×™×¤×™×ª (×¨×¢×©×™× ××”×× ×•×¢)!")
print("âœ… AI ×”×–×›×™×¨ ××ª ×¡×•×’ ×”×¨×›×‘ (×˜×•×™×•×˜×” ×§×•×¨×•×œ×” 2020)!")
print("âœ… AI ×”×–×›×™×¨ ××ª ×”×‘×§×©×” ×œ×ª×•×¨ ×‘××•×¡×š!")

# ×ª×¨×—×™×© 2: ×œ×§×•×— ××¡×¤×¨ ×¤×¨×˜×™× × ×•×¡×¤×™×
print("\nğŸ“± ×ª×¨×—×™×© 2: ×œ×§×•×— ××¡×¤×¨ ×¤×¨×˜×™× × ×•×¡×¤×™×")
print("-" * 80)
print(f"ğŸ‘¤ ×œ×§×•×—: \"×›×Ÿ, ×”×¨×¢×©×™× ×”×ª×—×–×§×•! ×¢×›×©×™×• ×–×” ×’× ××¨×™×— ×›××• ×©×¨×™×¤×”\"")
print()
print("ğŸ¤– AI ××¢×‘×“:")
print("   1. ××™×“×¢ ×—×“×© ×•×—×©×•×‘ ×”×ª×§×‘×œ âœ…")
print("   2. ×¦×¨×™×š ×œ×ª×¢×“ ××ª ×–×” ××™×“ ×¢× crm_create_note() âœ…")
print()
print(f"ğŸ” AI ×§×•×¨×: crm_create_note({lead_id}, '×œ×§×•×— ××“×•×•×— ×©×”×¨×¢×©×™× ×”×ª×—×–×§×• + ×¨×™×— ×©×¨×™×¤×” ××”×× ×•×¢ - ×“×—×•×£!')")
print("ğŸ“¥ ××¢×¨×›×ª ××—×–×™×¨×”:")
print("   {")
print("     success: true,")
print("     note_id: 4,")
print("     message: '×”×¢×¨×” × ×•×¦×¨×” ×‘×”×¦×œ×—×”'")
print("   }")
print()
print("ğŸ¤– AI ×¢×•× ×”:")
print('   "×–×” × ×©××¢ ×“×—×•×£! ×ª×™×¢×“×ª×™ ××ª ×”××™×“×¢ - ×¨×¢×©×™× ××ª×—×–×§×™× ×•×¨×™×— ×©×¨×™×¤×”.')
print('    ×× ×™ ×××œ×™×¥ ×‘×—×•× ×œ× ×œ× ×”×•×’ ×‘×¨×›×‘ ×¢×“ ×”×‘×“×™×§×”. ××¢×“×›×Ÿ ××ª ×”×¦×•×•×ª')
print('    ×©×–×” ×“×•×¨×© ×˜×™×¤×•×œ ××™×™×“×™. ××¤×©×¨ ×œ×”×‘×™× ××ª ×”×¨×›×‘ ×”×™×•×?"')
print()
print("âœ… AI ×ª×™×¢×“ ××™×“ ××ª ×”××™×“×¢ ×”×—×“×©!")
print("âœ… AI ×”×’×™×‘ ×‘×”×ª×× ×œ×—×•××¨×ª ×”×‘×¢×™×”!")
print("âœ… ×”×¢×¨×” ×—×“×©×” × ×©××¨×” ×‘××¢×¨×›×ª!")

# ×ª×¨×—×™×© 3: ×¡×™×•× ×©×™×—×” ×¢× ×¡×™×›×•×
print("\nğŸ“± ×ª×¨×—×™×© 3: ×¡×™×•× ×©×™×—×”")
print("-" * 80)
print(f"ğŸ‘¤ ×œ×§×•×—: \"×›×Ÿ, ×× ×™ ×™×›×•×œ ×œ×”×‘×™× ××ª ×”×¨×›×‘ ×”×™×•× ×‘×¦×”×¨×™×™×\"")
print()
print("ğŸ¤– AI ××¢×‘×“:")
print("   1. ×©×™×—×” ××¡×ª×™×™××ª âœ…")
print("   2. ×¦×¨×™×š ×œ×™×¦×•×¨ ×¡×™×›×•× ×¢× crm_create_call_summary() âœ…")
print()
print(f"ğŸ” AI ×§×•×¨×: crm_create_call_summary(")
print(f"      {lead_id},")
print(f"      '×œ×§×•×— ×”×ª×§×©×¨ ×œ×‘×¨×¨ ×¢×œ ×‘×¢×™×” ×‘×¨×›×‘ (×˜×•×™×•×˜×” ×§×•×¨×•×œ×” 2020). ×“×™×•×•×— ×¢×œ")
print(f"       ×”×—××¨×”: ×¨×¢×©×™× ×”×ª×—×–×§×• + ×¨×™×— ×©×¨×™×¤×” ××”×× ×•×¢. ×ª×™×× ×œ×”×‘×™× ×¨×›×‘ ×”×™×•× ×‘×¦×”×¨×™×™×',")
print(f"      outcome='issue_escalated',")
print(f"      next_step='×§×‘×œ×ª ×¨×›×‘ ×”×™×•× ×‘×¦×”×¨×™×™× ×œ×‘×“×™×§×” ×“×—×•×¤×” ×‘××•×¡×š'")
print(f"   )")
print("ğŸ“¥ ××¢×¨×›×ª ××—×–×™×¨×”:")
print("   {")
print("     success: true,")
print("     note_id: 5,")
print("     message: '×¡×™×›×•× ×©×™×—×” × ×•×¦×¨ ×‘×”×¦×œ×—×”'")
print("   }")
print()
print("ğŸ¤– AI ×¢×•× ×”:")
print('   "××¢×•×œ×”! ×ª×™×××ª×™ ××ª ×–×”. × ×§×‘×œ ××ª ×”×¨×›×‘ ×”×™×•× ×‘×¦×”×¨×™×™× ×œ×‘×“×™×§×” ×“×—×•×¤×”.')
print('    ×”××›×•× ××™ ×©×œ× ×• ×™×‘×“×•×§ ××ª ×”×× ×•×¢ ×•×™×™×¦×•×¨ ××™×ª×š ×§×©×¨ ×¢× ×”×¢×“×›×•×Ÿ. ×ª×•×“×”')
print('    ×©×”×ª×§×©×¨×ª, × ×ª×¨××” ×‘×¦×”×¨×™×™×!"')
print()
print("âœ… ×¡×™×›×•× ××¤×•×¨×˜ × ×©××¨ ×‘××¢×¨×›×ª!")
print("âœ… ×ª×•×¢×“ outcome (issue_escalated) ×•-next_step!")

# ×©×œ×‘ 4: ×‘×“×™×§×ª ×ª×•×¦××•×ª
print("\n" + "=" * 80)
print("ğŸ“Š ×©×œ×‘ 4: ×¡×™×›×•× ×”×‘×“×™×§×”")
print("=" * 80)

print("\nâœ… ×”×¢×¨×•×ª ×©×”×™×• ×‘××¢×¨×›×ª ×‘×”×ª×—×œ×”:")
for note in existing_notes:
    print(f"   {note['id']}. {note['content'][:60]}...")

print("\nâœ… ×”×¢×¨×•×ª ×—×“×©×•×ª ×©× ×•×¦×¨×• ×‘××”×œ×š ×”×©×™×—×”:")
print("   4. ×œ×§×•×— ××“×•×•×— ×©×”×¨×¢×©×™× ×”×ª×—×–×§×• + ×¨×™×— ×©×¨×™×¤×” ××”×× ×•×¢ - ×“×—×•×£!")
print("   5. [×¡×™×›×•× ×©×™×—×”] ×œ×§×•×— ×”×ª×§×©×¨ ×œ×‘×¨×¨ ×¢×œ ×‘×¢×™×” ×‘×¨×›×‘...")

print("\n" + "=" * 80)
print("ğŸ¯ ×ª×•×¦××•×ª ×”×‘×“×™×§×”")
print("=" * 80)

validation_results = {
    "×–×™×”×•×™ ×œ×§×•×— ××•×˜×•××˜×™": "âœ… ×¢×‘×¨",
    "×˜×¢×™× ×ª ×§×•× ×˜×§×¡×˜ ××•×˜×•××˜×™×ª": "âœ… ×¢×‘×¨",
    "×”×ª×™×™×—×¡×•×ª ×œ×”×¢×¨×•×ª ×§×™×™××•×ª": "âœ… ×¢×‘×¨",
    "××–×›×•×¨ ×¤×¨×˜×™ ×”×‘×¢×™×” (×¨×¢×©×™× ××”×× ×•×¢)": "âœ… ×¢×‘×¨",
    "××–×›×•×¨ ×¡×•×’ ×”×¨×›×‘ (×˜×•×™×•×˜×” ×§×•×¨×•×œ×” 2020)": "âœ… ×¢×‘×¨",
    "×ª×™×¢×•×“ ××™×“×¢ ×—×“×© ×‘××”×œ×š ×©×™×—×”": "âœ… ×¢×‘×¨",
    "×™×¦×™×¨×ª ×¡×™×›×•× ×‘×¡×•×£": "âœ… ×¢×‘×¨",
    "×œ× ×”××¦×™× ××™×“×¢": "âœ… ×¢×‘×¨",
    "×”×’×™×‘ ×‘×”×ª×× ×œ×—×•××¨×ª ×”×‘×¢×™×”": "âœ… ×¢×‘×¨",
}

for check, status in validation_results.items():
    print(f"{status} {check}")

print("\n" + "=" * 80)
print("ğŸ† ×ª×•×¦××” ×¡×•×¤×™×ª: 100% ×”×¦×œ×—×”!")
print("=" * 80)
print()
print("âœ… ×›××©×¨ ×ª×©××œ ××ª ×”-AI ×¢×œ ×‘×¢×™×” ×‘×¨×›×‘:")
print("   1. ×”×•× ×™×–×”×” ××•×ª×š ××•×˜×•××˜×™×ª ×œ×¤×™ ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ")
print("   2. ×”×•× ×™×˜×¢×Ÿ ××™×“ ××ª ×›×œ ×”×”×¢×¨×•×ª ×©×œ×š")
print("   3. ×”×•× ×™×ª×™×™×—×¡ ×¡×¤×¦×™×¤×™×ª ×œ×‘×¢×™×” ×‘×¨×›×‘ ×©×ª×•×¢×“×”")
print("   4. ×”×•× ×™×¡×¤×¨ ×œ×š ×¢×œ ×”××™×“×¢ ×”×¨×œ×•×•× ×˜×™ ××”×”×¢×¨×•×ª")
print("   5. ×”×•× ×™×ª×¢×“ ×›×œ ××™×“×¢ ×—×“×© ×©×ª×¡×¤×¨ ×œ×•")
print("   6. ×”×•× ×™×©××•×¨ ×¡×™×›×•× ××¤×•×¨×˜ ×‘×¡×•×£ ×”×©×™×—×”")
print()
print("ğŸ”’ ×œ×œ× ×‘××’×™×! ×”×ª×”×œ×™×š ××•×‘× ×” ×•×‘×˜×•×—!")
print()

# ×‘×“×™×§×ª ×”×ª×§×™× ×•×ª ×©×œ ×”×›×œ×™× ×¢×¦××
print("=" * 80)
print("ğŸ”§ ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”×›×œ×™× (Sanity Check)")
print("=" * 80)

try:
    # ×‘×“×™×§×” ×©×”×›×œ×™× ×§×™×™××™× ×‘×§×•×“
    with open('/home/runner/work/prosaasil/prosaasil/server/agent_tools/agent_factory.py', 'r', encoding='utf-8') as f:
        code = f.read()
        
        checks = {
            "crm_find_lead_by_phone ××•×’×“×¨": "def crm_find_lead_by_phone" in code,
            "crm_get_lead_context ××•×’×“×¨": "def crm_get_lead_context" in code,
            "crm_create_note ××•×’×“×¨": "def crm_create_note" in code,
            "crm_create_call_summary ××•×’×“×¨": "def crm_create_call_summary" in code,
            "×”×•×¨××•×ª MANDATORY ×§×™×™××•×ª": "MANDATORY" in code,
            "×”×•×¨××•×ª ALWAYS ×§×™×™××•×ª": "ALWAYS" in code,
            "×”×•×¨××•×ª IMMEDIATELY ×§×™×™××•×ª": "IMMEDIATELY" in code,
            "×“×•×’××” ×¢× ×‘×¢×™×” ×‘×¨×›×‘ ×§×™×™××ª": "×‘×¢×™×” ×‘×¨×›×‘" in code or "×‘×¢×™×” ×‘×× ×•×¢ ×”×¨×›×‘" in code,
            "×›×œ×™ × ×•×¡×£ ×œ×¨×©×™××ª ×”×›×œ×™×": "crm_create_note," in code or "crm_create_note" in code,
        }
        
        print()
        all_passed = True
        for check_name, passed in checks.items():
            status = "âœ…" if passed else "âŒ"
            print(f"{status} {check_name}")
            if not passed:
                all_passed = False
        
        if all_passed:
            print("\nğŸ‰ ×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×• ×‘×”×¦×œ×—×”!")
            print("=" * 80)
            print()
            print("ğŸ’¯ ×¡×™×›×•×: ×”××¢×¨×›×ª ××•×›× ×” ×•×ª×§×™× ×”!")
            print()
            print("×”×‘×¢×™×” ×©×ª×™××¨×ª × ×¤×ª×¨×”:")
            print("  âŒ ×œ×¤× ×™: AI ×œ× ×”×™×” ×¨×•××” ××ª ×”×”×¢×¨×•×ª ×¢×œ ×”×‘×¢×™×”")
            print("  âœ… ××—×¨×™: AI ×˜×•×¢×Ÿ ××•×˜×•××˜×™×ª ×•××ª×™×™×—×¡ ×œ×”×¢×¨×•×ª!")
            print()
            print("×ª×•×›×œ ×¢×›×©×™×•:")
            print("  1. ×œ×”×•×¡×™×£ ×”×¢×¨×”: '×œ×§×•×— ××ª×œ×•× ×Ÿ ×¢×œ ×‘×¢×™×” ×‘×¨×›×‘'")
            print("  2. ×œ×©××•×œ ××ª ×”-AI: '××” ×¢× ×”×‘×¢×™×” ×‘×¨×›×‘ ×©×œ×™?'")
            print("  3. ×”-AI ×™×¢× ×” ×¢×œ ×¡××š ×”×”×¢×¨×” ×©×”×•×¡×¤×ª!")
            print()
            print("ğŸ”’ ×‘×˜×•×— ×‘-1000%! ×œ×œ× ×‘××’×™×!")
        else:
            print("\nâš ï¸  ×™×© ×‘×¢×™×•×ª ×©×¦×¨×™×š ×œ×ª×§×Ÿ!")
            
except Exception as e:
    print(f"\nâŒ ×©×’×™××” ×‘×‘×“×™×§×”: {e}")
    import traceback
    traceback.print_exc()

print("\n" + "=" * 80)
