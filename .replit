# .replit — FIXED

# כפתור Run בסביבה (אל תתקין כאן npm/baileys)
run = """
bash -lc '
  export EVENTLET_NO_GREENDNS=1
  export EVENTLET_HUB=select
  python3 -m gunicorn wsgi:app -k eventlet -w 1 -b 0.0.0.0:$PORT \
    --timeout 120 --keep-alive 75 --log-level info \
    --access-logfile - --error-logfile -
'
"""

[deployment]
deploymentTarget = "autoscale"
build = [
  "bash", "-lc", "python3 -m pip install -U pip && pip install -r requirements.txt"
]
run = """
bash -lc '
  export EVENTLET_NO_GREENDNS=1
  export EVENTLET_HUB=select
  python3 -m gunicorn wsgi:app -k eventlet -w 1 -b 0.0.0.0:$PORT \
    --timeout 120 --keep-alive 75 --log-level info \
    --access-logfile - --error-logfile -
'
"""

# אל תקבע PORT ידנית! Replit מזריקה אותו.
[env]
PYTHONUNBUFFERED = "1"
PYTHONPATH = "."

# Nix (ה־OS) — מוסיפים Python 3.11 ו-Node 20, כדי שלא תקבל "python3: command not found"
[nix]
channel = "stable-25_05"
packages = [
  "python311Full",
  "nodejs_20",
  "postgresql_16",
  "ffmpeg-full",
  "openssl",
  "pkg-config",
  "iproute2",
  "nettools",
  "zlib"
]

# אין צורך במקטע [[ports]] בסביבת autoscale של Replit — מחק אם היה.