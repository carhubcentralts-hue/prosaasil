
prosaas-backend  | âœ… All businesses have owners!
prosaas-backend  | âœ… User ownership check completed
prosaas-backend  | âœ… Database initialization completed successfully!
prosaas-backend  | ğŸ“§ Admin login: admin@admin.com / admin123
prosaas-backend  | ğŸ¢ Business ID: 1
prosaas-backend  | INFO:     172.18.0.5:58336 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:58350 - "GET /api/auth/me HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ” LOGIN ATTEMPT: email=calliber@gmail.com
prosaas-backend  | âœ“ Found user: id=10, email=calliber@gmail.com, role=owner
prosaas-backend  | âœ“ Password hash: scrypt:32768:8:1$NwJjYhcFJjcNjejm$9cc6e19d7dbac0ba...
prosaas-backend  | âœ“ Password verification result: True
prosaas-backend  | ğŸ” LOGIN SUCCESS: user_id=10, email=calliber@gmail.com, role=owner, business_id=10
prosaas-backend  | INFO:     172.18.0.5:58366 - "POST /api/auth/login HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:58368 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.5:58380 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:58390 - "GET /api/admin/businesses?pageSize=1 HTTP/1.1" 403 Forbidden
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:58394 - "GET /api/dashboard/stats?time_filter=today HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:58408 - "GET /api/dashboard/activity?time_filter=today HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:55694 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:55702 - "GET /api/admin/businesses?pageSize=1 HTTP/1.1" 403 Forbidden
prosaas-backend  | INFO:     127.0.0.1:36978 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:55718 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:58472 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:58480 - "GET /api/business/current/prompt HTTP/1.1" 200 OK
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CA53450c2e52814e1b57227b43ca0c33ba
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CA53450c2e52814e1b57227b43ca0c33ba
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CA53450c2e52814e1b57227b43ca0c33bağŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1470ms - CA53450c2e52814e
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CA53450c2e52814e1b57227b43ca0c33ba" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.5:42428 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | INFO:     172.18.0.5:42434 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-7e9b14d0
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764878056.959] WS_START sid=MZcf8ee1d4f760b1e812756ca84c03aa5b call_sid=CA53450c2e52814e1b57227b43ca0c33ba from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CA53450c (FRESH SESSION)
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 464ms (T0+469ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 1022ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1133ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CA53450c2e52814e1b57227b43ca0c33ba
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764878058.094] STORING GREETING FOR REALTIME!
prosaas-backend  | 
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1135ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=8.0, threshold=108.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 669ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | âŒ [REALTIME] Async error: OpenAIRealtimeClient.configure_session() got an unexpected keyword argument 'prefix_padding_ms'
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/media_ws_ai.py", line 1561, in _run_realtime_mode_async
prosaas-backend  |     await client.configure_session(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  | TypeError: OpenAIRealtimeClient.configure_session() got an unexpected keyword argument 'prefix_padding_ms'
prosaas-backend  | INFO:     172.18.0.5:42438 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | âœ… Call log already exists for CA53450c2e52814e1b57227b43ca0c33ba
prosaas-backend  | âœ… Recording started for CA53450c2e52814e1b57227b43ca0c33ba: RE4187e22cf96d011c2e76111094c427f4
prosaas-backend  | ğŸ”Œ [REALTIME] Disconnected
prosaas-backend  | ğŸ”š [REALTIME] Thread ended for call CA53450c
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=700.0 > threshold=108.0
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.6s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=25280 | silence_ms=513
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.5:42448 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.5s audio, conversation #1
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=24000 | silence_ms=515
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #1
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=203.0 > threshold=108.0
prosaas-backend  | WS_STOP sid=MZcf8ee1d4f760b1e812756ca84c03aa5b rx=336 tx=0
prosaas-backend  | ğŸ“ [SES-7e9b14d0] CALL ENDED - duration=6.6s, business_id=10, rx=336, tx=0
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CA53450c2e52814e1b57227b43ca0c33ba stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.5:59558 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CA53450c2e52814e1b57227b43ca0c33ba: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE4187e22cf96d011c2e76111094c427f4.json
prosaas-backend  | INFO:     172.18.0.5:59562 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CA53450c2e52814e1b57227b43ca0c33ba
prosaas-backend  | ğŸ“Š [FINALIZE] NO USER SPEECH - skipping summary generation for CA53450c2e52814e1b57227b43ca0c33ba
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âœ… CALL FINALIZED (no conversation): CA53450c2e52814e1b57227b43ca0c33ba
prosaas-backend  | âœ… Background thread 4 completed
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZcf8ee1d4f760b1e812756ca84c03aa5b rx=336 tx=0
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CAd8e5a5ef8c2725d94766283f2195c8da
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAd8e5a5ef8c2725d94766283f2195c8da
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAd8e5a5ef8c2725d94766283f2195c8dağŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1412ms - CAd8e5a5ef8c2725
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAd8e5a5ef8c2725d94766283f2195c8da" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.5:59572 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:59582 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-1b36815f
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764878067.003] WS_START sid=MZ27147223dc594db5dab256f4f8d9e87e call_sid=CAd8e5a5ef8c2725d94766283f2195c8da from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAd8e5a5 (FRESH SESSION)
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 445ms (T0+446ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | INFO:     127.0.0.1:50488 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 984ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1091ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAd8e5a5ef8c2725d94766283f2195c8da
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764878068.095] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1093ms
prosaas-backend  | 
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=8.3, threshold=108.2)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 649ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | âŒ [REALTIME] Async error: OpenAIRealtimeClient.configure_session() got an unexpected keyword argument 'prefix_padding_ms'
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/media_ws_ai.py", line 1561, in _run_realtime_mode_async
prosaas-backend  |     await client.configure_session(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  | TypeError: OpenAIRealtimeClient.configure_session() got an unexpected keyword argument 'prefix_padding_ms'
prosaas-backend  | [WA-SESSION] ğŸ“± Check #1: Found 0 stale sessions to process
prosaas-backend  | âœ… Call log already exists for CAd8e5a5ef8c2725d94766283f2195c8da
prosaas-backend  | âœ… Recording started for CAd8e5a5ef8c2725d94766283f2195c8da: RE19f672c299cf9f499b5c280a678009f1
prosaas-backend  | ğŸ”Œ [REALTIME] Disconnected
prosaas-backend  | ğŸ”š [REALTIME] Thread ended for call CAd8e5a5
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=194.0 > threshold=108.2
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.1s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=16960 | silence_ms=514
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 0.8s audio, conversation #1
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=13120 | silence_ms=501
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #1
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=161.0 > threshold=108.2
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=300.0 > threshold=108.2
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | WS_STOP sid=MZ27147223dc594db5dab256f4f8d9e87e rx=522 tx=0
prosaas-backend  | ğŸ“ [SES-1b36815f] CALL ENDED - duration=10.4s, business_id=10, rx=522, tx=0
prosaas-backend  | STREAM_ENDED call=CAd8e5a5ef8c2725d94766283f2195c8da stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.5:47860 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | âœ… Found existing recording for CAd8e5a5ef8c2725d94766283f2195c8da: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE19f672c299cf9f499b5c280a678009f1.json
prosaas-backend  | INFO:     172.18.0.5:47868 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CAd8e5a5ef8c2725d94766283f2195c8da
prosaas-backend  | ğŸ“Š [FINALIZE] NO USER SPEECH - skipping summary generation for CAd8e5a5ef8c2725d94766283f2195c8da
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âœ… CALL FINALIZED (no conversation): CAd8e5a5ef8c2725d94766283f2195c8da
prosaas-backend  | âœ… Background thread 4 completed
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ27147223dc594db5dab256f4f8d9e87e rx=522 tx=0
p