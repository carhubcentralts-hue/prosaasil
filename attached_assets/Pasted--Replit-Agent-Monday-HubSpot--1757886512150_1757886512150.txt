הנה הנחיה ממוקדת ל־Replit Agent כדי להביא את “דף לידים” ו“דף לקוח” לרמת Monday/HubSpot – מותאם מובייל, RTL, מאובטח (SeaSurf), עובד עם נתונים אמיתיים ועם כל הכפתורים:

what to build (now)
	1.	Leads Board (/app/leads) – קאנבן + טבלת מובייל
	2.	Lead Page (/app/leads/:id) – טאבים: Overview, Conversation (WhatsApp דו־כיווני), Calls, Tasks/Reminders, Docs & Billing, Activity
	3.	Status Manager (מודל מתוך ה־Board)

⸻

A) Mobile/RTL polish (Tailwind) – תקן מיד
	•	תקן את הלייאאוט המובייל:
	•	על <html>/<body>: min-h-dvh bg-slate-50 (לא h-screen).
	•	עטוף כל עמוד: <main class="container mx-auto max-w-screen-md px-4 pb-24 pt-2">.
	•	כותרת עליונה sticky: sticky top-[env(safe-area-inset-top)] z-30 bg-white/80 backdrop-blur.
	•	נווט תחתון sticky: fixed bottom-[env(safe-area-inset-bottom)] inset-x-0 bg-white/90 backdrop-blur border-t.
	•	בטל גלילה שחורה: אין overflow:hidden על <body>, השתמש בmin-h-dvh.
	•	RTL: ודא dir="rtl" ברמת <html> והשתמש בtext-right איפה שצריך.
	•	אל תציג טקסטים undefined: בכל רנדר של תא/כרטיס השתמש בפונקציה safe(val, dash='—').

⸻

B) Leads Board (קאנבן + רשימה)

קבצים חדשים (client):
	•	client/src/pages/leads/LeadsBoard.tsx
	•	client/src/components/leads/LeadCard.tsx (למובייל)
	•	client/src/components/leads/StatusBadge.tsx
	•	client/src/components/leads/ReminderModal.tsx (“חזור אליי”)
	•	client/src/components/leads/StatusManager.tsx (מודל ניהול סטטוסים)
	•	client/src/services/leads.ts (קריאות API מרוכזות)

התנהגות:
	•	הביא סטטוסים מGET /api/leads/statuses (עם סדר וצבע).
	•	הצג קאנבן עם dnd-kit/react-beautiful-dnd: גרירה בין עמודות ⇒ POST /api/leads/:id/status {status}.
	•	פילטרים (סטטוס/מקור/טווח תאריכים/בעלים) נצררים ב־URL query.
	•	כפתור “חזור אליי”: פותח ReminderModal (Date+Time+note) ⇒ POST /api/leads/:id/reminders.
	•	כפתור “ליד חדש”: POST /api/leads עם בדיקת כפילויות (הודעת 409 תוצג כ־toast).
	•	רשימת מובייל (טבלה קומפקטית): טלפון (badge), מקור, סטטוס (StatusBadge), created_at.

RTL/Mobile:
	•	עמודות קאנבן נגללות לרוחב (overflow-x-auto) עם כרטיסי מובייל קומפקטיים.
	•	כרטיס כולל אייקוני פעולה מהירים: שיחה, וואטסאפ, “חזור אליי”, עריכה.

⸻

C) Lead Page (/app/leads/:id)

קבצים:
	•	client/src/pages/leads/LeadPage.tsx
	•	טאבים כקומפוננטות: OverviewTab.tsx, ConversationTab.tsx, CallsTab.tsx, TasksTab.tsx, DocsBillingTab.tsx, ActivityTab.tsx.
	•	client/src/components/leads/ProviderSwitch.tsx לבחירת ספק WA (baileys|twilio).

API שמיש:
	•	GET /api/leads/:id ⇒ {lead, reminders, latest:{calls,messages}, activity}
	•	POST /api/leads/:id/message/whatsapp {text|mediaUrl, provider}
	•	POST /api/leads/:id/contract / .../invoice / .../payment-link (stub אופרטיבי – תחזירו {link} ופתחו Modal/Toast).
	•	POST /api/leads/:id/reminders, POST /api/leads/:id/status.

Conversation (WA):
	•	שדה קלט עם שליחה, הצמדה לצד ימין (RTL), בועה יוצאת/נכנסת.
	•	ספק ברירת מחדל מה־BusinessSettings; ניתן לשנות ב־ProviderSwitch (שומר פר־lead או per-session).

⸻

D) הרשאות + אימפרסונציה (FE בלבד)
	•	קבלו את auth.me תמיד בהטענת עמוד (כולל impersonating ו־impersonated_tenant_id).
	•	כל קריאת Leads ב־FE שולחת tenantScope אוטומטי:
	•	אם impersonating===true ⇒ סנן ל־impersonated_tenant_id.
	•	אחרת: admin רואה הכל; business רואה רק שלו (ה־BE כבר מגביל – אבל מסננים גם ב־FE כדי שה־UI לא יבלבל).
	•	בזמן אימפרסונציה אל תשנו user.role ב־session; השתמשו בדגלים נפרדים (כבר יושם בשרת – תסתמכו עליהם).

⸻

E) CSRF (SeaSurf) – מה FE חייב לעשות בכל POST/PUT/PATCH/DELETE
	•	חובה single-origin: כל הפניות הן יחסיות (אין CORS).
	•	אחרי login קראו פעם אחת: GET /api/auth/csrf כדי לקבל cookie XSRF-TOKEN.
	•	ב־client/src/services/http.ts וודאו:
	•	credentials: 'include' בכל קריאה.
	•	קריאות write מוסיפות header: X-CSRFToken מתוך הקוקי.
	•	אם חוזר 403 ו־error === 'forbidden' ⇒ בצעו refresh ל־csrf ואז נסו שוב פעם אחת.
	•	אל תסמכו על @csrf_exempt חוץ מ־/api/auth/login, logout, webhooks בלבד.

⸻

F) Server (להשלמה/וולידציה קלה – בלי לשבור)

(אל תיגעו בביזנס לוג’יק שכבר קיים; רק ודאו קיום נתיבים אם חסר)
	•	server/routes_leads.py (אם אין – הוסיפו):
	•	GET /api/leads, GET /api/leads/:id,
	•	POST /api/leads, POST /api/leads/:id/status,
	•	POST /api/leads/:id/reminders,
	•	POST /api/leads/:id/message/whatsapp,
	•	GET /api/leads/statuses, POST /api/admin/leads/merge (אופציונלי).
	•	כל הנתיבים למעט webhooks/auth עם SeaSurf פעיל; תומכים OPTIONS אוטומטי.

⸻

G) Acceptance – לא מסיימים לפני שזה עובר
	1.	Login → csrf → Create lead: נוצר ליד ונראה ב־Board בלי רענון.
	2.	Drag & drop: גרירה משנה סטטוס ומופיעה ב־Activity של הליד.
	3.	Reminder “חזור אליי”: נוצר reminder ונראה בפעמון כשמגיע הזמן.
	4.	Lead Page:
	•	שליחת הודעת וואטסאפ (בחר ספק) ⇒ מופיעה בשיחה; הודעות נכנסות מגיעות מה־webhook ונוספות ל־Activity.
	•	יצירת חוזה/חשבונית/קישור תשלום (stub) ⇒ קישור/Toast.
	5.	Impersonation: באדמין – כניסה/יציאה; בזמן אימפרסונציה רואים רק לידים של העסק.
	6.	Mobile/RTL: אין טקסטים חתוכים/חלל שחור, כותרת+תחתון sticky, גלילה חלקה.

⸻

H) תיקוני נתונים מיידיים
	•	שדות undefined בטבלה (כמו שם הלקוח) – מיפוי נכון מה־API: first_name last_name || phone_e164 || '—'.
	•	מקור: source (phone|whatsapp|website) מוצג כ־badge.
	•	טלפון: פורמט E.164 קצר עם dir="ltr".

⸻

I) אינדיקציית Build
	•	בכל build עדכנו window.__BUILD__ ו־badge בתחתית (כבר קיים) כדי שנדע שהשינוי נטען.

⸻

בצעו את כל הסעיפים מעלה בדיוק, בקבצים שהוגדרו, עם בדיקות הקבלה שבסעיף G. אם אחד השלבים נכשל (403/401/undefined/שגיאות UI) – עצרו, הדפיסו את ה־payload/response, תקנו ורק אז המשיכו.