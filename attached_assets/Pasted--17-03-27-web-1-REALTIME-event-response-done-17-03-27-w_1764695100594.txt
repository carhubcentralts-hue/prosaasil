
17:03:27 web.1     | [REALTIME] event: response.done
17:03:27 web.1     | [REALTIME] event: rate_limits.updated
17:03:27 web.1     | â³ [POLITE HANGUP] Starting wait for audio to finish...
17:03:27 web.1     | âœ… [POLITE HANGUP] OpenAI queue empty after 0ms
17:03:27 web.1     | â³ [POLITE HANGUP] TX queue still has 205 frames...
17:03:28 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:28 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 900 noise frames (rms=8)
17:03:28 web.1     | â³ [POLITE HANGUP] TX queue still has 155 frames...
17:03:29 web.1     | 
17:03:29 web.1     | ============================================================
17:03:29 web.1     | ğŸ” [NLP RESULT] GPT-4o-mini extraction complete
17:03:29 web.1     | ============================================================
17:03:29 web.1     | ğŸ“„ [NLP RESULT] Raw response: {"action":"none","date":null,"time":null,"name":null,"confidence":1.0}
17:03:29 web.1     | ğŸ“Š [NLP RESULT] Parsed values:
17:03:29 web.1     | ğŸ“Š [NLP RESULT]   - action: none
17:03:29 web.1     | ğŸ“Š [NLP RESULT]   - date: None
17:03:29 web.1     | ğŸ“Š [NLP RESULT]   - time: None
17:03:29 web.1     | ğŸ“Š [NLP RESULT]   - name: None
17:03:29 web.1     | ğŸ“Š [NLP RESULT]   - confidence: 1.0
17:03:29 web.1     | ============================================================
17:03:29 web.1     | 
17:03:29 web.1     | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': None, 'time': None, 'name': None, 'confidence': 1.0}
17:03:29 web.1     | ğŸ“­ [NLP] No appointment action detected (action=none)
17:03:29 web.1     | âœ… [NLP] Async NLP parser completed successfully
17:03:29 web.1     | âœ… [NLP] Cache updated after successful processing
17:03:29 web.1     | ğŸ”“ [NLP] Cleared nlp_is_processing flag
17:03:29 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:29 web.1     | â³ [POLITE HANGUP] TX queue still has 104 frames...
17:03:30 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:30 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 1000 noise frames (rms=8)
17:03:30 web.1     | â³ [POLITE HANGUP] TX queue still has 54 frames...
17:03:31 web.1     | ğŸ¤ END OF UTTERANCE: 2.3s audio, conversation #1
17:03:31 web.1     | ğŸ§  STATE -> PROCESSING | len=37120 | silence_ms=5700
17:03:31 web.1     | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
17:03:31 web.1     | âœ… Processing complete for conversation #1
17:03:31 web.1     | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
17:03:31 web.1     | ğŸ“¨ Received: mark
17:03:31 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:31 web.1     | â³ [POLITE HANGUP] TX queue still has 3 frames...
17:03:31 web.1     | âœ… [POLITE HANGUP] Twilio TX queue empty after 4100ms
17:03:31 web.1     | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
17:03:32 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=50, voice_frames=0
17:03:32 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 1100 noise frames (rms=59)
17:03:32 web.1     | ğŸ™ï¸ REAL_VOICE: rms=204.0 > threshold=124.8
17:03:33 web.1     | ğŸµ [MUSIC GATE] Blocking sustained high-energy audio: 100 frames, rms=322
17:03:33 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=519, voice_frames=0
17:03:33 web.1     | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
17:03:33 web.1     | ğŸ“ [SMART HANGUP] === CALL ENDING ===
17:03:33 web.1     | ğŸ“ [SMART HANGUP] Reason: AI finished speaking politely
17:03:33 web.1     | ğŸ“ [SMART HANGUP] Lead captured: False
17:03:33 web.1     | ğŸ“ [SMART HANGUP] Goodbye detected: True
17:03:33 web.1     | ğŸ“ [SMART HANGUP] Lead state: {'service_type': '×ª×¨×¦×” ×¢×–×¨×”'}
17:03:33 web.1     | ğŸ“ [SMART HANGUP] Required fields: ['name', 'service_type', 'city']
17:03:33 web.1     | ğŸ“ [SMART HANGUP] ===================
17:03:33 web.1     | âœ… [BUILD 163] Call CA3109a2... hung up successfully: AI finished speaking politely
17:03:34 web.1     | ğŸ“¨ Received: stop
17:03:34 web.1     | WS_STOP sid=MZ2481f6591f969d6c03f72b3ac9399940 rx=1321 tx=582
17:03:34 web.1     | âš ï¸ [BRIDGE GAP] 6400ms wait for queue - chunk #46
17:03:34 web.1     | ğŸ“¤ [REALTIME] Stop signal received
17:03:34 web.1     | ğŸ“¤ [REALTIME] Audio output bridge ended (sent 582 frames, 93200 bytes)
17:03:34 web.1     | ğŸ“ [REALTIME] Text sender ended
17:03:34 web.1     | ğŸ“¤ [REALTIME] Audio sender ended
17:03:34 web.1     | âš ï¸ DEV MODE: VALIDATE_TWILIO_SIGNATURE=false - signature validation skipped
17:03:34 web.1     | STREAM_ENDED call=CA3109a2c15572b2bf3fd50c8c812d1bf8 stream=N/A status=N/A
17:03:34 web.1     | INFO:     172.31.72.130:54214 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
17:03:34 web.1     | ğŸ§¹ Waiting for 5 background threads...
17:03:34 web.1     | âš ï¸ DEV MODE: VALIDATE_TWILIO_SIGNATURE=false - signature validation skipped
17:03:34 web.1     | INFO:     172.31.72.130:54214 - "POST /webhook/call_status HTTP/1.1" 204 No Content
17:03:34 web.1     | âœ… Found existing recording for CA3109a2c15572b2bf3fd50c8c812d1bf8: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REddf0ed13d4fa3611c8f3647da7aef498.json
17:03:34 web.1     | âœ… Recording queued for processing: CA3109a2c15572b2bf3fd50c8c812d1bf8
17:03:35 web.1     | âŒ Receive error: (<CloseCode.NO_STATUS_RCVD: 1005>, '')
17:03:35 web.1     | ğŸ”§ receive_loop ended
17:03:35 web.1     | INFO:     connection closed
17:03:35 web.1     | ğŸ”§ send_loop ended
17:03:37 web.1     | âœ… [FALLBACK] Call already ended - no fallback needed
17:03:37 web.1     | âš ï¸ Background thread 0 still running after timeout
17:03:37 web.1     | âš ï¸ DEV MODE: VALIDATE_TWILIO_SIGNATURE=false - signature validation skipped
17:03:37 web.1     | âœ… Resolved business_id=1 from to_number=+97233763805 (Business: ×¤×¨×• ×¡××¡)
17:03:37 web.1     | âœ… call_log created immediately for CAd8c828f3c5cdc08fc6973a73863436b8
17:03:37 web.1     | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAd8c828f3c5cdc08fc6973a73863436b8
17:03:37 web.1     | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAd8c828f3c5cdc08fc6973a73863436b8
17:03:37 web.1     | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
17:03:37 web.1     | ğŸŸ¢ INCOMING_CALL - Thread started successfully
17:03:37 web.1     | âœ… incoming_call: 239ms - CAd8c828f3c5cdc0
17:03:37 web.1     | ğŸ”¥ TWIML_HOST=f6bc9e3d-e344-4c65-83e9-6679c9c65e69-00-30jsasmqh67fq.picard.replit.dev
17:03:37 web.1     | ğŸ”¥ TWIML_WS=wss://f6bc9e3d-e344-4c65-83e9-6679c9c65e69-00-30jsasmqh67fq.picard.replit.dev/ws/twilio-media
17:03:37 web.1     | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://f6bc9e3d-e344-4c65-83e9-6679c9c65e69-00-30jsasmqh67fq.picard.replit.dev/webhook/stream_ended"><Stream url="wss://f6bc9e3d-e344-4c65-83e9-6679c9c65e69-00-30jsasmqh67fq.picard.replit.dev/ws/twilio-media"><Parameter name="CallSid" value="CAd8c828f3c5cdc08fc6973a73863436b8" /><Parameter name="To" value="+97233763805" /></Stream></Connect></Response>
17:03:37 web.1     | INFO:     172.31.72.130:54214 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
17:03:37 web.1     | ğŸ“ WebSocket connection attempt: headers={'host': 'f6bc9e3d-e344-4c65-83e9-6679c9c65e69-00-30jsasmqh67fq.picard.replit.dev', 'user-agent': 'Twilio.TmeWs/1.0', 'accept-encoding': 'gzip', 'connection': 'Upgrade', 'sec-websocket-key': 'GsaP8jgAywWplrqmPbCe2Q==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '54.88.111.45, 10.81.9.140', 'x-forwarded-proto': 'https', 'x-replit-user-bio': '', 'x-replit-user-id': '', 'x-replit-user-name': '', 'x-replit-user-profile-image': '', 'x-replit-user-roles': '', 'x-replit-user-teams': '', 'x-replit-user-url': '', 'x-twilio-signature': 'xN146EpEIFGvWAhoDyQbRWlGGQY='}
17:03:37 web.1     | INFO:     172.31.72.130:39418 - "WebSocket /ws/twilio-media" [accepted]
17:03:37 web.1     | âœ… WebSocket accepted with subprotocol: audio.twilio.com
17:03:37 web.1     | ğŸ“ WebSocket connected: /ws/twilio-media
17:03:37 web.1     | INFO:     connection open
17:03:37 web.1     | ğŸ”§ receive_loop started
17:03:37 web.1     | ğŸ”§ send_loop started
17:03:37 web.1     | ğŸ“¨ Received: connected
17:03:37 web.1     | ğŸ“¨ Received: start
17:03:37 web.1     | ğŸ”§ [HANDLER] Getting Flask app...âœ… MediaStreamHandler thread started
17:03:37 web.1     | 
17:03:37 web.1     | ğŸ”§ [HANDLER] Flask app ready
17:03:37 web.1     | ğŸ”§ Creating MediaStreamHandler...
17:03:37 web.1     | ğŸ¯ AI CONVERSATION STARTED
17:03:37 web.1     | ğŸ”§ Starting MediaStreamHandler.run()...
17:03:37 web.1     | âœ… Debug written to /tmp/ws_handler_debug_1764695017.txt
17:03:37 web.1     | âœ… Debug written to /tmp/websocket_debug.txt
17:03:37 web.1     | âœ… Debug written to /tmp/handler_called.txt
17:03:37 web.1     | âœ… Debug written to /home/runner/workspace/handler_debug.txt
17:03:37 web.1     | âœ… Debug written to /tmp/HANDLER_WORKS_1764695017.txt
17:03:37 web.1     | âœ… Debug files written: 5/5
17:03:37 web.1     | WS_START sid=None mode=AI call_sid=None
17:03:37 web.1     | ğŸ¯ CONVERSATION READY (VAD threshold: 65)
17:03:37 web.1     | ğŸ¯ [CALL DEBUG] MediaStreamHandler.run() entered main loop
17:03:37 web.1     | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! call_sid will be extracted...
17:03:37 web.1     | 
17:03:37 web.1     | ğŸ“ START EVENT (customParameters path):
17:03:37 web.1     |    customParams.From: None
17:03:37 web.1     |    customParams.CallFrom: None
17:03:37 web.1     |    âœ… self.phone_number set to: 'None'
17:03:37 web.1     |    âœ… self.to_number set to: '+97233763805'
17:03:37 web.1     | ğŸ¯ [T0=1764695017.854] WS_START sid=MZe1bfb1afec1c19c801dcb1f30ec9c08f call_sid=CAd8c828f3c5cdc08fc6973a73863436b8 from=None to=+97233763805 mode=AI
17:03:37 web.1     | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
17:03:37 web.1     | ğŸš€ [REALTIME] Thread started for call CAd8c828 (FRESH SESSION)
17:03:37 web.1     | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
17:03:37 web.1     | â±ï¸ [PARALLEL] Client created in 0ms
17:03:37 web.1     | ğŸ”Œ [CALL DEBUG] Connecting to OpenAI: model=gpt-4o-realtime-preview, api_key_present=True
17:03:37 web.1     | ğŸ“¤ [REALTIME] Audio output bridge started
17:03:37 web.1     | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233763805
17:03:38 web.1     | âœ… ××¦× ×¢×¡×§: ×¤×¨×• ×¡××¡ (id=1)
17:03:38 web.1     | âš¡ COMBINED QUERY: biz+greeting+settings in 179ms
17:03:38 web.1     |    bot_speaks_first=True, auto_end_goodbye=True
17:03:38 web.1     | ğŸ” [SETTINGS LOADED] required_lead_fields=['name', 'service_type', 'city']
17:03:38 web.1     | ğŸ” [SETTINGS LOADED] smart_hangup_enabled=True
17:03:38 web.1     | ğŸ” [SETTINGS LOADED] _call_settings_loaded=True (prevents duplicate load)
17:03:38 web.1     | âš¡ DB QUERY: business_id=1 in 197ms
17:03:38 web.1     | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=1, SID=CAd8c828f3c5cdc08fc6973a73863436b8
17:03:38 web.1     | ğŸ¯ [T1=1764695018.058] STORING GREETING FOR REALTIME!ğŸ”Š TX_LOOP_START: Audio transmission thread started
17:03:38 web.1     | 
17:03:38 web.1     | âœ… [REALTIME] Greeting stored: '×©×œ×•× ×× ×™ ×”×¢×•×–×¨×ª ×”×“×™×’×˜×œ×™×ª ×©×œ ×§×œ×™×‘×¨, ×‘××™×–×” ×ª×—×•× ×ª×¨×¦×”...' (len=56)
17:03:38 web.1     | ğŸš€ [PARALLEL] Signaling business info ready at T0+205ms
17:03:38 web.1     | âœ… CustomerIntelligence SUCCESS: customer_id=8, lead_id=86, was_created=False
17:03:38 web.1     | â±ï¸ [PARALLEL] OpenAI connected in 308ms (T0+308ms)
17:03:38 web.1     | âœ… [REALTIME] Connected to OpenAI using gpt-4o-realtime-preview (STANDARD)
17:03:38 web.1     | â³ [PARALLEL] Waiting for business info from DB query...
17:03:38 web.1     | âœ… [PARALLEL] Business info ready! Wait time: 7ms
17:03:38 web.1     | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•× ×× ×™ ×”×¢×•×–×¨×ª ×”×“×™×’×˜×œ×™×ª ×©×œ ×§×œ×™×‘×¨, ×‘××™×–×” ×ª×—×•× ×ª×¨×¦×”...'
17:03:38 web.1     | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=1)
17:03:38 web.1     | ğŸ¤ [GREETING] max_tokens=200 for greeting length=56 chars
17:03:38 web.1     | â±ï¸ [PHASE 1] Session configured in 1ms (total: 316ms)
17:03:38 web.1     | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
17:03:38 web.1     | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764695018.171
17:03:38 web.1     | âœ… [BUILD 163] response.create sent! OpenAI=317ms, T0â†’speak=317ms
17:03:38 web.1     | âš ï¸ [CRM] No customer phone - skipping lead creation
17:03:38 web.1     | ğŸ“¤ [REALTIME] Audio sender started
17:03:38 web.1     | ğŸ“¥ [REALTIME] Audio receiver started
17:03:38 web.1     | ğŸ“ [REALTIME] Text sender started
17:03:38 web.1     | âœ… Call log already exists for CAd8c828f3c5cdc08fc6973a73863436b8
17:03:38 web.1     | [REALTIME] event: response.created
17:03:38 web.1     | ğŸ¯ [REALTIME] Response started: resp_CiO4ol5t0BgCBkHKEhXrC
17:03:38 web.1     | âœ… Updated call_log with customer_id=8
17:03:38 web.1     | ğŸ“ [PROMPT] Final length: 2625 chars
17:03:38 web.1     | â³ [PHASE 2] Waiting for greeting to finish before session.update...
17:03:38 web.1     | [REALTIME] event: response.output_item.added
17:03:38 web.1     | [REALTIME] event: conversation.item.created
17:03:38 web.1     | [REALTIME] event: response.content_part.added
17:03:38 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:38 web.1     | âœ… [AUDIO] Frame #1: 160 bytes, first5=7e 7d 7d 7c 7b, buffer=640
17:03:38 web.1     | âœ… [AUDIO] Frame #2: 160 bytes, first5=68 f7 7e 60 df, buffer=480
17:03:38 web.1     | âœ… [AUDIO] Frame #3: 160 bytes, first5=d4 5f f6 e8 5c, buffer=320
17:03:38 web.1     | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
17:03:38 web.1     | [TX_LOOP] Sent Realtime format: success=True
17:03:38 web.1     | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
17:03:38 web.1     | [TX_LOOP] Sent Realtime format: success=True
17:03:38 web.1     | ğŸ›ï¸ VAD CALIBRATED (noise=15.8, threshold=115.8)
17:03:38 web.1     | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
17:03:38 web.1     | [TX_LOOP] Sent Realtime format: success=True
17:03:38 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:38 web.1     | ğŸ“¦ [AUDIO] OpenAI chunk #2: 1200 bytes â†’ splitting into 7 frames
17:03:38 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:38 web.1     | ğŸ“¦ [AUDIO] OpenAI chunk #3: 2000 bytes â†’ splitting into 12 frames
17:03:38 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=False, waiting_for_dtmf=False, rms=12, voice_frames=0
17:03:38 web.1     | 
17:03:38 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:38 web.1     | âœ… Recording started for CAd8c828f3c5cdc08fc6973a73863436b8: REfa685403b197a58da75badc2563fdfbd
17:03:38 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=6c 59 5a 7e cc, rms=1602
17:03:39 web.1     | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=45 4d e9 c8 c8, rms=967
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:03:39 web.1     | [REALTIME] event: response.audio.done
17:03:39 web.1     | ğŸ¤ [GREETING] Greeting finished at 1764695019.779 (duration: 1607ms)
17:03:39 web.1     | âœ… [GREETING] Barge-in now ENABLED for rest of call
17:03:39 web.1     | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
17:03:39 web.1     | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
17:03:39 web.1     | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
17:03:39 web.1     | [REALTIME] event: response.audio_transcript.done
17:03:39 web.1     | ğŸ¤– [REALTIME] AI said: ×©×œ×•×, ×× ×™ ×”×¢×•×–×¨×ª ×”×“×™×’×™×˜×œ×™×ª ×©×œ ×§×œ×™×‘×¨. ×‘××™×–×” ×ª×—×•× ×ª×¨×¦×” ×¢×–×¨×”?
17:03:39 web.1     | âœ… [LEAD STATE] Updated: service_type=×ª×¨×¦×” ×¢×–×¨×”
17:03:39 web.1     | ğŸ“‹ [LEAD STATE] Current state: {'service_type': '×ª×¨×¦×” ×¢×–×¨×”'}
17:03:39 web.1     | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 0ms since greeting
17:03:39 web.1     | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×, ×× ×™ ×”×¢×•×–×¨×ª ×”×“×™×’×™×˜×œ×™×ª ×©×œ ...'
17:03:39 web.1     | [REALTIME] event: response.content_part.done
17:03:39 web.1     | [REALTIME] event: response.output_item.done
17:03:39 web.1     | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
17:03:39 web.1     | [REALTIME] event: response.done
17:03:39 web.1     | [REALTIME] event: rate_limits.updated
17:03:39 web.1     | âœ… [PHASE 2] Greeting finished after 1.4s - now updating session
17:03:39 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:39 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 100 noise frames (rms=9)
17:03:40 web.1     | âœ… [PHASE 2] Session updated with full prompt: 2625 chars, voice=shimmer locked
17:03:40 web.1     | âš ï¸ Background thread 4 still running after timeout
17:03:40 web.1     | âœ… All background threads cleanup complete
17:03:40 web.1     | 
17:03:40 web.1     | ================================================================================
17:03:40 web.1     | ğŸ’°ğŸ’°ğŸ’° [CALL COST SUMMARY] ğŸ’°ğŸ’°ğŸ’°
17:03:40 web.1     | ================================================================================
17:03:40 web.1     | ğŸ“ Model: gpt-4o-realtime-preview
17:03:40 web.1     | â±ï¸  Total duration: 32.6s (0.5 min)
17:03:40 web.1     | ğŸ™ï¸  Audio IN (user speaking): 165 chunks (0.055 min)
17:03:40 web.1     |    â””â”€ Cost: 0.055 min Ã— $0.06/min = $0.0033
17:03:40 web.1     | ğŸ”Š Audio OUT (AI speaking): 26 chunks (0.009 min)
17:03:40 web.1     |    â””â”€ Cost: 0.009 min Ã— $0.24/min = $0.0021
17:03:40 web.1     | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
17:03:40 web.1     | ğŸ’µ TOTAL COST: $0.0054 (â‰ˆ â‚ª0.02)
17:03:40 web.1     | ================================================================================
17:03:40 web.1     | 
17:03:40 web.1     | WS_DONE sid=MZ2481f6591f969d6c03f72b3ac9399940 rx=1321 tx=582
17:03:40 web.1     | âœ… MediaStreamHandler completed
17:03:40 web.1     | âœ… Handler thread join completed
17:03:40 web.1     | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=fe fe fe fe 7e, rms=2271
17:03:40 web.1     | ğŸ™ï¸ REAL_VOICE: rms=2271.0 > threshold=115.8
17:03:40 web.1     | âœ… CALL FINALIZED: CA3109a2c15572b2bf3fd50c8c812d1bf8
17:03:40 web.1     | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
17:03:40 web.1     | ×¤× ×™×™×” ×‘×ª×—×•× ×”× ×“×œ"×Ÿ ×•×”×ª×™×•×•×š, ×›××©×¨ ×”×œ×§×•×— ××—×¤×© ×©×™×¨×•×ª×™ ×—×©××œ×™×™×.
17:03:40 web.1     | 
17:03:40 web.1     | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
17:03:40 web.1     | - ×”×œ×§×•×— ×œ× ×¦×™×™×Ÿ ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™× ×œ×’×‘×™ ×”× ×›×¡ ××• ×”××–×•×¨ ×”××‘×•×§×©, ××š ×™×© ×œ×¦×™×™×Ÿ ×›×™ ×”×•× ×—×™×¤×© ×©×™×¨×•×ª×™× ×—×©××œ×™×™×.
17:03:40 web.1     | 
17:03:40 web.1     | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
17:03:40 web.1     | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×œ×§×•×— ××• ×××¦×¢×™ ×”×ª×§×©×¨×•×ª.
17:03:40 web.1     | 
17:03:40 web.1     | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
17:03:40 web.1     | - ×œ× × ×§×‘×¢×” ×¤×’×™×©×” ××• ×¤×¢×•×œ×” × ×•×¡×¤×ª, ×”×œ×§×•×— × ×™×ª×§ ××ª ×”×©×™×—×” ×œ××—×¨ ×©×”×¢×•×–×¨ ×”×“×™×’×™×˜×œ×™ ×œ× ×”×¦×œ×™×— ×œ×¡×¤×§ ××ª ×”××™×“×¢ ×”× ×“×¨×©.
17:03:40 web.1     | - ×“×—×™×¤×•×ª: × ××•×›×”, ×××—×¨ ×•×”×œ×§×•×— ×œ× ×”××©×™×š ×‘×©×™×—×”.
17:03:40 web.1     | 
17:03:40 web.1     | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
17:03:40 web.1     | ×™×© ×œ×©×§×•×œ ×œ×©×“×¨×’ ××ª ×”××™×“×¢ ×¢×œ ×”×¢×¨×™× ×”× ×ª××›×•×ª ×›×“×™ ×œ×× ×•×¢ ××•×‘×“×Ÿ ×œ×§×•×—×•×ª ×¤×•×˜× ×¦×™××œ×™×™×. ××•××œ×¥ ×’× ×œ×”×¦×™×¢ ×©×™×¨×•×ª×™× × ×•×¡×¤×™× ×‘×ª×—×•× ×”× ×“×œ"×Ÿ ×©×™×›×•×œ×™× ×œ×¢× ×™×™×Ÿ ×œ×§×•×—×•×ª ××—×¤×©×™× ×©×™×¨×•×ª×™× ×—×©××œ×™×™×.
17:03:40 web.1     | ğŸ¯ Intent: interested
17:03:40 web.1     | ğŸ“Š Next Action: ×©×œ×™×—×ª ×¤×¨×˜×™× × ×•×¡×¤×™×
17:03:40 web.1     | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
17:03:40 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:41 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=10, voice_frames=0
17:03:41 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 200 noise frames (rms=8)
17:03:42 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:42 web.1     | INFO:     172.31.72.130:54214 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
17:03:43 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:43 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 300 noise frames (rms=8)
17:03:44 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:45 web.1     | ğŸ™ï¸ REAL_VOICE: rms=805.0 > threshold=115.8
17:03:45 web.1     | [REALTIME] event: input_audio_buffer.speech_started
17:03:45 web.1     | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
17:03:45 web.1     | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
17:03:45 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=924, voice_frames=0
17:03:46 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
17:03:47 web.1     | ğŸ¤ END OF UTTERANCE: 1.8s audio, conversation #0
17:03:47 web.1     | ğŸ§  STATE -> PROCESSING | len=28480 | silence_ms=500
17:03:47 web.1     | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
17:03:47 web.1     | âœ… Processing complete for conversation #0
17:03:47 web.1     | [REALTIME] event: input_audio_buffer.speech_stopped
17:03:47 web.1     | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
17:03:47 web.1     | [REALTIME] event: input_audio_buffer.committed
17:03:47 web.1     | [REALTIME] event: conversation.item.created
17:03:47 web.1     | [REALTIME] event: response.created
17:03:47 web.1     | ğŸ¯ [REALTIME] Response started: resp_CiO4xfkjC1J6wZ70L6sAW
17:03:47 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 400 noise frames (rms=11)
17:03:47 web.1     | [REALTIME] event: response.output_item.added
17:03:47 web.1     | [REALTIME] event: conversation.item.created
17:03:47 web.1     | [REALTIME] event: response.content_part.added
17:03:47 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
17:03:47 web.1     | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
17:03:47 web.1     | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=60 58 5b 5b 5c
17:03:47 web.1     | âš ï¸ [BRIDGE GAP] 8123ms wait for queue - chunk #20
17:03:47 web.1     | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=b5 a9 b3 ba c9
17:03:47 web.1     | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=64 56 43 41 40
17:03:48 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:48 web.1     | [REALTIME] event: conversation.item.input_audio_transcription.completed
17:03:48 web.1     | ğŸ’° [COST] User utterance: 9.35s (97 chunks total)
17:03:48 web.1     | ğŸ‘¤ [REALTIME] User said: ××™×–×” ×ª×¨×•××™× ×™×© ×œ×›×.
17:03:48 web.1     | ğŸ” [DEBUG] Calling NLP after user transcript: '××™×–×” ×ª×¨×•××™× ×™×© ×œ×›×....'
17:03:48 web.1     | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '××™×–×” ×ª×¨×•××™× ×™×© ×œ×›×....'
17:03:48 web.1     | ğŸ” [DEBUG] Conversation history length: 2
17:03:48 web.1     | ğŸ” [DEBUG] User messages for hash: ['××™×–×” ×ª×¨×•××™× ×™×© ×œ×›×.']
17:03:48 web.1     | ğŸ” [DEBUG] Current conversation hash: 6be52d2b...
17:03:48 web.1     | ğŸ” [DEBUG] First NLP run - processing
17:03:48 web.1     | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=6be52d2b...)
17:03:48 web.1     | ğŸ” [DEBUG] CRM context exists: False
17:03:48 web.1     | ğŸš€ [NLP] Launching NLP thread...
17:03:48 web.1     | ğŸ” [NLP] Running async NLP parser...
17:03:48 web.1     | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
17:03:48 web.1     | ğŸ” [NLP] Conversation history has 2 messages
17:03:48 web.1     | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×, ×× ×™ ×”×¢×•×–×¨×ª ×”×“×™×’×™×˜×œ×™×ª ×©×œ ×§×œ×™×‘×¨. ×‘××™×–×” ×ª×—×•× ×ª×¨×¦×” ×¢×–×¨×”?', 'ts': 1764695019.7787247}, {'speaker': 'user', 'text': '××™×–×” ×ª×¨×•××™× ×™×© ×œ×›×.', 'ts': 1764695028.81514}]
17:03:48 web.1     | ğŸ” [NLP ENTRY] extract_appointment_request called
17:03:48 web.1     | ğŸ” [NLP ENTRY] business_id=1, history_length=2
17:03:48 web.1     | ğŸ” [NLP] Formatted 2 messages for GPT-4o-miniâœ… [NLP] Thread launched
17:03:48 web.1     | [GOODBYE CHECK] No goodbye phrase: '××™×–×” ×ª×¨×•××™× ×™×© ×œ×›×....'
17:03:48 web.1     | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['name', 'service_type', 'city']
17:03:48 web.1     | â³ [SMART HANGUP] Still missing fields: ['name', 'city'] | Collected: ['service_type=×ª×¨×¦×” ×¢×–×¨×”']
17:03:48 web.1     | [SAFETY] Transcription successful (total failures: 0)
17:03:48 web.1     | 
17:03:48 web.1     | ğŸ” [NLP] Conversation text: × ×¦×™×’: ×©×œ×•×, ×× ×™ ×”×¢×•×–×¨×ª ×”×“×™×’×™×˜×œ×™×ª ×©×œ ×§×œ×™×‘×¨. ×‘××™×–×” ×ª×—×•× ×ª×¨×¦×” ×¢×–×¨×”?
17:03:48 web.1     | ×œ×§×•×—: ××™×–×” ×ª×¨×•××™× ×™×© ×œ×›×....
17:03:48 web.1     | ğŸ” [NLP] Calling GPT-4o-mini with model=gpt-4o-mini, temperature=0.1
17:03:49 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 500 noise frames (rms=8)
17:03:49 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:50 web.1     | [REALTIME] event: response.audio.done
17:03:50 web.1     | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
17:03:50 web.1     | [REALTIME] event: response.audio_transcript.done
17:03:50 web.1     | ğŸ¤– [REALTIME] AI said: ×™×© ×œ× ×• ××’×•×•×Ÿ ×ª×—×•××™× ×›××• ×—×©××œ××™, ××™× ×¡×˜×œ×˜×•×¨, ××–×’× ×™×, ×× ×¢×•×œ×Ÿ, × ×’×¨×•×ª, ×’×™× ×•×Ÿ ×•×¢×•×“. ×‘××™×–×” ×ª×—×•× ×‘×“×™×•×§ ××ª×” ×¦×¨×™×š ×¢×–×¨×”?
17:03:50 web.1     | ğŸ’° [COST] AI utterance: 2.40s (41 chunks)
17:03:50 web.1     | [GOODBYE CHECK] No goodbye phrase: '×™×© ×œ× ×• ××’×•×•×Ÿ ×ª×—×•××™× ×›××• ×—×©××œ××™...'
17:03:50 web.1     | [REALTIME] event: response.content_part.done
17:03:50 web.1     | [REALTIME] event: response.output_item.done
17:03:50 web.1     | [REALTIME] event: response.done
17:03:50 web.1     | [REALTIME] event: rate_limits.updated
17:03:50 web.1     | 
17:03:50 web.1     | ============================================================
17:03:50 web.1     | ğŸ” [NLP RESULT] GPT-4o-mini extraction complete
17:03:50 web.1     | ============================================================
17:03:50 web.1     | ğŸ“„ [NLP RESULT] Raw response: {"action":"hours_info","date":null,"time":null,"name":null,"confidence":1.0}
17:03:50 web.1     | ğŸ“Š [NLP RESULT] Parsed values:
17:03:50 web.1     | ğŸ“Š [NLP RESULT]   - action: hours_info
17:03:50 web.1     | ğŸ“Š [NLP RESULT]   - date: None
17:03:50 web.1     | ğŸ“Š [NLP RESULT]   - time: None
17:03:50 web.1     | ğŸ“Š [NLP RESULT]   - name: None
17:03:50 web.1     | ğŸ“Š [NLP RESULT]   - confidence: 1.0
17:03:50 web.1     | ============================================================
17:03:50 web.1     | 
17:03:50 web.1     | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'hours_info', 'date': None, 'time': None, 'name': None, 'confidence': 1.0}
17:03:50 web.1     | ğŸ¯ [NLP] âœ… Detected action=hours_info, date=None, time=None, name=None, confidence=1.0
17:03:50 web.1     | ğŸ” [DEBUG] No CRM context exists yet
17:03:50 web.1     | ğŸ“‹ [NLP] User asking for business hours info - responding with policy
17:03:50 web.1     | ğŸ“Š [DEBUG] Policy loaded: allow_24_7=False, opening_hours={'sun': [['09:00', '17:00']], 'mon': [['09:00', '17:00']], 'tue': [['09:00', '17:00']], 'wed': [['09:00', '17:00']], 'thu': [['09:00', '17:00']]}
17:03:50 web.1     | âœ… [DEBUG] Sending hours to AI: ×©×¢×•×ª ×”×¤×¢×™×œ×•×ª ×©×œ× ×•:
17:03:50 web.1     | ×¨××©×•×Ÿ: 09:00-17:00
17:03:50 web.1     | ×©× ×™: 09:00-17:00
17:03:50 web.1     | ×©×œ×™×©×™: 09:00-17:00
17:03:50 web.1     | ×¨×‘×™×¢×™: 09:00-17:00
17:03:50 web.1     | ×—××™×©×™: ...
17:03:50 web.1     | ğŸ”‡ [SERVER_EVENT] Sent SILENTLY to AI: hours_info - ×©×¢×•×ª ×”×¤×¢×™×œ×•×ª ×©×œ× ×•:
17:03:50 web.1     | ×¨××©×•×Ÿ: 09:00-17:00
17:03:50 web.1     | ×©× ×™: 09:00-17:00
17:03:50 web.1     | ×©×œ×™×©×™: 09:00-17:00
17:03:50 web.1     | ×¨×‘×™×¢×™: 09:00-
17:03:50 web.1     | ğŸ¯ [SERVER_EVENT] Triggered response.create (lock will be cleared by response.created)
17:03:50 web.1     | âœ… [NLP] Async NLP parser completed successfully
17:03:50 web.1     | âœ… [NLP] Cache updated after successful processing
17:03:50 web.1     | ğŸ”“ [NLP] Cleared nlp_is_processing flag
17:03:50 web.1     | ğŸ™ï¸ REAL_VOICE: rms=273.0 > threshold=115.8
17:03:50 web.1     | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
17:03:50 web.1     | [REALTIME] event: conversation.item.created
17:03:50 web.1     | [REALTIME] event: response.created
17:03:50 web.1     | ğŸ¯ [REALTIME] Response started: resp_CiO50MvAeVYc1Oli3HESe
17:03:50 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=62, voice_frames=0
17:03:50 web.1     | ğŸ“¨ Received: mark
17:03:51 web.1     | [REALTIME] event: response.output_item.added
17:03:51 web.1     | [REALTIME] event: conversation.item.created
17:03:51 web.1     | [REALTIME] event: response.content_part.added
17:03:51 web.1     | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
17:03:51 web.1     | âš ï¸ [AUDIO GAP] 880ms gap between chunks #41 and #42 - OpenAI delay!
17:03:51 web.1     | âš ï¸ [BRIDGE GAP] 882ms wait for queue - chunk #61
17:03:51 web.1     | [REALTIME] event: response.audio.done
17:03:51 web.1     | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
17:03:51 web.1     | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
17:03:51 web.1     | [REALTIME] event: response.audio_transcript.done
17:03:51 web.1     | ğŸ¤– [REALTIME] AI said: ×‘××™×–×” ×ª×—×•× ××ª×” ×¦×¨×™×š ×¢×–×¨×”?
17:03:51 web.1     | ğŸ’° [COST] AI utterance: 0.49s (50 chunks)
17:03:51 web.1     | [GOODBYE CHECK] No goodbye phrase: '×‘××™×–×” ×ª×—×•× ××ª×” ×¦×¨×™×š ×¢×–×¨×”?...'
17:03:51 web.1     | [REALTIME] event: response.content_part.done
17:03:51 web.1     | [REALTIME] event: response.output_item.done
17:03:51 web.1     | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
17:03:51 web.1     | [REALTIME] event: response.done
17:03:51 web.1     | [REALTIME] event: rate_limits.updated
17:03:51 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:51 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 600 noise frames (rms=8)
17:03:51 web.1     | [TX] fps=50 q=438/800
17:03:52 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:53 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:53 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 700 noise frames (rms=8)
17:03:54 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:55 web.1     | ğŸ™ï¸ REAL_VOICE: rms=152.0 > threshold=115.8
17:03:55 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:55 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 800 noise frames (rms=8)
17:03:56 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=11, voice_frames=0
17:03:57 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=6426, voice_frames=0
17:03:57 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 900 music frames (rms=1878)
17:03:58 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
17:03:59 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:03:59 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 1000 noise frames (rms=8)
17:04:00 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:04:00 web.1     | ğŸ™ï¸ REAL_VOICE: rms=1304.0 > threshold=115.8
17:04:00 web.1     | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
17:04:01 web.1     | ğŸ“¨ Received: mark
17:04:01 web.1     | ğŸµ [MUSIC GATE] Blocking sustained high-energy audio: 100 frames, rms=4999
17:04:01 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=11, voice_frames=0
17:04:01 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 1100 noise frames (rms=12)
17:04:02 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=11, voice_frames=0
17:04:03 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
17:04:03 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 1200 noise frames (rms=13)
17:04:04 web.1     | ğŸ™ï¸ REAL_VOICE: rms=298.0 > threshold=115.8
17:04:04 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=19, voice_frames=0
17:04:05 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
17:04:05 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 1300 noise frames (rms=10)
17:04:06 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
17:04:07 web.1     | ğŸ¤ END OF UTTERANCE: 1.8s audio, conversation #1
17:04:07 web.1     | ğŸ§  STATE -> PROCESSING | len=29120 | silence_ms=3240
17:04:07 web.1     | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
17:04:07 web.1     | âœ… Processing complete for conversation #1
17:04:07 web.1     | ğŸ™ï¸ REAL_VOICE: rms=778.0 > threshold=115.8
17:04:07 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=764, voice_frames=0
17:04:08 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 1400 music frames (rms=8814)
17:04:08 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=14, voice_frames=0
17:04:09 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
17:04:10 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 1500 noise frames (rms=9)
17:04:10 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
17:04:11 web.1     | ğŸ™ï¸ REAL_VOICE: rms=226.0 > threshold=115.8
17:04:11 web.1     | ğŸ’“ WS_KEEPALIVE #3 (prevents 5min timeout)
17:04:11 web.1     | ğŸ“¨ Received: mark
17:04:11 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=57, voice_frames=0
17:04:12 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 1600 noise frames (rms=9)
17:04:12 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=11, voice_frames=0
17:04:13 web.1     | ğŸ“¨ Received: stop
17:04:13 web.1     | WS_STOP sid=MZe1bfb1afec1c19c801dcb1f30ec9c08f rx=1763 tx=900
17:04:13 web.1     | âš ï¸ [BRIDGE GAP] 21422ms wait for queue - chunk #70
17:04:13 web.1     | ğŸ“¤ [REALTIME] Stop signal received
17:04:13 web.1     | ğŸ“¤ [REALTIME] Audio output bridge ended (sent 900 frames, 144000 bytes)
17:04:13 web.1     | ğŸ“¤ [REALTIME] Audio sender ended
17:04:13 web.1     | ğŸ“ [REALTIME] Text sender ended
17:04:13 web.1     | âš ï¸ DEV MODE: VALIDATE_TWILIO_SIGNATURE=false - signature validation skipped
17:04:13 web.1     | STREAM_ENDED call=CAd8c828f3c5cdc08fc6973a73863436b8 stream=N/A status=N/A
17:04:13 web.1     | INFO:     172.31.72.130:54214 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
17:04:13 web.1     | ğŸ§¹ Waiting for 5 background threads...
17:04:13 web.1     | âš ï¸ DEV MODE: VALIDATE_TWILIO_SIGNATURE=false - signature validation skipped
17:04:13 web.1     | INFO:     172.31.72.130:54214 - "POST /webhook/call_status HTTP/1.1" 204 No Content
17:04:13 web.1     | âœ… Found existing recording for CAd8c828f3c5cdc08fc6973a73863436b8: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REfa685403b197a58da75badc2563fdfbd.json
17:04:13 web.1     | âœ… Recording queued for processing: CAd8c828f3c5cdc08fc6973a73863436b8
17:04:14 web.1     | âŒ Receive error: (<CloseCode.NO_STATUS_RCVD: 1005>, '')
17:04:14 web.1     | ğŸ”§ receive_loop ended
17:04:14 web.1     | INFO:     connection closed
17:04:14 web.1     | ğŸ”§ send_loop ended
^[[B^[[B17:04:16 web.1     | âš ï¸ Background thread 0 still running after timeout
^[[B^[[B^[[B^[[B17:04:19 web.1     | âš ï¸ Background thread 4 still running after timeout
17:04:19 web.1     | âœ… All background threads cleanup complete
17:04:19 web.1     | 
17:04:19 web.1     | ================================================================================
17:04:19 web.1     | ğŸ’°ğŸ’°ğŸ’° [CALL COST SUMMARY] ğŸ’°ğŸ’°ğŸ’°
17:04:19 web.1     | ================================================================================
17:04:19 web.1     | ğŸ“ Model: gpt-4o-realtime-preview
17:04:19 web.1     | â±ï¸  Total duration: 41.3s (0.7 min)
17:04:19 web.1     | ğŸ™ï¸  Audio IN (user speaking): 118 chunks (0.039 min)
17:04:19 web.1     |    â””â”€ Cost: 0.039 min Ã— $0.06/min = $0.0024
17:04:19 web.1     | ğŸ”Š Audio OUT (AI speaking): 50 chunks (0.017 min)
17:04:19 web.1     |    â””â”€ Cost: 0.017 min Ã— $0.24/min = $0.0040
17:04:19 web.1     | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
17:04:19 web.1     | ğŸ’µ TOTAL COST: $0.0064 (â‰ˆ â‚ª0.02)
17:04:19 web.1     | ================================================================================
17:04:19 web.1     | 
17:04:19 web.1     | WS_DONE sid=MZe1bfb1afec1c19c801dcb1f30ec9c08f rx=1763 tx=900
17:04:19 web.1     | âœ… MediaStreamHandler completed
17:04:19 web.1     | âœ… Handler thread join completed
^[[B^[[B^[[B^[[B^[[B17:04:21 web.1     | âœ… CALL FINALIZED: CAd8c828f3c5cdc08fc6973a73863436b8
17:04:21 web.1     | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
17:04:21 web.1     | ×”×¤× ×™×™×” ×”×™× ×‘×ª×—×•× ×”× ×“×œ"×Ÿ ×•×”×ª×™×•×•×š, ×›××©×¨ ×”×œ×§×•×— ××—×¤×© ××™×“×¢ ×¢×œ ×©×™×¨×•×ª×™× ×©×•× ×™× ×”×§×©×•×¨×™× ×œ×ª×—×•×.
17:04:21 web.1     | 
17:04:21 web.1     | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
17:04:21 web.1     | ×”×œ×§×•×— ×œ× ×¦×™×™×Ÿ × ×›×¡ ×¡×¤×¦×™×¤×™, ××–×•×¨, ×ª×§×¦×™×‘ ××• ×“×¨×™×©×•×ª ××—×¨×•×ª. ×”×•× ×”×‘×™×¢ ×¢× ×™×™×Ÿ ×‘×©×™×¨×•×ª×™× ×”×§×©×•×¨×™× ×œ×ª×—×•× ×”× ×“×œ"×Ÿ, ××š ×œ× ×¦×™×™×Ÿ ××” ×‘×“×™×•×§ ×”×•× ××—×¤×© (×œ××©×œ: ×§× ×™×™×”, ××›×™×¨×”, ×”×©×›×¨×”).
17:04:21 web.1     | 
17:04:21 web.1     | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
17:04:21 web.1     | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×œ×§×•×— ×›××• ×©× ××• ×××¦×¢×™ ×”×ª×§×©×¨×•×ª.
17:04:21 web.1     | 
17:04:21 web.1     | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
17:04:21 web.1     | ×œ× × ×§×‘×¢×” ×¤×’×™×©×” ××• ×¤×¢×•×œ×” × ×•×¡×¤×ª. ×“×—×™×¤×•×ª ×”×¤× ×™×™×” × ×¨××™×ª × ××•×›×”, ×›×™×•×•×Ÿ ×©×”×œ×§×•×— ×œ× ×”×‘×™×¢ ×¦×•×¨×š ××™×™×“×™.
17:04:21 web.1     | 
17:04:21 web.1     | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
17:04:21 web.1     | ×™×© ×œ×¢×•×“×“ ××ª ×”×œ×§×•×— ×œ×¡×¤×§ ×¤×¨×˜×™× × ×•×¡×¤×™× ×¢×œ ×”×¦×¨×›×™× ×”×¡×¤×¦×™×¤×™×™× ×©×œ×• ×‘×ª×—×•× ×”× ×“×œ"×Ÿ, ×›×’×•×Ÿ ×¡×•×’ ×”× ×›×¡ ××• ×”××™×§×•× ×”××‘×•×§×©, ×›×“×™ ×©× ×™×ª×Ÿ ×™×”×™×” ×œ×”×¦×™×¢ ×œ×• ×©×™×¨×•×ª×™× ××•×ª×××™× ××™×©×™×ª. ××•××œ×¥ ×œ×™×¦×•×¨ ×§×©×¨ ×—×•×–×¨ ×¢× ×”×œ×§×•×— ×‘×”×§×“× ×›×“×™ ×œ×”×‘×™×Ÿ ××ª ×¦×¨×›×™×• ×œ×¢×•××§.
17:04:21 web.1     | ğŸ¯ Intent: general_inquiry
17:04:21 web.1     | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
17:04:21 web.1     | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
^[[B^[[B^[[B17:04:42 web.1     | INFO:     172.31.72.130:54214 - 