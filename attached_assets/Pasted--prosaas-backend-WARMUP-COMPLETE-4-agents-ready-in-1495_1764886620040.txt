
prosaas-backend  | ğŸ‰ WARMUP COMPLETE: 4 agents ready in 1495ms
prosaas-backend  |   âœ… ×§×œ×™×‘×¨ (calls): 0ms
prosaas-backend  |   âœ… ×§×œ×™×‘×¨ (calls): 0ms
prosaas-backend  |   âœ… ×§×œ×™×‘×¨ (whatsapp): 0ms
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP COMPLETE: 4/4 agents ready in 860ms
prosaas-backend  | ğŸš€ System preheated - First AI response will be FAST!
prosaas-backend  | 
prosaas-backend  |   âœ… ×§×œ×™×‘×¨ (whatsapp): 0ms
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP COMPLETE: 4/4 agents ready in 821ms
prosaas-backend  | ğŸš€ System preheated - First AI response will be FAST!
prosaas-backend  | 
prosaas-backend  | âœ… Service warmup thread completed
prosaas-backend  | âœ… Service warmup thread completed
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ WARMUP: Pre-creating agents for active businesses...
prosaas-backend  | INFO:     172.18.0.5:44822 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:44828 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | âœ… DATA PROTECTION: 0 FAQs preserved (no deletions)
prosaas-backend  | âœ… DATA PROTECTION: 19 leads preserved (no deletions)
prosaas-backend  |   ğŸ”¥ Warming 2 active businesses (Agent Cache)...
prosaas-backend  | ğŸ”„ Starting admin roles migration...
prosaas-backend  |   âœ… ×¤×¨×• ×¡××¡ (calls): 0ms
prosaas-backend  | ğŸ“Š Found 1 users with legacy roles
prosaas-backend  | ğŸ“ Business admin: 'admin@shai-realestate.co.il' (ID=7): admin -> admin (business_id=1)
prosaas-backend  |   âœ… ×¤×¨×• ×¡××¡ (whatsapp): 0ms
prosaas-backend  | ğŸ“Š Found 2 businesses to warm up
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (calls)
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (whatsapp)
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (calls)
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (whatsapp)
prosaas-backend  | 
prosaas-backend  | ğŸ‰ WARMUP COMPLETE: 4 agents ready in 857ms
prosaas-backend  | 
prosaas-backend  | âœ… Successfully migrated 1 users to new role structure!
prosaas-backend  |   âœ… ×§×œ×™×‘×¨ (calls): 0ms
prosaas-backend  |   âœ… ×§×œ×™×‘×¨ (whatsapp): 0ms
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP COMPLETE: 4/4 agents ready in 527ms
prosaas-backend  | ğŸš€ System preheated - First AI response will be FAST!
prosaas-backend  | 
prosaas-backend  | âœ… Service warmup thread completed
prosaas-backend  | ğŸ‘¤ Admin exists (ID=8), resetting password to 'admin123'
prosaas-backend  | âœ… Admin password reset: admin@admin.com / admin123
prosaas-backend  | ğŸ”§ Starting database initialization...
prosaas-backend  | âœ… DATA PROTECTION: 0 FAQs preserved (no deletions)
prosaas-backend  | âœ… DATA PROTECTION: 19 leads preserved (no deletions)
prosaas-backend  | ğŸ”„ Starting admin roles migration...
prosaas-backend  | ğŸ“Š Found 1 users with legacy roles
prosaas-backend  | ğŸ“ Business admin: 'admin@shai-realestate.co.il' (ID=7): admin -> admin (business_id=1)
prosaas-backend  | 
prosaas-backend  | âœ… Successfully migrated 1 users to new role structure!
prosaas-backend  | âœ… Business exists: ×¤×¨×• ×¡××¡ (ID: 1)
prosaas-backend  | âœ… System admin user exists: admin@admin.com (ID: 8, role: system_admin, business_id: None)
prosaas-backend  | 
prosaas-backend  | ğŸ“Š Total users in database: 6
prosaas-backend  |   - User 3: manager@shai-realestate.co.il | role=agent | business_id=1
prosaas-backend  |   - User 2: business@shai-offices.co.il | role=owner | business_id=1
prosaas-backend  |   - User 7: admin@shai-realestate.co.il | role=admin | business_id=1
prosaas-backend  |   - User 9: freezeb123@gmail.com | role=owner | business_id=1
prosaas-backend  |   - User 8: admin@admin.com | role=system_admin | business_id=None
prosaas-backend  |   - User 10: calliber@gmail.com | role=owner | business_id=10
prosaas-backend  | âœ… Lead statuses exist: 4 statuses found
prosaas-backend  | âœ… FAQs table exists: 0 FAQs found across all businesses
prosaas-backend  | âœ… Business settings exist (slot_size: 60min, 24/7: False)
prosaas-backend  | ğŸ‘¥ Checking user ownership...
prosaas-backend  | ğŸ”„ Starting User-to-Owner migration...
prosaas-backend  | ğŸ“Š Found 2 businesses
prosaas-backend  | âœ… Business '×¤×¨×• ×¡××¡' (ID=1) already has owner: business@shai-offices.co.il
prosaas-backend  | âœ… Business '×§×œ×™×‘×¨' (ID=10) already has owner: calliber@gmail.com
prosaas-backend  | 
prosaas-backend  | âœ… User-to-Owner migration completed!
prosaas-backend  | 
prosaas-backend  | âœ… All businesses have owners!
prosaas-backend  | âœ… User ownership check completed
prosaas-backend  | âœ… Database initialization completed successfully!
prosaas-backend  | ğŸ“§ Admin login: admin@admin.com / admin123
prosaas-backend  | ğŸ¢ Business ID: 1
prosaas-backend  | ğŸ‘¤ Admin exists (ID=8), resetting password to 'admin123'
prosaas-backend  | âœ… Admin password reset: admin@admin.com / admin123
prosaas-backend  | ğŸ”§ Starting database initialization...
prosaas-backend  | âœ… Business exists: ×¤×¨×• ×¡××¡ (ID: 1)
prosaas-backend  | âœ… System admin user exists: admin@admin.com (ID: 8, role: system_admin, business_id: None)
prosaas-backend  | 
prosaas-backend  | ğŸ“Š Total users in database: 6
prosaas-backend  |   - User 3: manager@shai-realestate.co.il | role=agent | business_id=1
prosaas-backend  |   - User 2: business@shai-offices.co.il | role=owner | business_id=1
prosaas-backend  |   - User 7: admin@shai-realestate.co.il | role=admin | business_id=1
prosaas-backend  |   - User 9: freezeb123@gmail.com | role=owner | business_id=1
prosaas-backend  |   - User 8: admin@admin.com | role=system_admin | business_id=None
prosaas-backend  |   - User 10: calliber@gmail.com | role=owner | business_id=10
prosaas-backend  | âœ… Lead statuses exist: 4 statuses found
prosaas-backend  | âœ… FAQs table exists: 0 FAQs found across all businesses
prosaas-backend  | âœ… Business settings exist (slot_size: 60min, 24/7: False)
prosaas-backend  | ğŸ‘¥ Checking user ownership...
prosaas-backend  | ğŸ”„ Starting User-to-Owner migration...
prosaas-backend  | ğŸ“Š Found 2 businesses
prosaas-backend  | âœ… Business '×¤×¨×• ×¡××¡' (ID=1) already has owner: business@shai-offices.co.il
prosaas-backend  | âœ… Business '×§×œ×™×‘×¨' (ID=10) already has owner: calliber@gmail.com
prosaas-backend  | 
prosaas-backend  | âœ… User-to-Owner migration completed!
prosaas-backend  | 
prosaas-backend  | âœ… All businesses have owners!
prosaas-backend  | âœ… User ownership check completed
prosaas-backend  | âœ… Database initialization completed successfully!
prosaas-backend  | ğŸ“§ Admin login: admin@admin.com / admin123
prosaas-backend  | ğŸ¢ Business ID: 1
prosaas-backend  | âœ… DATA PROTECTION: 0 FAQs preserved (no deletions)
prosaas-backend  | âœ… DATA PROTECTION: 19 leads preserved (no deletions)
prosaas-backend  | ğŸ”„ Starting admin roles migration...
prosaas-backend  | ğŸ“Š Found 1 users with legacy roles
prosaas-backend  | ğŸ“ Business admin: 'admin@shai-realestate.co.il' (ID=7): admin -> admin (business_id=1)
prosaas-backend  | 
prosaas-backend  | âœ… Successfully migrated 1 users to new role structure!
prosaas-backend  | ğŸ‘¤ Admin exists (ID=8), resetting password to 'admin123'
prosaas-backend  | âœ… Admin password reset: admin@admin.com / admin123
prosaas-backend  | ğŸ”§ Starting database initialization...
prosaas-backend  | âœ… Business exists: ×¤×¨×• ×¡××¡ (ID: 1)
prosaas-backend  | âœ… System admin user exists: admin@admin.com (ID: 8, role: system_admin, business_id: None)
prosaas-backend  | 
prosaas-backend  | ğŸ“Š Total users in database: 6
prosaas-backend  |   - User 3: manager@shai-realestate.co.il | role=agent | business_id=1
prosaas-backend  |   - User 2: business@shai-offices.co.il | role=owner | business_id=1
prosaas-backend  |   - User 7: admin@shai-realestate.co.il | role=admin | business_id=1
prosaas-backend  |   - User 9: freezeb123@gmail.com | role=owner | business_id=1
prosaas-backend  |   - User 8: admin@admin.com | role=system_admin | business_id=None
prosaas-backend  |   - User 10: calliber@gmail.com | role=owner | business_id=10
prosaas-backend  | âœ… Lead statuses exist: 4 statuses found
prosaas-backend  | âœ… FAQs table exists: 0 FAQs found across all businesses
prosaas-backend  | âœ… Business settings exist (slot_size: 60min, 24/7: False)
prosaas-backend  | ğŸ‘¥ Checking user ownership...
prosaas-backend  | ğŸ”„ Starting User-to-Owner migration...
prosaas-backend  | ğŸ“Š Found 2 businesses
prosaas-backend  | âœ… Business '×¤×¨×• ×¡××¡' (ID=1) already has owner: business@shai-offices.co.il
prosaas-backend  | âœ… Business '×§×œ×™×‘×¨' (ID=10) already has owner: calliber@gmail.com
prosaas-backend  | 
prosaas-backend  | âœ… User-to-Owner migration completed!
prosaas-backend  | 
prosaas-backend  | âœ… All businesses have owners!
prosaas-backend  | âœ… User ownership check completed
prosaas-backend  | âœ… Database initialization completed successfully!
prosaas-backend  | ğŸ“§ Admin login: admin@admin.com / admin123
prosaas-backend  | ğŸ¢ Business ID: 1
prosaas-backend  | INFO:     127.0.0.1:41330 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:52922 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:34034 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:34050 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | [WA-SESSION] ğŸ“± Check #1: Found 0 stale sessions to process
prosaas-backend  | INFO:     127.0.0.1:44448 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:46648 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:37492 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:37494 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:41518 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:37188 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:60520 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:60534 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:49512 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:58604 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:33860 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:33864 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:41524 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:34434 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:34438 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:39010 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:33600 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:46536 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:46538 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:33872 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | [WA-SESSION] ğŸ“± Check #2: Found 0 stale sessions to process
prosaas-backend  | INFO:     127.0.0.1:55522 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:45996 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:46006 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:42500 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:50012 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:38464 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:38480 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:52548 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:43736 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:35252 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:35256 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:33310 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:57762 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:59272 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:59280 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:37538 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:32892 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:50744 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:50752 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:52402 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | [WA-SESSION] ğŸ“± Check #3: Found 0 stale sessions to process
prosaas-backend  | INFO:     127.0.0.1:54498 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:60382 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:60396 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:44016 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:43840 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:59708 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:59720 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:51274 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:44352 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:47778 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:47790 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:37100 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:34548 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:40152 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:40154 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:51578 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:35342 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:49666 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:49680 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:53290 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | [WA-SESSION] ğŸ“± Check #4: Found 0 stale sessions to process
prosaas-backend  | INFO:     127.0.0.1:44202 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:37602 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:37616 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:48398 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:50610 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:46854 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:46864 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:58208 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:39704 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:38352 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:38364 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:45894 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | WARNING:  Invalid HTTP request received.
prosaas-backend  | INFO:     127.0.0.1:46260 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:56868 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:56876 - "GET /api/auth/me HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:38774 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:38788 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:36986 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:38140 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:45726 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:45736 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:41480 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | [WA-SESSION] ğŸ“± Check #5: Found 0 stale sessions to process
prosaas-backend  | INFO:     127.0.0.1:60076 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:42028 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.5:42032 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:58942 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:57050 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:57052 - "GET /api/auth/me HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ” LOGIN ATTEMPT: email=calliber@gmail.com
prosaas-backend  | âœ“ Found user: id=10, email=calliber@gmail.com, role=owner
prosaas-backend  | âœ“ Password hash: scrypt:32768:8:1$NwJjYhcFJjcNjejm$9cc6e19d7dbac0ba...
prosaas-backend  | âœ“ Password verification result: True
prosaas-backend  | ğŸ” LOGIN SUCCESS: user_id=10, email=calliber@gmail.com, role=owner, business_id=10
prosaas-backend  | INFO:     172.18.0.5:57058 - "POST /api/auth/login HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:57074 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.5:57076 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:57090 - "GET /api/admin/businesses?pageSize=1 HTTP/1.1" 403 Forbidden
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:57094 - "GET /api/dashboard/stats?time_filter=today HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:57096 - "GET /api/dashboard/activity?time_filter=today HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:57102 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:57104 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:57112 - "GET /api/admin/businesses?pageSize=1 HTTP/1.1" 403 Forbidden
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:49478 - "GET /api/business/current/prompt HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.5:49480 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CAa0a075559c8c196603bebe6991a02761
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAa0a075559c8c196603bebe6991a02761
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAa0a075559c8c196603bebe6991a02761ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1294ms - CAa0a075559c8c19
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAa0a075559c8c196603bebe6991a02761" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.5:49492 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:47806 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-533df385
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764886483.054] WS_START sid=MZ466157ab239cdf2614eb99a57d005a6c call_sid=CAa0a075559c8c196603bebe6991a02761 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAa0a075 (FRESH SESSION)
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 454ms (T0+460ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 940ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1043ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAa0a075559c8c196603bebe6991a02761
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764886484.098] STORING GREETING FOR REALTIME!
prosaas-backend  | 
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1045ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=13.4, threshold=80.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 588ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1042ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764886484.102
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1042ms, T0â†’speak=1048ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjBsyrdvC9BqskH...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjBsyrdvC9BqskH... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Call log already exists for CAa0a075559c8c196603bebe6991a02761
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Recording started for CAa0a075559c8c196603bebe6991a02761: RE5d795968ab91cde0f0cff160d900f8d0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ“ [PROMPT] Final length: 4097 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6936 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764886485.669 (duration: 1568ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=201.0 > threshold=80.0
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=eb 72 67 5d 58, rms=1304, consec_frames=4
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=ce ce cf d2 d9, rms=773, consec_frames=5
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=62 5d 59 56 56, rms=324, consec_frames=6
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=10, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1657ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 2.1s - now updating session
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 4097 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=34, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=53, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjBt2m4Yb4m91HM...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjBt2m4Yb4m91HM... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=10, reason=noise)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=fd fa 7c 77 70
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [SILENCE GATE] âŒ REJECTED (RMS=9 < 30, frames=0): '×ª×•×“×”.'
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=6c 6b ef f5 df
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=7e fe ff fe fe
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.38s (8 chunks)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=116.0 > threshold=80.0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨' (confidence=54%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | INFO:     127.0.0.1:36654 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=219, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 200 frames (rms=25, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=124, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=290.0 > threshold=80.0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8229, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=28, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjBt9Z9jA44kGxI...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjBt9Z9jA44kGxI... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=27, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=230.0 > threshold=80.0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ›¡ï¸ [BUILD 187 GRACE] Ignoring speech_started - only 469ms since response.created (grace=750ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=0, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  | ğŸ”„ [BUILD 187] Response cancelled with NO audio! Scheduling recovery...
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED (has Hebrew): 'â€«×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×–××ª×•×ª.'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: 'â€«×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×–××ª×•×ª.' (hebrew=16, english=0)
prosaas-backend  | ğŸ’° [COST] User utterance: 9.15s (286 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: â€«×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×–××ª×•×ª.
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=231, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¦×¨×™×š' (confidence=47%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: 'â€«×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×–××ª×•×ª....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: 'â€«×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×–××ª×•×ª....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 4
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×ª×•×“×”.', '\u202b×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×–××ª×•×ª.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 285393d4...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=285393d4...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...[GOODBYE CHECK] No goodbye phrase: 'â€«×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×–××ª×•×ª....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | 
prosaas-backend  | ğŸ” [NLP] Conversation history has 4 messages[SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | 
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×ª×•×“×”.', 'ts': 1764886489.0853214, 'filtered': True}, {'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764886489.4246123}, {'speaker': 'user', 'text': '\u202b×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×–××ª×•×ª.', 'ts': 1764886496.482245}]
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=619, voice_frames=0
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1846, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.5:35006 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 300 frames (rms=45, reason=noise)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=627.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=65, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=35, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=5180, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=141.0 > threshold=80.0
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 5.7s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=837, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 400 frames (rms=59, reason=noise)
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=51, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=106, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 500 frames (rms=236, reason=insufficient_consec_frames(1/4))
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=236.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=66, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=52, voice_frames=0
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 12.0s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=192000 | silence_ms=22
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=23, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 600 frames (rms=29, reason=noise)
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 2/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=118.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=264, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=399, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=30, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 700 frames (rms=44, reason=noise)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=420.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=42, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=244, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=38, voice_frames=0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #3 (prevents 5min timeout)
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 800 frames (rms=58, reason=noise)
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ”‡ [SILENCE] Max warnings exceeded - initiating polite hangup
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=170.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=79, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=41, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=298, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 900 frames (rms=371, reason=insufficient_consec_frames(3/4))
prosaas-backend  | ğŸ“ [SMART HANGUP] === CALL ENDING ===
prosaas-backend  | ğŸ“ [SMART HANGUP] Reason: silence_timeout
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead captured: False
prosaas-backend  | ğŸ“ [SMART HANGUP] Goodbye detected: False
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead state: {'city_needs_retry': 'True'}
prosaas-backend  | ğŸ“ [SMART HANGUP] Required fields: ['city', 'service_type']
prosaas-backend  | ğŸ“ [SMART HANGUP] ===================
prosaas-backend  | âœ… [BUILD 163] Call CAa0a075... hung up successfully: silence_timeout
prosaas-backend  | WS_STOP sid=MZ466157ab239cdf2614eb99a57d005a6c rx=1731 tx=332
prosaas-backend  | ğŸ“ [SES-533df385] CALL ENDED - duration=34.5s, business_id=10, rx=1731, tx=332
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | STREAM_ENDED call=CAa0a075559c8c196603bebe6991a02761 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.5:54944 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | âœ… Found existing recording for CAa0a075559c8c196603bebe6991a02761: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE5d795968ab91cde0f0cff160d900f8d0.json
prosaas-backend  | INFO:     172.18.0.5:54960 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CAa0a075559c8c196603bebe6991a02761
prosaas-backend  | INFO:     172.18.0.5:54964 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     connection closed
prosaas-backend  | INFO:     127.0.0.1:51122 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âœ… CALL FINALIZED: CAa0a075559c8c196603bebe6991a02761
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×”×¤× ×™×™×” ×”×™× ×‘×ª×—×•× ×©×™×¨×•×ª×™ ×”×× ×¢×•×œ× ×•×ª. ×”×œ×§×•×— ××—×¤×© ×©×™×¨×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | - ×¡×•×’ ×”×©×™×¨×•×ª: ×¤×•×¨×¥ ×“×œ×ª×•×ª
prosaas-backend  | - ××™×§×•×: ×œ× ×¦×•×™×Ÿ ×‘××¤×•×¨×©, ××š ×™×© ×œ×‘×¨×¨ ××ª ×”×¢×™×¨ ×‘×” × ××¦× ×”×œ×§×•×— ×›×“×™ ×œ×ª×× ××ª ×”×©×™×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×©× ×”×œ×§×•×— ×œ× × ××¡×¨, ×™×© ×œ×‘×§×© ×¤×¨×˜×™ ×”×ª×§×©×¨×•×ª × ×•×¡×¤×™×.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - ×œ× × ×§×‘×¢×” ×¤×’×™×©×” ××• ×ª×•×¨ ×‘×©×™×—×” ×–×•.
prosaas-backend  | - ×“×—×™×¤×•×ª: ×™×© ×œ×‘×¨×¨ ××ª ×¨××ª ×”×“×—×™×¤×•×ª ×©×œ ×”×©×™×¨×•×ª (×’×‘×•×”×”/×‘×™× ×•× ×™×ª/× ××•×›×”).
prosaas-backend  | - ×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª: ×™×© ×œ×™×¦×•×¨ ×§×©×¨ ×¢× ×”×œ×§×•×— ×œ×¦×•×¨×š ×§×‘×œ×ª ×¤×¨×˜×™× × ×•×¡×¤×™× ×¢×œ ×”××™×§×•× ×•×”×“×—×™×¤×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×—×©×•×‘ ×œ×”×“×’×™×© ××ª ×”×¦×•×¨×š ×‘××¢× ×” ××”×™×¨, ×‘××™×•×—×“ ×× ××“×•×‘×¨ ×‘××¦×‘ ×“×—×•×£. ×™×© ×œ×•×•×“× ×©×”×©×™×¨×•×ª×™× ×”××•×¦×¢×™× ×–××™× ×™× ×‘××–×•×¨ ×”×œ×§×•×—.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ466157ab239cdf2614eb99a57d005a6c rx=1731 tx=332
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Found LAST professional in transcript: ×× ×¢×•×œ×Ÿ (pos=21)
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True'}
prosaas-backend  |    â””â”€ City from transcript (fuzzy): ×¢×™×¨ ×’× ×™× (confidence=86%)
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CAa0a075559c8c196603bebe6991a02761, phone=+972504294724, city=×¢×™×¨ ×’× ×™×, direction=inbound
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×¢×™×¨ ×’× ×™×, service=×× ×¢×•×œ×Ÿ
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.5:49308 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CAd67bdacf9dadc1883dd1ea180f7a88b7
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAd67bdacf9dadc1883dd1ea180f7a88b7
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAd67bdacf9dadc1883dd1ea180f7a88b7ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | âœ… incoming_call: 1382ms - CAd67bdacf9dadc1
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAd67bdacf9dadc1883dd1ea180f7a88b7" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.5:47420 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:47430 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-f209e1dc
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764886540.987] WS_START sid=MZb583442aa682d251b98ba19846f00224 call_sid=CAd67bdacf9dadc1883dd1ea180f7a88b7 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAd67bda (FRESH SESSION)
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELYâš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | 
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 439ms (T0+440ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 947ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1051ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAd67bdacf9dadc1883dd1ea180f7a88b7
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764886542.039] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | 
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1053ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=11.9, threshold=80.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 615ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1055ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764886542.042
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1055ms, T0â†’speak=1056ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjBtuGkuJz4ZOJx...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjBtuGkuJz4ZOJx... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Call log already exists for CAd67bdacf9dadc1883dd1ea180f7a88b7
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… Recording started for CAd67bdacf9dadc1883dd1ea180f7a88b7: RE6c76d968cd477dca3ca364181c0f4335
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ“ [PROMPT] Final length: 4097 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6400 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764886543.420 (duration: 1378ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=117.0 > threshold=80.0
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=6f 6c 6f 7a fa, rms=277, consec_frames=4
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=7c 6b 62 60 5f, rms=163, consec_frames=5
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=6c 70 74 78 7e, rms=186, consec_frames=6
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=4316, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1594ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 1.9s - now updating session
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 4097 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=3237, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1106, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=153.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1482, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=4856, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1996, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=10590.0 > threshold=80.0
prosaas-backend  | INFO:     127.0.0.1:59568 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=42, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjBu2c6kPs8S63w...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjBu2c6kPs8S63w... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=f6 ed fb f7 f6
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=317, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=df c9 b6 ad ad
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=ee d8 ae a5 a4
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ›¡ï¸ [BUILD 187 GRACE] Ignoring speech_started - only 654ms since response.created (grace=750ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×”×‘× ×ª×™, ××ª×” ×¦×¨×™×š ×¤×•×¨×¥ ×“×œ×ª
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.25s (5 chunks)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=145, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '× ×ª×™' (confidence=58%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×”×‘× ×ª×™, ××ª×” ×¦×¨×™×š ×¤×•×¨×¥ ×“×œ×ª...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=1, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | ğŸ”¥ [BUILD 171 COOLDOWN] âŒ REJECTED: Transcript arrived 3ms after AI finished (min: 700ms)
prosaas-backend  |    Rejected text: 'â€«××– ×–×” ××¤×•×œ×©×” ××—×“, ××”... â€«×›×Ÿ, ×××ª, ××– ×›×Ÿ. â€«×× ×™ ×¦×¨×™...' (likely hallucination)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=1069.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1257, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=527, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1660, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=298.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=103, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=29, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=34, voice_frames=0
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 12.0s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=192000 | silence_ms=0
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1291, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=383.0 > threshold=80.0
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.5:57878 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.5s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 200 frames (rms=29, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=33, voice_frames=0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=83, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=1258.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=16, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 300 frames (rms=13, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=18, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=285, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 400 frames (rms=15, reason=noise)
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 2/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=102.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=25, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=66, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 500 frames (rms=47, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=949, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=716.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=101, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=31, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 600 frames (rms=26, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=585, voice_frames=0
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ”‡ [SILENCE] Max warnings exceeded - initiating polite hangup
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=15, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=321.0 > threshold=80.0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #3 (prevents 5min timeout)
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 700 frames (rms=35, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=18, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1124, voice_frames=0
prosaas-backend  | ğŸ“ [SMART HANGUP] === CALL ENDING ===
prosaas-backend  | ğŸ“ [SMART HANGUP] Reason: silence_timeout
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead captured: False
prosaas-backend  | ğŸ“ [SMART HANGUP] Goodbye detected: False
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead state: {'city_needs_retry': 'True'}
prosaas-backend  | ğŸ“ [SMART HANGUP] Required fields: ['city', 'service_type']
prosaas-backend  | ğŸ“ [SMART HANGUP] ===================
prosaas-backend  | âœ… [BUILD 163] Call CAd67bda... hung up successfully: silence_timeout
prosaas-backend  | WS_STOP sid=MZb583442aa682d251b98ba19846f00224 rx=1670 tx=280
prosaas-backend  | ğŸ“ [SES-f209e1dc] CALL ENDED - duration=33.4s, business_id=10, rx=1670, tx=280
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CAd67bdacf9dadc1883dd1ea180f7a88b7 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.5:50044 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CAd67bdacf9dadc1883dd1ea180f7a88b7: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE6c76d968cd477dca3ca364181c0f4335.json
prosaas-backend  | INFO:     172.18.0.5:50058 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CAd67bdacf9dadc1883dd1ea180f7a88b7
prosaas-backend  | ğŸ“Š [FINALIZE] NO USER SPEECH - skipping summary generation for CAd67bdacf9dadc1883dd1ea180f7a88b7
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âœ… CALL FINALIZED (no conversation): CAd67bdacf9dadc1883dd1ea180f7a88b7
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZb583442aa682d251b98ba19846f00224 rx=1670 tx=280
prosaas-backend  | INFO:     172.18.0.5:50074 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CAd813c5b8be51a002ffca786eca9894ca
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAd813c5b8be51a002ffca786eca9894ca
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAd813c5b8be51a002ffca786eca9894cağŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1278ms - CAd813c5b8be51a0
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAd813c5b8be51a002ffca786eca9894ca" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.5:50084 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:37920 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:50090 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-be59f009
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764886580.510] WS_START sid=MZc74132986ed581ee6aa977fc7df9907f call_sid=CAd813c5b8be51a002ffca786eca9894ca from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAd813c5 (FRESH SESSION)
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 445ms (T0+446ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 975ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1082ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAd813c5b8be51a002ffca786eca9894ca
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764886581.595] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1085ms
prosaas-backend  | 
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=17.0, threshold=80.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 641ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1087ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764886581.597
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1087ms, T0â†’speak=1088ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjBuX2so6BoRp8J...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjBuX2so6BoRp8J... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… Recording started for CAd813c5b8be51a002ffca786eca9894ca: REd23cb09d51055a48a20501d22ed495a4
prosaas-backend  | âœ… Call log already exists for CAd813c5b8be51a002ffca786eca9894ca
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ“ [PROMPT] Final length: 4097 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764886583.079 (duration: 1482ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=193.0 > threshold=80.0
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=d9 d4 d1 d0 cf, rms=753, consec_frames=4
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=6b 5a 4f 4b 48, rms=827, consec_frames=5
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=66 5f 5c 59 58, rms=264, consec_frames=6
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=10, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1583ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 2.0s - now updating session
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 4097 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=75, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=413.0 > threshold=80.0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjBucJI7uaTfLxT...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjBucJI7uaTfLxT... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=347, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=ed e6 e8 eb ef
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ›¡ï¸ [BUILD 187 GRACE] Ignoring speech_started - only 474ms since response.created (grace=750ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×”
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.07s (1 chunks)
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=12, reason=noise)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨' (confidence=54%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×”...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=1, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | ğŸ”¥ [BUILD 171 COOLDOWN] âŒ REJECTED: Transcript arrived 1ms after AI finished (min: 700ms)
prosaas-backend  |    Rejected text: '×ª×•×“×” ×¨×‘×”...' (likely hallucination)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=19, voice_frames=0
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.5:45974 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=3736, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=8858.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=14, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=13, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 200 frames (rms=18, reason=noise)
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=836, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=796.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=895, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=148, voice_frames=0
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.7s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=19, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=29, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 300 frames (rms=21, reason=noise)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=210.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=16, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1515, voice_frames=0
prosaas-backend  | WS_STOP sid=MZc74132986ed581ee6aa977fc7df9907f rx=907 tx=280
prosaas-backend  | ğŸ“ [SES-be59f009] CALL ENDED - duration=18.1s, business_id=10, rx=907, tx=280
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | STREAM_ENDED call=CAd813c5b8be51a002ffca786eca9894ca stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.5:43486 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CAd813c5b8be51a002ffca786eca9894ca: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REd23cb09d51055a48a20501d22ed495a4.json
prosaas-backend  | INFO:     172.18.0.5:43494 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | âœ… Recording queued for processing: CAd813c5b8be51a002ffca786eca9894ca
prosaas-backend  | INFO