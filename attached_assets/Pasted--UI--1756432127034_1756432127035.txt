הבנתי—יש לך כבר דף התחברות, דף מנהל ודף עסק. אתה מבקש עכשיו הנחיה סופר-מדויקת שתגרום ל־UI לעבוד “כמו אפליקציה” במובייל (סיידבר מתקפל), עם ניתובים נכונים, הרשאות ברזל, וכפתורים שעובדים (HTMX) — כולל ניהול משתמשים גם למנהל (כל המערכת) וגם לעסק (רק העסק שלו), וספירת משתמשים ב”קוביה” בדשבורד.

להלן מפרט־על ממוקד “שדרוג” (לא בונה מאפס), להדבקה לפי הקבצים הקיימים שלך.

⸻

0) בסיס: before_request + הרשאות

קובץ: server/routes_auth.py (או היכן שמוגדרים)

# ודא שקיים:
def load_current_user():
    g.user = session.get("al_user")
    g.token = session.get("al_token")

def require_roles(*roles):
    def deco(fn):
        @wraps(fn)
        def wrap(*a, **kw):
            if not getattr(g, "user", None):
                return redirect(url_for("ui.login"))
            if roles and g.user.get("role") not in roles:
                # ניתוב חכם למסך הנכון
                role = g.user.get("role")
                if role in ("admin","superadmin"):
                    return redirect(url_for("ui.admin_home"))
                return redirect(url_for("ui.biz_home"))
            return fn(*a, **kw)
        return wrap
    return deco

def require_api_auth(roles=None):
    def deco(fn):
        @wraps(fn)
        def wrap(*a, **kw):
            if not getattr(g, "user", None):
                return jsonify({"error":"unauthorized"}), 401
            if roles and g.user.get("role") not in roles:
                return jsonify({"error":"forbidden"}), 403
            return fn(*a, **kw)
        return wrap
    return deco

def effective_business_id(arg_name="business_id"):
    """Admin יכול לבחור ?business_id=; אחרת ננעל לַ־business של המשתמש."""
    bid = request.args.get(arg_name)
    if g.user["role"] not in ("admin","superadmin"):
        bid = g.user.get("business_id")
    return bid

קובץ: server/app_factory.py

# אחרי יצירת app
from server.routes_auth import load_current_user
app.before_request(load_current_user)

app.config.update(
  SESSION_COOKIE_HTTPONLY=True,
  SESSION_COOKIE_SAMESITE="Lax",
  SESSION_COOKIE_SECURE=True,  # בפרודקשן
)


⸻

1) סיידבר מתקפל (RTL) + ניתוב כפתורים + באדג’ים

קובץ: server/templates/layout.html
מטרות: Drawer במובייל, הצגת פריטים לפי תפקיד, “באדג’ים” (counters), ו־כפתורי פעולה שפותחים מודלים (HTMX).

כל דף שמרחיב את layout.html חייב להעביר context: role, current_user, active, current_business_id, counters.

<!doctype html>
<html lang="he" dir="rtl" class="h-full bg-neutral-50">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>{{ page_title or "AgentLocator CRM" }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <style>
    .btn{ @apply px-3 py-2 rounded-xl border border-neutral-200 bg-white hover:bg-neutral-100; }
    .btn-primary{ @apply px-3 py-2 rounded-xl bg-neutral-900 text-white hover:opacity-90; }
    .badge{ @apply text-xs px-2 py-0.5 rounded-full bg-neutral-200; }
  </style>
</head>
<body class="min-h-full text-neutral-900">
  <!-- Overlay למובייל -->
  <div id="overlay" class="fixed inset-0 bg-black/30 z-40 hidden md:hidden"></div>

  <!-- Drawer / Sidebar (RTL: צד ימין) -->
  <aside id="drawer"
    class="fixed inset-y-0 right-0 z-50 w-72 bg-white border-l border-neutral-200
           transform translate-x-full transition-transform duration-300
           md:static md:translate-x-0 md:w-64 md:border-l-0 md:border-r">

    <!-- כותרת קצרה במובייל -->
    <div class="md:hidden flex items-center justify-between px-4 h-14 border-b">
      <div class="font-semibold">תפריט</div>
      <button id="btnClose" class="btn">סגור</button>
    </div>

    <!-- פרופיל + בחירת עסק למנהל -->
    <div class="hidden md:flex items-center gap-2 px-4 h-14 border-b">
      <span class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-neutral-900 text-white">AL</span>
      <div class="text-sm truncate">{{ current_user.name if current_user else "" }}</div>
    </div>

    <nav class="px-2 py-3 space-y-1 overflow-y-auto h-[calc(100vh-56px)] md:h-[calc(100vh-56px)]">
      {% macro item(href,label,key,badge=None) -%}
        <a href="{{ href }}"
           class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-neutral-100
                  {{ 'bg-neutral-100 font-semibold' if active==key }}">
          <span class="text-sm">{{ label }}</span>
          {% if badge is not none %}<span class="badge">{{ badge }}</span>{% endif %}
        </a>
      {%- endmacro %}

      {# ADMIN ONLY #}
      {% if role in ['admin','superadmin'] %}
        {{ item('/app/admin', 'דשבורד ראשי', 'admin_home') }}
        {{ item('/app/admin#tenants', 'ניהול עסקים', 'admin_tenants', counters.tenants_active) }}
        {{ item('/app/admin#users', 'ניהול משתמשים', 'admin_users', counters.users_pending) }}

        <!-- כפתורי פעולה (HTMX → מודל) -->
        <div class="px-3 pt-1 flex gap-2">
          <button class="btn-primary"
                  hx-get="/ui/admin/tenants/new"
                  hx-target="#modal" hx-swap="innerHTML">➕ הוסף עסק</button>
          <button class="btn"
                  hx-get="/ui/admin/users/new"
                  hx-target="#modal" hx-swap="innerHTML">➕ משתמש</button>
        </div>

        <!-- מתג בחירת עסק (מסנן כל ה-UI לקוורי עם ?business_id=) -->
        <div class="px-3 pt-3">
          <label class="block text-xs mb-1">בחר עסק</label>
          <select id="bizSelect" class="w-full px-3 py-2 border rounded-xl"
                  hx-get="/ui/admin/switch_business"
                  hx-target="#switchHook" hx-swap="outerHTML">
            <!-- מלא אופציות בשרת או ב-HTMX -->
            <option value="">כל העסקים</option>
            {% for t in (tenants or []) %}
              <option value="{{ t.id }}" {{ 'selected' if t.id==current_business_id else '' }}>
                {{ t.name }}
              </option>
            {% endfor %}
          </select>
          <div id="switchHook"></div>
        </div>
      {% endif %}

      {# BUSINESS + ADMIN #}
      {{ item('/app/biz#wa', 'WhatsApp', 'biz_whatsapp', counters.whatsapp_unread) }}
      {{ item('/app/biz#calls', 'ניהול שיחות', 'biz_calls', counters.today_calls) }}
      {{ item('/app/biz#crm', 'CRM לקוחות', 'biz_crm') }}
      {{ item('/app/biz#users', 'משתמשים בעסק', 'biz_users') }}

      <a href="/logout" class="block mt-2 px-3 py-2 text-sm rounded-xl bg-red-600 text-white text-center">התנתק</a>
    </nav>
  </aside>

  <!-- תוכן -->
  <div class="md:pr-64">
    <header class="sticky top-0 z-30 bg-white/80 backdrop-blur border-b">
      <div class="max-w-screen-xl mx-auto px-4 h-14 flex items-center gap-3">
        <button id="btnOpen" class="md:hidden btn">☰</button>
        <div class="text-xl font-bold truncate">{{ page_title or 'CRM' }}</div>
      </div>
    </header>

    <main class="max-w-screen-xl mx-auto px-2 sm:px-4 py-4 pb-[calc(env(safe-area-inset-bottom)+56px)]">
      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- מודל כללי ל-HTMX -->
  <div id="modal"></div>

  <script>
    const drawer = document.getElementById('drawer');
    const overlay = document.getElementById('overlay');
    const openBtn = document.getElementById('btnOpen');
    const closeBtn = document.getElementById('btnClose');
    function openDrawer(){ drawer.classList.remove('translate-x-full'); overlay.classList.remove('hidden'); document.body.classList.add('overflow-hidden'); }
    function closeDrawer(){ drawer.classList.add('translate-x-full'); overlay.classList.add('hidden'); document.body.classList.remove('overflow-hidden'); }
    openBtn && openBtn.addEventListener('click', openDrawer);
    overlay && overlay.addEventListener('click', closeDrawer);
    closeBtn && closeBtn.addEventListener('click', closeDrawer);
    drawer.querySelectorAll('a').forEach(a=>a.addEventListener('click', closeDrawer));
    // סגירת מודל אחרי POST מוצלח (אם partial מחזיר hook)
    window.closeModal = ()=>{ document.getElementById('modal').innerHTML=''; }
  </script>
</body>
</html>

מה חשוב:
	•	פריטי הסיידבר מוצגים לפי role.
	•	כפתורי “➕ הוסף עסק/משתמש” פותחים מודלים (partials) — לא מרעננים דף.
	•	Admin יכול לבחור עסק (select) → בקשה קטנה ל־/ui/admin/switch_business שמגדירה cookie/redirect עם ?business_id= (ראה בהמשך).
	•	באדג’ים (counters) מוזנים מהשרת.

⸻

2) ניתובי UI (קיימים אצלך – להקפיד על הרשאות ו־active)

קובץ: server/ui/routes_ui.py

@ui_bp.get("/")
def home():
    if getattr(g, "user", None):
        return redirect(url_for("ui.admin_home") if g.user["role"] in ("admin","superadmin") else url_for("ui.biz_home"))
    return redirect(url_for("ui.login"))

@ui_bp.get("/app/admin")
@require_roles("admin","superadmin")
def admin_home():
    # active מגדיר פריט פעיל בסיידבר
    return render_template("admin.html",
        page_title="איזור מנהל",
        role=g.user["role"], current_user=g.user,
        active="admin_home",
        current_business_id=request.args.get("business_id"),
        counters=_load_counters_for_admin()
    )

@ui_bp.get("/app/biz")
@require_roles("admin","superadmin","manager","agent")
def biz_home():
    bid = effective_business_id()
    return render_template("business.html",
        page_title="איזור עסק",
        role=g.user["role"], current_user=g.user,
        active="biz_whatsapp",
        current_business_id=bid,
        counters=_load_counters_for_business(bid)
    )

# Admin: החלפת עסק פעיל (לסנן דפים וקישורים)
@ui_bp.get("/ui/admin/switch_business")
@require_roles("admin","superadmin")
def ui_admin_switch_business():
    bid = request.args.get("business_id","")
    # אפשר לשמור cookie קצר לצרכי UI, או פשוט לעשות redirect:
    return render_template_string('<div id="switchHook"></div><script>location = "/app/admin?business_id={{bid}}"</script>', bid=bid)

הקפד שב־admin.html ו־business.html יש anchors (#tenants/#users/#wa/#calls/#crm) על מקטעים — כדי שהקישורים בסיידבר יגללו לשם.

⸻

3) “קוביות” דשבורד + כפתורים שמובילים למסכים

Admin (templates/admin.html)
	•	קוביות KPI: שיחות היום, עסקים פעילים, משתמשים ממתינים וכו’ (מה־counters).
	•	מתחת—מקטעים עם כותרות + כפתורים:
	•	עסקים: כפתור “➕ הוסף עסק” (כבר בסיידבר וגם בראש המקטע), חיפוש, טבלה נטענת ב־HTMX.
	•	משתמשים: כפתור “➕ משתמש חדש”, חיפוש/סינון, טבלה נטענת ב־HTMX.

דוגמת ראש מקטע “משתמשים”:

<section id="users" class="space-y-2">
  <div class="flex items-center gap-2">
    <h2 class="font-semibold">משתמשים</h2>
    <button class="btn-primary"
            hx-get="/ui/admin/users/new" hx-target="#modal" hx-swap="innerHTML">➕ משתמש חדש</button>
    <input id="uq" placeholder="חיפוש" class="ml-auto px-3 py-2 border rounded-xl" oninput="loadUsersAdmin()"/>
  </div>
  <div id="usersTable"></div>
</section>
<script>
function loadUsersAdmin(){
  const q = document.getElementById('uq').value || '';
  const u = new URL('/ui/admin/users', location.origin);
  u.searchParams.set('q', q);
  const sel = document.getElementById('bizSelect');
  if(sel && sel.value) u.searchParams.set('business_id', sel.value);
  htmx.ajax('GET', u.toString(), { target:'#usersTable', swap:'innerHTML' });
}
window.addEventListener('load', ()=>{ loadUsersAdmin(); setInterval(loadUsersAdmin, 15000); });
</script>

Business (templates/business.html)
	•	עליון: “כרטיס משתמשים בעסק” עם מספר משתמשים וכפתור → פותח את רשימת המשתמשים של העסק (מוגבל ל־business_id).
	•	WhatsApp / Calls / CRM כבר קיימים — הוסף anchors id="wa" | "calls" | "crm" | "users".

כרטיס “משתמשים בעסק”:

<section id="users" class="space-y-2">
  <div class="flex items-center gap-2">
    <h2 class="font-semibold">משתמשים בעסק</h2>
    <button class="btn-primary"
            hx-get="/ui/biz/users/new?business_id={{ current_business_id }}"
            hx-target="#modal" hx-swap="innerHTML">➕ משתמש</button>
    <div class="ml-auto text-sm opacity-70">סה\"כ: {{ counters.get('biz_users_count',0) }}</div>
  </div>
  <div id="bizUsersTable"
       hx-get="/ui/biz/users?business_id={{ current_business_id }}"
       hx-trigger="load, every 15s"
       hx-swap="innerHTML"></div>
</section>


⸻

4) Partials + כפתורים שעובדים (HTMX)

4.1 Admin — רשימת משתמשים

UI partial: templates/partials/_admin_users_table.html

<table class="w-full text-sm">
  <thead><tr class="border-b">
    <th class="p-2 text-right">שם</th>
    <th class="p-2 text-right">אימייל</th>
    <th class="p-2">תפקיד</th>
    <th class="p-2">עסק</th>
    <th class="p-2">סטטוס</th>
    <th class="p-2"></th>
  </tr></thead>
  <tbody>
    {% for u in users %}
    <tr class="border-b">
      <td class="p-2">{{ u.name }}</td>
      <td class="p-2">{{ u.email }}</td>
      <td class="p-2">{{ u.role }}</td>
      <td class="p-2">{{ u.business_name or u.business_id }}</td>
      <td class="p-2">{{ 'פעיל' if u.enabled else 'מושבת' }}</td>
      <td class="p-2 text-left">
        <button class="btn" hx-get="/ui/admin/users/{{u.id}}/edit" hx-target="#modal" hx-swap="innerHTML">ערוך</button>
      </td>
    </tr>
    {% else %}
    <tr><td class="p-3 opacity-60" colspan="6">אין משתמשים</td></tr>
    {% endfor %}
  </tbody>
</table>

Routes (UI): server/ui/routes_ui.py

@ui_bp.get("/ui/admin/users")
@require_roles("admin","superadmin")
def ui_admin_users():
    q = request.args.get("q","")
    bid = request.args.get("business_id")
    users = dao_users.list(q=q, business_id=bid)  # תתאים ל-DAO שלך
    return render_template("partials/_admin_users_table.html", users=users)

@ui_bp.get("/ui/admin/users/new")
@require_roles("admin","superadmin")
def ui_admin_users_new():
    tenants = dao_tenants.list(q="")
    return render_template("partials/_admin_user_form.html", mode="new", tenants=tenants, user=None)

@ui_bp.get("/ui/admin/users/<uid>/edit")
@require_roles("admin","superadmin")
def ui_admin_users_edit(uid):
    u = dao_users.get(uid)
    tenants = dao_tenants.list(q="")
    return render_template("partials/_admin_user_form.html", mode="edit", tenants=tenants, user=u)

Form partial: templates/partials/_admin_user_form.html

<div class="fixed inset-0 z-50 grid place-items-center bg-black/40">
  <form class="w-full max-w-lg bg-white rounded-2xl p-4 space-y-3"
        hx-post="{{ '/api/admin/users' if mode=='new' else '/api/admin/users/' ~ user.id ~ '/update' }}"
        hx-target="{{ '#usersTable' if role in ['admin','superadmin'] else '#bizUsersTable' }}"
        hx-swap="outerHTML"
        hx-on::after-request="closeModal()">
    <div class="text-lg font-semibold">{{ 'משתמש חדש' if mode=='new' else 'עריכת משתמש' }}</div>
    <input name="name" required placeholder="שם מלא" class="w-full px-3 py-2 border rounded-xl" value="{{ user.name if user else '' }}"/>
    <input name="email" dir="ltr" type="email" required placeholder="אימייל" class="w-full px-3 py-2 border rounded-xl" value="{{ user.email if user else '' }}"/>
    <div class="grid grid-cols-2 gap-2">
      <select name="role" class="px-3 py-2 border rounded-xl">
        {% for r in ['agent','manager','admin'] %}
          <option value="{{r}}" {{ 'selected' if user and user.role==r else '' }}>{{ r }}</option>
        {% endfor %}
      </select>
      <select name="business_id" class="px-3 py-2 border rounded-xl">
        {% for t in tenants %}
          <option value="{{t.id}}" {{ 'selected' if user and user.business_id==t.id else '' }}>{{ t.name }}</option>
        {% endfor %}
      </select>
    </div>
    {% if mode=='edit' %}
      <label class="inline-flex items-center gap-2 text-sm">
        <input type="checkbox" name="enabled" {{ 'checked' if user.enabled else '' }}/>
        משתמש פעיל
      </label>
    {% endif %}
    <div class="flex gap-2 justify-end pt-2">
      <button type="button" class="btn" onclick="closeModal()">בטל</button>
      <button class="btn-primary">שמור</button>
    </div>
  </form>
</div>

Routes (API): server/routes_admin.py

@admin_bp.get("/ui/admin/users")  # כבר יש ב-UI לעיל
def _noop(): pass

@admin_bp.post("/api/admin/users")
@require_api_auth(["admin","superadmin"])
def api_admin_users_create():
    f = request.form
    user = dao_users.create(
        name=f.get("name","").strip(),
        email=f.get("email","").lower().strip(),
        role=f.get("role","agent"),
        business_id=f.get("business_id"),
        enabled=True
    )
    users = dao_users.list(q="", business_id=request.args.get("business_id"))
    return render_template("partials/_admin_users_table.html", users=users)

@admin_bp.post("/api/admin/users/<uid>/update")
@require_api_auth(["admin","superadmin"])
def api_admin_users_update(uid):
    f = request.form
    ok = dao_users.update(uid, {
        "name": f.get("name","").strip(),
        "email": f.get("email","").lower().strip(),
        "role": f.get("role","agent"),
        "business_id": f.get("business_id"),
        "enabled": bool(f.get("enabled"))
    })
    users = dao_users.list(q="", business_id=request.args.get("business_id"))
    return render_template("partials/_admin_users_table.html", users=users)

4.2 Business — רשימת משתמשים בעסק

Routes (UI):

@ui_bp.get("/ui/biz/users")
@require_roles("admin","superadmin","manager","agent")
def ui_biz_users():
    bid = effective_business_id()
    users = dao_users.list(q=request.args.get("q",""), business_id=bid)
    return render_template("partials/_biz_users_table.html", users=users)

@ui_bp.get("/ui/biz/users/new")
@require_roles("admin","superadmin","manager")  # רק מנהל/אדמין יוצר
def ui_biz_users_new():
    bid = effective_business_id()
    tenants=[{"id":bid,"name":"העסק שלי"}]  # נועל לעסק הנוכחי
    return render_template("partials/_admin_user_form.html", mode="new", tenants=tenants, user=None)

Partial: templates/partials/_biz_users_table.html

<table class="w-full text-sm">
  <thead><tr class="border-b">
    <th class="p-2 text-right">שם</th>
    <th class="p-2 text-right">אימייל</th>
    <th class="p-2">תפקיד</th>
    <th class="p-2">סטטוס</th>
    <th class="p-2"></th>
  </tr></thead>
  <tbody>
    {% for u in users %}
    <tr class="border-b">
      <td class="p-2">{{ u.name }}</td>
      <td class="p-2">{{ u.email }}</td>
      <td class="p-2">{{ u.role }}</td>
      <td class="p-2">{{ 'פעיל' if u.enabled else 'מושבת' }}</td>
      <td class="p-2 text-left">
        {% if role in ['admin','superadmin','manager'] %}
        <button class="btn" hx-get="/ui/biz/users/{{u.id}}/edit?business_id={{u.business_id}}" hx-target="#modal" hx-swap="innerHTML">ערוך</button>
        {% endif %}
      </td>
    </tr>
    {% else %}
    <tr><td class="p-3 opacity-60" colspan="5">אין משתמשים</td></tr>
    {% endfor %}
  </tbody>
</table>

Routes (API) לעסק בלבד: server/routes_biz.py

@biz_bp.post("/api/biz/users")
@require_api_auth(["admin","superadmin","manager"])
def api_biz_users_create():
    bid = g.user["business_id"] if g.user["role"] not in ("admin","superadmin") else request.form.get("business_id")
    f = request.form
    user = dao_users.create(
        name=f.get("name","").strip(),
        email=f.get("email","").lower().strip(),
        role=f.get("role","agent"),    # מנהל יכול ליצור גם manager, לא admin
        business_id=bid,
        enabled=True
    )
    users = dao_users.list(q="", business_id=bid)
    return render_template("partials/_biz_users_table.html", users=users)

@biz_bp.post("/api/biz/users/<uid>/update")
@require_api_auth(["admin","superadmin","manager"])
def api_biz_users_update(uid):
    bid = g.user["business_id"] if g.user["role"] not in ("admin","superadmin") else request.form.get("business_id")
    f = request.form
    # manager לא יכול להפוך מישהו ל-admin
    role = f.get("role","agent")
    if g.user["role"]=="manager" and role=="admin":
        return jsonify({"error":"forbidden"}), 403

    dao_users.update(uid, {
        "name": f.get("name","").strip(),
        "email": f.get("email","").lower().strip(),
        "role": role,
        "business_id": bid,
        "enabled": bool(f.get("enabled"))
    })
    users = dao_users.list(q="", business_id=bid)
    return render_template("partials/_biz_users_table.html", users=users)

חשוב: ב־DAO ודא שכל קריאה ננעלת ל־business_id כשלא מדובר ב־admin/superadmin.

⸻

5) ניתובים של כפתורים בכל הדפים (לבדוק שלא יהיו 404)
	•	בסיידבר:
	•	“➕ הוסף עסק” → hx-get="/ui/admin/tenants/new" (Admin בלבד)
	•	“➕ משתמש” (Admin) → hx-get="/ui/admin/users/new"
	•	“➕ משתמש” (Business) → hx-get="/ui/biz/users/new?business_id={{ current_business_id }}"
	•	בדשבורד:
	•	קוביית “משתמשים בעסק” → עוגן #users באותו דף.
	•	בכל טבלה: “ערוך” → hx-get="/ui/.../users/<id>/edit"
	•	בחירת עסק (Admin) → GET /ui/admin/switch_business מחיל redirect ל־/app/admin?business_id=..., וכל הלינקים/טעינות מוסיפים ?business_id=.

⸻

6) מובייל — כדי שזה “יישב פיקס”
	•	Drawer נפתח בכפתור ☰, נסגר ב־overlay/סגירה/ניווט.
	•	כל כפתור ≥ 44px גובה (py-2), rounded-2xl, shadow-sm לרכיבי־מפתח.
	•	pb-[calc(env(safe-area-inset-bottom)+56px)] במיין כדי ששורת הקלט לא תיחתך.
	•	טבלאות/רשימות — text-sm, שברי־שורה truncate/whitespace-nowrap לפי הצורך.

⸻

7) בדיקות GO/NO-GO (מהירות)
	1.	סיידבר: נפתח/נסגר, פריטי Admin לא מופיעים לעסק ולהיפך, באדג’ים מוצגים.
	2.	Admin/Users: “➕ משתמש חדש” פותח מודל, שמור → הטבלה מתרעננת, המודל נסגר.
	3.	Business/Users: “➕ משתמש” יוצר רק בעסק שלו; Manager לא יכול להעלות role ל-Admin.
	4.	חיפוש: oninput מטעין partial בלי שגיאות.
	5.	בחירת עסק (Admin): מחליפה business_id לכל הטעינות בעמוד.
	6.	הרשאות: agent/manager לא רואים /app/admin, וכן ההפך.
	7.	404/405: אין — כל כפתור מצביע ל־UI partial או API קיים.

⸻

טיפי אימות מהירים לבוט
	•	אם HTMX מחזיר 401/403 — הצג toast קטן ב־JS (אופציונלי), או <div class="p-3 text-red-600">אין הרשאה</div>.
	•	לכל POST שמחזיר HTML-טבלה: השתמש ב־hx-target="#...Table" + hx-swap="outerHTML" כדי “להחליף” את כל הטבלה.
	•	אחרי POST מוצלח: hx-on::after-request="closeModal()".

⸻

זהו — זה בדיוק מה שחסר כדי שה־סיידבר, ה־ניתובים, וה־הרשאות יהיו מושלמים, ושכפתורי “הוספת משתמש/עריכה” יעבדו גם למנהל וגם לעסק.
אם תרצה, אכין לך עכשיו 3 partials נוספים (Tenants table + forms) כדי שתוכל להדביק ולהריץ מיד.