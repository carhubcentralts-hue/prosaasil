', 'fe': 'client/dist', 'time': '2025-09-17 21:51:23', 'app': 'AgentLocator-Complete', 'commit': '81ed4ca', 'startup_ts': 1758145883}
21:51:23 whatsapp.1 | [BOOT] Baileys listening on 0.0.0.0:3300 pid=15402
21:51:24 web.1      | ‚úÖ Auth blueprints registered
21:51:24 web.1      | üîß WebSocket: EventLet Composite WSGI + Flask WebSocket fallback
21:51:24 web.1      | üîß REGISTERING TEST ROUTES...
21:51:24 web.1      | üîß WebSocket routes removed from Flask - handled by wsgi.py composite
21:51:24 web.1      | üîß TEST ROUTE REGISTERED
21:51:24 web.1      | üîß WebSocket routes handled by EventLet WebSocketWSGI in wsgi.py
21:51:24 web.1      | üìû /ws/twilio-media ‚Üí EventLet WebSocketWSGI with audio.twilio.com
21:51:24 web.1      | ‚úÖ WebSocket test route added: /test-websocket-version
21:51:24 web.1      | üîç ALL REGISTERED ROUTES:
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /<path:filename>
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses/<int:business_id>/prompt
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/admin/businesses/<int:business_id>/prompt
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/business/current/prompt
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/business/current/prompt
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses/<int:business_id>/prompt/history
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/business/current/prompt/history
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/statuses
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/statuses
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/statuses/<int:status_id>
21:51:24 web.1      |   {'OPTIONS', 'DELETE'} /api/statuses/<int:status_id>
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/statuses/reorder
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/statuses/initialize/<int:business_id>
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/auth/csrf
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/auth/login
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/auth/forgot
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/auth/reset
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/auth/logout
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/auth/me
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/auth/current
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/overview
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/calls
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/whatsapp
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/businesses
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/revenue
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses/<int:business_id>/overview
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/overview
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/calls
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/whatsapp
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/tenants
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/calls
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/leads
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/leads/stats
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/phone-numbers
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses/prompts
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/support/profile
21:51:24 web.1      |   {'OPTIONS', 'GET', 'PUT', 'HEAD'} /api/admin/support/prompt
21:51:24 web.1      |   {'OPTIONS', 'GET', 'PUT', 'HEAD'} /api/admin/support/phones
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/threads
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/threads/<thread_id>/messages
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/customers
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls/active
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls/history
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/payments
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/contracts
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/crm/contracts
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/crm/payments/create
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/payments/paypal/return/success
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/payments/paypal/return/cancel
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/payments/tranzila/return/success
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/payments/tranzila/return/fail
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/invoices/<invoice_number>
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/crm/contracts/sign
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/deals
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/crm/deals
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/business/<int:business_id>
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/business
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/admin/business/<int:business_id>
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/business/<int:business_id>/change-password
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/user
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/user/<int:user_id>
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/admin/user/<int:user_id>
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/user/<int:user_id>/change-password
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/user/<int:user_id>/toggle-status
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/businesses/<int:business_id>/impersonate
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/impersonate/exit
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /webhook/incoming_call_preview
21:51:24 web.1      |   {'POST', 'OPTIONS'} /webhook/incoming_call
21:51:24 web.1      |   {'POST', 'OPTIONS'} /webhook/stream_ended
21:51:24 web.1      |   {'POST', 'OPTIONS'} /webhook/handle_recording
21:51:24 web.1      |   {'POST', 'OPTIONS'} /webhook/stream_status
21:51:24 web.1      |   {'POST', 'OPTIONS'} /webhook/call_status
21:51:24 web.1      |   {'POST', 'GET', 'HEAD', 'OPTIONS'} /webhook/test
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /webhook/test_media_streams_1756667590
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calendar/appointments
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/calendar/appointments
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calendar/appointments/<int:appointment_id>
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/calendar/appointments/<int:appointment_id>
21:51:24 web.1      |   {'OPTIONS', 'DELETE'} /api/calendar/appointments/<int:appointment_id>
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calendar/stats
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/leads
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/leads
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/leads/<int:lead_id>
21:51:24 web.1      |   {'OPTIONS', 'PATCH'} /api/leads/<int:lead_id>
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/status
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/leads/<int:lead_id>/reminders
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/leads/<int:lead_id>/activities
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/reminders
21:51:24 web.1      |   {'OPTIONS', 'PATCH'} /api/leads/<int:lead_id>/move
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/leads/<int:lead_id>/reminders/<int:reminder_id>
21:51:24 web.1      |   {'OPTIONS', 'PATCH'} /api/leads/<int:lead_id>/reminders/<int:reminder_id>
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/reminders/due
21:51:24 web.1      |   {'OPTIONS', 'PATCH'} /api/leads/bulk
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/message/whatsapp
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls/<call_sid>/details
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls/<call_sid>/download
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/calls/cleanup
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls/stats
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/receipts
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/contracts
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/billing/invoice/<invoice_id>/view
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/billing/invoice/<invoice_id>/download
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/billing/contract/<contract_id>/view
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/billing/contract/<contract_id>/download
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/whatsapp/status
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/whatsapp/qr
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/whatsapp/start
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/whatsapp/reset
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/whatsapp/disconnect
21:51:24 web.1      |   {'POST', 'OPTIONS'} /webhook/whatsapp/incoming
21:51:24 web.1      |   {'POST', 'OPTIONS'} /webhook/whatsapp/status
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/dashboard/stats
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/dashboard/activity
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/stats
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /healthz
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /readyz
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /version
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /livez
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /app/admin
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /app/biz
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/admin/overview
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/admin/switch_business
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/admin/tenants/new
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/admin/users/new
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/admin/tenants
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/admin/users
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/whatsapp/threads
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/whatsapp/messages
21:51:24 web.1      |   {'POST', 'OPTIONS'} /ui/whatsapp/send
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/calls/active
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/calls/history
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/biz/contacts
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/biz/contacts/new
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/biz/users/new
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /ui/biz/users
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/ui/login
21:51:24 web.1      |   {'POST', 'GET', 'HEAD', 'OPTIONS'} /api/ui/logout
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/tenants
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/users
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/biz/users
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/crm/contacts
21:51:24 web.1      |   {'POST', 'OPTIONS'} /admin/impersonate/<int:business_id>
21:51:24 web.1      |   {'POST', 'OPTIONS'} /admin/stop-impersonate
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /biz/invoices
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /biz/contracts
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /logout
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /unauthorized
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /test-websocket-version
21:51:24 web.1      | üîç Route registration complete
21:51:24 web.1      | üîß WebSocket routes removed from Flask - handled by wsgi.py composite
21:51:24 web.1      | ‚úÖ Health routes handled by health_endpoints.py blueprint
21:51:24 web.1      | ‚úÖ Factory debug route registered: /debug-factory-http
21:51:24 web.1      | ‚úÖ /healthz route added directly to app_factory
21:51:24 web.1      | üÜò Emergency healthz-direct route added
21:51:24 web.1      | ‚úÖ WhatsApp routes removed - using unified only
21:51:24 web.1      | ‚úÖ Baileys proxy routes: 0 /wa/* endpoints
21:51:24 web.1      | ‚úÖ Legacy proxy routes: 0 /api/wa-proxy/* endpoints
21:51:24 web.1      | FE_DIST = /home/runner/workspace/client/dist mtime = 1758144716.040687
21:51:24 web.1      | üîß Database migrations skipped (set RUN_MIGRATIONS_ON_START=1 to enable)
21:51:24 web.1      | üîß Server will start immediately without blocking on DB operations
21:51:24 web.1      | üîß Warmup disabled for debugging
21:51:24 web.1      | 
21:51:24 web.1      | === URL MAP ===
21:51:24 web.1      |   {'POST', 'OPTIONS'} /admin/impersonate/<int:business_id> -> ui.admin_impersonate_business
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/business -> business_management.create_business
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/business/<int:business_id> -> business_management.get_business
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/admin/business/<int:business_id> -> business_management.update_business
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/business/<int:business_id>/change-password -> business_management.change_business_password
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses -> admin_bp.api_admin_businesses
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses -> api_adapter.admin_businesses
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/businesses/<int:business_id>/impersonate -> business_management.impersonate_business
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses/<int:business_id>/overview -> admin_bp.get_business_overview
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses/<int:business_id>/prompt -> ai_prompt.get_business_prompt
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/admin/businesses/<int:business_id>/prompt -> ai_prompt.update_business_prompt
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses/<int:business_id>/prompt/history -> ai_prompt.get_prompt_history
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/businesses/prompts -> admin_bp.admin_businesses_prompts
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/calls -> admin_bp.api_admin_calls
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/impersonate/exit -> business_management.exit_impersonation
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/businesses -> admin_bp.api_kpis_businesses
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/calls -> admin_bp.api_kpis_calls
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/calls -> admin_bp.api_admin_kpis_calls
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/overview -> admin_bp.api_admin_kpis_overview
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/revenue -> admin_bp.api_kpis_revenue
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/whatsapp -> admin_bp.api_kpis_whatsapp
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/kpis/whatsapp -> admin_bp.api_admin_kpis_whatsapp
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/leads -> admin_bp.admin_leads
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/leads/stats -> admin_bp.admin_leads_stats
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/overview -> admin_bp.api_overview
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/phone-numbers -> admin_bp.admin_phone_numbers
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/run-migrations -> run_migrations_endpoint
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/stats -> api_adapter.admin_stats
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/statuses/initialize/<int:business_id> -> status_management.initialize_default_statuses
21:51:24 web.1      |   {'OPTIONS', 'GET', 'PUT', 'HEAD'} /api/admin/support/phones -> admin_bp.admin_support_phones
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/support/profile -> admin_bp.admin_support_profile
21:51:24 web.1      |   {'OPTIONS', 'GET', 'PUT', 'HEAD'} /api/admin/support/prompt -> admin_bp.admin_support_prompt
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/tenants -> admin_bp.api_tenants
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/tenants -> ui.api_admin_tenants_create
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/user -> business_management.create_user
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/admin/user/<int:user_id> -> business_management.get_user
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/admin/user/<int:user_id> -> business_management.update_user
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/user/<int:user_id>/change-password -> business_management.change_user_password
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/user/<int:user_id>/toggle-status -> business_management.toggle_user_status
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/admin/users -> ui.api_admin_users_create
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/auth/csrf -> auth_api.get_csrf
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/auth/current -> auth_api.get_current_user_legacy
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/auth/forgot -> auth_api.forgot_password
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/auth/login -> auth_api.login
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/auth/logout -> auth_api.logout
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/auth/me -> auth_api.get_current_user
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/auth/reset -> auth_api.reset_password
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/billing/contract/<contract_id>/download -> receipts_contracts.download_contract
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/billing/contract/<contract_id>/view -> receipts_contracts.view_contract
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/billing/invoice/<invoice_id>/download -> receipts_contracts.download_invoice
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/billing/invoice/<invoice_id>/view -> receipts_contracts.view_invoice
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/biz/users -> ui.api_biz_users_create
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/business/current/prompt -> ai_prompt.get_current_business_prompt
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/business/current/prompt -> ai_prompt.update_current_business_prompt
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/business/current/prompt/history -> ai_prompt.get_current_prompt_history
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calendar/appointments -> calendar.get_appointments
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/calendar/appointments -> calendar.create_appointment
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calendar/appointments/<int:appointment_id> -> calendar.get_appointment
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/calendar/appointments/<int:appointment_id> -> calendar.update_appointment
21:51:24 web.1      |   {'OPTIONS', 'DELETE'} /api/calendar/appointments/<int:appointment_id> -> calendar.delete_appointment
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calendar/stats -> calendar.get_calendar_stats
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls -> calls.list_calls
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls/<call_sid>/details -> calls.get_call_details
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls/<call_sid>/download -> calls.download_recording
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls/active -> crm_bp.api_active_calls
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/calls/cleanup -> calls.cleanup_old_recordings
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls/history -> crm_bp.api_call_history
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/calls/stats -> calls.get_calls_stats
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/contracts -> receipts_contracts.create_contract
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/crm/contacts -> ui.api_crm_contacts_create
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/contracts -> crm_bp.get_contracts
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/crm/contracts -> crm_bp.create_contract
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/crm/contracts/sign -> crm_bp.contract_sign
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/customers -> crm_bp.api_customers
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/deals -> crm_bp.list_deals
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/crm/deals -> crm_bp.create_deal
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/invoices/<invoice_number> -> crm_bp.get_invoice
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/payments -> crm_bp.get_payments
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/crm/payments/create -> crm_bp.payments_create
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/payments/paypal/return/cancel -> crm_bp.paypal_cancel
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/payments/paypal/return/success -> crm_bp.paypal_success
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/payments/tranzila/return/fail -> crm_bp.tranzila_fail
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/payments/tranzila/return/success -> crm_bp.tranzila_success
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/threads -> crm_bp.api_threads
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/crm/threads/<thread_id>/messages -> crm_bp.api_thread_messages
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/dashboard/activity -> api_adapter.dashboard_activity
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/dashboard/stats -> api_adapter.dashboard_stats
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/leads -> leads_bp.list_leads
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/leads -> leads_bp.create_lead
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/leads/<int:lead_id> -> leads_bp.get_lead_detail
21:51:24 web.1      |   {'OPTIONS', 'PATCH'} /api/leads/<int:lead_id> -> leads_bp.update_lead
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/leads/<int:lead_id>/activities -> leads_bp.get_lead_activities
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/message/whatsapp -> leads_bp.send_whatsapp_message
21:51:24 web.1      |   {'OPTIONS', 'PATCH'} /api/leads/<int:lead_id>/move -> leads_bp.move_lead_in_kanban
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/leads/<int:lead_id>/reminders -> leads_bp.get_lead_reminders
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/reminders -> leads_bp.create_reminder
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/leads/<int:lead_id>/reminders/<int:reminder_id> -> leads_bp.get_reminder
21:51:24 web.1      |   {'OPTIONS', 'PATCH'} /api/leads/<int:lead_id>/reminders/<int:reminder_id> -> leads_bp.update_reminder
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/status -> leads_bp.update_lead_status
21:51:24 web.1      |   {'OPTIONS', 'PATCH'} /api/leads/bulk -> leads_bp.bulk_update_leads
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/receipts -> receipts_contracts.create_receipt
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/reminders/due -> leads_bp.get_due_reminders
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/statuses -> status_management.get_business_statuses
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/statuses -> status_management.create_status
21:51:24 web.1      |   {'OPTIONS', 'PUT'} /api/statuses/<int:status_id> -> status_management.update_status
21:51:24 web.1      |   {'OPTIONS', 'DELETE'} /api/statuses/<int:status_id> -> status_management.delete_status
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/statuses/reorder -> status_management.reorder_statuses
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/ui/login -> ui.api_login
21:51:24 web.1      |   {'POST', 'GET', 'HEAD', 'OPTIONS'} /api/ui/logout -> ui.api_logout
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/whatsapp/disconnect -> whatsapp.disconnect
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/whatsapp/qr -> whatsapp.qr
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/whatsapp/reset -> whatsapp.reset
21:51:24 web.1      |   {'POST', 'OPTIONS'} /api/whatsapp/start -> whatsapp.start
21:51:24 web.1      |   {'OPTIONS', 'GET', 'HEAD'} /api/whatsapp/status -> whatsapp.status
21:51:24 web.1      | ================
21:51:24 web.1      | ‚úÖ Simple SPA routes registered (no blueprint)
21:51:24 web.1      | ‚úÖ Flask app context initialized successfully
21:51:24 web.1      | ‚úÖ EventLet Composite WSGI ready
21:51:24 web.1      | üìû /ws/twilio-media ‚Üí EventLet WebSocketWSGI with audio.twilio.com
21:51:24 web.1      | üåê All other routes ‚Üí Flask app
21:53:28 web.1      | üîç WSGI Route: GET /
21:53:28 web.1      | üåê Routing to Flask app: /
21:53:29 web.1      | üîç WSGI Route: GET /assets/index-6WqHGuc7.css
21:53:29 web.1      | üåê Routing to Flask app: /assets/index-6WqHGuc7.css
21:53:29 web.1      | üîç WSGI Route: GET /assets/index-C263Q_nr.js
21:53:29 web.1      | üåê Routing to Flask app: /assets/index-C263Q_nr.js
21:53:31 web.1      | üîç WSGI Route: GET /api/auth/csrf
21:53:31 web.1      | üåê Routing to Flask app: /api/auth/csrf
21:53:32 web.1      | üîç WSGI Route: GET /api/auth/me
21:53:32 web.1      | üåê Routing to Flask app: /api/auth/me
21:54:36 web.1      | üîç WSGI Route: POST /api/auth/login
21:54:36 web.1      | üåê Routing to Flask app: /api/auth/login
21:54:37 web.1      | üîç WSGI Route: GET /api/auth/csrf
21:54:37 web.1      | üåê Routing to Flask app: /api/auth/csrf
21:54:38 web.1      | üîç WSGI Route: GET /api/admin/businesses
21:54:38 web.1      | üåê Routing to Flask app: /api/admin/businesses
21:54:38 web.1      | üîç WSGI Route: GET /api/admin/leads
21:54:38 web.1      | üåê Routing to Flask app: /api/admin/leads
21:54:38 web.1      | üîç WSGI Route: GET /api/admin/leads/stats
21:54:38 web.1      | üåê Routing to Flask app: /api/admin/leads/stats
21:54:38 web.1      | üîç WSGI Route: GET /api/admin/phone-numbers
21:54:38 web.1      | üåê Routing to Flask app: /api/admin/phone-numbers
21:54:38 web.1      | üîç WSGI Route: GET /api/admin/overview
21:54:38 web.1      | üåê Routing to Flask app: /api/admin/overview
21:56:46 web.1      | üîç WSGI Route: GET /api/whatsapp/status
21:56:46 web.1      | üåê Routing to Flask app: /api/whatsapp/status
21:56:46 web.1      | üîç WSGI Route: GET /api/crm/threads
21:56:46 web.1      | üåê Routing to Flask app: /api/crm/threads
21:56:46 web.1      | üîç WSGI Route: GET /api/business/current/prompt
21:56:46 web.1      | üåê Routing to Flask app: /api/business/current/prompt
21:56:46 web.1      | CSRF-DBG cookie= 2WSdTNw6updaqFTi3o5gwvZRw301TE_vDMWGTd5fr4A header= None ct= None
21:56:53 web.1      | üîç WSGI Route: POST /api/whatsapp/start
21:56:53 web.1      | üåê Routing to Flask app: /api/whatsapp/start
21:56:53 whatsapp.1 | [1] üöÄ startSession called
21:56:53 whatsapp.1 | [1] üìÅ Loading auth state from: /home/runner/workspace/storage/whatsapp/1/auth
21:56:53 whatsapp.1 | [1] üîß Creating WhatsApp socket
21:56:53 whatsapp.1 | [1] üíæ Session stored in memory
21:56:53 whatsapp.1 | [1] Connection update: { connection: 'connecting', qr: false, lastDisconnect: undefined }
21:56:53 whatsapp.1 | [1] üîó Connecting to WhatsApp...
21:56:53 whatsapp.1 | {"level":30,"time":"2025-09-17T21:56:53.454Z","pid":15402,"hostname":"83b2d5fb4e2d","class":"baileys","browser":["Ubuntu","Chrome","22.04.4"],"helloMsg":{"clientHello":{"ephemeral":{"type":"Buffer","data":[67,239,167,185,196,94,228,54,179,209,126,33,184,25,146,63,240,89,202,211,198,75,105,12,197,191,17,5,137,37,169,47]}}},"msg":"connected to WA"}
21:56:53 whatsapp.1 | {"level":30,"time":"2025-09-17T21:56:53.504Z","pid":15402,"hostname":"83b2d5fb4e2d","class":"baileys","node":{"shards":[],"connectType":1,"connectReason":1,"userAgent":{"appVersion":{"primary":2,"secondary":3000,"tertiary":1023223821},"platform":14,"releaseChannel":0,"osVersion":"0.1","device":"Desktop","osBuildNumber":"0.1","localeLanguageIso6391":"en","mnc":"000","mcc":"000","localeCountryIso31661Alpha2":"US"},"webInfo":{"webSubPlatform":0},"passive":false,"pull":false,"devicePairingData":{"buildHash":{"type":"Buffer","data":[115,217,80,121,67,37,77,218,204,172,136,191,249,135,15,136]},"deviceProps":{"type":"Buffer","data":[10,6,85,98,117,110,116,117,24,1,32,0]},"eRegid":{"0":0,"1":0,"2":0,"3":187},"eKeytype":{"type":"Buffer","data":[5]},"eIdent":{"type":"Buffer","data":[201,230,80,85,113,102,102,188,181,36,205,14,206,5,145,97,43,186,6,131,194,184,52,102,84,205,140,90,26,109,171,29]},"eSkeyId":{"0":0,"1":0,"2":1},"eSkeyVal":{"type":"Buffer","data":[86,174,134,136,197,129,6,14,161,38,42,35,85,9,43,188,12,63,18,59,20,85,40,128,189,237,193,183,32,239,177,78]},"eSkeySig":{"type":"Buffer","data":[241,138,208,128,226,73,73,188,157,137,126,71,9,53,208,40,246,131,143,192,170,0,72,169,220,87,148,117,95,5,216,54,15,66,16,150,178,54,214,176,88,127,242,37,61,5,232,123,121,36,156,5,94,172,177,65,140,100,229,12,213,155,22,129]}}},"msg":"not logged in, attempting registration..."}
21:56:53 whatsapp.1 | [1] Connection update: { connection: undefined, qr: true, lastDisconnect: undefined }
21:56:53 whatsapp.1 | [1] üîÑ Generating new QR code
21:56:54 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:56:54 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:57:05 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:57:05 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:57:15 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:57:15 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:57:25 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:57:25 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:57:35 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:57:35 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:57:45 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:57:45 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:57:53 whatsapp.1 | [1] Connection update: { connection: undefined, qr: true, lastDisconnect: undefined }
21:57:53 whatsapp.1 | [1] üîÑ Generating new QR code
21:57:55 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:57:55 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:58:05 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:58:05 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:58:13 whatsapp.1 | [1] Connection update: { connection: undefined, qr: true, lastDisconnect: undefined }
21:58:13 whatsapp.1 | [1] üîÑ Generating new QR code
21:58:15 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:58:15 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:58:22 web.1      | üîç WSGI Route: POST /api/whatsapp/start
21:58:22 web.1      | üåê Routing to Flask app: /api/whatsapp/start
21:58:22 whatsapp.1 | [1] üöÄ startSession called
21:58:22 whatsapp.1 | [1] ‚ö†Ô∏è Session already exists, returning existing
21:58:23 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:58:23 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:58:33 web.1      | üîç WSGI Route: GET /api/whatsapp/qr
21:58:33 web.1      | üåê Routing to Flask app: /api/whatsapp/qr
21:58:33 whatsapp.1 | {"level":30,"time":"2025-09-17T21:58:33.634Z","pid":15402,"hostname":"83b2d5fb4e2d","class":"baileys","me":{"id":"972504294724:37@s.whatsapp.net","lid":"87621728518253:37@lid"},"platform":"iphone","msg":"pairing configured successfully, expect to restart the connection..."}
21:58:33 whatsapp.1 | [1] Connection update: { connection: undefined, qr: false, lastDisconnect: undefined }
21:58:33 whatsapp.1 | [1] Connection update: { connection: undefined, qr: true, lastDisconnect: undefined }
21:58:33 whatsapp.1 | [1] üîÑ Generating new QR code
21:58:34 whatsapp.1 | {"level":50,"time":"2025-09-17T21:58:34.199Z","pid":15402,"hostname":"83b2d5fb4e2d","class":"baileys","node":{"tag":"stream:error","attrs":{"code":"515"}},"msg":"stream errored out"}
21:58:34 whatsapp.1 | [1] Connection update: { connection: 'close', qr: false, lastDisconnect: 515 }
21:58:34 whatsapp.1 | [1] ‚ùå WhatsApp connection closed
21:58:34 whatsapp.1 | [1] üîÑ Will reconnect in 2 seconds
21:58:34 whatsapp.1 | {"level":30,"time":"2025-09-17T21:58:34.200Z","pid":15402,"hostname":"83b2d5fb4e2d","class":"baileys","trace":"Error: Stream Errored (restart required)\n    at WebSocketClient.<anonymous> (file:///home/runner/workspace/node_modules/@whiskeysockets/baileys/lib/Socket/socket.js:703:13)\n    at WebSocketClient.emit (node:events:524:28)\n    at file:///home/runner/workspace/node_modules/@whiskeysockets/baileys/lib/Socket/socket.js:402:35\n    at Object.decodeFrame (file:///home/runner/workspace/node_modules/@whiskeysockets/baileys/lib/Utils/noise-handler.js:140:17)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"connection errored"}
21:58:36 whatsapp.1 | [1] üöÄ startSession called
21:58:36 whatsapp.1 | [1] ‚ö†Ô∏è Session already exists, returning existing