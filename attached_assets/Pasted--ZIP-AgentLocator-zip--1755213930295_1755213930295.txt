עברתי על ה‑ZIP האחרון (AgentLocator.zip) ובדקתי את קבצי המפתח. הנה המצב המדויק ומה לסגור עכשיו כדי שהאפליקציה באמת תרוץ ותציג את הגרסה החדשה.

סטטוס מהיר (מסקנות מהקובץ)
	•	✅ יש: server/app_factory.py, server/main.py, server/routes/__init__.py, server/error_handlers.py, server/logging_setup.py, server/api_timeline.py
	•	⚠️ חסר: server/__init__.py (בלי זה server לא נחשב package).
	•	⚠️ Twilio: קיים רק /webhook/handle_recording. חסרים /webhook/incoming_call ו־/webhook/call_status.
	•	✅ פרונט: יש public/sw.js, ויש src/lib/socket.ts.
	•	⚠️ התראות לקוח (Modal): לא מצאתי TaskDueModal.tsx / useTaskDue.ts.
	•	⚠️ טבלאות TanStack: לא מצאתי שימוש ב־@tanstack/react-table.
	•	✅ CI: קיים .github/workflows/ci.yml.
	•	ℹ️ server/main.py כבר מכיל “מעטפת” שמוסיפה את ה־root ל־sys.path (כך שזה יעבוד גם אם מריצים מתוך server/). עדיין מומלץ להריץ נכון (ראה למטה).

⸻

מה לסגור עכשיו — הנחיה חדה לסוכן

1) להפוך את server לחבילה חוקית (בלי הפתעות בפריסה)

צור קובץ ריק: AgentLocator/server/__init__.py
(שורה ריקה מספיקה.)

2) להשלים שני webhooks של Twilio

קובץ: AgentLocator/server/routes_twilio.py
הוסף את שני הנתיבים הבאים (השאר את handle_recording כפי שהוא):

from flask import Blueprint, Response, current_app
twilio_bp = Blueprint("twilio_bp", __name__, url_prefix="")

@twilio_bp.post("/webhook/incoming_call")
def incoming_call():
    host = current_app.config.get("PUBLIC_HOST", "https://YOUR_HOST")
    xml = f"""<?xml version="1.0" encoding="UTF-8"?>
<Response>
  <Play>{host}/server/static/voice_responses/greeting.mp3</Play>
  <Pause length="1"/>
  <Record action="/webhook/handle_recording"
          method="POST"
          maxLength="30"
          timeout="5"
          finishOnKey="*"
          transcribe="false"/>
</Response>"""
    return Response(xml, mimetype="text/xml")

@twilio_bp.post("/webhook/call_status")
def call_status():
    return "OK", 200

אחרי דיפלוי: בעמוד המספר ב‑Twilio להגדיר ל‑POST:
	•	Voice webhook → /webhook/incoming_call
	•	Status callback → /webhook/call_status

3) פופ‑אפ משימות בזמן אמת (Client)

(אפשר לדחות ויזואלית, אבל שיהיה בסיס עובד)
	•	צור client/src/hooks/useTaskDue.ts:

import { useEffect } from "react";
import { socket } from "@/lib/socket";
export function useTaskDue(onDue:(p:any)=>void){
  useEffect(()=>{
    socket.on("task:due", onDue);
    return ()=> socket.off("task:due", onDue);
  },[onDue]);
}

	•	צור client/src/components/TaskDueModal.tsx (מסך מלא בסיסי) וחבר אותו ב־App.tsx דרך useTaskDue.
	•	צד שרת: ודא שיש פליטה של socket.emit("task:due", payload, ...) כשמגיעה שעת המשימה (אפשר גם פולינג זמני אם אין Scheduler).

4) טבלאות מקצועיות (אפשר שלב ראשון רק לקוחות)
	•	הוסף תלות @tanstack/react-table.
	•	החלף את טבלת הלקוחות לשימוש ב־DataTable עם מיון/סינון/הסתרת עמודות/Export CSV.

5) פקודת ריצה/פריסה נכונה

עדיף לא לעשות cd server && python main.py. שני מסלולים תקינים:

A. ללא Gunicorn (פשוט):
	•	פקודת ריצה/Deploy:
python -m server.main
	•	ב־server/main.py להשאיר:

from server.app_factory import create_app
app = create_app()
if __name__ == "__main__":
    import os
    app.run(host="0.0.0.0", port=int(os.getenv("PORT", 5000)))

B. עם Gunicorn (פרודקשן, מומלץ; Socket.IO → eventlet):
	•	פקודה:
gunicorn --worker-class eventlet -w 1 -b 0.0.0.0:$PORT server.main:app

אם הפלטפורמה מתעקשת להריץ מתוך server/, תשאיר את מעטפת ה‑sys.path שיש לך ב־main.py (היא כבר טיפול טוב), אבל עדיין עדיף מודול: python -m server.main.

6) משתני סביבה נדרשים

FLASK_ENV=production
PUBLIC_HOST=https://YOUR_HOST
CORS_ORIGINS=https://YOUR_HOST
PORT=5000            # אם הפלטפורמה לא מזריקה אוטומטית
DATABASE_URL=...
JWT_SECRET=...
TWILIO_SID=...
TWILIO_TOKEN=...
GOOGLE_APPLICATION_CREDENTIALS=/secrets/google_tts_key.json
VAPID_PUBLIC_KEY=...
VAPID_PRIVATE_KEY=...


⸻

בדיקות סגירה (5 דקות, תריץ אחת‑אחת)
	1.	Twilio

curl -sS -X POST https://YOUR_HOST/webhook/incoming_call -H "Accept: text/xml" | head
curl -sS -X POST https://YOUR_HOST/webhook/call_status -o /dev/null -w "%{http_code}\n"   # צריך 200

	2.	ברכה נגישה

curl -I https://YOUR_HOST/server/static/voice_responses/greeting.mp3   # צריך 200

	3.	בריאות API

curl -sS https://YOUR_HOST/api/health

	4.	פרונט עדכני (לשבור קאש)

	•	DevTools → Network → Disable cache → רענון.
	•	Application → Service Workers → Unregister + Update on reload.
	•	ודא שהעמוד נטען מחדש (רצוי להוסיף header X-Revision בשרת).

⸻

למה זה לא עלה קודם?
	•	חסרו שני נתיבי Twilio → Twilio נתן אזהרות/500.
	•	server לא היה package → פריסה מסוימת נפלה על ModuleNotFoundError.
	•	ייתכן SW/קאש בצד הלקוח → הוספתי kill‑switch ומדיניות רענון.

—

רוצה שאכין לך “PR מוכן” עם: server/__init__.py, שני ה‑webhooks החסרים, hook/modal להתראות, ו־סקריפט build/Run command מוגדר?