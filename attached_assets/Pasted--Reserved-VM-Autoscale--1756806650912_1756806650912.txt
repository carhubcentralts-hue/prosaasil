××ª×” ×¦×•×“×§â€”×œ× ×—×™×™×‘×™× Reserved VM. ×’× ×¢× Autoscale ×–×” ×™×¢×‘×•×“. ×”×‘×¢×™×” ××¦×œ×š ×›×¨×’×¢ ×”×™× ×œ× â€œ×©×™×¨×•×ªâ€, ××œ× ××™×š ×”×“×™×¤×œ×•×™ ×¨×¥: ×× ×”Ö¾Autoscale ××¨×™×¥ python main.py / Flask dev / ××©×”×• ××—×¨ â€“ ×”Ö¾WebSocket ×œ× ×™×§×‘×œ ×”× ×“×©×™×™×§ × ×›×•×Ÿ ×•×ª×§×‘×œ 400/×©×§×˜.

×‘×•× × ×¡×“×¨ ××ª ×–×” ×‘×œ×™ ×œ×©× ×•×ª ×¡×•×’ ×“×™×¤×œ×•×™ ×‘×›×œ×œ:

××” ×œ×ª×§×Ÿ (×‘×œ×™ ×œ×”×—×œ×™×£ Autoscale)

1) ×”×¤×§×•×“×ª Start ×©×œ ×”×“×™×¤×œ×•×™

×‘Ö¾Replit â†’ Deployments â†’ âš™ï¸ Edit (×©×œ ×”×“×™×¤×œ×•×™ ×”×§×™×™×):
	â€¢	×ª×—×ª Start command ×©×™× ×‘×“×™×•×§:

gunicorn wsgi:app -k eventlet -w 1 -b 0.0.0.0:$PORT

×–×” ××—×™×™×‘ ××ª ×”Ö¾Composite WSGI ×©×œ×š (×©×›×•×œ×œ ××ª /ws/twilio-media + ×›×œ ×”×”×’× ×•×ª ×•×”×¢×§×™×¤×•×ª ×©×”×•×¡×¤× ×•).
×× ×¨×¥ ××©×”×• ××—×¨ (×›××• python main.py/Flask dev) â€“ ×”Ö¾WS ×™×™×¤×•×œ.

	â€¢	Health check: ×©×™× /version (×œ× /healthz).
	â€¢	×•×“× ×©×”×“×•××™×™×Ÿ × ×©××¨ ×–×”×” (×œ× ×œ×©× ×•×ª ×›×“×™ ×œ× ×œ×’×¢×ª ×‘-Twilio).

2) ×•×“× ×©×”×§×•×“ ×”××¢×•×“×›×Ÿ ×‘×¤×¨×•×“×§×©×Ÿ

×›×‘×¨ ×™×© ×œ×š ××ª ×”×¤××¥â€™ ×‘Ö¾wsgi.py (×‘×“×§× ×•):
	â€¢	××—×–×™×¨ 204 ××™×™×“×™ ×œÖ¾/webhook/stream_status|stream_ended|call_status
	â€¢	××—×–×™×¨ TwiML ××™×™×“×™ ×œÖ¾/webhook/incoming_call
	â€¢	××¡×œ×•×œ WS: ××§×‘×œ ×’× /ws/twilio-media/
	â€¢	×”× ×“×©×™×™×§: ××—×–×™×¨ Sec-WebSocket-Protocol: audio.twilio.com + Upgrade + Connection

×•×•×“× ×©×”×“×™×¤×œ×•×™ ×‘×××ª ××¨×™×¥ ××ª ×”×§×•×“ ×”×–×” (××—×¨×™ Redeploy).

3) ××™××•×ª ×—×ª×™××” â€“ ×ª×§×™×Ÿ, ×œ× ××‘×˜×œ×™×

×”×©××¨ @require_twilio_signature ×¢×œ:
	â€¢	/webhook/incoming_call
	â€¢	/webhook/handle_recording
	â€¢	/webhook/call_status
×œ× ×¦×¨×™×š ×—×ª×™××” ×¢×œ stream_status/ended (×××™×œ× ×¢×•× ×™× ×‘-WSGI).

4) ××©×ª× ×™ ×¡×‘×™×‘×” ×‘×“×™×¤×œ×•×™ (×œ× ×¨×§ ×‘-.env ×©×œ ×”×¤×¨×•×™×§×˜)

×‘×“×£ ×”×“×™×¤×œ×•×™ ×¢×¦××• (Environment):

PUBLIC_BASE_URL=https://ai-crmd.replit.app
OPENAI_API_KEY=...
TWILIO_ACCOUNT_SID=...
TWILIO_AUTH_TOKEN=...
GOOGLE_CLOUD_SERVICE_ACCOUNT_JSON={"type":"service_account",...}   # ×›×œ ×”-JSON ×‘×©×•×¨×” ××—×ª

5) ×‘×“×™×§×•×ª ××™×™×“×™×•×ª
	â€¢	Webhooks (×¦×¨×™×š 204 ××”×¨):

curl -i -X POST https://ai-crmd.replit.app/webhook/stream_status
curl -i -X POST https://ai-crmd.replit.app/webhook/stream_ended
curl -i -X POST https://ai-crmd.replit.app/webhook/call_status

	â€¢	TwiML Preview:

curl -i https://ai-crmd.replit.app/webhook/incoming_call_preview
# Content-Type: application/xml; charset=utf-8
# wss://ai-crmd.replit.app/ws/twilio-media

	â€¢	(××•×¤×¦×™×•× ×œ×™) Handshake ×™×“× ×™:

# ×× ×™×© ×œ×š wscat ××§×•××™
wscat -c "wss://ai-crmd.replit.app/ws/twilio-media" -H "Sec-WebSocket-Protocol: audio.twilio.com"

×‘×œ×•×’ ×©×œ ×”×“×™×¤×œ×•×™ ×ª×—×¤×©:

ğŸ“ Routing to EventLet WebSocketWSGI
ğŸ¯ Twilio subprotocol requested
âœ… Added Twilio subprotocol to handshake

6) Twilio â€“ ×•×“× URL ××“×•×™×§

×‘××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ â†’ Voice:
	â€¢	Webhook: POST https://ai-crmd.replit.app/webhook/incoming_call  (×œ×œ× ×¡×œ×© ×‘×¡×•×£)
	â€¢	××™×Ÿ query params.

â¸»

×œ××” ×–×” ×”×¤×ª×¨×•×Ÿ (×•×œ× â€œ××¡×ª×‘×šâ€)
	â€¢	Autoscale ×›×Ÿ ×™×›×•×œ ×œ×¢×‘×•×“ â€“ ×‘×ª× ××™ ×©×”Ö¾Start command ××¨×™×¥ ××ª Gunicorn ×¢× Eventlet ×•××ª wsgi:app ×©×œ×š. ××– ×”×¤×¨×•×§×¡×™ ×©×œ Replit (â€œGoogle Frontendâ€) ××¢×‘×™×¨ WS ×ª×§×™×Ÿ, ×•×”×§×•×“ ×©×œ×š ××—×–×™×¨ ×‘×“×™×•×§ ××ª ×”Ö¾headers ×©×˜×•×•×™×œ×™×• ×¦×¨×™×š.
	â€¢	×›×œ ×©××¨ ×”×‘×¢×™×•×ª (11205) ×›×‘×¨ × ×¤×ª×¨×• ×¢× ×”Ö¾204 ×”××™×™×“×™ ×‘×¨××ª WSGI.

â¸»

×˜×§×¡×˜ ×§×¦×¨ ×œ××™×™×’â€™× ×˜ (××¤×©×¨ ×œ×”×“×‘×™×§ ×œ×•)

×‘-Replit Deployments ×¢×¨×•×š ××ª ×”×“×™×¤×œ×•×™ ×”×§×™×™× (Autoscale) ×•×©× ×” ××ª Start command ×œ:
  gunicorn wsgi:app -k eventlet -w 1 -b 0.0.0.0:$PORT

×”×©××¨ Health ×œ-/version, ×”×©××¨ ×“×•××™×™×Ÿ ×–×”×”, ×•×“× ×›×œ ×”-ENV ×‘×“×™×¤×œ×•×™.
××—×¨ ×›×š ×¢×©×” Redeploy.

×‘×“×•×§:
- POST /webhook/stream_status|stream_ended|call_status â†’ 204 ××™×“
- GET /webhook/incoming_call_preview â†’ XML ×¢× wss://
- ×”×ª×§×©×¨ ××”×˜×œ×¤×•×Ÿ; ×‘-Logs ×—×¤×© "Added Twilio subprotocol to handshake" ×•××– WS_MEDIA/ASR_TEXT/TTS_SUCCESS.

×× ××—×¨×™ ×–×” ×¢×“×™×™×Ÿ ×ª×¨××” 400 ×‘-WSâ€”×ª×©×œ×— ×œ×™ ××ª ×”-Logs ×©×œ ×”×“×™×¤×œ×•×™ (××”×”×ª×—×œ×” ×©×œ ×”×©×¨×ª ×•×¢×“ × ×™×¡×™×•×Ÿ ×”×”×ª×—×‘×¨×•×ª), ×•×× ×™ ××¦×‘×™×¢ ×¢×œ ×”×©×•×¨×” ×”××“×•×™×§×ª.