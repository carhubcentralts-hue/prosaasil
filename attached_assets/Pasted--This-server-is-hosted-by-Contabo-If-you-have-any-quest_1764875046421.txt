
This server is hosted by Contabo. If you have any questions or need help,
please don't hesitate to contact us at support@contabo.com.

Last login: Thu Dec  4 19:55:12 2025 from 62.56.147.58
root@vmi2930819:~# cd /opt/prosaasil
docker compose logs -f backend
WARN[0000] The "TWILIO_PHONE_NUMBER" variable is not set. Defaulting to a blank string. 
prosaas-backend  | INFO:     Started server process [1]
prosaas-backend  | INFO:     Waiting for application startup.
prosaas-backend  | INFO:     Application startup complete.
prosaas-backend  | INFO:     Uvicorn running on http://0.0.0.0:5000 (Press CTRL+C to quit)
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP STARTING - Preloading all services...
prosaas-backend  |   ğŸ”¥ Warming OpenAI client...
prosaas-backend  |     âœ… OpenAI client ready
prosaas-backend  |   ğŸ”¥ Warming Google TTS client...
prosaas-backend  |     âŒ TTS client failed
prosaas-backend  |   ğŸ”¥ Warming Google STT client...
prosaas-backend  |     âŒ STT client failed
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP STARTING - Preloading all services...
prosaas-backend  |   ğŸ”¥ Warming OpenAI client...
prosaas-backend  |     âœ… OpenAI client ready
prosaas-backend  |   ğŸ”¥ Warming Google TTS client...
prosaas-backend  |     âŒ TTS client failed
prosaas-backend  |   ğŸ”¥ Warming Google STT client...
prosaas-backend  |     âŒ STT client failed
prosaas-backend  | INFO:     127.0.0.1:41472 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 0 FAQs in database
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 0 FAQs in database
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 19 leads in database
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 19 leads in database
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP STARTING - Preloading all services...
prosaas-backend  |   ğŸ”¥ Warming OpenAI client...
prosaas-backend  |     âœ… OpenAI client ready
prosaas-backend  |   ğŸ”¥ Warming Google TTS client...
prosaas-backend  |     âŒ TTS client failed
prosaas-backend  |   ğŸ”¥ Warming Google STT client...
prosaas-backend  |     âŒ STT client failed
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ WARMUP: Pre-creating agents for active businesses...
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 0 FAQs in database
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ WARMUP: Pre-creating agents for active businesses...
prosaas-backend  | [WA-SESSION] ğŸ“± Background processor thread started - checking every 5 minutes
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 19 leads in database
prosaas-backend  | ğŸ“Š Found 2 businesses to warm up
prosaas-backend  | ğŸ“‹ PROMPT LOADING: business_id=10, channel=calls, custom_instructions provided=False
prosaas-backend  | âš ï¸ Could not load DB prompt for business=10: (psycopg2.errors.UndefinedColumn) column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | ğŸ”¨ CALLING create_booking_agent(business_id=10, channel=calls)
prosaas-backend  | ğŸ“Š Found 2 businesses to warm up
prosaas-backend  |   ğŸ”¥ Warming 2 active businesses (Agent Cache)...
prosaas-backend  |   ğŸ”¥ Warming 2 active businesses (Agent Cache)...
prosaas-backend  | 
prosaas-backend  | âš ï¸  NO DB prompt - using minimal fallback for ×§×œ×™×‘×¨
prosaas-backend  | 
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“œ AGENT INSTRUCTIONS (first 500 chars):
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ”’ SYSTEM CONTEXT (READ BUT DON'T MENTION):
prosaas-backend  | TODAY: 2025-12-04 20:57 (Israel)
prosaas-backend  | TOMORROW: 2025-12-05
prosaas-backend  | APPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)
prosaas-backend  | 
prosaas-backend  | âš ï¸ CRITICAL ANTI-HALLUCINATION RULES (BUILD 112):
prosaas-backend  | 1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true
prosaas-backend  | 2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn
prosaas-backend  | 3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn
prosaas-backend  | 4. ğŸ”¥ BUILD 112: 
prosaas-backend  | ...
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“… Today calculated as: 2025-12-04 (Thursday)
prosaas-backend  | ğŸ“… Tomorrow calculated as: 2025-12-05
prosaas-backend  | ================================================================================
prosaas-backend  | 
prosaas-backend  | âœ… create_booking_agent RETURNED: True
prosaas-backend  | â±ï¸  AGENT_CREATION_TIME: 249ms
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (calls)
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (calls)
prosaas-backend  | ğŸ“‹ PROMPT LOADING: business_id=10, channel=whatsapp, custom_instructions provided=False
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.UndefinedColumn: column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.UndefinedColumn: column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | âš ï¸ Could not load DB prompt for business=10: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | ğŸ”¨ CALLING create_booking_agent(business_id=10, channel=whatsapp)
prosaas-backend  | 
prosaas-backend  | âš ï¸  NO DB prompt - using minimal fallback for ×§×œ×™×‘×¨
prosaas-backend  | 
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“œ AGENT INSTRUCTIONS (first 500 chars):
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ”’ SYSTEM CONTEXT (READ BUT DON'T MENTION):
prosaas-backend  | TODAY: 2025-12-04 20:57 (Israel)
prosaas-backend  | TOMORROW: 2025-12-05
prosaas-backend  | APPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)
prosaas-backend  | 
prosaas-backend  | âš ï¸ CRITICAL ANTI-HALLUCINATION RULES (BUILD 112):
prosaas-backend  | 1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true
prosaas-backend  | 2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn
prosaas-backend  | 3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn
prosaas-backend  | 4. ğŸ”¥ BUILD 112: 
prosaas-backend  | ...
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“… Today calculated as: 2025-12-04 (Thursday)
prosaas-backend  | ğŸ“… Tomorrow calculated as: 2025-12-05
prosaas-backend  | ================================================================================
prosaas-backend  | 
prosaas-backend  | âœ… create_booking_agent RETURNED: True
prosaas-backend  | â±ï¸  AGENT_CREATION_TIME: 121ms
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (whatsapp)
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (whatsapp)
prosaas-backend  | ğŸ“‹ PROMPT LOADING: business_id=1, channel=calls, custom_instructions provided=False
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | âš ï¸ Could not load DB prompt for business=1: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | ğŸ”¨ CALLING create_booking_agent(business_id=1, channel=calls)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  | 
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP COMPLETE: 0/4 agents ready in 438ms
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  | ğŸš€ System preheated - First AI response will be FAST!
prosaas-backend  | 
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | 
prosaas-backend  | âš ï¸  NO DB prompt - using minimal fallback for ×¤×¨×• ×¡××¡
prosaas-backend  | 
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“œ AGENT INSTRUCTIONS (first 500 chars):
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ”’ SYSTEM CONTEXT (READ BUT DON'T MENTION):
prosaas-backend  | TODAY: 2025-12-04 20:57 (Israel)
prosaas-backend  | TOMORROW: 2025-12-05
prosaas-backend  | APPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)
prosaas-backend  | 
prosaas-backend  | âš ï¸ CRITICAL ANTI-HALLUCINATION RULES (BUILD 112):
prosaas-backend  | 1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true
prosaas-backend  | 2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn
prosaas-backend  | 3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn
prosaas-backend  | 4. ğŸ”¥ BUILD 112: 
prosaas-backend  | ...
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“… Today calculated as: 2025-12-04 (Thursday)
prosaas-backend  | ğŸ“… Tomorrow calculated as: 2025-12-05
prosaas-backend  | ================================================================================
prosaas-backend  | 
prosaas-backend  | âœ… create_booking_agent RETURNED: True
prosaas-backend  | â±ï¸  AGENT_CREATION_TIME: 235ms
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (calls)
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (calls)
prosaas-backend  | ğŸ“‹ PROMPT LOADING: business_id=1, channel=whatsapp, custom_instructions provided=False
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  | 
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP COMPLETE: 0/4 agents ready in 463ms
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  | ğŸš€ System preheated - First AI response will be FAST!
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  | 
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | âœ… Service warmup thread completed
prosaas-backend  | âš ï¸ Could not load DB prompt for business=1: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | ğŸ”¨ CALLING create_booking_agent(business_id=1, channel=whatsapp)
prosaas-backend  | 
prosaas-backend  | âš ï¸  NO DB prompt - using minimal fallback for ×¤×¨×• ×¡××¡
prosaas-backend  | 
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“œ AGENT INSTRUCTIONS (first 500 chars):
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ”’ SYSTEM CONTEXT (READ BUT DON'T MENTION):
prosaas-backend  | TODAY: 2025-12-04 20:57 (Israel)
prosaas-backend  | TOMORROW: 2025-12-05
prosaas-backend  | APPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)
prosaas-backend  | 
prosaas-backend  | âš ï¸ CRITICAL ANTI-HALLUCINATION RULES (BUILD 112):
prosaas-backend  | 1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true
prosaas-backend  | 2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn
prosaas-backend  | 3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn
prosaas-backend  | 4. ğŸ”¥ BUILD 112: 
prosaas-backend  | ...
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“… Today calculated as: 2025-12-04 (Thursday)
prosaas-backend  | ğŸ“… Tomorrow calculated as: 2025-12-05
prosaas-backend  | ================================================================================
prosaas-backend  | 
prosaas-backend  | âœ… create_booking_agent RETURNED: True
prosaas-backend  | â±ï¸  AGENT_CREATION_TIME: 119ms
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (whatsapp)
prosaas-backend  | 
prosaas-backend  | ğŸ‰ WARMUP COMPLETE: 4 agents ready in 1693ms
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (whatsapp)
prosaas-backend  | 
prosaas-backend  | ğŸ‰ WARMUP COMPLETE: 4 agents ready in 1437ms
prosaas-backend  | âœ… Service warmup thread completed
prosaas-backend  |   ğŸ”¥ Warming 2 active businesses (Agent Cache)...
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.UndefinedColumn: column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP COMPLETE: 0/4 agents ready in 473ms
prosaas-backend  | ğŸš€ System preheated - First AI response will be FAST!
prosaas-backend  | 
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | âœ… Service warmup thread completed
prosaas-backend  | âœ… DATA PROTECTION: 0 FAQs preserved (no deletions)
prosaas-backend  | âœ… DATA PROTECTION: 19 leads preserved (no deletions)
prosaas-backend  | ğŸ”„ Starting admin roles migration...
prosaas-backend  | ğŸ“Š Found 1 users with legacy roles
prosaas-backend  | ğŸ“ Business admin: 'admin@shai-realestate.co.il' (ID=7): admin -> admin (business_id=1)
prosaas-backend  | 
prosaas-backend  | âœ… Successfully migrated 1 users to new role structure!
prosaas-backend  | âœ… DATA PROTECTION: 0 FAQs preserved (no deletions)
prosaas-backend  | âœ… DATA PROTECTION: 19 leads preserved (no deletions)
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ WARMUP: Pre-creating agents for active businesses...
prosaas-backend  | INFO:     172.18.0.6:59282 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.6:39366 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:39370 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:42996 - "GET /api/auth/me HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ”„ Starting admin roles migration...
prosaas-backend  | ğŸ” LOGIN ATTEMPT: email=calliber@gmail.com
prosaas-backend  | ğŸ“Š Found 1 users with legacy roles
prosaas-backend  | ğŸ“ Business admin: 'admin@shai-realestate.co.il' (ID=7): admin -> admin (business_id=1)
prosaas-backend  | 
prosaas-backend  | âœ… Successfully migrated 1 users to new role structure!
prosaas-backend  | ğŸ“Š Found 2 businesses to warm up
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (calls)
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (whatsapp)
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (calls)
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (whatsapp)
prosaas-backend  | 
prosaas-backend  | ğŸ‰ WARMUP COMPLETE: 4 agents ready in 883ms
prosaas-backend  | âœ“ Found user: id=10, email=calliber@gmail.com, role=owner
prosaas-backend  | âœ“ Password hash: scrypt:32768:8:1$NwJjYhcFJjcNjejm$9cc6e19d7dbac0ba...
prosaas-backend  | âœ“ Password verification result: True
prosaas-backend  | ğŸ‘¤ Admin exists (ID=8), resetting password to 'admin123'
prosaas-backend  | âœ… Admin password reset: admin@admin.com / admin123
prosaas-backend  | ğŸ”§ Starting database initialization...
prosaas-backend  | ğŸ‘¤ Admin exists (ID=8), resetting password to 'admin123'
prosaas-backend  | ğŸ” LOGIN SUCCESS: user_id=10, email=calliber@gmail.com, role=owner, business_id=10
prosaas-backend  | âœ… Business exists: ×¤×¨×• ×¡××¡ (ID: 1)
prosaas-backend  | INFO:     172.18.0.6:42998 - "POST /api/auth/login HTTP/1.1" 200 OK
prosaas-backend  | âœ… System admin user exists: admin@admin.com (ID: 8, role: system_admin, business_id: None)
prosaas-backend  | INFO:     172.18.0.6:43004 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | âœ… Admin password reset: admin@admin.com / admin123
prosaas-backend  | ğŸ”§ Starting database initialization...
prosaas-backend  | 
prosaas-backend  | ğŸ“Š Total users in database: 6
prosaas-backend  |   - User 3: manager@shai-realestate.co.il | role=agent | business_id=1
prosaas-backend  |   - User 2: business@shai-offices.co.il | role=owner | business_id=1
prosaas-backend  |   - User 7: admin@shai-realestate.co.il | role=admin | business_id=1
prosaas-backend  |   - User 9: freezeb123@gmail.com | role=owner | business_id=1
prosaas-backend  |   - User 10: calliber@gmail.com | role=owner | business_id=10
prosaas-backend  |   - User 8: admin@admin.com | role=system_admin | business_id=None
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | âœ… Lead statuses exist: 4 statuses found
prosaas-backend  | âœ… FAQs table exists: 0 FAQs found across all businesses
prosaas-backend  | âŒ Database initialization failed: (psycopg2.errors.UndefinedColumn) column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.UndefinedColumn: column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/init_database.py", line 172, in initialize_production_database
prosaas-backend  |     existing_settings = BusinessSettings.query.filter_by(tenant_id=business.id).first()
prosaas-backend  |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | 
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | âœ… Business exists: ×¤×¨×• ×¡××¡ (ID: 1)
prosaas-backend  | INFO:     172.18.0.6:43012 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:43016 - "GET /api/admin/businesses?pageSize=1 HTTP/1.1" 403 Forbidden
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | âœ… System admin user exists: admin@admin.com (ID: 8, role: system_admin, business_id: None)
prosaas-backend  | 
prosaas-backend  | ğŸ“Š Total users in database: 6
prosaas-backend  |   - User 3: manager@shai-realestate.co.il | role=agent | business_id=1
prosaas-backend  |   - User 2: business@shai-offices.co.il | role=owner | business_id=1
prosaas-backend  |   - User 7: admin@shai-realestate.co.il | role=admin | business_id=1
prosaas-backend  |   - User 9: freezeb123@gmail.com | role=owner | business_id=1
prosaas-backend  |   - User 10: calliber@gmail.com | role=owner | business_id=10
prosaas-backend  |   - User 8: admin@admin.com | role=system_admin | business_id=None
prosaas-backend  | âœ… Lead statuses exist: 4 statuses found
prosaas-backend  | âœ… FAQs table exists: 0 FAQs found across all businesses
prosaas-backend  | âŒ Database initialization failed: (psycopg2.errors.UndefinedColumn) column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.UndefinedColumn: column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/init_database.py", line 172, in initialize_production_database
prosaas-backend  |     existing_settings = BusinessSettings.query.filter_by(tenant_id=business.id).first()
prosaas-backend  |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | 
prosaas-backend  | âœ… DATA PROTECTION: 0 FAQs preserved (no deletions)
prosaas-backend  | âœ… DATA PROTECTION: 19 leads preserved (no deletions)
prosaas-backend  | ğŸ”„ Starting admin roles migration...
prosaas-backend  | ğŸ“Š Found 1 users with legacy roles
prosaas-backend  | ğŸ“ Business admin: 'admin@shai-realestate.co.il' (ID=7): admin -> admin (business_id=1)
prosaas-backend  | 
prosaas-backend  | âœ… Successfully migrated 1 users to new role structure!
prosaas-backend  | INFO:     172.18.0.6:43032 - "GET /api/dashboard/stats?time_filter=today HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:43040 - "GET /api/dashboard/activity?time_filter=today HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:43050 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ‘¤ Admin exists (ID=8), resetting password to 'admin123'
prosaas-backend  | âœ… Admin password reset: admin@admin.com / admin123
prosaas-backend  | ğŸ”§ Starting database initialization...
prosaas-backend  | INFO:     172.18.0.6:43052 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:43064 - "GET /api/admin/businesses?pageSize=1 HTTP/1.1" 403 Forbidden
prosaas-backend  | âœ… Business exists: ×¤×¨×• ×¡××¡ (ID: 1)
prosaas-backend  | âœ… System admin user exists: admin@admin.com (ID: 8, role: system_admin, business_id: None)
prosaas-backend  | 
prosaas-backend  | ğŸ“Š Total users in database: 6
prosaas-backend  |   - User 3: manager@shai-realestate.co.il | role=agent | business_id=1
prosaas-backend  |   - User 2: business@shai-offices.co.il | role=owner | business_id=1
prosaas-backend  |   - User 7: admin@shai-realestate.co.il | role=admin | business_id=1
prosaas-backend  |   - User 9: freezeb123@gmail.com | role=owner | business_id=1
prosaas-backend  |   - User 10: calliber@gmail.com | role=owner | business_id=10
prosaas-backend  |   - User 8: admin@admin.com | role=system_admin | business_id=None
prosaas-backend  | âœ… Lead statuses exist: 4 statuses found
prosaas-backend  | âœ… FAQs table exists: 0 FAQs found across all businesses
prosaas-backend  | âŒ Database initialization failed: (psycopg2.errors.UndefinedColumn) column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.UndefinedColumn: column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/init_database.py", line 172, in initialize_production_database
prosaas-backend  |     existing_settings = BusinessSettings.query.filter_by(tenant_id=business.id).first()
prosaas-backend  |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column business_settings.enable_calendar_scheduling does not exist
prosaas-backend  | LINE 1: ...eaks_first AS business_settings_bot_speaks_first, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | 
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:36230 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     127.0.0.1:50460 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:36232 - "GET /api/business/current/prompt HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:60230 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:60246 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:60250 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:60256 - "GET /api/business/current/prompt HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:40232 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | [WA-SESSION] ğŸ“± Check #1: Found 0 stale sessions to process
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:41532 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:39538 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:37850 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:37858 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:45214 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:50784 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:50788 - "GET /api/auth/me HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ” LOGIN ATTEMPT: email=calliber@gmail.com
prosaas-backend  | âœ“ Found user: id=10, email=calliber@gmail.com, role=owner
prosaas-backend  | âœ“ Password hash: scrypt:32768:8:1$NwJjYhcFJjcNjejm$9cc6e19d7dbac0ba...
prosaas-backend  | âœ“ Password verification result: True
prosaas-backend  | ğŸ” LOGIN SUCCESS: user_id=10, email=calliber@gmail.com, role=owner, business_id=10
prosaas-backend  | INFO:     172.18.0.6:50796 - "POST /api/auth/login HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:50298 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:50300 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:50302 - "GET /api/admin/businesses?pageSize=1 HTTP/1.1" 403 Forbidden
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:50310 - "GET /api/dashboard/stats?time_filter=today HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:50322 - "GET /api/dashboard/activity?time_filter=today HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:50334 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:50342 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:50358 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:50362 - "GET /api/admin/businesses?pageSize=1 HTTP/1.1" 403 Forbidden
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:50366 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:50378 - "GET /api/business/current/prompt HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:56330 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:49894 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:49908 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:37248 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:42120 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:59480 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:58154 - "PUT /api/business/current/prompt HTTP/1.1" 500 Internal Server Error
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:41890 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:41892 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:41898 - "PUT /api/business/current/prompt HTTP/1.1" 500 Internal Server Error
prosaas-backend  | INFO:     127.0.0.1:42768 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:37504 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:60568 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:42924 - "GET /api/admin/users HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:42926 - "GET /api/auth/me HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:42936 - "GET /api/leads HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:42950 - "GET /api/reminders HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:42966 - "GET /api/calls?search=&status=all&direction=all&limit=25&offset=0 HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:53704 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:53718 - "GET /api/statuses HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:53726 - "GET /api/leads?page=1&pageSize=25 HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:53742 - "GET /api/statuses HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:53748 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:53760 - "GET /api/statuses HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:53764 - "GET /api/statuses HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:37512 - "GET /api/whatsapp/status HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:37518 - "GET /api/business/current/prompt HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     127.0.0.1:59538 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:37528 - "GET /api/crm/threads HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:37538 - "GET /api/whatsapp/summaries HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:37542 - "GET /api/whatsapp/active-chats HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:37556 - "GET /api/whatsapp/provider-info HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:32846 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0