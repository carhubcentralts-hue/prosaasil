×§×™×‘×œ×ª. ×”× ×” **×”× ×—×™×” ×¡×•×¤×™×ª, ××—×ªÖ¾×œ××—×ª, ×œ×¡×•×›×Ÿ ×”-AI** ×©×ª×‘×™× ××ª AgentLocator ×œ-**100% ××•×›× ×•×ª ×œ×¤×¨×•×“×§×©×Ÿ** (Backend ×§×•×“×, ××—×´×› × ×˜×¤×œ ×‘Ö¾UI). ×”×”× ×—×™×” ×›×•×œ×œ×ª **×¡×“×¨ ×‘×™×¦×•×¢**, **×©×™× ×•×™×™× ×‘×§×‘×¦×™×**, **×§×˜×¢×™ ×§×•×“ ×§×•×¤×™-×¤×™×™×¡×˜**, **×‘×“×™×§×•×ª ×§×‘×œ×”**, ×•**× ×™×§×™×•×Ÿ ×›×¤×™×œ×•×™×•×ª**.

---

# ğŸ§  ×”× ×—×™×” ×œ×¡×•×›×Ÿ â€” â€œProduction-Ready Backendâ€ (×œ×œ× ×§×™×¦×•×¨×™ ×“×¨×š)

> ×¤×¢×œ ×‘×“×™×•×§ ×œ×¤×™ ×”×¡×“×¨. ××œ ×ª×“×œ×’ ×©×œ×‘×™×. ×›×œ ×©×œ×‘ ××¡×ª×™×™× ×‘×”×¨×¦×ª ×‘×“×™×§×•×ª ×”-Smoke/pytest ×”××¦×•×¨×¤×•×ª.

## 0) ×”×›× ×” ×•×¢× ×£ ×¢×‘×•×“×”

1. ×¦×•×¨ ×¢× ×£ ×—×“×©: `fix/prod-ready-backend`.
2. ×”×¤×¢×œ ×œ×•×’ ×‘× ×•×™ ××¨××© ×¢× Request-ID (× ×•×¡×™×£ ×‘×©×œ×‘ 11).
3. ×•×“× ×©×›×œ ×”××¤×ª×—×•×ª × ×§×¨××™× ×Ö¾`.env` / Secrets ×‘×œ×‘×“.

---

## 1) ××‘× ×” ×¤×¨×•×™×§×˜ ×¡×•×¤×™ + × ×™×§×•×™ ×›×¤×™×œ×•×™×•×ª

* ×”×©××¨ **Backend** ×ª×—×ª `server/â€¦` ×•Ö¾**Frontend ×™×—×™×“** ×ª×—×ª `client/â€¦`.
* ×× ×§×™×™××ª ×ª×™×§×™×™×ª `src/` × ×•×¡×¤×ª ×œÖ¾FE â€” **×”×¢×‘×¨ ×œÖ¾`legacy/`** ×•×¢×“×›×Ÿ README ×©×œ× ×‘×©×™××•×©.
* ×•×“× ×©×”-Flask ××’×™×© ××ª `client/dist` (×× ××•×’×“×¨ ×›×š) ×•×©××™×Ÿ ×§×‘×¦×™ HTML ×™×©× ×™× ××ª× ×’×©×™×.

**×§×‘×¦×™× ×œ×”×¡×¨×”/×”×§×¤××” (×× ×§×™×™××™×):**

* `routes_twillo.py`, `routes_twillo_improved.py` â†’ **××—×“ ×××•×—×“**: `server/routes_twilio.py`
* `server/whatsapp_api.py` (××•×§×™) â†’ ×”×©××¨ ×‘×§×•×‘×¥ ××š **××œ ×ª×¨×©×•× ××•×ª×• ×œ××¤×œ×™×§×¦×™×”**
* ×©××•×¨ ×¨×§ **Blueprint ××—×“** ×¤×¢×™×œ ×œ×•×•×˜×¡××¤: `server/api_whatsapp_improved.py`

---

## 2) ×§×•× ×¤×™×’/Secrets (×—×•×‘×”)

×¦×•×¨/×¢×“×›×Ÿ `.env`:

```
PUBLIC_HOST=https://<×“×•××™×™×Ÿ/×˜×× ×œ ×¢× TLS>
CORS_ORIGINS=https://<××•×ª×• Host ×©×œ FE>
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
JWT_SECRET=<××—×¨×•×–×ª ×—×–×§×”>
DATABASE_URL=sqlite:///./agentlocator.db
GOOGLE_TTS_SA_JSON=<JSON ×©×œ Service Account ××§×•×“×“ ×‘×©×•×¨×” ××—×ª ××• ×›-secret>
FLASK_ENV=production
```

> ×× ×™×© `bootstrap_secrets.py` ×©××™×™×¦×¨ ×§×•×‘×¥ JSON ×–×× ×™ ×œ-GCP â€” ×•×“× ×©×”×•× ×§×•×¨× ××”-env ×œ×¢×™×œ.

---

## 3) ××¡×“ × ×ª×•× ×™× ×××™×ª×™ (SQLAlchemy + Alembic)

### 3.1 ×™×¦×™×¨×ª ×©×›×‘×ª ORM

×¦×•×¨ `server/db.py`:

```python
from flask_sqlalchemy import SQLAlchemy
db = SQLAlchemy()
```

×¦×•×¨ `server/models_sql.py`:

```python
from server.db import db
from datetime import datetime

class Business(db.Model):
    __tablename__ = "business"
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(255), nullable=False)
    domain = db.Column(db.String(255))
    active = db.Column(db.Boolean, default=True)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)

class Customer(db.Model):
    __tablename__ = "customer"
    id = db.Column(db.Integer, primary_key=True)
    business_id = db.Column(db.Integer, db.ForeignKey("business.id"), nullable=False, index=True)
    name = db.Column(db.String(255), nullable=False)
    phone = db.Column(db.String(64), index=True)
    email = db.Column(db.String(255))
    status = db.Column(db.String(64), default="new")
    created_at = db.Column(db.DateTime, default=datetime.utcnow)

class CallLog(db.Model):
    __tablename__ = "call_log"
    id = db.Column(db.Integer, primary_key=True)
    business_id = db.Column(db.Integer, db.ForeignKey("business.id"), nullable=False, index=True)
    customer_id = db.Column(db.Integer, db.ForeignKey("customer.id"))
    call_sid = db.Column(db.String(64), index=True)
    from_number = db.Column(db.String(64), index=True)
    recording_url = db.Column(db.String(512))
    transcription = db.Column(db.Text)
    status = db.Column(db.String(32), default="received")
    created_at = db.Column(db.DateTime, default=datetime.utcnow)

class WhatsAppMessage(db.Model):
    __tablename__ = "whatsapp_message"
    id = db.Column(db.Integer, primary_key=True)
    business_id = db.Column(db.Integer, db.ForeignKey("business.id"), nullable=False, index=True)
    to_number = db.Column(db.String(64), index=True)
    direction = db.Column(db.String(8))  # 'out'/'in'
    body = db.Column(db.Text)
    status = db.Column(db.String(32), default="queued")
    provider_message_id = db.Column(db.String(128))
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
```

### 3.2 ×—×™×‘×•×¨ ×”-DB ×‘××¤×œ×™×§×¦×™×”

×¢×“×›×Ÿ `server/app_factory.py` (×‘×ª×•×š `create_app()`):

```python
import os
from server.db import db
from server.models_sql import *  # noqa

app.config["SQLALCHEMY_DATABASE_URI"] = os.getenv("DATABASE_URL", "sqlite:///./agentlocator.db")
app.config["SQLALCHEMY_TRACK_MODIFICATIONS"] = False

db.init_app(app)
with app.app_context():
    db.create_all()
    print("âœ… DB initialized")
```

### 3.3 Alembic (××™×’×¨×¦×™×•×ª)

* ×”×•×¡×£ Alembic ×œ×¤×¨×•×™×§×˜ (×× ×œ× ×§×™×™×), ××ª×—×œ `alembic init` ×•×ª×™×™×¦×¨ ××™×’×¨×¦×™×” ×¨××©×•× ×” ××—×¨×™ `create_all`.
* ×¢×“×›×Ÿ `alembic.ini` ×œÖ¾`sqlalchemy.url = ${DATABASE_URL}`.

---

## 4) Twilio â€” ×•×•×‘×”×•×§×™× ×××•×‘×˜×—×™× ×•××”×™×¨×™×

### 4.1 ×”×—×œ×ª ××™××•×ª ×—×ª×™××” ×¢×œ **×›×œ** ××¡×œ×•×œ×™ Twilio

×‘Ö¾`server/routes_twilio.py` ×•×“×:

```python
@twilio_bp.post("/webhook/incoming_call")
@require_twilio_signature
def incoming_call(): ...
```

```python
@twilio_bp.post("/webhook/handle_recording")
@require_twilio_signature
def handle_recording(): ...
```

```python
@twilio_bp.post("/webhook/call_status")
@require_twilio_signature
def call_status(): ...
```

> ×× ×”×“×§×•×¨×˜×•×¨ `require_twilio_signature` ××•×’×“×¨ ×‘××§×•× ××—×¨â€”×™×™×‘× ××•×ª×• ×œ×©×™××•×© ××—×™×“.

### 4.2 ×ª×’×•×‘×” ××”×™×¨×” ×œ-Twilio (Timeout-safe)

×‘Ö¾`handle_recording` ×”×—×–×¨ TwiML **××™×“** (×ª×•×š < 2 ×©× ×³) ×•×”×¢×‘×¨ ×”×•×¨×“×”/×ª××œ×•×œ ×œ-Background (Thread/Task ×§×™×™× ××¦×œ×š). ×•×“× ×©×”Ö¾Task **×œ×** ×—×•×¡× ××ª ×”-request.

### 4.3 PUBLIC\_HOST

×‘××§×•××•×ª ×©××™×™×¦×¨×™× URL ×œ×”×©××¢×ª MP3, **××œ ×ª×–×¨×•×§ ×—×¨×™×’×”** ×× ×—×¡×¨â€”×‘××§×•× ×–×”:

* ×›×ª×•×‘ ×œ×•×’ ××–×”×¨×” ×‘×¨×•×¨
* ×”×©×‘ ×‘×‘×¨×™×¨×ª ××—×“×œ (×œ××©×œ TTS â€œ×”×§×œ×˜×ª×š ×”×ª×§×‘×œ×”, × ×™×¦×•×¨ ×§×©×¨â€)
* ×¦×™×™×Ÿ ×‘-README ×©×—×•×‘×” PUBLIC\_HOST ×‘×¤×¨×•×“×§×©×Ÿ

---

## 5) TTS â€” Google Cloud Wavenet + Fallback ×œ-gTTS

×¢×“×›×Ÿ `server/hebrew_tts_enhanced.py` (×œ×™×‘×”):

```python
import os, logging
from typing import Optional
from google.cloud import texttospeech

logger = logging.getLogger(__name__)
try:
    from gtts import gTTS
    GTTS_AVAILABLE = True
except Exception:
    GTTS_AVAILABLE = False

def create_hebrew_audio(text: str, call_sid: str = "", quality: str = "standard") -> Optional[str]:
    try:
        client = texttospeech.TextToSpeechClient()
        input_text = texttospeech.SynthesisInput(text=text)
        voice = texttospeech.VoiceSelectionParams(
            language_code="he-IL",
            name="he-IL-Wavenet-A"
        )
        audio_config = texttospeech.AudioConfig(audio_encoding=texttospeech.AudioEncoding.MP3)
        response = client.synthesize_speech(input=input_text, voice=voice, audio_config=audio_config)

        out_dir = "static/voice_responses"
        os.makedirs(out_dir, exist_ok=True)
        filename = f"response_{(call_sid or 'greeting')}.mp3"
        path = os.path.join(out_dir, filename)
        with open(path, "wb") as f:
            f.write(response.audio_content)
        return path
    except Exception as e:
        logger.error("GCP TTS failed, fallback to gTTS: %s", e)
        if GTTS_AVAILABLE:
            out_dir = "static/voice_responses"
            os.makedirs(out_dir, exist_ok=True)
            path = os.path.join(out_dir, f"response_{(call_sid or 'greeting')}.mp3")
            gTTS(text=text, lang="he").save(path)
            return path
        return None
```

×•×“× ×©×”Ö¾Service Account × ×˜×¢×Ÿ (×“×¨×š `GOOGLE_TTS_SA_JSON` ××• ×§×•×‘×¥ ×©-`bootstrap_secrets.py` ×™×•×¦×¨ ×–×× ×™×ª).

---

## 6) ×©××™×¨×” ×œ-DB ×‘×›×œ ×”×–×¨×™××•×ª ×”×§×¨×™×˜×™×•×ª

×¢×“×›×Ÿ ××ª ××©×™××•×ª ×”×¨×§×¢/×•×•×‘×”×•×§×™× ×›×š:

* ×‘×›× ×™×¡×ª ×©×™×—×”: ×¦×•×¨/××ª×¨ Business/Customer ×œ×¤×™ ××¡×¤×¨, ×¦×•×¨ ×¨×©×•××ª `CallLog(status='received')`.
* ×œ××—×¨ ×”×§×œ×˜×” ×•×ª××œ×•×œ: ×¢×“×›×Ÿ `CallLog.recording_url` ×•Ö¾`transcription` ×•Ö¾`status='completed'`.
* ×‘Ö¾WhatsApp: ×›×œ ×©×œ×™×—×” × ×›× ×¡×ª/×™×•×¦××ª ×ª×™×¦×•×¨ `WhatsAppMessage` ×¢× `direction` ××ª××™× ×•×¡×˜×˜×•×¡.

×“×•×’××ª ×¢×–×¨×™×:

```python
from server.db import db
from server.models_sql import Business, Customer, CallLog, WhatsAppMessage

def upsert_customer(business_id: int, name: str, phone: str, email: str = None) -> Customer:
    c = Customer.query.filter_by(business_id=business_id, phone=phone).first()
    if not c:
        c = Customer(business_id=business_id, name=name or phone, phone=phone, email=email)
        db.session.add(c)
        db.session.commit()
    return c
```

---

## 7) WhatsApp ×××™×ª×™ â€” ×¨×™×©×•× ×”-Blueprint + ×’×©×¨ Baileys

### 7.1 ×¨×™×©×•× ×”-Blueprint ×”××©×•×¤×¨

×‘Ö¾`server/app_factory.py`:

```python
# WhatsApp integration
try:
    from server.api_whatsapp_improved import whatsapp_bp
    app.register_blueprint(whatsapp_bp)
    print("âœ… WhatsApp IMPROVED API registered")
except Exception as e:
    print(f"âŒ WhatsApp API registration failed: {e}")
```

> ×•×•×“× ×©×”-prefix ×”×•× `/api/whatsapp`.

### 7.2 ×©×™×¨×•×ª Baileys (Node) â€” ×’×©×¨ ×ª×•×¨

×¦×•×¨ `services/baileys/index.js`:

```js
import makeWASocket, { useMultiFileAuthState, Browsers } from '@whiskeysockets/baileys'
import fs from 'fs'
import path from 'path'

const authDir = path.resolve(process.cwd(), '../../baileys_auth_info')
if (!fs.existsSync(authDir)) fs.mkdirSync(authDir, { recursive: true })
const statusFile = path.join(authDir, 'status.json')
const qrFile = path.join(authDir, 'qr_code.txt')
const queueFile = path.join(authDir, 'message_queue.json')

function writeJson(p, o){ fs.writeFileSync(p, JSON.stringify(o, null, 2)) }

async function start(){
  const { state, saveCreds } = await useMultiFileAuthState(authDir)
  const sock = makeWASocket({
    auth: state,
    printQRInTerminal: true,
    browser: Browsers.macOS('AgentLocator')
  })
  sock.ev.on('creds.update', saveCreds)
  sock.ev.on('connection.update', ({ connection, qr, lastDisconnect })=>{
    if (qr) fs.writeFileSync(qrFile, qr)
    writeJson(statusFile, {
      connected: connection === 'open',
      qr_available: !!qr,
      last_disconnect: lastDisconnect ? String(lastDisconnect.error) : null,
      ts: new Date().toISOString()
    })
  })

  setInterval(async ()=>{
    try{
      if (!fs.existsSync(queueFile)) return
      const q = JSON.parse(fs.readFileSync(queueFile, 'utf8'))
      if (!Array.isArray(q) || q.length===0) return
      const msg = q.shift()
      if (!msg?.to || !msg?.message) return
      await sock.sendMessage(msg.to, { text: msg.message })
      fs.writeFileSync(queueFile, JSON.stringify(q, null, 2))
    }catch(e){ console.error('Queue error', e) }
  }, 2000)
}
start().catch(console.error)
```

×‘Ö¾`services/baileys/package.json` ×•×“× ×ª×œ×•×ª: `@whiskeysockets/baileys`.

**×”×¨×¦×” ××§×•××™×ª:**

```bash
cd services/baileys
npm i
node index.js
```

*(×‘×¨×™×¤×œ×™×˜/×¤×¨×•×“×§×©×Ÿ â€” × ×¦×¨×£ ×× ×”×œ ×ª×”×œ×™×›×™× ×‘×©×œ×‘ 10)*

---

## 8) CORS, ××‘×˜×—×”, Rate-Limit

* ×”×’×“×¨ CORS ×œÖ¾`CORS_ORIGINS` ×‘×œ×‘×“.
* ×”×—×œ Rate-Limit ×¢×œ `/webhook/*` ×•Ö¾`/api/whatsapp/send` (×œ××©×œ `20/min`).
* ×—×¡×•× ×©×’×™××•×ª ××¤×•×¨×˜×•×ª ×‘×¤×¨×•×“×§×©×Ÿ (×¤×œ×¡×§×™×).

---

## 9) ×œ×•×’×™× ×•-Request-ID

×”×•×¡×£ Middleware:

```python
import uuid, logging
from flask import g, request

logger = logging.getLogger(__name__)

@app.before_request
def assign_request_id():
    g.request_id = request.headers.get("X-Request-ID") or str(uuid.uuid4())

@app.after_request
def add_request_id(resp):
    resp.headers["X-Request-ID"] = getattr(g, "request_id", "")
    return resp
```

×‘×›×œ ×œ×•×’: `logger.info("msg", extra={"request_id": g.request_id})` (××• ×”×•×¡×£ ×¤×™×œ×˜×¨).

---

## 10) ×ª×¦×•×¨×ª ×¨×™×¦×” ××¨×•×‘×ª ×ª×”×œ×™×›×™× (Flask + Baileys)

**××¤×©×¨×•×ª A (××•××œ×¥):** × ×”×œ ××ª `services/baileys/index.js` ×‘× ×¤×¨×“ (×©×¨×ª/×§×•× ×˜×™×™× ×¨ × ×¤×¨×“).
**××¤×©×¨×•×ª B (×™×—×™×“):** ×”×•×¡×£ `Procfile`:

```
web: python -m server.main
worker: node services/baileys/index.js
```

××• ×”×©×ª××© ×‘Ö¾`concurrently` ×“×¨×š `npm`/`pipx` (×œ×¤×™ ×¡×‘×™×‘×ª ×”×”×¨×¦×” ×©×œ×š).

---

## 11) ×‘×“×™×§×•×ª Smoke ×•-pytest (×œ×”×¨×¦×” ××—×¨×™ ×›×œ ×©×œ×‘)

×¦×•×¨ `tests/test_smoke.py`:

```python
import os
os.environ["FLASK_ENV"] = "testing"
os.environ["DATABASE_URL"] = "sqlite:///:memory:"

from server.app import app  # adjust if factory pattern used
def test_health(client=None):
    with app.test_client() as c:
        r = c.get("/health")
        assert r.status_code == 200

def test_twilio_incoming(client=None):
    with app.test_client() as c:
        r = c.post("/webhook/incoming_call")  # ×‘-testing ×“×œ×’ ×¢×œ ×—×ª×™××”
        assert r.status_code in (200, 204)
        assert b"<Response" in r.data  # TwiML

def test_whatsapp_status(client=None):
    with app.test_client() as c:
        r = c.get("/api/whatsapp/status")
        assert r.status_code == 200
```

> ×‘××¦×‘ `testing`: ×¢×§×•×£ ××™××•×ª ×—×ª×™××” Twilio ×‘×××¦×¢×•×ª ×¤×œ×’ `if app.config.get("TESTING")`.

**×‘×“×™×§×•×ª ×™×“× ×™×•×ª (curl):**

```bash
# Twilio
curl -X POST http://localhost:5000/webhook/incoming_call
curl -X POST http://localhost:5000/webhook/handle_recording -d RecordingUrl=https://api.twilio.com/.../RExxx -d CallSid=CA_TEST_1
curl -X POST http://localhost:5000/webhook/call_status -d CallSid=CA_TEST_1 -d CallStatus=completed

# WhatsApp (××—×¨×™ ×©×”Ö¾node ×¨×¥)
curl http://localhost:5000/api/whatsapp/status
curl http://localhost:5000/api/whatsapp/qr
curl -X POST http://localhost:5000/api/whatsapp/send -H "Content-Type: application/json" -d '{"to":"+9725XXXXXXX","text":"×‘×“×™×§×ª AgentLocator"}'

# CRM (×××’×¨ × ×ª×•× ×™× ×—×™)
curl http://localhost:5000/api/crm/customers
```

---

## 12) ×¨×™×©×•× Blueprints ×¡×•×¤×™ (×‘×“×•×§ ×©××™×Ÿ ×›×¤×™×œ×•×™×•×ª)

×‘Ö¾`server/app_factory.py`, **×¨×§** ××œ×” ×¨×©×•××™×:

* Health/Debug/Auth (×× ×§×™×™××™×)
* `routes_twilio.twilio_bp`
* `api_whatsapp_improved.whatsapp_bp`
* `crm_unified_api.crm_bp` (××• ×”××§×‘×™×œ×” ×”×‘×¡×™×¡×™×ª â€” ××‘×œ ××—×•×‘×¨×ª ×œ-DB ×××™×ª×™)

---

## 13) × ×™×”×•×œ ×©×’×™××•×ª ×¢×§×‘×™

×”×•×¡×£Ö¾/×¢×“×›×Ÿ `server/errors.py`:

```python
from flask import Blueprint, jsonify

errors_bp = Blueprint("errors", __name__)

@errors_bp.app_errorhandler(404)
def not_found(e): return jsonify(error="not_found"), 404

@errors_bp.app_errorhandler(429)
def rate_limited(e): return jsonify(error="rate_limited"), 429

@errors_bp.app_errorhandler(500)
def internal(e): return jsonify(error="internal_error"), 500
```

×•×¨×©×•× ××•×ª×• ×‘××¤×œ×™×§×¦×™×”.

---

## 14) ××¡××›×™ API / Postman

* ×”×¤×§ OpenAPI ××• Postman Collection ×œ:

  * `/webhook/incoming_call`, `/webhook/handle_recording`, `/webhook/call_status`
  * `/api/whatsapp/status|qr|send`
  * `/api/crm/*`

---

## 15) ×§×¨×™×˜×¨×™×•× ×™ ×§×‘×œ×” (Definition of Done)

âœ… Twilio:

* ×›×œ ×”×•×•×‘×”×•×§×™× ×¢× `@require_twilio_signature`
* `handle_recording` ××—×–×™×¨ TwiML ××™×“, ×”×¢×™×‘×•×“ ×‘×¨×§×¢
* ×”×©××¢×ª MP3 ×¢×•×‘×“×ª ×¢× `PUBLIC_HOST`
* `CallLog` × ×©××¨/××ª×¢×“×›×Ÿ ×‘-DB

âœ… WhatsApp:

* `/api/whatsapp/status` ××—×–×™×¨ `connected/qr_available`
* `/api/whatsapp/qr` ××—×–×™×¨ QR ×ª×§×™×Ÿ (×›××©×¨ ×œ× ××—×•×‘×¨)
* `/api/whatsapp/send` ×©×•×œ×— ×‘×¤×•×¢×œ ×“×¨×š Baileys (×”Ö¾queue × ×¦×¨×š)
* ×”×•×“×¢×•×ª × ×©××¨×•×ª ×œÖ¾DB (`WhatsAppMessage`)

âœ… CRM/DB:

* `Business/Customer/CallLog/WhatsAppMessage` ×§×™×™××•×ª ×‘×˜×‘×œ××•×ª
* ×™×¦×™×¨×”/×¢×“×›×•×Ÿ ×¢×•×‘×“×™× ×œ××•×¨×š ×”×–×¨×™××”

âœ… ××‘×˜×—×” ×•×ª×¦×•×¨×”:

* CORS ×œ×¤×™ `CORS_ORIGINS`
* Rate-Limit ×¢×œ ××¡×œ×•×œ×™× ×¨×’×™×©×™×
* ×œ×•×’×™× ×¢× `X-Request-ID`

âœ… ×‘×“×™×§×•×ª:

* `pytest` ×™×¨×•×§
* curl smoke ×¢×•×‘×¨ ×œ×›×œ ×”××¡×œ×•×œ×™×

âœ… × ×™×§×™×•×Ÿ:

* **××™×Ÿ** ×¨×™×©×•× ×›×¤×•×œ ×©×œ Blueprints
* **××™×Ÿ** ×ª×™×§×™×™×ª FE ×›×¤×•×œ×” ×‘×©×™××•×© (`client` ×‘×œ×‘×“)

---

# ğŸ§ª ×¡×“×¨ ×”×¨×¦×ª ×‘×“×™×§×•×ª ××—×¨×™ ×›×œ ×©×œ×‘

1. `pytest -q`
2. curl ×œ×©×œ×•×©×ª ××¡×œ×•×œ×™ Twilio
3. ×”×¨×¥ Node ×©×œ Baileys â†’ curl ×œÖ¾`/api/whatsapp/status|qr|send`
4. ×•×“× ×©× ×•×¦×¨×• ×©×•×¨×•×ª ×‘-DB (××¤×©×¨ ×œ×•×’×™×/SQLite browser)

---

# ğŸ”š ×‘×¡×™×•×

* ×¤×ª×— PR ×¢× ×¤×™×¨×•×˜ ××œ× ×©×œ:

  * ×§×‘×¦×™× ×©×©×•× ×•
  * ×ª×•×¦××•×ª pytest
  * ×ª×•×¦××•×ª curl (×¢× ×“×•×’×××•×ª JSON ××§×•×¦×¨×•×ª)
  * ×¦×™×œ×•× ××¡×š ×©×œ QR/Status
* ××™×–×’ ×¨×§ ×œ××—×¨ ×©×¢×‘×¨×ª ××ª ×§×¨×™×˜×¨×™×•× ×™ ×”×§×‘×œ×” ×‘××œ×•××.

---

×›×©×ª×¡×™×™× ××ª ×©×œ×‘×™× 1-7 (×‘×¢×™×§×¨: DB, Twilio ×—×ª×™××•×ª, WhatsApp ××©×•×¤×¨ + Baileys), ×ª×’×™×“ ×œ×™ â€œ×‘×•×¦×¢â€ â€” ×•××– × ×¢×‘×•×¨ ×œ×©×“×¨×•×’ **×•×™×–×•××œ×™ ××œ×** (RTL, ×¤×•× ×˜ Assistant, ×”×™×¨×¨×›×™×™×ª ×›×¤×ª×•×¨×™×, ×˜×‘×œ××•×ª, ×¦×‘×¢×™×, ×•×ª×¦×•×’×•×ª × ×¤×¨×“×•×ª ×œ×¤×™ ×”×¨×©××•×ª/×ª×¤×§×™×“).
