××¢×•×œ×”! ×× ×™ ×”×•×œ×š ×œ×ª×ª ×œ×š ×¡×˜ ×‘×“×™×§×•×ª ××•×˜×•××˜×™ ××œ× ×œ×”×¨×¦×” ×¢×›×©×™×• ×‘Ö¾Replit, ×›×“×™ ×œ×•×•×“× ×©×›×œ ×”××¢×¨×›×•×ª (×©×™×—×•×ª, WhatsApp, CRM) ×ª×§×™× ×•×ª ××—×¨×™ ×”×¤×¨×™×¡×”. ×× ×™ ×œ× ×¤×•×ª×— ×›××Ÿ ××ª ×”-ZIP ×©×œ×š, ××– ×”×›× ×ª×™ ×œ×š ×‘×“×™×§×•×ª ×©×ª×•×›×œ ×œ×”×¨×™×¥ ×¢×œ ×”×¤×¨×•×™×§×˜ ×©×œ×š ×™×©×™×¨×•×ªâ€”×™×§×‘×œ×• âœ…/âŒ ×‘×¨×•×¨ ×œ×›×œ ×¨×›×™×‘.

â¸»

ğŸ” ××” ×œ×”×¨×™×¥ ×¢×›×©×™×• (×¦×¢×“Ö¾××—×¨Ö¾×¦×¢×“)

0) ×”×›× ×•×ª (×¤×¢× ××—×ª)

×‘×˜×¨××™× ×œ ×©×œ Replit (××• ×‘Ö¾Shell):

python3 -m pip install --upgrade pip
python3 -m pip install httpx==0.27.2 rich==13.7.1 PyJWT==2.8.0

1) ×‘×“×™×§×ª ×ª×œ×•×ª×™× ×•Ö¾runtime

×¦×¨×£ ×œÖ¾requirements.txt ××ª ××œ×” (×× ×—×¡×¨ ××©×”×• â€“ ×œ×”×•×¡×™×£):

flask
gunicorn==21.2.0
eventlet==0.36.1
greenlet>=2.0
twilio
python-dotenv
requests
httpx
PyJWT

×•××–:

python3 - <<'PY'
import importlib, sys
mods = ["flask","gunicorn","eventlet","greenlet","twilio","requests"]
missing=[m for m in mods if importlib.util.find_spec(m) is None]
print("Missing:", missing if missing else "OK")
PY

×¦×™×¤×™×”: OK.

2) Smoke ×‘×“×™×§×•×ª HTTP ×‘×¡×™×¡×™×•×ª (Health/Root)

×¦×•×¨ ×§×•×‘×¥ post_deploy_smoke.py ×•×”×“×‘×§:

import os, time, httpx
BASE = os.environ.get("BASE_URL", "https://<×”×“×•××™×™×Ÿ-×©×œ×š>")

def check(path, method="GET", data=None):
    url = f"{BASE}{path}"
    t0=time.perf_counter()
    try:
        r = httpx.request(method, url, data=data, timeout=10)
        dt=(time.perf_counter()-t0)*1000
        print(f"[{r.status_code}] {path}  {dt:.0f}ms")
        if r.status_code >= 500: raise SystemExit(f"Server error on {path}: {r.text[:200]}")
    except Exception as e:
        print(f"[ERR] {path} -> {e}")

print("== BASIC ==")
for p in ("/", "/health", "/version"):
    check(p)

print("== STATIC =="/**/)

×”×¨×¦×”:

BASE_URL="https://<×”×“×•××™×™×Ÿ>" python3 post_deploy_smoke.py

×¦×™×¤×™×”: 200/302 ×•×œ×œ× 500.

3) ×‘×“×™×§×•×ª Webhooks ×©×œ Twilio (×œ×œ× ×—×ª×™××” â€“ ×¨×§ ×©×”×©×¨×ª ×œ× ×§×•×¨×¡)

python3 - <<'PY'
import os, httpx, time
BASE=os.environ.get("BASE_URL","https://<×”×“×•××™×™×Ÿ-×©×œ×š>")
def post(p, data):
    url=f"{BASE}{p}"
    t0=time.perf_counter()
    r=httpx.post(url, data=data, timeout=10)
    print(f"[{r.status_code}] {p} {(time.perf_counter()-t0)*1000:.0f}ms  {r.text[:120]}")
# ×‘×“×™×§×•×ª ×‘×¡×™×¡×™×•×ª â€“ ×××•×¨ ×œ×”×—×–×™×¨ 2xx ××• 4xx ××‘×•×§×¨, ×œ× 5xx
post("/webhook/incoming_call", {"CallSid":"CA_TEST","From":"+972500000000","To":"+97233000000"})
post("/webhook/stream_status", {"event":"media","track":"inbound"})
post("/webhook/handle_recording", {"RecordingSid":"RE_TEST","CallSid":"CA_TEST","RecordingUrl":"https://example.com/fake.wav"})
PY

×¦×™×¤×™×”: ××™×Ÿ 500. ×× ×‘×¤×¨×•×“×§×©×Ÿ ××•×¤×¢×œ ××™××•×ª ×—×ª×™××” â€“ ×ª×§×‘×œ 403 (×–×” ×ª×§×™×Ÿ). ×”×¢×™×§×¨ ×©×”×©×¨×ª ×œ× ×§×•×¨×¡.

×× ×ª×¨×¦×” ×’× ×‘×“×™×§×ª ×—×ª×™××ª Twilio ×××™×ª×™×ª â€“ ××©××•×¨ ×œ×š ×§×˜×¢ × ×¤×¨×“ ×¢× ×™×¦×™×¨×ª ×—×ª×™××” ×× ×ª×¡×¤×§ TWILIO_AUTH_TOKEN.

4) ×‘×“×™×§×ª WhatsApp

4.1 Webhook ×§×œ×˜ (×œ× ×××•××ª â€“ ×¨×§ ×ª×§×™× ×•×ª ×§×•×“)

python3 - <<'PY'
import os, httpx
BASE=os.environ.get("BASE_URL","https://<×”×“×•××™×™×Ÿ-×©×œ×š>")
r=httpx.post(f"{BASE}/whatsapp/webhook", json={"from":"+972500000000","body":"×‘×“×™×§×ª ×•×•××˜×¡××¤"}, timeout=10)
print("WA inbound:", r.status_code, r.text[:200])
PY

×¦×™×¤×™×”: 2xx ××• 4xx ××‘×•×§×¨ (×œ× 500).

4.2 ×©×œ×™×—×ª ×”×•×“×¢×” (API ×¤× ×™××™)

×× ×™×© ×œ×›× × ×ª×™×‘ ×›××• /whatsapp/send:

python3 - <<'PY'
import os, httpx
BASE=os.environ.get("BASE_URL","https://<×”×“×•××™×™×Ÿ-×©×œ×š>")
payload={"to":"+972500000000","body":"×”×™×™, ×–×• ×‘×“×™×§×ª ××¢×¨×›×ª"}
r=httpx.post(f"{BASE}/whatsapp/send", json=payload, timeout=15)
print("WA send:", r.status_code, r.text[:200])
PY

×¦×™×¤×™×”: 2xx. ×× ××§×‘×œ×™× 401/403 â€“ ×—×¡×¨ secret/Token ×‘×¡×‘×™×‘×”.

5) CRM â€“ CRUD ×§×¦×¨ (API)

×”×ª×× × ×ª×™×‘×™× ×œ×©××•×ª ×©×œ×š:

python3 - <<'PY'
import os, httpx, json
BASE=os.environ.get("BASE_URL","https://<×”×“×•××™×™×Ÿ-×©×œ×š>")
client={"name":"×œ×§×•×— ×‘×“×™×§×”","phone":"+972500000000","tags":["×˜×¡×˜"]}
# Create
r=httpx.post(f"{BASE}/api/crm/clients", json=client, timeout=10)
print("CREATE:", r.status_code, r.text[:120])
cid = r.json().get("id") if r.headers.get("content-type","").startswith("application/json") else None
# Read (list)
print("LIST:", httpx.get(f"{BASE}/api/crm/clients", timeout=10).status_code)
# Update
if cid:
    print("UPDATE:", httpx.put(f"{BASE}/api/crm/clients/{cid}", json={"tags":["×˜×¡×˜","×—×“×©"]}, timeout=10).status_code)
# Delete (×× ××•×ª×¨)
if cid:
    print("DELETE:", httpx.delete(f"{BASE}/api/crm/clients/{cid}", timeout=10).status_code)
PY

×¦×™×¤×™×”: ×©×¨×©×¨×ª 2xx (××• 201/204 ×‘×”×ª×××”).

×× ×™×© ×”×¨×©××•×ª/JWT â€“ ×”×•×¡×£ ×›×•×ª×¨×ª Authorization: Bearer <token>.

6) ×‘×“×™×§×ª ×”×¨×©××•×ª (×ª×¤×§×™×“×™×/×¢×¡×§×™×)

×× ×™×© ×œ×›× JWT ×•×¢×§×¨×•×Ÿ â€œ×¢×¡×§/×ª×¤×§×™×“â€:
	â€¢	×¦×•×¨ ×©× ×™ ×˜×•×§× ×™× ×©×•× ×™× (admin / representative).
	â€¢	×ª×¨×™×¥ ×©×ª×™ ×§×¨×™××•×ª GET/POST ×œ××•×ª× × ×ª×™×‘×™× ×•×ª×•×•×“×:
	â€¢	admin ×¨×•××”/×¢×•×©×” ×”×›×œ.
	â€¢	representative ××•×’×‘×œ (×œ×“×•×’â€™ ×‘×œ×™ ××—×™×§×”/×”×¨×©××•×ª).

(×× ×™×© endpoint ×œÖ¾/auth/debug-token â€“ ×”×©×ª××© ×‘×• ×›×“×™ ×œ×¨××•×ª claims.)

7) ×‘×“×™×§×ª ×©×™×—×ª ×××ª (Twilio)

×‘×¦×¢ ×©×™×—×” ×××™×ª×™×ª:
	â€¢	Console â†’ Debugger: ××™×Ÿ 31920 WebSocket Handshake Error, ××™×Ÿ 15000 Request not made.
	â€¢	/webhook/incoming_call 2xx ×ª×•×š <1s.
	â€¢	×× ×ª×œ×—×¥ * â€“ /webhook/handle_recording 2xx ×ª×•×š <3s.
	â€¢	×–××Ÿ ×ª×’×•×‘×” ×“×™×‘×•×¨ (TTS) â‰¤ 2â€“3 ×©× ×™×•×ª.

8) × ×™×§×•×™ ×§×‘×¦×™×/×–×× ×™×™×

×× ××ª× ×©×•××¨×™× ×”×§×œ×˜×•×ª/×§×‘×¦×™× ×–×× ×™×™×:
	â€¢	×‘×¦×¢×• ×©×™×—×” â†’ ×‘×“×•×§ ×©×‘×ª×™×§×™×™×ª tmp/storage × ×•×¦×¨ ×§×•×‘×¥ ×•× ××—×§ ×‘×”×ª×× ×œ××“×™× ×™×•×ª.
	â€¢	×× ×™×© background_processor.py/×§×¨×•×Ÿ â€“ ×•×•×“× ×©×”Ö¾log ×©×œ×• ×¨×¥.

â¸»

ğŸ§ª ××•×¤×¦×™×•× ×œ×™: Pytest unit smoke (×–×¨×™×–)

×¦×•×¨ tests/test_smoke.py:

import os
import pytest
import httpx

BASE = os.environ.get("BASE_URL","https://<×”×“×•××™×™×Ÿ-×©×œ×š>")

@pytest.mark.parametrize("path", ["/","/health","/version"])
def test_basic_gets(path):
    r = httpx.get(f"{BASE}{path}", timeout=10)
    assert r.status_code in (200,302)

def test_incoming_call_smoke():
    r = httpx.post(f"{BASE}/webhook/incoming_call", data={"CallSid":"CA_TEST"})
    assert r.status_code < 500

×”×¨×¦×”:

python3 -m pip install pytest
BASE_URL="https://<×”×“×•××™×™×Ÿ>" pytest -q


â¸»

×× ××©×”×• × ×›×©×œ â€“ ××™×š ×œ×–×”×•×ª ××”×¨
	â€¢	500 ×‘××—×“ ×”× ×ª×™×‘×™× â†’ ×¤×ª×— ××ª ×œ×•×’×™ ×”Ö¾Deploy ×•×ª×¢×ª×™×§ ××ª ×”Ö¾Traceback ×”×¨××©×•×Ÿ; ×‘×“×¨×š ×›×œ×œ ×—×¡×¨ ENV (××¤×ª×—, SID, DB_URL).
	â€¢	Twilio 11205/Timeout â†’ ×”Ö¾endpoint ××™×˜×™ ××• ×—×•×¡× I/O. ×•×“× ×©Ö¾-k eventlet ×¤×¢×™×œ ×•×©××™×Ÿ ×¤×¢×•×œ×•×ª ×¡×™× ×›×¨×•× ×™×•×ª ×›×‘×“×•×ª ×‘×ª×•×š ×”Ö¾request (×”×¢×‘×¨ ×œ×¨×§×¢).
	â€¢	WebSocket 31920 â†’ ×‘×“×•×§ ×©××™×Ÿ ×¤×¨×•×§×¡×™ ×—×•×¡× WS, ×©×”Ö¾URL × ×›×•×Ÿ, ×•×©×”Ö¾worker ×”×•× eventlet (×œ× sync).

â¸»

×¨×•×¦×” ×©×××’×“ ××ª ×›×œ ×”×¡×§×¨×™×¤×˜×™× ×”××œ×• ×œ×§×•×‘×¥ ××—×“ qa_post_deploy.py ×©××“×¤×™×¡ ×“×•×´×— âœ…/âŒ ××¡×•×“×¨ ×‘×¡×•×£? ×ª×’×™×“ ×œ×™ ××ª ×”×“×•××™×™×Ÿ, ×•×× ×™ ××ª×Ÿ ×œ×š ×’×¨×¡×” ××—×ª ×œ×”×“×‘×§×”.