2025-10-09T19:14:12Z info: Deployment: f9681961-cc91-4362-974e-376665d45e80
2025-10-09T19:14:12Z info: Build: 749f812e-244c-4107-9e4e-3005dd0ecf2c
2025-10-09T19:14:12Z info: Connecting to builder
2025-10-09T19:14:12Z info: Builder connected
2025-10-09T19:14:13Z info: Installing packages
2025-10-09T19:14:15Z info: Starting Build

up to date, audited 417 packages in 3s

78 packages are looking for funding

  run `npm fund` for details


5 low severity vulnerabilities

To address issues that do not require attention, run:
  npm audit fix

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.

npm notice
npm notice New major version of npm available! 10.8.2 -> 11.6.2
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
npm notice To update run: npm install -g npm@11.6.2
npm notice

2025-10-09T19:14:18Z info: Pushing pid1 binary layer...
2025-10-09T19:14:20Z info: Created pid1 binary layer
2025-10-09T19:14:24Z info: Pushing Repl layer...
2025-10-09T19:14:24Z info: Pushing hosting layer...
2025-10-09T19:14:24Z info: Retrieved cached nix layer
2025-10-09T19:14:24Z info: Created hosting layer
2025-10-09T19:15:15Z info: Created Repl layer
2025-10-09T19:15:15Z info: Pushing Repl (cache) layer...
2025-10-09T19:15:15Z info: Created Repl (cache) layer
2025-10-09T19:15:18Z info: Pushed image manifest
2025-10-09T19:15:19Z info: Pushed soci index manifest
2025-10-09T19:15:23Z info: Creating Autoscale service
  run `npm fund` for details
ğŸ“Š Access: http://0.0.0.0:5000
starting up user application
ğŸ“ Logs: /tmp/baileys_prod.log | /tmp/flask_prod.log
found 0 vulnerabilities
npm notice
33 packages are looking for funding
ğŸ“Š Flask: 0.0.0.0:5000 | Baileys: 127.0.0.1:3300
ğŸš€ Starting AgentLocator Production System - Build #70
ğŸŸ¡ Starting Baileys on port 3300...
âœ… Build 70: PRODUCTION FIX - ASGI/Starlette (not EventLet)
âœ… INTERNAL_SECRET found in environment
ğŸ”§ APP_SHA=dev
npm notice New major version of npm available! 10.8.2 -> 11.6.2
================================================================================
ğŸš© APP_START {'build': 78, 'sha': 'dev', 'fe': 'client/dist', 'time': '2025-10-09 19:15:45', 'app': 'AgentLocator-Complete', 'commit': 'dev', 'startup_ts': 1760037345}
forwarding local port 5000 to external port 80 (mapped as 1104)
npm notice
âœ… BUILD 74 Uvicorn/ASGI started (PID: 36)
ğŸŸ¡ Installing Node dependencies for Baileys...
ğŸŸ¡ Starting BUILD 74 with Uvicorn ASGI on port 5000...
ğŸ¯ Both services running. System ready!
================================================================================
npm notice To update run: npm install -g npm@11.6.2
up to date, audited 183 packages in 1s
âœ… Baileys started (PID: 35)
ğŸš€ ASGI BUILD 76 LOADING - STATUS ADMIN + BULK DELETE
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
ğŸ”§ FE_DIST=/home/runner/workspace/server/../client/dist
ğŸ”§ GCP credentials converted from JSON to file
âœ… WebSocket test route added: /test-websocket-version
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/overview
  {'POST', 'OPTIONS'} /api/auth/logout
ğŸ”§ WebSocket: Handled by ASGI layer (Starlette WebSocket)
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses/<int:business_id>/prompt/history
âœ… Auth blueprints registered
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/overview
  {'GET', 'HEAD', 'OPTIONS'} /api/business/current/prompt/history
  {'GET', 'HEAD', 'OPTIONS'} /api/auth/current
  {'POST', 'OPTIONS'} /api/crm/contracts
  {'POST', 'OPTIONS'} /api/auth/forgot
  {'POST', 'OPTIONS'} /api/business/<tenant>/prompts
  {'GET', 'PUT', 'HEAD', 'OPTIONS'} /api/admin/support/phones
  {'PUT', 'OPTIONS'} /api/admin/businesses/<int:business_id>/prompt
  {'GET', 'HEAD', 'OPTIONS'} /api/business/current/prompt
  {'POST', 'OPTIONS'} /api/auth/reset
  {'DELETE', 'OPTIONS'} /api/statuses/<int:status_id>
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/threads/<thread_id>/messages
ğŸ“ /ws/twilio-media â†’ ASGI WebSocket (asgi.py)
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses/<int:business_id>/overview
  {'POST', 'OPTIONS'} /api/statuses/reorder
  {'PATCH', 'OPTIONS'} /api/leads/<int:lead_id>
  {'GET', 'HEAD', 'OPTIONS'} /<path:filename>
  {'PUT', 'OPTIONS'} /api/statuses/<int:status_id>
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/whatsapp
  {'PUT', 'OPTIONS'} /api/business/current/prompt
  {'POST', 'OPTIONS'} /api/statuses
  {'POST', 'OPTIONS'} /api/admin/statuses/initialize/<int:business_id>
  {'POST', 'OPTIONS'} /api/auth/login
  {'GET', 'HEAD', 'OPTIONS'} /api/statuses
  {'POST', 'OPTIONS'} /webhook/voice
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/phone-numbers
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/customers
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/business/<int:business_id>
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/threads
  {'GET', 'HEAD', 'OPTIONS'} /api/reminders/due
  {'POST', 'OPTIONS'} /api/admin/user/<int:user_id>/change-password
  {'PUT', 'OPTIONS'} /api/admin/user/<int:user_id>
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/leads/stats
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/payments/paypal/return/cancel
  {'POST', 'OPTIONS'} /webhook/whatsapp/incoming
  {'POST', 'OPTIONS'} /api/calendar/appointments
  {'GET', 'HEAD', 'OPTIONS'} /api/leads/<int:lead_id>/reminders/<int:reminder_id>
  {'GET', 'HEAD', 'OPTIONS'} /biz/invoices
  {'GET', 'HEAD', 'OPTIONS'} /webhook/test_media_streams_1756667590
ğŸ” ALL REGISTERED ROUTES:
  {'GET', 'HEAD', 'OPTIONS'} /ui/whatsapp/threads
  {'GET', 'HEAD', 'OPTIONS'} /api/calls/active
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/whatsapp
  {'POST', 'OPTIONS'} /api/crm/contracts/sign
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/calls
  {'POST', 'OPTIONS'} /api/admin/user/<int:user_id>/toggle-status
  {'POST', 'OPTIONS'} /webhook/stream_status
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/payments
  {'POST', 'OPTIONS'} /api/crm/deals
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/support/profile

  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/status
  {'POST', 'OPTIONS'} /api/admin/business/<int:business_id>/change-password
  {'GET', 'HEAD', 'OPTIONS'} /api/calls/<call_sid>/details
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/calls
  {'PUT', 'OPTIONS'} /api/admin/business/<int:business_id>
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/payments/tranzila/return/fail
  {'GET', 'HEAD', 'OPTIONS'} /api/business/current
  {'GET', 'HEAD', 'OPTIONS'} /api/auth/csrf
  {'GET', 'HEAD', 'OPTIONS'} /api/calls/history
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses/<int:business_id>/prompt
  {'GET', 'HEAD', 'OPTIONS'} /api/auth/me
  {'GET', 'HEAD', 'OPTIONS'} /api/billing/invoice/<invoice_id>/download
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/calls
  {'GET', 'HEAD', 'OPTIONS'} /api/calls/<call_sid>/download
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/revenue
  {'POST', 'OPTIONS'} /webhook/whatsapp/status
  {'POST', 'OPTIONS'} /api/admin/business
  {'GET', 'HEAD', 'OPTIONS'} /ui/biz/contacts
  {'GET', 'HEAD', 'OPTIONS'} /api/calls/stats
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses/prompts
  {'POST', 'OPTIONS'} /webhook/call_status
  {'POST', 'OPTIONS'} /api/calls/cleanup
  {'POST', 'OPTIONS'} /api/admin/businesses/<int:business_id>/impersonate
  {'POST', 'OPTIONS'} /api/admin/impersonate/exit
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/leads
  {'PUT', 'OPTIONS'} /api/business/current/settings
  {'POST', 'OPTIONS'} /admin/stop-impersonate
  {'DELETE', 'OPTIONS'} /api/calendar/appointments/<int:appointment_id>
  {'GET', 'HEAD', 'OPTIONS'} /ui/admin/tenants
  {'GET', 'HEAD', 'OPTIONS'} /api/billing/invoice/<invoice_id>/view
  {'POST', 'OPTIONS'} /webhook/handle_recording
  {'POST', 'OPTIONS'} /api/crm/payments/create
  {'GET', 'HEAD', 'OPTIONS'} /api/calendar/appointments/<int:appointment_id>
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/invoices/<invoice_number>
  {'POST', 'OPTIONS'} /api/whatsapp/disconnect
  {'POST', 'OPTIONS'} /webhook/incoming_call
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/deals
  {'GET', 'HEAD', 'OPTIONS'} /app/biz
  {'GET', 'HEAD', 'OPTIONS'} /api/calendar/appointments
  {'POST', 'OPTIONS'} /api/whatsapp/reset
  {'GET', 'HEAD', 'OPTIONS'} /ui/calls/active
  {'POST', 'OPTIONS'} /api/contracts
  {'GET', 'HEAD', 'OPTIONS'} /api/leads/<int:lead_id>/reminders
  {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/status
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/stats
  {'GET', 'HEAD', 'OPTIONS'} /app/admin
  {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/message/whatsapp
  {'GET', 'HEAD', 'OPTIONS'} /ui/biz/users/new
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/user/<int:user_id>
  {'GET', 'HEAD', 'OPTIONS'} /api/leads
  {'GET', 'HEAD', 'OPTIONS'} /livez
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/contracts
  {'GET', 'HEAD', 'OPTIONS'} /ui/admin/overview
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/businesses
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/payments/paypal/return/success
  {'GET', 'HEAD', 'OPTIONS'} /api/leads/<int:lead_id>
  {'POST', 'OPTIONS'} /api/whatsapp/send
  {'POST', 'OPTIONS'} /api/admin/users
  {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/reminders
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/payments/tranzila/return/success
  {'GET', 'HEAD', 'OPTIONS'} /api/leads/<int:lead_id>/activities
  {'POST', 'OPTIONS'} /ui/whatsapp/send
  {'POST', 'OPTIONS'} /api/whatsapp/prompts/<int:business_id>
  {'PUT', 'OPTIONS'} /api/calendar/appointments/<int:appointment_id>
  {'GET', 'HEAD', 'OPTIONS'} /ui/calls/history
  {'GET', 'HEAD', 'POST', 'OPTIONS'} /webhook/test
  {'GET', 'HEAD', 'OPTIONS'} /api/calendar/stats
  {'GET', 'HEAD', 'OPTIONS'} /biz/contracts
  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/stats
  {'GET', 'HEAD', 'OPTIONS'} /healthz
  {'GET', 'HEAD', 'OPTIONS'} /ui/admin/users/new
  {'GET', 'HEAD', 'OPTIONS'} /readyz
  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/contacts
  {'POST', 'OPTIONS'} /api/admin/tenants
  {'POST', 'OPTIONS'} /api/leads
  {'GET', 'HEAD', 'OPTIONS'} /logout
  {'GET', 'HEAD', 'OPTIONS'} /ui/admin/switch_business
  {'GET', 'HEAD', 'OPTIONS'} /api/billing/contract/<contract_id>/view
  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/conversation/<phone_number>
  {'POST', 'OPTIONS'} /webhook/stream_ended
  {'PATCH', 'OPTIONS'} /api/leads/<int:lead_id>/reminders/<int:reminder_id>
  {'POST', 'OPTIONS'} /api/whatsapp/start
  {'GET', 'HEAD', 'OPTIONS'} /ui/admin/users
  {'GET', 'HEAD', 'OPTIONS'} /api/calls
  {'GET', 'HEAD', 'OPTIONS'} /ui/admin/tenants/new
  {'POST', 'OPTIONS'} /api/crm/contacts
  {'DELETE', 'OPTIONS'} /api/leads/<int:lead_id>
  {'POST', 'OPTIONS'} /api/ui/login
  {'GET', 'HEAD', 'OPTIONS'} /api/intelligence/stats
  {'PATCH', 'OPTIONS'} /api/leads/bulk
  {'POST', 'OPTIONS'} /api/leads/bulk-delete
  {'GET', 'HEAD', 'OPTIONS'} /api/intelligence/customers
  {'GET', 'HEAD', 'OPTIONS'} /api/dashboard/activity
  {'GET', 'HEAD', 'OPTIONS'} /ui/biz/users
  {'POST', 'OPTIONS'} /admin/impersonate/<int:business_id>
  {'GET', 'HEAD', 'OPTIONS'} /ui/biz/contacts/new
  {'POST', 'OPTIONS'} /api/biz/users
  {'POST', 'OPTIONS'} /api/admin/user
  {'GET', 'HEAD', 'OPTIONS'} /api/billing/contract/<contract_id>/download
  {'GET', 'HEAD', 'OPTIONS'} /webhook/incoming_call_preview
  {'POST', 'OPTIONS'} /api/receipts
  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/qr
  {'GET', 'HEAD', 'OPTIONS'} /version
  {'GET', 'HEAD', 'OPTIONS'} /unauthorized
  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/messages
  {'GET', 'HEAD', 'OPTIONS'} /ui/whatsapp/messages
  {'GET', 'HEAD', 'OPTIONS'} /api/dashboard/stats
  {'GET', 'HEAD', 'POST', 'OPTIONS'} /api/ui/logout
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/tenants
  {'GET', 'PUT', 'HEAD', 'OPTIONS'} /api/admin/support/prompt
  {'PATCH', 'OPTIONS'} /api/leads/<int:lead_id>/move
ğŸ†˜ Emergency healthz-direct route added
ğŸ“Š No business found, creating default business...
    ret_value = fn(self, *arg, **kw)
ğŸ”§ WebSocket routes removed from Flask - handled by wsgi.py composite
âœ… All services confirmed running and ready!
ğŸ” Route registration complete
    cursor.execute(statement, parameters)
âœ… Factory debug route registered: /debug-factory-http
FE_DIST = /home/runner/workspace/client/dist mtime = 1760027118.0
ğŸ” Final status check...
    trans.commit(_to_root=True)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 599, in commit

âœ… /healthz route added directly to app_factory

  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
ğŸ’¡ Press Ctrl+C to stop all services
âœ… Legacy proxy routes: 0 /api/wa-proxy/* endpoints
  {'GET', 'HEAD', 'OPTIONS'} /test-websocket-version
DETAIL:  Failing row contains (10, ×¢×¡×§ ×¨××©×™, real_estate, +972500000000, null, ×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?, null, null, t, t, t, t, 2025-10-09 19:15:48.869184, 2025-10-09 19:15:48.869187, t, t, f, paypal, null, t, t, t, f, f, 08:00-18:00, null).
  File "/home/runner/workspace/server/init_database.py", line 46, in initialize_production_database
psycopg2.errors.NotNullViolation: null value in column "system_prompt" of relation "business" violates not-null constraint
    flush_context.execute()
âœ… Health routes handled by health_endpoints.py blueprint
âœ… Database migrations applied successfully
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    self._handle_dbapi_exception(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    _emit_insert_statements(
[parameters: {'name': '×¢×¡×§ ×¨××©×™', 'business_type': 'real_estate', 'phone_number': '+972500000000', 'whatsapp_number': None, 'greeting_message': '×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?', 'whatsapp_greeting': None, 'system_prompt': None, 'whatsapp_enabled': True, 'phone_permissions': True, 'whatsapp_permissions': True, 'is_active': True, 'calls_enabled': True, 'crm_enabled': True, 'payments_enabled': False, 'default_provider': 'paypal', 'working_hours': '08:00-18:00', 'voice_message': None, 'created_at': datetime.datetime(2025, 10, 9, 19, 15, 48, 869184), 'updated_at': datetime.datetime(2025, 10, 9, 19, 15, 48, 869187)}]
    with util.safe_reraise():

                ^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4480, in _flush
    return self._exec_single_context(
âœ… WhatsApp routes removed - using unified only
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "system_prompt" of relation "business" violates not-null constraint
    ret_value = fn(self, *arg, **kw)
âœ… Startup complete - keeping processes alive...
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
âŒ Database initialization failed: (psycopg2.errors.NotNullViolation) null value in column "system_prompt" of relation "business" violates not-null constraint
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)

ğŸ”§ Starting database initialization...
DETAIL:  Failing row contains (10, ×¢×¡×§ ×¨××©×™, real_estate, +972500000000, null, ×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?, null, null, t, t, t, t, 2025-10-09 19:15:48.869184, 2025-10-09 19:15:48.869187, t, t, f, paypal, null, t, t, t, f, f, 08:00-18:00, null).
    self.dialect.do_execute(
âœ… Baileys proxy routes: 0 /wa/* endpoints
psycopg2.errors.NotNullViolation: null value in column "system_prompt" of relation "business" violates not-null constraint
    db.session.commit()
    return self._proxied.commit()
âŒ Database initialization failed: (psycopg2.errors.NotNullViolation) null value in column "system_prompt" of relation "business" violates not-null constraint
             ^^^^^^^^^^^^^^^^^^^
The above exception was the direct cause of the following exception:
(Background on this error at: https://sqlalche.me/e/20/gkpj)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4480, in _flush
    trans.commit(_to_root=True)
    self._flush(objects)
    return connection._execute_clauseelement(
  File "<string>", line 2, in _prepare_impl
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
[parameters: {'name': '×¢×¡×§ ×¨××©×™', 'business_type': 'real_estate', 'phone_number': '+972500000000', 'whatsapp_number': None, 'greeting_message': '×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?', 'whatsapp_greeting': None, 'system_prompt': None, 'whatsapp_enabled': True, 'phone_permissions': True, 'whatsapp_permissions': True, 'is_active': True, 'calls_enabled': True, 'crm_enabled': True, 'payments_enabled': False, 'default_provider': 'paypal', 'working_hours': '08:00-18:00', 'voice_message': None, 'created_at': datetime.datetime(2025, 10, 9, 19, 15, 48, 869184), 'updated_at': datetime.datetime(2025, 10, 9, 19, 15, 48, 869187)}]
  {'POST', 'OPTIONS'} /api/admin/business -> business_management.create_business
    return meth(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
DETAIL:  Failing row contains (10, ×¢×¡×§ ×¨××©×™, real_estate, +972500000000, null, ×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?, null, null, t, t, t, t, 2025-10-09 19:15:48.869184, 2025-10-09 19:15:48.869187, t, t, f, paypal, null, t, t, t, f, f, 08:00-18:00, null).
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
ğŸ”‘ PIDs saved - Baileys: 35 | Flask: 36
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    util.preloaded.orm_persistence.save_obj(
  {'POST', 'OPTIONS'} /admin/impersonate/<int:business_id> -> ui.admin_impersonate_business
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
                ^^^^^^^^^^^^^^^^^^^^
DETAIL:  Failing row contains (10, ×¢×¡×§ ×¨××©×™, real_estate, +972500000000, null, ×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?, null, null, t, t, t, t, 2025-10-09 19:15:48.869184, 2025-10-09 19:15:48.869187, t, t, f, paypal, null, t, t, t, f, f, 08:00-18:00, null).
    util.preloaded.orm_persistence.save_obj(
  File "<string>", line 2, in commit
    ret = self._execute_context(
Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
[SQL: INSERT INTO business (name, business_type, phone_number, whatsapp_number, greeting_message, whatsapp_greeting, system_prompt, whatsapp_enabled, phone_permissions, whatsapp_permissions, is_active, calls_enabled, crm_enabled, payments_enabled, default_provider, working_hours, voice_message, created_at, updated_at) VALUES (%(name)s, %(business_type)s, %(phone_number)s, %(whatsapp_number)s, %(greeting_message)s, %(whatsapp_greeting)s, %(system_prompt)s, %(whatsapp_enabled)s, %(phone_permissions)s, %(whatsapp_permissions)s, %(is_active)s, %(calls_enabled)s, %(crm_enabled)s, %(payments_enabled)s, %(default_provider)s, %(working_hours)s, %(voice_message)s, %(created_at)s, %(updated_at)s) RETURNING business.id]

  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    self.dialect.do_execute(
             ^^^^^^^^^^^^^^^^^^^
ğŸ”§ Warmup disabled for debugging
    result = connection.execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2032, in commit

DETAIL:  Failing row contains (10, ×¢×¡×§ ×¨××©×™, real_estate, +972500000000, null, ×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?, null, null, t, t, t, t, 2025-10-09 19:15:48.869184, 2025-10-09 19:15:48.869187, t, t, f, paypal, null, t, t, t, f, f, 08:00-18:00, null).

    return self._exec_single_context(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context

           ^^^^^^^^^^^^^^^^^^^^^^^^^^
[SQL: INSERT INTO business (name, business_type, phone_number, whatsapp_number, greeting_message, whatsapp_greeting, system_prompt, whatsapp_enabled, phone_permissions, whatsapp_permissions, is_active, calls_enabled, crm_enabled, payments_enabled, default_provider, working_hours, voice_message, created_at, updated_at) VALUES (%(name)s, %(business_type)s, %(phone_number)s, %(whatsapp_number)s, %(greeting_message)s, %(whatsapp_greeting)s, %(system_prompt)s, %(whatsapp_enabled)s, %(phone_permissions)s, %(whatsapp_permissions)s, %(is_active)s, %(calls_enabled)s, %(crm_enabled)s, %(payments_enabled)s, %(default_provider)s, %(working_hours)s, %(voice_message)s, %(created_at)s, %(updated_at)s) RETURNING business.id]
  {'POST', 'OPTIONS'} /api/admin/businesses/<int:business_id>/impersonate -> business_management.impersonate_business
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4345, in flush
    self.session.flush()
    self._prepare_impl()
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "system_prompt" of relation "business" violates not-null constraint
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 599, in commit
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses/<int:business_id>/prompt/history -> ai_prompt.get_prompt_history
  File "<string>", line 2, in commit
    ret_value = fn(self, *arg, **kw)
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
    rec.execute(self)
  {'POST', 'OPTIONS'} /api/admin/user -> business_management.create_user
  {'PUT', 'OPTIONS'} /api/admin/business/<int:business_id> -> business_management.update_business
    raise exc_value.with_traceback(exc_tb)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4345, in flush
    ret_value = fn(self, *arg, **kw)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    result = connection.execute(
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/leads -> admin_bp.admin_leads
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4441, in _flush
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:
  File "/home/runner/workspace/server/init_database.py", line 46, in initialize_production_database
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/whatsapp -> admin_bp.api_admin_kpis_whatsapp
  File "<string>", line 2, in _prepare_impl
[SQL: INSERT INTO business (name, business_type, phone_number, whatsapp_number, greeting_message, whatsapp_greeting, system_prompt, whatsapp_enabled, phone_permissions, whatsapp_permissions, is_active, calls_enabled, crm_enabled, payments_enabled, default_provider, working_hours, voice_message, created_at, updated_at) VALUES (%(name)s, %(business_type)s, %(phone_number)s, %(whatsapp_number)s, %(greeting_message)s, %(whatsapp_greeting)s, %(system_prompt)s, %(whatsapp_enabled)s, %(phone_permissions)s, %(whatsapp_permissions)s, %(is_active)s, %(calls_enabled)s, %(crm_enabled)s, %(payments_enabled)s, %(default_provider)s, %(working_hours)s, %(voice_message)s, %(created_at)s, %(updated_at)s) RETURNING business.id]
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/businesses -> admin_bp.api_kpis_businesses
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/overview -> admin_bp.api_admin_kpis_overview

  {'PUT', 'OPTIONS'} /api/admin/businesses/<int:business_id>/prompt -> ai_prompt.update_business_prompt
Traceback (most recent call last):
Traceback (most recent call last):
                ^^^^^^^^^^^^^^^^^^^^
    self._flush(objects)
    return meth(
    return connection._execute_clauseelement(
    raise exc_value.with_traceback(exc_tb)
    self._prepare_impl()
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    ret = self._execute_context(
  {'PUT', 'OPTIONS'} /api/admin/user/<int:user_id> -> business_management.update_user
  {'POST', 'OPTIONS'} /api/admin/user/<int:user_id>/toggle-status -> business_management.toggle_user_status
    self.session.flush()
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/stats -> api_adapter.admin_stats
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl

  {'POST', 'OPTIONS'} /api/admin/run-migrations -> run_migrations_endpoint
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/leads/stats -> admin_bp.admin_leads_stats
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses -> api_adapter.admin_businesses
  {'GET', 'HEAD', 'OPTIONS'} /api/auth/csrf -> auth_api.get_csrf
    return self._proxied.commit()
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/business/<int:business_id> -> business_management.get_business
  {'POST', 'OPTIONS'} /api/auth/reset -> auth_api.reset_password
    rec.execute(self)
  {'POST', 'OPTIONS'} /api/admin/statuses/initialize/<int:business_id> -> status_management.initialize_default_statuses
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    self._handle_dbapi_exception(

  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses/<int:business_id>/overview -> admin_bp.get_business_overview
    self.dialect.do_execute(
  {'POST', 'OPTIONS'} /api/admin/business/<int:business_id>/change-password -> business_management.change_business_password
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/phone-numbers -> admin_bp.admin_phone_numbers
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
  {'GET', 'HEAD', 'OPTIONS'} /api/auth/me -> auth_api.get_current_user
âš ï¸ Database initialization had issues but continuing...
           ^^^^^
    cursor.execute(statement, parameters)
  {'GET', 'HEAD', 'OPTIONS'} /api/auth/current -> auth_api.get_current_user_legacy
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/user/<int:user_id> -> business_management.get_user
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4441, in _flush
    flush_context.execute()
  {'POST', 'OPTIONS'} /api/admin/tenants -> ui.api_admin_tenants_create

  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses/<int:business_id>/prompt -> ai_prompt.get_business_prompt
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
  {'POST', 'OPTIONS'} /api/admin/user/<int:user_id>/change-password -> business_management.change_user_password
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses -> admin_bp.api_admin_businesses
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute

  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/revenue -> admin_bp.api_kpis_revenue
  {'POST', 'OPTIONS'} /api/auth/login -> auth_api.login
  {'POST', 'OPTIONS'} /api/auth/logout -> auth_api.logout
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  {'POST', 'OPTIONS'} /api/admin/users -> ui.api_admin_users_create
  {'POST', 'OPTIONS'} /api/admin/impersonate/exit -> business_management.exit_impersonation
    with util.safe_reraise():
    _emit_insert_statements(
=== URL MAP ===
           ^^^^^
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/calls -> admin_bp.api_admin_kpis_calls
(Background on this error at: https://sqlalche.me/e/20/gkpj)
[parameters: {'name': '×¢×¡×§ ×¨××©×™', 'business_type': 'real_estate', 'phone_number': '+972500000000', 'whatsapp_number': None, 'greeting_message': '×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?', 'whatsapp_greeting': None, 'system_prompt': None, 'whatsapp_enabled': True, 'phone_permissions': True, 'whatsapp_permissions': True, 'is_active': True, 'calls_enabled': True, 'crm_enabled': True, 'payments_enabled': False, 'default_provider': 'paypal', 'working_hours': '08:00-18:00', 'voice_message': None, 'created_at': datetime.datetime(2025, 10, 9, 19, 15, 48, 869184), 'updated_at': datetime.datetime(2025, 10, 9, 19, 15, 48, 869187)}]
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/businesses/prompts -> admin_bp.admin_businesses_prompts

  {'GET', 'PUT', 'HEAD', 'OPTIONS'} /api/admin/support/phones -> admin_bp.admin_support_phones
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
DETAIL:  Failing row contains (10, ×¢×¡×§ ×¨××©×™, real_estate, +972500000000, null, ×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?, null, null, t, t, t, t, 2025-10-09 19:15:48.869184, 2025-10-09 19:15:48.869187, t, t, f, paypal, null, t, t, t, f, f, 08:00-18:00, null).

  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/calls -> admin_bp.api_kpis_calls

  {'GET', 'HEAD', 'OPTIONS'} /api/admin/kpis/whatsapp -> admin_bp.api_kpis_whatsapp
[SQL: INSERT INTO business (name, business_type, phone_number, whatsapp_number, greeting_message, whatsapp_greeting, system_prompt, whatsapp_enabled, phone_permissions, whatsapp_permissions, is_active, calls_enabled, crm_enabled, payments_enabled, default_provider, working_hours, voice_message, created_at, updated_at) VALUES (%(name)s, %(business_type)s, %(phone_number)s, %(whatsapp_number)s, %(greeting_message)s, %(whatsapp_greeting)s, %(system_prompt)s, %(whatsapp_enabled)s, %(phone_permissions)s, %(whatsapp_permissions)s, %(is_active)s, %(calls_enabled)s, %(crm_enabled)s, %(payments_enabled)s, %(default_provider)s, %(working_hours)s, %(voice_message)s, %(created_at)s, %(updated_at)s) RETURNING business.id]
  {'GET', 'HEAD', 'OPTIONS'} /api/billing/contract/<contract_id>/download -> receipts_contracts.download_contract
  {'GET', 'PUT', 'HEAD', 'OPTIONS'} /api/admin/support/prompt -> admin_bp.admin_support_prompt
  {'GET', 'HEAD', 'OPTIONS'} /api/billing/invoice/<invoice_id>/download -> receipts_contracts.download_invoice
(Background on this error at: https://sqlalche.me/e/20/gkpj)
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/overview -> admin_bp.api_overview
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/support/profile -> admin_bp.admin_support_profile
[parameters: {'name': '×¢×¡×§ ×¨××©×™', 'business_type': 'real_estate', 'phone_number': '+972500000000', 'whatsapp_number': None, 'greeting_message': '×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?', 'whatsapp_greeting': None, 'system_prompt': None, 'whatsapp_enabled': True, 'phone_permissions': True, 'whatsapp_permissions': True, 'is_active': True, 'calls_enabled': True, 'crm_enabled': True, 'payments_enabled': False, 'default_provider': 'paypal', 'working_hours': '08:00-18:00', 'voice_message': None, 'created_at': datetime.datetime(2025, 10, 9, 19, 15, 48, 869184), 'updated_at': datetime.datetime(2025, 10, 9, 19, 15, 48, 869187)}]

    db.session.commit()
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/tenants -> admin_bp.api_tenants
  {'GET', 'HEAD', 'OPTIONS'} /api/billing/invoice/<invoice_id>/view -> receipts_contracts.view_invoice
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
  {'GET', 'HEAD', 'OPTIONS'} /api/admin/calls -> admin_bp.api_admin_calls
  {'GET', 'HEAD', 'OPTIONS'} /api/billing/contract/<contract_id>/view -> receipts_contracts.view_contract
  {'POST', 'OPTIONS'} /api/auth/forgot -> auth_api.forgot_password

  {'POST', 'OPTIONS'} /api/calendar/appointments -> calendar.create_appointment
  {'GET', 'HEAD', 'OPTIONS'} /api/calendar/appointments -> calendar.get_appointments
  {'GET', 'HEAD', 'OPTIONS'} /api/business/current/prompt -> ai_prompt.get_current_business_prompt
  {'PUT', 'OPTIONS'} /api/business/current/prompt -> ai_prompt.update_current_business_prompt
  {'POST', 'OPTIONS'} /api/business/<tenant>/prompts -> ai_prompt.save_prompt
  {'GET', 'HEAD', 'OPTIONS'} /api/calls/stats -> calls.get_calls_stats
  {'PUT', 'OPTIONS'} /api/business/current/settings -> business_management.update_current_business_settings
  {'POST', 'OPTIONS'} /api/crm/contacts -> ui.api_crm_contacts_create


  {'GET', 'HEAD', 'OPTIONS'} /api/crm/deals -> crm_bp.list_deals
  {'GET', 'HEAD', 'OPTIONS'} /api/calls/<call_sid>/details -> calls.get_call_details
  {'GET', 'HEAD', 'OPTIONS'} /api/business/current/prompt/history -> ai_prompt.get_current_prompt_history
  {'POST', 'OPTIONS'} /api/biz/users -> ui.api_biz_users_create
  {'POST', 'OPTIONS'} /api/calls/cleanup -> calls.cleanup_old_recordings
  {'GET', 'HEAD', 'OPTIONS'} /api/leads/<int:lead_id> -> leads_bp.get_lead_detail
  {'GET', 'HEAD', 'OPTIONS'} /api/intelligence/stats -> intelligence.get_intelligence_stats
  {'DELETE', 'OPTIONS'} /api/calendar/appointments/<int:appointment_id> -> calendar.delete_appointment
  {'GET', 'HEAD', 'OPTIONS'} /api/calendar/appointments/<int:appointment_id> -> calendar.get_appointment
  {'POST', 'OPTIONS'} /api/whatsapp/reset -> whatsapp.reset
  {'PATCH', 'OPTIONS'} /api/leads/<int:lead_id>/move -> leads_bp.move_lead_in_kanban
  {'GET', 'HEAD', 'OPTIONS'} /api/calls/history -> crm_bp.api_call_history
  {'DELETE', 'OPTIONS'} /api/statuses/<int:status_id> -> status_management.delete_status
  {'POST', 'OPTIONS'} /api/crm/contracts -> crm_bp.create_contract
INFO:     127.0.0.1:39596 - "GET / HTTP/1.1" 200 OK


  {'GET', 'HEAD', 'OPTIONS'} /api/leads/<int:lead_id>/reminders/<int:reminder_id> -> leads_bp.get_reminder
  {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/message/whatsapp -> leads_bp.send_whatsapp_message
  {'GET', 'HEAD', 'OPTIONS'} /api/leads/<int:lead_id>/reminders -> leads_bp.get_lead_reminders
  {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/status -> leads_bp.update_lead_status

  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/contacts -> whatsapp.api_wa_contacts
  {'GET', 'HEAD', 'OPTIONS'} /api/leads/<int:lead_id>/activities -> leads_bp.get_lead_activities


  {'GET', 'HEAD', 'OPTIONS'} /api/crm/payments/paypal/return/success -> crm_bp.paypal_success
  {'POST', 'OPTIONS'} /api/crm/payments/create -> crm_bp.payments_create
  {'POST', 'OPTIONS'} /api/leads -> leads_bp.create_lead
  {'GET', 'HEAD', 'OPTIONS'} /api/calls -> calls.list_calls
  {'POST', 'OPTIONS'} /api/receipts -> receipts_contracts.create_receipt
  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/stats -> whatsapp.api_wa_stats
  {'PUT', 'OPTIONS'} /api/calendar/appointments/<int:appointment_id> -> calendar.update_appointment
  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/status -> whatsapp.status
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/customers -> crm_bp.api_customers
  {'GET', 'HEAD', 'OPTIONS'} /api/calendar/stats -> calendar.get_calendar_stats
  {'POST', 'OPTIONS'} /api/crm/deals -> crm_bp.create_deal

  {'GET', 'HEAD', 'OPTIONS'} /api/business/current -> business_management.get_current_business
  {'GET', 'HEAD', 'OPTIONS'} /api/dashboard/stats -> api_adapter.dashboard_stats
  {'POST', 'OPTIONS'} /api/statuses -> status_management.create_status
  {'POST', 'OPTIONS'} /api/contracts -> receipts_contracts.create_contract
  {'GET', 'HEAD', 'OPTIONS'} /api/calls/<call_sid>/download -> calls.download_recording


  {'GET', 'HEAD', 'OPTIONS'} /api/leads -> leads_bp.list_leads
  {'POST', 'OPTIONS'} /api/leads/bulk-delete -> leads_bp.bulk_delete_leads
  {'POST', 'OPTIONS'} /api/whatsapp/prompts/<int:business_id> -> whatsapp.save_whatsapp_prompt


âœ… ASGI BUILD 76 READY - ALL SYSTEMS GO
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/payments/tranzila/return/fail -> crm_bp.tranzila_fail
  {'POST', 'OPTIONS'} /api/whatsapp/disconnect -> whatsapp.disconnect
  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/qr -> whatsapp.qr
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/invoices/<invoice_number> -> crm_bp.get_invoice
  {'GET', 'HEAD', 'OPTIONS'} /api/calls/active -> crm_bp.api_active_calls
INFO:     Started server process [36]
  {'PATCH', 'OPTIONS'} /api/leads/<int:lead_id>/reminders/<int:reminder_id> -> leads_bp.update_reminder
  {'GET', 'HEAD', 'OPTIONS'} /api/dashboard/activity -> api_adapter.dashboard_activity
  {'POST', 'OPTIONS'} /api/leads/<int:lead_id>/reminders -> leads_bp.create_reminder
  {'POST', 'OPTIONS'} /api/ui/login -> ui.api_login


  {'POST', 'OPTIONS'} /api/whatsapp/start -> whatsapp.start


âœ… Simple SPA routes registered (no blueprint)
  {'PATCH', 'OPTIONS'} /api/leads/bulk -> leads_bp.bulk_update_leads
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/payments -> crm_bp.get_payments
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/threads/<thread_id>/messages -> crm_bp.api_thread_messages
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/payments/paypal/return/cancel -> crm_bp.paypal_cancel
INFO:     Uvicorn running on http://0.0.0.0:5000 (Press CTRL+C to quit)
  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/messages -> whatsapp.api_wa_messages
  {'GET', 'HEAD', 'OPTIONS'} /api/intelligence/customers -> intelligence.get_intelligent_customers
  {'GET', 'HEAD', 'OPTIONS'} /api/statuses -> status_management.get_business_statuses
================
================================================================================
  {'POST', 'OPTIONS'} /api/whatsapp/send -> whatsapp.send_manual_message
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/contracts -> crm_bp.get_contracts

  {'PATCH', 'OPTIONS'} /api/leads/<int:lead_id> -> leads_bp.update_lead
  {'GET', 'HEAD', 'OPTIONS'} /api/crm/threads -> crm_bp.api_threads
  {'PUT', 'OPTIONS'} /api/statuses/<int:status_id> -> status_management.update_status

  {'DELETE', 'OPTIONS'} /api/leads/<int:lead_id> -> leads_bp.delete_lead
  {'GET', 'HEAD', 'OPTIONS'} /api/reminders/due -> leads_bp.get_due_reminders
  {'GET', 'HEAD', 'POST', 'OPTIONS'} /api/ui/logout -> ui.api_logout

================================================================================
  {'GET', 'HEAD', 'OPTIONS'} /api/whatsapp/conversation/<phone_number> -> whatsapp.get_conversation
  {'POST', 'OPTIONS'} /api/statuses/reorder -> status_management.reorder_statuses
  {'POST', 'OPTIONS'} /api/crm/contracts/sign -> crm_bp.contract_sign

  {'GET', 'HEAD', 'OPTIONS'} /api/crm/payments/tranzila/return/success -> crm_bp.tranzila_success
2025-10-09T19:15:51Z info: Waiting for service to be ready
2025-10-09T19:15:53Z info: Deployment successful
