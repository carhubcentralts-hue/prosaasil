ACK] 10s passed, AI didn't say closing phrase - forcing polite disconnect
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED (has Hebrew): '×œ×, ×××© ×œ×.'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×œ×, ×××© ×œ×.' (hebrew=7, english=0)
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (10627ms)
prosaas-backend  | ğŸ’° [COST] User utterance: 9.78s (308 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×œ×, ×××© ×œ×.
prosaas-backend  | ğŸ”„ [BUILD 168] User wants CORRECTION - resetting verification state
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=19, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1000 frames (rms=18, reason=noise)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ×©××•× ×”', 'raw_city': '×§×¨×™×™×ª ×©××•× ×”', 'city_confidence': '100.0', 'service_type': '×©×›×¤×•×œ ××¤×ª×— ×œ×¨×›×‘'}
prosaas-backend  | âŒ [CITY] Rejected '×××© ×œ×.' (confidence=45%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×œ×, ×××© ×œ×....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×œ×, ×××© ×œ×....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 6
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['\u202b××•×¨×¥ ×œ×¨×—×‘.', '×‘×™×™ ×¦×”×¨×™×™×', '×œ×, ×××© ×œ×.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: a05b92ab...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (b7e635e3 â†’ a05b92ab) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=a05b92ab...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×œ×, ×××© ×œ×....'
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 6 messages
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×‘×™×™ ×¦×”×¨×™×™×', 'ts': 1764906944.2574716}, {'speaker': 'ai', 'text': '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×©×›×¤×•×œ ××¤×ª×— ×œ×¨×›×‘ ×‘×¢×™×¨ ×§×¨×™×™×ª ×©××•× ×”, × ×›×•×Ÿ?', 'ts': 1764906945.2049983}, {'speaker': 'user', 'text': '×œ×, ×××© ×œ×.', 'ts': 1764906954.8846705}]
prosaas-backend  | 
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×§×¨×™×™×ª ×©××•× ×”, service_type=×©×›×¤×•×œ ××¤×ª×— ×œ×¨×›×‘
prosaas-backend  | â³ [BUILD 172] Lead fields collected - waiting for customer confirmation
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”‡ [SERVER_EVENT] Sent SILENTLY to AI: [SYSTEM] ×¤×¨×˜×™× × ××¡×¤×• ××‘×œ ×”×œ×§×•×— ×¢×“×™×™×Ÿ ×œ× ××™×©×¨! ×—×–×•×¨ ×¢×œ ×”×¤×¨×˜×™× ×•×©××œ '×”×× ×”×¤×¨×˜×™× × ×›×•× ×™×?' - ×”××ª×Ÿ ×œ××™×©×•×¨
prosaas-backend  | â¸ï¸ [RESPONSE GUARD] Active response in progress (resp_CjHD7MxAGuXSYvR...) - skipping (SERVER_EVENT:[SYSTEM] ×¤×¨×˜×™× × ××¡×¤×• ××‘×œ ×”×œ×§×•×—)
prosaas-backend  | â¸ï¸ [SERVER_EVENT] Response blocked by trigger_response guards
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (1200ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¡×œ×™×—×” ×× ×”×™×” ×‘×œ×‘×•×œ. ×¨×§ × ×—×–×•×¨ ×¢×œ ×”×¤×¨×˜×™×â€”×‘××™×–×” ×¡×•×’ ×©×™×¨×•×ª ×‘×“×™×•×§ ××ª×” ×¦×¨×™×š ×¢×–×¨×”?
prosaas-backend  | â­ï¸ [LOOP GUARD] Skipped - call is ending (closing=True, hangup=False)
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.24s (55 chunks)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1100 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ×©××•× ×”', 'raw_city': '×§×¨×™×™×ª ×©××•× ×”', 'city_confidence': '100.0', 'service_type': '×©×›×¤×•×œ ××¤×ª×— ×œ×¨×›×‘'}
prosaas-backend  | âŒ [CITY] Rejected '×©×™×¨×•×ª' (confidence=61%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] Skipping greeting: '×¡×œ×™×—×” ×× ×”×™×” ×‘×œ×‘×•×œ. ×¨×§ × ×—×–×•×¨ ×¢...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (1200ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1200 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1300 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=150.0 > threshold=113.3
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #3 (prevents 5min timeout)
prosaas-backend  | ğŸ“ [FALLBACK] Triggering hangup after user_goodbye timeout
prosaas-backend  | ğŸ“ [SMART HANGUP] === CALL ENDING ===
prosaas-backend  | ğŸ“ [SMART HANGUP] Reason: Fallback after user_goodbye
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead captured: False
prosaas-backend  | ğŸ“ [SMART HANGUP] Goodbye detected: True
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ×©××•× ×”', 'raw_city': '×§×¨×™×™×ª ×©××•× ×”', 'city_confidence': '100.0', 'service_type': '×©×›×¤×•×œ ××¤×ª×— ×œ×¨×›×‘'}
prosaas-backend  | ğŸ“ [SMART HANGUP] Required fields: ['city', 'service_type']
prosaas-backend  | ğŸ“ [SMART HANGUP] ===================
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=3938, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=309 blocked=0 | active_response=None... | ai_speaking=False | user_has_spoken=True
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | âœ… [BUILD 163] Call CAf58d31... hung up successfully: Fallback after user_goodbye
prosaas-backend  | WS_STOP sid=MZee5823d614719c69822c1799355a2c54 rx=1900 tx=995
prosaas-backend  | ğŸ“ [SES-f3bb8b94] CALL ENDED - duration=37.9s, business_id=10, rx=1900, tx=995
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | STREAM_ENDED call=CAf58d314e951d42cfd365ec703e43d771 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.5:53500 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | INFO:     172.18.0.5:53512 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | INFO:     127.0.0.1:58396 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | âœ… Found existing recording for CAf58d314e951d42cfd365ec703e43d771: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE1ba1ad3ce84bffd4d4900a28cf665c04.json
prosaas-backend  | âœ… Recording queued for processing: CAf58d314e951d42cfd365ec703e43d771
prosaas-backend  | INFO:     connection closed
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×¢×“×™, service_type=×¤×•×¨×¥ ×œ×¨×›×‘ ×‘×¢×™×¨ ×¨××œ×”
prosaas-backend  | ğŸ”‡ [SILENCE] Max warnings exceeded - initiating polite hangup
prosaas-backend  | ğŸ›‘ [RESPONSE GUARD] Loop guard engaged - blocking (SILENCE_HANDLER:[SYSTEM] User has been silent )
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.5:53516 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=1) retry #0
prosaas-backend  | âœ… CALL FINALIZED: CAf58d314e951d42cfd365ec703e43d771
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×©×™×—×” ×¢× ×œ×§×•×— ×‘×ª×—×•× ×”×× ×¢×•×œ×™×, ×”××ª×¢× ×™×™×Ÿ ×‘×©×™×¨×•×ª ×©×›×¤×•×œ ××¤×ª×—.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | - **×©×™×¨×•×ª × ×“×¨×©**: ×©×›×¤×•×œ ××¤×ª×— ×œ×¨×›×‘
prosaas-backend  | - **××™×§×•×**: ×§×¨×™×™×ª ×©××•× ×” (×”×œ×§×•×— ×œ× ××™×©×¨ ××ª ×”××™×§×•× ×”× ×›×•×Ÿ)
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | - **×©×**: ×œ× × ××¡×¨
prosaas-backend  | - **×××¦×¢×™ ×”×ª×§×©×¨×•×ª**: ×œ× × ××¡×¨
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - **×¤×’×™×©×”/×ª×•×¨**: ×œ× × ×§×‘×¢×” ×¤×’×™×©×”
prosaas-backend  | - **×“×—×™×¤×•×ª**: ×œ× ×¦×•×™×Ÿ
prosaas-backend  | - **×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª**: ×™×© ×¦×•×¨×š ×œ×××ª ××ª ×¤×¨×˜×™ ×”×©×™×¨×•×ª ×•×”×¢×™×¨ ×”× ×›×•× ×” ×¢× ×”×œ×§×•×—.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×”×œ×§×•×— ×œ× ×”×™×” ××¨×•×¦×” ××”×‘× ×ª ×”×©×™×¨×•×ª ×”×¨××©×•× ×™×ª. ××•××œ×¥ ×œ×”×§×¤×™×“ ×¢×œ ×‘×”×™×¨×•×ª ×•×“×™×•×§ ×‘×¤×¨×˜×™ ×”×¤× ×™×™×” ×›×“×™ ×œ×× ×•×¢ ×‘×œ×‘×•×œ×™× ×‘×¢×ª×™×“.
prosaas-backend  | ğŸ¯ Intent: information_request
prosaas-backend  | ğŸ“Š Next Action: ××ª×Ÿ ××™×“×¢ ××¤×•×¨×˜
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
^[[Aprosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Extracted SPECIFIC service from AI confirmation: '×©×›×¤×•×œ ××¤×ª×— ×œ×¨×›×‘'
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ×©××•× ×”', 'raw_city': '×§×¨×™×™×ª ×©××•× ×”', 'city_confidence': '100.0', 'service_type': '×©×›×¤×•×œ ××¤×ª×— ×œ×¨×›×‘'}
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CAf58d314e951d42cfd365ec703e43d771, phone=+972504294724, city=×§×¨×™×™×ª ×©××•× ×”, direction=inbound
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×§×¨×™×™×ª ×©××•× ×”, service=×©×›×¤×•×œ ××¤×ª×— ×œ×¨×›×‘
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | âœ… Background thread 4 completed
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZee5823d614719c69822c1799355a2c54 rx=1900 tx=995
^[[Bprosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=1) retry #10
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CAfbe1ca07784061306b7adedfb2ca558f
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAfbe1ca07784061306b7adedfb2ca558f
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAfbe1ca07784061306b7adedfb2ca558fğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1306ms - CAfbe1ca07784061
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAfbe1ca07784061306b7adedfb2ca558f" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.5:44116 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:44126 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-bb279824
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764906975.635] WS_START sid=MZ6561ee5d45aacf37839168bcb0f5ac94 call_sid=CAfbe1ca07784061306b7adedfb2ca558f from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAfbe1ca (FRESH SESSION)âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | 
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 451ms (T0+453ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 965ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=15s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1071ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAfbe1ca07784061306b7adedfb2ca558f
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764906976.707] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1073ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=9.9, threshold=109.9)
prosaas-backend  | 
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 623ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | âœ… Call log already exists for CAfbe1ca07784061306b7adedfb2ca558f
prosaas-backend  | âœ… Recording started for CAfbe1ca07784061306b7adedfb2ca558f: REe8784d1637dea93e7ffe32a2bc3bb06f
prosaas-backend  | ğŸ¤ [BUILD 202] Transcription prompt: '×©×™×—×” ×¢×‘×¨×™×ª ×œ×¢×¡×§ ×§×œ×™×‘×¨. ×ª××œ×œ: ×¢×¨×™×. ×”×¢×“×£ ×¢×‘×¨×™×ª. ×‘×§×© ×”×‘×”×¨×” ×× ×œ× ×‘×¨×•×¨.' (68 chars)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 1068ms (total: 2142ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764906977.778
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (GREETING)
prosaas-backend  | ğŸ¯ [BUILD 200] GREETING response.create sent! OpenAI time: 2142ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | [PIPELINE] LIVE AUDIO PIPELINE ACTIVE: Twilio â†’ realtime_audio_in_queue â†’ send_audio_chunk (single path)
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=1) retry #20
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjHDVWTzOPZx4tm...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjHDVWTzOPZx4tm... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ“ [PROMPT] Final length: 2367 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764906979.109 (duration: 1331ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (1200ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=15s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=50, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=276.0 > threshold=109.9
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1618ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (1200ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 1.8s - now updating session
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 2367 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=59, voice_frames=0
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=1) retry #30
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 200 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âš ï¸ [BUILD 178] Max hangup retries exceeded - forcing hangup
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=20, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=138.0 > threshold=109.9
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 300 frames (rms=532, reason=insufficient_consec_frames(1/7))
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=532, voice_frames=0
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=53 58 59 69 62, rms=728, consec_frames=7
prosaas-backend  | [PIPELINE STATUS] sent=1 blocked=0 | active_response=None... | ai_speaking=False | user_has_spoken=False
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=d2 d4 dd e5 ed, rms=531, consec_frames=8
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=5a 58 59 5c 5c, rms=317, consec_frames=9
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=79, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=2723, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=1197.0 > threshold=109.9
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=19, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=113 blocked=0 | active_response=None... | ai_speaking=False | user_has_spoken=True
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjHDg8ZZg2kNnuy...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjHDg8ZZg2kNnuy... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=16, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=7d 7a 7a 7a 7b
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=c9 c2 c8 c5 c5
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=49 2f 3b d8 3d
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 4800 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (1200ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.27s (6 chunks)
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 400 frames (rms=16, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨' (confidence=54%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (1200ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | ğŸ”¥ [BUILD 171 COOLDOWN] âŒ REJECTED: Transcript arrived 0ms after AI finished (min: 1200ms)
prosaas-backend  |    Rejected text: '×¤×•×¨×¥ ×œ×¨×—×‘...' (likely hallucination)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 500 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=11, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=207.0 > threshold=109.9
prosaas-backend  | [PIPELINE STATUS] sent=141 blocked=0 | active_response=None... | ai_speaking=False | user_has_spoken=True
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=22, voice_frames=0
prosaas-backend  | INFO:     127.0.0.1:40208 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=20, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjHDmP8hazV0dkV...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjHDmP8hazV0dkV... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 5374ms gap between chunks #6 and #7 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×‘×§×©×Ÿ!...' despite low RMS=16)
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED (has Hebrew): '×‘×§×©×Ÿ!'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×‘×§×©×Ÿ!' (hebrew=4, english=0)
prosaas-backend  | ğŸ’° [COST] User utterance: 9.84s (237 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×‘×§×©×Ÿ!
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=17, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×§×¨×™×™×ª ×©××•× ×”
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ×©××•× ×”'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×§×©×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ×©××•× ×”', 'raw_city': '×§×©×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=90.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ×©××•× ×”', 'raw_city': '×§×©×Ÿ', 'city_confidence': '90.0'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_confirmation=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ×©××•× ×”', 'raw_city': '×§×©×Ÿ', 'city_confidence': '90.0', 'city_needs_confirmation': 'True'}
prosaas-backend  | âš ï¸ [CITY] Needs confirmation: '×§×¨×™×™×ª ×©××•× ×”' (confidence=90%)
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×‘×§×©×Ÿ!...'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×‘×§×©×Ÿ!...'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 4
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×¤×•×¨×¥ ×œ×¨×—×‘', '×‘×§×©×Ÿ!']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 7a79b1f2...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=7a79b1f2...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×‘×§×©×Ÿ!...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']ğŸ” [NLP] Conversation history has 4 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764906989.4953053}, {'speaker': 'user', 'text': '×¤×•×¨×¥ ×œ×¨×—×‘', 'ts': 1764906990.226231, 'filtered': True}, {'speaker': 'user', 'text': '×‘×§×©×Ÿ!', 'ts': 1764906995.064783}]
prosaas-backend  | 
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['service_type'] | Collected: ['city=×§×¨×™×™×ª ×©××•× ×”']
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (1200ms)
prosaas-backend  | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¤×¨×™×¦×ª ×¨×›×‘ ×‘×¢×™×¨ ×‘×™×ª ×©××Ÿ, × ×›×•×Ÿ?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.96s (25 chunks)
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 600 frames (rms=15, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.5:41236 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 700 frames (rms=8, reason=noise)
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×‘×™×ª ×©××Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×‘×™×ª ×©××Ÿ', 'raw_city': '×§×©×Ÿ', 'city_confidence': '90.0', 'city_needs_confirmation': 'True'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×‘×™×ª ×©××Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×‘×™×ª ×©××Ÿ', 'raw_city': '×‘×™×ª ×©××Ÿ', 'city_confidence': '90.0', 'city_needs_confirmation': 'True'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×‘×™×ª ×©××Ÿ', 'raw_city': '×‘×™×ª ×©××Ÿ', 'city_confidence': '100.0', 'city_needs_confirmation': 'True'}
prosaas-backend  | âœ… [CITY] Auto-accepted: '×‘×™×ª ×©××Ÿ' (confidence=100%)
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×¤×¨×™×¦×ª ×¨×›×‘ ×‘×¢×™×¨ ×‘×™×ª ×©××Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×‘×™×ª ×©××Ÿ', 'raw_city': '×‘×™×ª ×©××Ÿ', 'city_confidence': '100.0', 'city_needs_confirmation': 'True', 'service_type': '×¤×¨×™×¦×ª ×¨×›×‘ ×‘×¢×™×¨ ×‘×™×ª ×©××Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×¤×¨×™×¦×ª ×¨×›×‘ ×‘×¢×™×¨ ×‘×™×ª ×©××Ÿ
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¤×¨×™×¦×ª ×¨×›×‘...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (1200ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=215.0 > threshold=109.9
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 800 frames (rms=10, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=1679.0 > threshold=109.9
prosaas-backend  | [PIPELINE STATUS] sent=238 blocked=0 | active_response=None... | ai_speaking=False | user_has_spoken=True
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=15, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjHDvzVCSn52bkv...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjHDvzVCSn52bkv... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 900 frames (rms=12, reason=noise)
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 7780ms gap between chunks #25 and #26 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=15, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×§×•×¨××™×....' despite low RMS=11)
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED (has Hebrew): '×§×•×¨××™×.'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×§×•×¨××™×.' (hebrew=6, english=0)
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (9237ms)
prosaas-backend  | ğŸ’° [COST] User utterance: 2.66s (311 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×§×•×¨××™×.
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×‘×™×ª ×©××Ÿ', 'raw_city': '×‘×™×ª ×©××Ÿ', 'city_confidence': '100.0', 'city_needs_confirmation': 'True', 'service_type': '×¤×¨×™×¦×ª ×¨×›×‘ ×‘×¢×™×¨ ×‘×™×ª ×©××Ÿ'}
prosaas-backend  | âŒ [CITY] Rejected '×§×•×¨××™×.' (confidence=56%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×§×•×¨××™×....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×§×•×¨××™×....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 6
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×¤×•×¨×¥ ×œ×¨×—×‘', '×‘×§×©×Ÿ!', '×§×•×¨××™×.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 2b7f32c2...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (7a79b1f2 â†’ 2b7f32c2) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=2b7f32c2...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×§×•×¨××™×....'
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 6 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×‘×§×©×Ÿ!', 'ts': 1764906995.064783}, {'speaker': 'ai', 'text': '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¤×¨×™×¦×ª ×¨×›×‘ ×‘×¢×™×¨ ×‘×™×ª ×©××Ÿ, × ×›×•×Ÿ?', 'ts': 1764906995.8272364}, {'speaker': 'user', 'text': '×§×•×¨××™×.', 'ts': 1764907004.302082}]
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×‘×™×ª ×©××Ÿ, service_type=×¤×¨×™×¦×ª ×¨×›×‘ ×‘×¢×™×¨ ×‘×™×ª ×©××Ÿ
prosaas-backend  | â³ [BUILD 172] Lead fields collected - waiting for customer confirmation
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”‡ [SERVER_EVENT] Sent SILENTLY to AI: [SYSTEM] ×¤×¨×˜×™× × ××¡×¤×• ××‘×œ ×”×œ×§×•×— ×¢×“×™×™×Ÿ ×œ× ××™×©×¨! ×—×–×•×¨ ×¢×œ ×”×¤×¨×˜×™× ×•×©××œ '×”×× ×”×¤×¨×˜×™× × ×›×•× ×™×?' - ×”××ª×Ÿ ×œ××™×©×•×¨
prosaas-backend  | â¸ï¸ [RESPONSE GUARD] Active response in progress (resp_CjHDvzVCSn52bkv...) - skipping (SERVER_EVENT:[SYSTEM] ×¤×¨×˜×™× × ××¡×¤×• ××‘×œ ×”×œ×§×•×—)
prosaas-backend  | â¸ï¸ [SERVER_EVENT] Response blocked by trigger_response guards
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6400 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (1200ms)
prosaas-backend  | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ××œ×™×š ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª. ×ª×•×“×” ×•×œ×”×ª×¨××•×ª.
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.43s (53 chunks)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1000 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1100 frames (rms=9, reason=noise)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×‘×™×ª ×©××Ÿ', 'raw_city': '×‘×™×ª ×©××Ÿ', 'city_confidence': '100.0', 'city_needs_confirmation': 'True', 'service_type': '×¤×¨×™×¦×ª ×¨×›×‘ ×‘×¢×™×¨ ×‘×™×ª ×©××Ÿ'}
prosaas-backend  | âŒ [CITY] Rejected '××œ×™×š' (confidence=84%) - ask to repeatWS_STOP sid=MZ6561ee5d45aacf37839168bcb0f5ac94 rx=1593 tx=788
prosaas-backend  | 
prosaas-backend  | [GOODBYE CHECK] Clear goodbye detected: '××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™×...'
prosaas-backend  | âœ… [HANGUP BUILD 176] AI said goodbye with auto_end_on_goodbye=True + user interaction - disconnecting
prosaas-backend  | ğŸ“ [STATE] Transitioning ACTIVE â†’ CLOSING (reason: ai_goodbye_auto_end)
prosaas-backend  | ğŸ“ [BUILD 163] Pending hangup set - will disconnect after audio finishes playing
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.doneğŸ“ [SES-bb279824] CALL ENDED - duration=31.8s, business_id=10, rx=1593, tx=788
prosaas-backend  | 
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (1200ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | âœ… [POLITE HANGUP] OpenAI queue empty after 0ms
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 187 frames...
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CAfbe1ca07784061306b7adedfb2ca558f stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.5:48800 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CAfbe1ca07784061306b7adedfb2ca558f: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REe8784d1637dea93e7ffe32a2bc3bb06f