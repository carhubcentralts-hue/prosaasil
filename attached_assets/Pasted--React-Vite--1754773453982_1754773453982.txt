×§×™×‘×œ×ª×™. ×”× ×” ×”×•×“×¢×” ××—×ªÖ¾×œ××—×ª ×œ×”×“×‘×™×§ ×œ×¡×•×›×Ÿ ×©×œ×š ×›×“×™ ×œ×”×©××™×¨ ×¨×§ ×“×£ ×”×ª×—×‘×¨×•×ª × ×§×™ ×‘-React (Vite), ×œ××—×•×§ ××ª ×©××¨ ×”×ª×‘× ×™×•×ª ×”×•×•×™×–×•××œ×™×•×ª â€“ ×‘×œ×™ ×œ×¤×’×•×¢ ×‘×©×™×—×•×ª (Twilio+Whisper), ×‘-WhatsApp ×•×‘-CRM (×”-API × ×©××¨×™× ×›××• ×©×”×). ×–×” ××•×›×Ÿ ×œ×¤×¨×™×¡×” ×•××¡×•×“×¨ ×©×œ×‘-××—×¨-×©×œ×‘ ×¢× ×§×•×“.

â¸»

ğŸš¦ SAFE MODE â€” â€œLogin-Only UIâ€

××•×ª×¨ ×œ××—×•×§ ×ª×‘× ×™×•×ª ×¤×¨×•× ×˜. ××¡×•×¨ ×œ×’×¢×ª ×‘-API/×•×•×‘Ö¾×”×•×§×™×/×©×›×‘×•×ª ×©×¨×ª ×§×™×™××•×ª (Twilio/WhatsApp/CRM).
×›×œ ×©×™× ×•×™ ×‘×§×•×“: ×¢× ×£ ×—×“×© + PR + diff.

0) ×¢× ×£ ×¢×‘×•×“×” + × ×§×™×•×Ÿ

git checkout -b ui/login-only
git pull --rebase


â¸»

1) Backend â€” ××—×‘×¨×™× ××™××•×ª ××™× ×™××œ×™ (Cookie Session), ×œ× ×—×•×¡××™× webhooks

×¦×•×¨ ×§×•×‘×¥ ×—×“×©: server/auth_bp.py

# server/auth_bp.py
from flask import Blueprint, request, jsonify, session
import os, hmac, hashlib

auth_bp = Blueprint("auth", __name__, url_prefix="/api/auth")

ADMIN_EMAIL = os.getenv("ADMIN_EMAIL", "admin@example.com")
ADMIN_PASS_HASH = os.getenv("ADMIN_PASS_HASH", "")  # sha256 ×©×œ ×”×¡×™×¡××”

def _ok(p: str):
    h = hashlib.sha256(p.encode()).hexdigest()
    return hmac.compare_digest(h, ADMIN_PASS_HASH)

@auth_bp.post("/login")
def login():
    data = request.get_json(force=True)
    if data.get("email")==ADMIN_EMAIL and _ok(data.get("password","")):
        session["user"] = {"email": ADMIN_EMAIL}
        return jsonify({"ok": True})
    return jsonify({"ok": False, "error":"invalid"}), 401

@auth_bp.get("/me")
def me(): return jsonify(session.get("user") or {}), 200

@auth_bp.post("/logout")
def logout():
    session.clear(); return jsonify({"ok": True})

×—×‘×¨ ××ª ×”-Blueprint: server/routes/__init__.py

from .auth_bp import auth_bp
# ... ×™×‘×•××™ BPs ×§×™×™××™× (××œ ×ª×™×’×¢)
def register_blueprints(app):
    app.register_blueprint(auth_bp)  # ×—×“×©
    # ... ×›×œ ×”-BPs ×”×§×™×™××™× ×›×¨×’×™×œ (crm, twilio, ×•×›×•')

Session & Healthcheck: ×‘-server/main.py (××• config)

app.secret_key = os.getenv("SECRET_KEY", "change-me")  # ×œ× ×‘×§×•×“ ×‘×¤×¨×•×“×§×©×Ÿ
app.config.update(SESSION_COOKIE_SAMESITE="Lax", SESSION_COOKIE_SECURE=False)

@app.route("/health", methods=["GET"])
def health(): return {"ok": True}, 200

×—×©×•×‘: ×œ× ×œ×—×¡×•× /webhook/* (Twilio/WhatsApp) ×•×œ× ××ª /api/* â€” ×¨×§ ×”-UI ×™×¦×™×’ ×”×ª×—×‘×¨×•×ª. ×”-API × ×©××¨×™× ×¤×¢×™×œ×™× ×œ×©×™×¨×•×ª×™×.

â¸»

2) Frontend â€” ××©××™×¨×™× ×¨×§ ×“×£ ×”×ª×—×‘×¨×•×ª ××—×“

2.1 ××—×™×§×ª ×ª×‘× ×™×•×ª ×•×™×–×•××œ×™×•×ª (×¨×§ ×‘-client/)

××—×§ ××ª ×›×œ ×“×¤×™ ×”-UI/Routes/Components ×©××™× × ×“×£ ×”×ª×—×‘×¨×•×ª.
×“×•×’×××•×ª (×”×ª×× ×œ×©××•×ª ××¦×œ×š):

cd client/src
# ×©××•×¨ ×§×‘×¦×™× ×—×™×•× ×™×™× ×‘×œ×‘×“: main.tsx / main.jsx, index.css, styles/tokens.css, lib/api.ts (× ×™×¦×•×¨), auth/AuthContext.tsx (× ×™×¦×•×¨), pages/Login.tsx (× ×™×¦×•×¨).
# ××—×™×§×ª ×›×œ ×”×“×¤×™×/×¨×›×™×‘×™× ×”××—×¨×™×:
git rm -r pages/* components/* routes/* 2>/dev/null || true
git rm -r app/* 2>/dev/null || true

2.2 ×™×¦×™×¨×ª ×©×™×¨×•×ª API ×§×˜×Ÿ

×—×“×©: client/src/lib/api.ts

export async function api<T = any>(path: string, opts?: RequestInit): Promise<T> {
  const res = await fetch(path, {
    credentials: 'include',
    headers: { 'Content-Type': 'application/json' },
    ...opts
  });
  if (!res.ok) throw new Error(await res.text());
  return res.json();
}
export const auth = {
  me:    () => api('/api/auth/me'),
  login: (email: string, password: string) =>
           api('/api/auth/login', { method:'POST', body: JSON.stringify({ email, password }) }),
  logout: () => api('/api/auth/logout', { method:'POST' })
};

2.3 ×§×•× ×˜×§×¡×˜ ×”×ª×—×‘×¨×•×ª

×—×“×©: client/src/auth/AuthContext.tsx

import { createContext, useContext, useEffect, useState } from "react";
import { auth } from "../lib/api";
type User = { email: string } | null;
const Ctx = createContext<{ user: User, setUser: (u: User)=>void }>({ user: null, setUser: ()=>{} });

export function AuthProvider({ children }: any) {
  const [user, setUser] = useState<User>(null);
  useEffect(()=>{ auth.me().then(u=>setUser(u.email?u:null)).catch(()=>setUser(null)); },[]);
  return <Ctx.Provider value={{user,setUser}}>{children}</Ctx.Provider>;
}
export const useAuth = ()=> useContext(Ctx);

2.4 ×“×£ ×”×ª×—×‘×¨×•×ª × ×§×™ (RTL, ××™×›×•×ª×™)

×—×“×©: client/src/pages/Login.tsx

import { useState } from "react";
import { auth } from "../lib/api";
import { useAuth } from "../auth/AuthContext";
import "./login.css"; // ××•×¤×¦×™×•× ×œ×™ ×œ×¡×’× ×•×Ÿ ××§×•××™

export default function Login() {
  const { setUser } = useAuth();
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [err, setErr] = useState("");

  async function onSubmit(e:any){
    e.preventDefault(); setErr("");
    try { await auth.login(email, password); setUser({email}); }
    catch { setErr("×”××™××™×™×œ ××• ×”×¡×™×¡××” ×©×’×•×™×™×"); }
  }

  return (
    <div style={{minHeight:"100vh", display:"grid", placeItems:"center", direction:"rtl"}}>
      <form onSubmit={onSubmit} style={{
        width: "100%", maxWidth: 380, padding: 24, borderRadius: 16,
        boxShadow: "0 10px 30px rgba(0,0,0,.08)", background: "#fff"
      }}>
        <h1 style={{marginBottom:16, fontWeight:700}}>×”×ª×—×‘×¨×•×ª</h1>
        <label style={{display:"block", marginBottom:8}}>××™××™×™×œ</label>
        <input value={email} onChange={e=>setEmail(e.target.value)} type="email" required
               style={{width:"100%", padding:12, marginBottom:12, borderRadius:10, border:"1px solid #ddd"}}/>
        <label style={{display:"block", marginBottom:8}}>×¡×™×¡××”</label>
        <input value={password} onChange={e=>setPassword(e.target.value)} type="password" required
               style={{width:"100%", padding:12, marginBottom:16, borderRadius:10, border:"1px solid #ddd"}}/>
        {err && <div style={{color:"#c00", marginBottom:12}}>{err}</div>}
        <button type="submit" style={{
          width:"100%", padding:12, borderRadius:10, border:"none", fontWeight:700, cursor:"pointer"
        }}>×›× ×™×¡×”</button>
      </form>
    </div>
  );
}

2.5 ××¤×œ×™×§×¦×™×” â€” ××¦×™×’×” ×¨×§ ××ª Login

×¤×ª×—/×¢×“×›×Ÿ client/src/main.tsx (××• main.jsx) ×›×š ×©×™×˜×¢×™×Ÿ ×¨×§ ××ª Login:

import React from 'react'
import ReactDOM from 'react-dom/client'
import Login from './pages/Login'
import { AuthProvider } from './auth/AuthContext'
import './index.css'
import './styles/tokens.css' // ×©××•×¨ RTL/×¤×•× ×˜×™× ×× ×™×©

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <AuthProvider>
      <Login />
    </AuthProvider>
  </React.StrictMode>
)

××™×Ÿ Router ×•××™×Ÿ ×“×¤×™× ××—×¨×™× â€” ×¨×§ Login. ××—×¨×™ ×©× ××©×¨ ××ª ×”-login, × ×•×¡×™×£ ×‘×”××©×š ×“×¤×™× ×××—×•×¨×™ ×©×•××¨Ö¾××¡×š (guard).

â¸»

3) Vite â€” ×¤×¨×•×§×¡×™ ×œ-API (×“×‘) + RTL

×‘×“×•×§/×¢×“×›×Ÿ client/vite.config.js:

import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
export default defineConfig({
  base: './',
  plugins: [react()],
  server: {
    host: '0.0.0.0',
    port: Number(process.env.PORT) || 5173,
    proxy: {
      '/api': 'http://localhost:5000',
      '/webhook': 'http://localhost:5000',
      '/socket.io': { target: 'http://localhost:5000', ws: true }
    }
  }
})

×•×“× ×‘-client/src/styles/tokens.css:

html { direction: rtl; font-family: "Assistant", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; }


â¸»

4) ×”×¤×¢×œ×”

×˜×¨××™× ×œ A (Backend)

cd AgentLocator
python3 -m venv .venv
source .venv/bin/activate
python -m pip install -U pip
pip install -r server/requirements.txt
export FLASK_APP=server/main.py
export FLASK_RUN_PORT=5000
flask run --host 0.0.0.0

×˜×¨××™× ×œ B (Frontend)

cd AgentLocator/client
npm ci
npm run dev -- --host 0.0.0.0 --port 5173


â¸»

5) Preview / ×¤×¨×™×¡×”

×× ×”-Preview ××¨×™×¥ Flask (×¤×•×¨×˜ 5000), ×•×“× ×©×™×© ×œ×š start.sh/.replit ×›××•×¡×‘×¨ ×§×•×“×.
×œ×¤×¨×•×“×§×©×Ÿ: ×‘×—×¨ ×× ×œ××’×“ React ×œ-client/dist ×•×œ×©×¨×ª ×›×¡×˜×˜×™, ××• ×œ×¤×¨×•×¡ ×‘× ×¤×¨×“ (Nginx ×œ-React, Gunicorn ×œ-Flask). ×‘×©×œ×‘ ×–×” ××¡×¤×™×§ ×“×‘.

â¸»

6) Acceptance (×œ×¤× ×™ ××™×–×•×’)
	â€¢	Front: × ×˜×¢×Ÿ ×¨×§ ×“×£ ×”×ª×—×‘×¨×•×ª; ××™×Ÿ × ×™×•×•×˜ ××—×¨.
	â€¢	Auth: POST /api/auth/login ××—×–×™×¨ {"ok":true} ×•××¦×™×‘ session cookie; GET /api/auth/me ××—×–×™×¨ ××™××™×™×œ.
	â€¢	Health: GET /health â†’ 200.
	â€¢	Twilio/WhatsApp/CRM: ×”-API/×•Ö¶×‘×”×•×§×™× ×××©×™×›×™× ×œ×¢×‘×•×“ (×œ× × ×’×¢× ×•).
	â€¢	Build: npm run build ×¢×•×‘×“; ×”-CI (×× ×§×™×™×) ×××©×™×š ×™×¨×•×§.

â¸»

××©×ª× ×™ ×¡×‘×™×‘×” (×§×‘×™×¢×ª ×¡×™×¡××”)
	â€¢	×‘×—×¨ ××™××™×™×œ/×¡×™×¡××” ×œ× ×™×”×•×œ, ×”×¤×•×š ××ª ×”×¡×™×¡××” ×œ-SHA256:

echo -n 'MyStrongPass' | sha256sum


	â€¢	×”×¦×‘:

ADMIN_EMAIL=you@domain.com
ADMIN_PASS_HASH=<×”×ª×•×¦×¨ ××”×¤×§×•×“×”>
SECRET_KEY=<××—×¨×•×–×ª ××§×¨××™×ª ××¨×•×›×”>



(×œ× ×‘×§×•×“. ×‘×¡×‘×™×‘×•×ª / Secrets ×‘×œ×‘×“.)

â¸»

×× ××ª×” ×¨×•×¦×”â€”××›×™×Ÿ ×œ×š PR-diff ××•×›×Ÿ ×©××‘×¦×¢:
	1.	×™×¦×™×¨×ª server/auth_bp.py ×•×—×™×‘×•×¨×•.
	2.	×™×¦×™×¨×ª client/src/lib/api.ts, auth/AuthContext.tsx, pages/Login.tsx.
	3.	××—×™×§×ª ×©××¨ ×”×ª×‘× ×™×•×ª ×‘-client/src (×‘×œ×‘×“).
	4.	×¢×“×›×•×Ÿ main.tsx ×•-vite.config.js.
	5.	×‘×“×™×§×•×ª ×¢×©×Ÿ.