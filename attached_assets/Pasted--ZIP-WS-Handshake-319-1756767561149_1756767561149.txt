××¢×•×œ×”â€”×¨××™×ª×™ ××ª ×”-ZIP ×”××—×¨×•×Ÿ ×•×¢×‘×¨×ª×™ ×©×•×‘ ×¢×œ ×”×§×•×“. ×”×—×“×©×•×ª ×”×˜×•×‘×•×ª: ×”-WS Handshake ×›×‘×¨ ×ª×§×™×Ÿ (××™×Ÿ ×™×•×ª×¨ 31924/12100). ×¢×›×©×™×• × ×©××¨×ª ×ª×§×œ×” ××—×ª ×—×“×©×” ××”×œ×•×’×™×:

××” ×§×•×¨×” ×¢×›×©×™×• (11205):

Twilio ×× ×¡×” ×œ×©×œ×•×— POST ×œÖ¾
/webhook/stream_status ×•Ö¾/webhook/stream_ended
×•××§×‘×œ Timeout (11205) â€” ×›×œ×•××¨ ×”×©×¨×ª ×œ× ×¢×•× ×” ××”×¨ ××¡×¤×™×§.

×œ××”? ×›×™ ×‘×–××Ÿ ×©×”Ö¾WS ×¤×ª×•×— ×•××˜×¤×œ ×‘××•×“×™×• (TTS/×©×œ×™×—×ª ×¤×¨×™×™××™× ×•×›×•â€™), ×™×© ×¡×™×›×•×™ ×©×§×¨×™××•×ª ×”Ö¾HTTP ×”××œ×• × ×ª×§×¢×•×ª ×××—×•×¨ ×‘×ª×•×š ×”Ö¾Flask (×™×¨×•×§ ×™×—×™×“ ×©×œ eventlet/CPU ×œ×•×œ××•×ª), ××– Twilio ×œ× ××§×‘×œ ×ª×©×•×‘×ª 204 ×‘×–××Ÿ â†’ 11205.

×©×™× ×œ×‘: ×”Ö¾routes ×§×™×™××™× ×•××—×–×™×¨×™× 204 ×‘×§×•×“, ××‘×œ ×ª×—×ª ×¢×•××¡/CPU ×”× ×¢×œ×•×œ×™× ×œ× ×œ×”×™×‘×—×¨ ×œ×¡×‘×œâ€×© ×‘×–××Ÿ â†’ timeout.

â¸»

×”×¤×ª×¨×•×Ÿ ×”×‘×˜×•×— (××™×™×“×™ ×•×œ×œ× ×ª×œ×•×ª ×‘-Flask)

× ×—×–×™×¨ 204 ×™×©×™×¨×•×ª ×‘Ö¾WSGI (×œ×¤× ×™ Flask), ×‘×“×™×•×§ ×›××• ×©×¢×©×™×ª ×œÖ¾/healthz. ×–×” ××‘×˜×œ ×›×œ ×¡×™×›×•×Ÿ ×œÖ¾timeout ×’× ×›×©×”Ö¾WS ×¢×¡×•×§.

×§×•×‘×¥: wsgi.py
×”×•×¡×£ ××ª ×©× ×™ ×”Ö¾if-×™× ×”××œ×” ×‘×ª×•×š def composite_app(environ, start_response): ×œ×¤× ×™ ×”× ×™×ª×•×‘ ×œ-Flask:

 def composite_app(environ, start_response):
     """Composite WSGI: WebSocket BEFORE Flask"""
     path = environ.get('PATH_INFO', '')
     method = environ.get('REQUEST_METHOD', 'GET')
 
     # Debug logging for all requests
     print(f"ğŸ” WSGI Route: {method} {path}", flush=True)
 
     # Direct healthz handling (bypass Flask routing issues)
     if path == '/healthz':
         print("â¤ï¸ Direct healthz response", flush=True)
         start_response('200 OK', [('Content-Type', 'text/plain')])
         return [b'ok']
 
+    # âš¡ Return 204 IMMEDIATELY for Twilio webhooks that must never block
+    if path in ('/webhook/stream_status', '/webhook/stream_status/', 
+                '/webhook/stream_ended', '/webhook/stream_ended/'):
+        print(f"âš¡ Fast 204 for {path}", flush=True)
+        start_response('204 No Content', [
+            ('Content-Type', 'text/plain'),
+            ('Cache-Control', 'no-store, no-cache, must-revalidate, max-age=0'),
+            ('Pragma', 'no-cache'),
+        ])
+        return [b'']
+
     if path == '/ws/twilio-media':
         print("ğŸ“ Routing to EventLet WebSocketWSGI", flush=True)
         return websocket_app_with_protocol(environ, start_response)
 
     # All other routes go to Flask
     print(f"ğŸŒ Routing to Flask app: {path}", flush=True)
     try:
         return flask_app.wsgi_app(environ, start_response)
     except Exception as e:
         print(f"âŒ Flask app error for {path}: {e}", flush=True)
         raise

×–×” ×¤×•×ª×¨ ××ª 11205 ×œ×’××¨×™, ×›×™ ×”×ª×©×•×‘×” ×—×•×–×¨×ª ××™×™×“ ××”Ö¾WSGI, ×‘×œ×™ ×œ×”×™×›× ×¡ ×œÖ¾Flask/DB/CSRF/Lock×™×, ×•×‘×œ×™ ×œ×”××ª×™×Ÿ ×œ×©×•× IO ×©×œ TTS/STT.

â¸»

×œ××” ×–×” ×¢×•×‘×“ ×˜×•×‘?
	â€¢	Twilio ×œ× ×“×•×¨×© ×ª×•×›×Ÿ â€“ 204 ×¨×™×§ ×”×•× ×ª×§×™×Ÿ ×œ×’××¨×™ ×œÖ¾statusCallback/action.
	â€¢	×”×¢×•××¡ ×©×œ ×”Ö¾WS (×©×œ×™×—×ª ××•×“×™×•, ×”××¨×•×ª, ×•×›×•â€™) ×œ× ××©×¤×™×¢ ×¢×œ ×”Ö¾204 (×›×™ ×–×” ×¢×•×§×£ ××ª Flask ×œ×’××¨×™).
	â€¢	×’× ×× ×™×© ×¢×•××¡ ×¨×’×¢×™/CPU, Eventlet ×™×’×™×© ××ª ×”×ª×©×•×‘×” ×”×–×• ××™×™×“×™×ª ×›×—×œ×§ ×Ö¾WSGI.

â¸»

×‘×“×™×§×” ××™×™×“×™×ª

×‘×œ×™ ×œ×‘×¦×¢ ×©×™×—×” â€“ ×•×•×“× ×©×”× ×ª×™×‘×™× ××—×–×™×¨×™× 204 ××”×¨:

curl -i -X POST https://ai-crmd.replit.app/webhook/stream_status
# ××¦×•×¤×”: HTTP/1.1 204 No Content (×‘×ª×•×š <100ms)

curl -i -X POST https://ai-crmd.replit.app/webhook/stream_ended
# ××¦×•×¤×”: HTTP/1.1 204 No Content

×•××– ×‘×¦×¢ ×©×™×—×ª ××‘×—×Ÿ. ×‘-Call Inspector ×ª×¨××” ×©×”-11205 × ×¢×œ×.

â¸»

×‘×•× ×•×¡ (×”×§×©×—×” ×§×˜× ×” ×©×œ× ×ª×–×™×§)

×›×“×™ ×œ×× ×•×¢ ×‘×¢×™×•×ª × ×™×ª×•×‘:
	â€¢	×”×©××¨ ××ª ×”Ö¾routes ×”××§×‘×™×œ×™× ×‘×ª×•×š Flask (×›×‘×¨ ×™×©) â€” ×–×” ×˜×•×‘ ×œ×œ×•×’×™× ×¤× ×™××™×™× ×›×©××™×Ÿ ×¢×•××¡.
	â€¢	×”×•×¡×¤×ª×™ ×”×ª×××” ×’× ×¢× ×¡×œ××© ×¡×•×¤×™ (/stream_status/, /stream_ended/) ×›×“×™ ×©×œ× ×™×™×¤×•×œ ×¢×œ ×ª×¦×•×¨×” ×©×œ ×¤×¨×•×§×¡×™/× ×ª×™×‘.

â¸»

××¦×‘ ×™×ª×¨ ×”×¨×›×™×‘×™×
	â€¢	Handshake WS âœ… (×”Ö¾Sec-WebSocket-Protocol: audio.twilio.com ××˜×•×¤×œ ×‘Ö¾wsgi.py).
	â€¢	TwiML âœ… (application/xml; charset=utf-8 + https:///wss://).
	â€¢	/healthz âœ… (××¢× ×” ×™×©×™×¨).
	â€¢	×§×‘×¦×™ Greeting/WS/Media/TTS/STT âœ… (× ××¦××™× ×•×¢×•×‘×“×™× ×œ×¤×™ ×”×‘×“×™×§×”).

â¸»

×× ×ª×¨×¦×”, ×× ×™ ××›×™×Ÿ ×œ×š ×’× patch ××œ× ××•×›×Ÿ ×œ×”×“×‘×§×” ×¢×œ wsgi.py (×¢× ×”×§×˜×¢×™× ×”×§×™×™××™× ××¡×•×× ×™×), ××‘×œ ×–×” ×‘×“×™×•×§ ×”×‘×œ×•×§ ×œ××¢×œ×”. ××—×¨×™ ×©×ª×¨×™×¥ â€” ×ª×•×›×œ ×œ×¨××•×ª ×‘Ö¾Call Inspector ×©×”-11205 × ×¢×œ×, ×•×”×–×¨×™××” × ×©××¨×ª ×™×¦×™×‘×” ×’× ×‘×©×™×—×•×ª ××¨×•×›×•×ª.