EALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ”‡ [SILENCE] Max warnings exceeded - initiating polite hangup
prosaas-backend  | ğŸ”’ [BUILD 194] Silence closing - blocking future transcripts
prosaas-backend  | ğŸ”’ [BUILD 194] Blocking _send_text_to_ai - closing already sent
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=9, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”, × ×›×•×Ÿ?
prosaas-backend  | â„¹ï¸ [BUILD 195] Verification phrase detected but lead NOT captured yet - NOT setting pending_confirmation
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.86s (24 chunks)
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 500 frames (rms=13, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×—×™×¤×”
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×™×¤×”'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×—×™×¤×”
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×™×¤×”', 'raw_city': '×—×™×¤×”'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×™×¤×”', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0'}
prosaas-backend  | âœ… [CITY] Auto-accepted: '×—×™×¤×”' (confidence=100%)
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×™×¤×”', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0', 'service_type': '×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¤×•×¨×¥ ×“×œ×ª×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [BUILD 193] ALLOWED: Transcript 1ms after AI (within 300ms overlap grace)
prosaas-backend  | [SILENCE GATE] âŒ REJECTED (RMS=8 < 30, frames=0): '×—×™×¤×”.'
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 600 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=160) retry #0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 700 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=538.0 > threshold=80.0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
prosaas-backend  | INFO:     127.0.0.1:59678 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12481, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=5954, voice_frames=0
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×—×™×¤×”, service_type=×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=160) retry #10
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=7281, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=2466.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=35, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (4055ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCnWOQ92NMwit7...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCnWOQ92NMwit7... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 9870ms gap between chunks #24 and #25 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [SILENCE GATE] âŒ REJECTED (RMS=10 < 30, frames=0): '×œ×, ×¡×œ×™×—×” ×™×“×•×¢×œ, ×‘×œ×ª×™, ×× ×™ ×‘×›×œ×œ ×¦×¨×™×š ×¤×•×¨×¥ ×“×“×œ×ª×•×ª ×‘×§×¨×™×™×ª ×©××•× ×”.'
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 800 frames (rms=9, reason=noise)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6936 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×”×‘× ×ª×™, ××– ××ª×” ×¦×¨×™×š ×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×§×¨×™×™×ª ×©××•× ×”, × ×›×•×Ÿ?
prosaas-backend  | â„¹ï¸ [BUILD 195] Verification phrase detected but lead NOT captured yet - NOT setting pending_confirmation
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.95s (40 chunks)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×™×¤×”', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0', 'service_type': '×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”'}
prosaas-backend  | âŒ [CITY] Rejected '×©××•× ×”,' (confidence=58%) - ask to repeat
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×§×¨×™×™×ª ×©××•× ×”
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×™×¤×”', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0', 'service_type': '×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×§×¨×™×™×ª ×©××•× ×”'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×§×¨×™×™×ª ×©××•× ×”
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×”×‘× ×ª×™, ××– ××ª×” ×¦×¨×™×š ×¤×•×¨×¥ ×“×œ×ª×•×ª ...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 900 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=160) retry #20
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1000 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=783.0 > threshold=80.0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #3 (prevents 5min timeout)
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12066, voice_frames=0
prosaas-backend  | INFO:     172.18.0.6:56496 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=19, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (1314ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCneHPs8tX330Z...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCneHPs8tX330Z... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 6675ms gap between chunks #40 and #41 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=160) retry #30
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=13, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1100 frames (rms=12, reason=noise)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | âš ï¸ [BUILD 178] Max hangup retries exceeded - forcing hangup
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×—×™×¤×”, service_type=×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×§×¨×™×™×ª ×©××•× ×”
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [SILENCE GATE] âŒ REJECTED (RMS=20 < 30, frames=0): '× ×›×•×Ÿ'
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ××œ×™×š ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª. ×ª×•×“×” ×•×œ×”×ª×¨××•×ª.
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.27s (65 chunks)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=16, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1200 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×™×¤×”', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0', 'service_type': '×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×§×¨×™×™×ª ×©××•× ×”'}
prosaas-backend  | âŒ [CITY] Rejected '××œ×™×š' (confidence=84%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] Clear goodbye detected: '××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™×...'
prosaas-backend  | âœ… [HANGUP BUILD 176] AI said goodbye with auto_end_on_goodbye=True + user interaction - disconnecting
prosaas-backend  | ğŸ”’ [BUILD 194] Hangup triggered - blocking future transcripts
prosaas-backend  | ğŸ”‡ [BUILD 194] Cleared audio input buffer
prosaas-backend  | ğŸ“ [STATE] Transitioning ACTIVE â†’ CLOSING (reason: ai_goodbye_auto_end)
prosaas-backend  | ğŸ“ [BUILD 163] Pending hangup set - will disconnect after audio finishes playing
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | âœ… [POLITE HANGUP] OpenAI queue empty after 0ms
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 158 frames...
prosaas-backend  | [REALTIME] event: input_audio_buffer.cleared
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1300 frames (rms=8, reason=noise)
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 108 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 57 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1400 frames (rms=9, reason=noise)
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 6 frames...
prosaas-backend  | âœ… [POLITE HANGUP] Twilio TX queue empty after 3200ms
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=13, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1500 frames (rms=16, reason=noise)
prosaas-backend  | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
prosaas-backend  | ğŸ“ [SMART HANGUP] === CALL ENDING ===
prosaas-backend  | ğŸ“ [SMART HANGUP] Reason: AI finished speaking politely
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead captured: False
prosaas-backend  | ğŸ“ [SMART HANGUP] Goodbye detected: True
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead state: {'city_needs_retry': 'True', 'city': '×—×™×¤×”', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0', 'service_type': '×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×§×¨×™×™×ª ×©××•× ×”'}
prosaas-backend  | ğŸ“ [SMART HANGUP] Required fields: ['city', 'service_type']
prosaas-backend  | ğŸ“ [SMART HANGUP] ===================
prosaas-backend  | âœ… [BUILD 163] Call CA09114d... hung up successfully: AI finished speaking politely
prosaas-backend  | WS_STOP sid=MZ3944770af18de895161c4344699e8bfd rx=2173 tx=1145
prosaas-backend  | ğŸ“ [SES-069db762] CALL ENDED - duration=43.4s, business_id=10, rx=2173, tx=1145
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | STREAM_ENDED call=CA09114d9349d393057ebd580f52dc0cd5 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:55524 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | INFO:     172.18.0.6:55534 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CA09114d9349d393057ebd580f52dc0cd5: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE0847c07da77cff2e7102aa3f227f3cf8.json
prosaas-backend  | âœ… Recording queued for processing: CA09114d9349d393057ebd580f52dc0cd5
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âœ… CALL FINALIZED: CA09114d9349d393057ebd580f52dc0cd5
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×”×¤× ×™×™×” ×”×™× ×‘×ª×—×•× ×©×™×¨×•×ª×™ ×¤×¨×™×¦×ª ×“×œ×ª×•×ª. ×”×œ×§×•×— ××—×¤×© ×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×§×¨×™×™×ª ×©××•× ×”.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | - **×©×™×¨×•×ª × ×“×¨×©**: ×¤×•×¨×¥ ×“×œ×ª×•×ª
prosaas-backend  | - **××™×§×•×**: ×§×¨×™×™×ª ×©××•× ×”
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×§×©×¨ ××• ×©× ×”×œ×§×•×—.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - **×¤×¢×•×œ×”**: ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ×œ×œ×§×•×— ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª.
prosaas-backend  | - **×“×—×™×¤×•×ª**: ×œ× ×¦×•×™× ×” ×“×—×™×¤×•×ª, ××š ×™×© ×œ×”× ×™×— ×©×”×©×™×¨×•×ª × ×“×¨×© ×‘×”×§×“×.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×™×© ×œ×•×•×“× ×©×”×œ×§×•×— ××§×‘×œ ××ª ×”×©×™×¨×•×ª ×‘×”×§×“× ×”××¤×©×¨×™, ×©×›×Ÿ ××“×•×‘×¨ ×‘×©×™×¨×•×ª ×“×—×•×£. ××•××œ×¥ ×œ×¢×§×•×‘ ××—×¨×™ ×”×¤× ×™×™×” ×•×œ×•×•×“× ×©×”×œ×§×•×— ××¨×•×¦×” ××”×©×™×¨×•×ª ×©× ×™×ª×Ÿ ×œ×•.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ3944770af18de895161c4344699e8bfd rx=2173 tx=1145
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Extracted SPECIFIC service from AI confirmation: '×¤×•×¨×¥ ×“×œ×ª×•×ª'
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True', 'city': '×—×™×¤×”', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0', 'service_type': '×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×§×¨×™×™×ª ×©××•× ×”'}
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CA09114d9349d393057ebd580f52dc0cd5, phone=+972504294724, city=×—×™×¤×”, direction=inbound
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×—×™×¤×”, service=×¤×•×¨×¥ ×“×œ×ª×•×ª
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | INFO:     127.0.0.1:37858 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CA0af170c70dd1a02b3bf9f79fe9272cc3
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CA0af170c70dd1a02b3bf9f79fe9272cc3
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CA0af170c70dd1a02b3bf9f79fe9272cc3
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1261ms - CA0af170c70dd1a0
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CA0af170c70dd1a02b3bf9f79fe9272cc3" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:44190 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:44196 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-43b503da
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764890039.147] WS_START sid=MZ598acd2968eb36ba4ab9b0fb2bbc205f call_sid=CA0af170c70dd1a02b3bf9f79fe9272cc3 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CA0af170 (FRESH SESSION)
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 480ms (T0+482ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 956ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1060ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CA0af170c70dd1a02b3bf9f79fe9272cc3
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764890040.210] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1062ms
prosaas-backend  | 
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=20.7, threshold=80.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 583ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1063ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764890040.213
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1063ms, T0â†’speak=1066ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCoKbU5WDtZX3r...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCoKbU5WDtZX3r... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… Call log already exists for CA0af170c70dd1a02b3bf9f79fe9272cc3
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ“ [PROMPT] Final length: 3575 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6400 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764890041.821 (duration: 1609ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=214.0 > threshold=80.0
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=66 66 64 63 61, rms=248, consec_frames=4
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=f4 f0 f2 f0 f2, rms=141, consec_frames=5
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=7e fc f8 f4 f2, rms=174, consec_frames=6
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | âœ… Recording started for CA0af170c70dd1a02b3bf9f79fe9272cc3: RE5dd52a0b4059ff93e6433f8ae874028e
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=594, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1566ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 2.1s - now updating session
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 3575 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.1s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=17600 | silence_ms=506
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (1004ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCoOyO0baIXYnm...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCoOyO0baIXYnm... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=d6 c9 c6 c3 c9
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=53 4b 4a 46 43
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=38 37 4b 46 e0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=25, reason=noise)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 4268 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.27s (6 chunks)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=1134.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=257, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨' (confidence=54%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [BUILD 193] ALLOWED: Transcript 1ms after AI (within 300ms overlap grace)
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED Hebrew: '×‘×‘×§×©×”'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×‘×‘×§×©×”' (hebrew=5, english=0)
prosaas-backend  | ğŸ’° [COST] User utterance: 2.54s (66 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×‘×‘×§×©×”
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×‘×§×©×”' (confidence=48%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×‘×‘×§×©×”...'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×‘×‘×§×©×”...'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 3
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×‘×‘×§×©×”']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 65dc99fa...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=65dc99fa...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×‘×‘×§×©×”...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...[SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | 
prosaas-backend  | ğŸ” [NLP] Conversation history has 3 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?', 'ts': 1764890041.821706}, {'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764890045.223688}, {'speaker': 'user', 'text': '×‘×‘×§×©×”', 'ts': 1764890045.9296534}]
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | INFO:     127.0.0.1:38766 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (1002ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCoRFNDnca1rnP...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCoRFNDnca1rnP... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 2306ms gap between chunks #6 and #7 - OpenAI delay!
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=424, voice_frames=0
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED Hebrew: '×ª×•×“×”.'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×ª×•×“×”.' (hebrew=4, english=0)
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (1900ms)
prosaas-backend  | ğŸ’° [COST] User utterance: 1.78s (139 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×ª×•×“×”.
prosaas-backend  | âš ï¸ [BUILD 186] INCOHERENT: Response '×ª×•×“×”.' doesn't match city question
prosaas-backend  | ğŸ”„ [BUILD 186] Marked incoherent response - AI will ask for clarification
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×ª×•×“×”.' (confidence=45%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×ª×•×“×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×ª×•×“×”....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 4
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×‘×‘×§×©×”', '×ª×•×“×”.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: ec7cc52e...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (65dc99fa â†’ ec7cc52e) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=ec7cc52e...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...[GOODBYE CHECK] No goodbye phrase: '×ª×•×“×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | ğŸ” [NLP] Conversation history has 4 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764890045.223688}, {'speaker': 'user', 'text': '×‘×‘×§×©×”', 'ts': 1764890045.9296534}, {'speaker': 'user', 'text': '×ª×•×“×”.', 'ts': 1764890047.8295586}]
prosaas-backend  | 
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ›¡ï¸ [BUILD 187 GRACE] Ignoring speech_started - only 803ms since response.created (grace=1000ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¤×•×¨×¥ ×× ×¢×•×œ×™× ×‘×¢×™×¨ ×ª×œ ××‘×™×‘, × ×›×•×Ÿ
prosaas-backend  | â„¹ï¸ [BUILD 195] Verification phrase detected but lead NOT captured yet - NOT setting pending_confirmation
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.51s (14 chunks)
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 200 frames (rms=21, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=19, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×ª×œ ××‘×™×‘
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×ª×œ ××‘×™×‘'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×ª×œ ××‘×™×‘
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×ª×œ ××‘×™×‘', 'raw_city': '×ª×œ ××‘×™×‘'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×ª×œ ××‘×™×‘', 'raw_city': '×ª×œ ××‘×™×‘', 'city_confidence': '100.0'}
prosaas-backend  | âœ… [CITY] Auto-accepted: '×ª×œ ××‘×™×‘' (confidence=100%)
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×¤×•×¨×¥ ×× ×¢×•×œ×™× ×‘×¢×™×¨ ×ª×œ ××‘×™×‘
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×ª×œ ××‘×™×‘', 'raw_city': '×ª×œ ××‘×™×‘', 'city_confidence': '100.0', 'service_type': '×¤×•×¨×¥ ×× ×¢×•×œ×™× ×‘×¢×™×¨ ×ª×œ ××‘×™×‘'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×¤×•×¨×¥ ×× ×¢×•×œ×™× ×‘×¢×™×¨ ×ª×œ ××‘×™×‘
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¤×•×¨×¥ ×× ×¢×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=1, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | ğŸ”„ [BUILD 193] Response cancelled (output=1)! Triggering IMMEDIATE recovery...
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=281.0 > threshold=80.0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 300 frames (rms=37, reason=noise)
prosaas-backend  | ğŸ”„ [BUILD 192] RECOVERY: Triggering response.create NOW!
prosaas-backend  | âœ… [BUILD 192] RECOVERY SUCCESS: response.create sent!
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=33, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCoU6Qescnzlts...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCoU6Qescnzlts... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=459, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=73, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 400 frames (rms=31, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=24, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=504.0 > threshold=80.0
prosaas-backend  | WS_STOP sid=MZ598acd2968eb36ba4ab9b0fb2bbc205f rx=757 tx=387
prosaas-backend  | ğŸ“ [SES-43b503da] CALL ENDED - duration=15.1s, business_id=10, rx=757, tx=387
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CA0af170c70dd1a02b3bf9f79fe9272cc3 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:60648 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CA0af170c70dd1a02b3bf9f79fe9272cc3: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE5dd52a0b4059ff93e6433f8ae874028e.json
prosaas-backend  | INFO:     172.18.0.6:60662 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CA0af170c70dd1a02b3bf9f79fe9272cc3
prosaas-backend  | INFO:     connection closed
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×ª×œ ××‘×™×‘, service_type=×¤×•×¨×¥ ×× ×¢×•×œ×™× ×‘×¢×™×¨ ×ª×œ ××‘×™×‘
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CAb048308f4ec5d7934f99fdb487a05193
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAb048308f4ec5d7934f99fdb487a05193
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAb048308f4ec5d7934f99fdb487a05193
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1265ms - CAb048308f4ec5d7
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAb048308f4ec5d7934f99fdb487a05193" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:60670 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:60684 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-25b959fd
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764890057.354] WS_START sid=MZ475a391142baaaa7d83ae12ebd17ceae call_sid=CAb048308f4ec5d7934f99fdb487a05193 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAb04830 (FRESH SESSION)
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELYâš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | 
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 447ms (T0+448ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | INFO:     172.18.0.6:60700 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 980ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1087ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAb048308f4ec5d7934f99fdb487a05193
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread started
prosaas-backend  | ğŸ¯ [T1=1764890058.442] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1088ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=23.8, threshold=80.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 643ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1090ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764890058.445
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1091ms, T0â†’speak=1092ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCoceuiZMB0crY...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCoceuiZMB0crY... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 11292ms gap between chunks #14 and #15 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | âœ… Call log already exists for CAb048308f4ec5d7934f99fdb487a05193
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… Recording started for CAb048308f4ec5d7934f99fdb487a05193: REb615a0e6fee8f91804311b52bbe8aa25
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ“ [PROMPT] Final length: 3575 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CALL FINALIZED: CA0af170c70dd1a02b3bf9f79fe9272cc3
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×©×™×—×” ×‘× ×•×©× ×©×™×¨×•×ª×™ ×¤×¨×™×¦×ª ×× ×¢×•×œ×™×, ×‘×ª×—×•× ×”× ×“×œ"×Ÿ.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | ×”×œ×§×•×— ××—×¤×© ×©×™×¨×•×ª×™ ×¤×•×¨×¥ ×× ×¢×•×œ×™× ×‘×¢×™×¨ ×ª×œ ××‘×™×‘. ×œ× × ××¡×¨×• ×¤×¨×˜×™× × ×•×¡×¤×™× ×œ×’×‘×™ ×¡×•×’ ×”×× ×¢×•×œ ××• ×“×—×™×¤×•×ª ×”×©×™×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×œ×§×•×— ×›×’×•×Ÿ ×©× ××• ×××¦×¢×™ ×”×ª×§×©×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - ×œ× × ×§×‘×¢×” ×¤×’×™×©×” ××• ×ª×•×¨ ×‘×©×™×—×” ×–×•.
prosaas-backend  | - ×“×—×™×¤×•×ª: ×œ× ×¦×•×™× ×” ×“×—×™×¤×•×ª, ××š ×™×© ×œ×”× ×™×— ×©×”×©×™×¨×•×ª × ×“×¨×© ×‘×”×§×“×.
prosaas-backend  | - ×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª: ×™×© ×œ×™×¦×•×¨ ×§×©×¨ ×¢× ×”×œ×§×•×— ×œ×”×‘×”×¨×ª ×¤×¨×˜×™× × ×•×¡×¤×™× ×•×œ×ª×™××•× ××•×¢×“ ×©×™×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ××•××œ×¥ ×œ×‘×“×•×§ ××ª ×–××™× ×•×ª ×”×˜×›× ××™× ×‘×¢×™×¨ ×ª×œ ××‘×™×‘ ×•×œ×•×•×“× ×©×”×©×™×¨×•×ª×™× ×”××•×¦×¢×™× ××ª××™××™× ×œ×¦×¨×›×™ ×”×œ×§×•×—. ×™×© ×œ×”×¦×™×¢ ×¤×ª×¨×•× ×•×ª ××”×™×¨×™× ×•×™×¢×™×œ×™×, ×©×›×Ÿ ×©×™×¨×•×ª×™ ×¤×¨×™×¦×ª ×× ×¢×•×œ×™× × ×“×¨×©×™× ×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª ×‘××¦×‘×™× ×“×—×•×¤×™×.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | âš ï¸ [AUDIO GAP] 849ms gap between chunks #21 and #22 - OpenAI delay!
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ598acd2968eb36ba4ab9b0fb2bbc205f rx=757 tx=387
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764890060.407 (duration: 1962ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=108.0 > threshold=80.0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=f8 eb e4 e2 e2, rms=281, consec_frames=4
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [AUDIO] 56 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ××œ×™×š ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª. ×ª×•×“×” ×•×œ×”×ª×¨××•×ª.
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.42s (45 chunks)
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=e6 dc db de ea, rms=487, consec_frames=5
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=db cd cd d8 7e, rms=702, consec_frames=6
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Extracted SPECIFIC service from AI confirmation: '×¤×•×¨×¥ ×× ×¢×•×œ×™×'
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True', 'city': '×ª×œ ××‘×™×‘', 'raw_city': '×ª×œ ××‘×™×‘', 'city_confidence': '100.0', 'service_type': '×¤×•×¨×¥ ×× ×¢×•×œ×™× ×‘×¢×™×¨ ×ª×œ ××‘×™×‘'}
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CA0af170c70dd1a02b3bf9f79fe9272cc3, phone=+972504294724, city=×ª×œ ××‘×™×‘, direction=inbound
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×ª×œ ××‘×™×‘, service=×¤×•×¨×¥ ×× ×¢×•×œ×™×
prosaas-backend  | 
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=102, voice_frames=0
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=25, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=51, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=25, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=140.0 > threshold=80.0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ×¡...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 4.7s - now updating session
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.7s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=26880 | silence_ms=753
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×ª×œ ××‘×™×‘', 'raw_city': '×ª×œ ××‘×™×‘', 'city_confidence': '100.0', 'service_type': '×¤×•×¨×¥ ×× ×¢×•×œ×™× ×‘×¢×™×¨ ×ª×œ ××‘×™×‘'}
prosaas-backend  | âŒ [CITY] Rejected '××œ×™×š' (confidence=84%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] Clear goodbye detected: '××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™×...'
prosaas-backend  | âœ… [HANGUP BUILD 176] AI said goodbye with auto_end_on_goodbye=True + user interaction - disconnecting
prosaas-backend  | ğŸ”’ [BUILD 194] Hangup triggered - blocking future transcripts
prosaas-backend  | ğŸ”‡ [BUILD 194] Cleared audio input buffer
prosaas-backend  | ğŸ“ [STATE] Transitioning ACTIVE â†’ CLOSING (reason: ai_goodbye_auto_end)
prosaas-backend  | ğŸ“ [BUILD 163] Pending hangup set - will disconnect after audio finishes playing
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [AUDIO] 56 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 3575 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | [REALTIME] event: input_audio_buffer.cleared
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=42, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (1118ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCojVYU5dIkUaF...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCojVYU5dIkUaF... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=7e 7e 7e 7e 7d
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=4f 46 48 47 48
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=7c 79 79 7a 7a
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [SILENCE GATE] âŒ REJECTED (RMS=15 < 30, frames=0): '×ª×•×“×” ×¨×‘×”.'
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 200 frames (rms=19, reason=noise)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6400 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.37s (6 chunks)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=14, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨' (confidence=54%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=122.0 > threshold=80.0
prosaas-backend  | WS_STOP sid=MZ475a391142baaaa7d83ae12ebd17ceae rx=504 tx=383
prosaas-backend  | ğŸ“ [SES-25b959fd] CALL ENDED - duration=10.0s, business_id=10, rx=504, tx=383
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CAb048308f4ec5d7934f99fdb487a05193 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:40012 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | INFO:     172.18.0.6:40024 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CAb048308f4ec5d7934f99fdb487a05193: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REb615a0e6fee8f91804311b52bbe8aa25.json
prosaas-backend  | âœ… Recording queued for processing: CAb048308f4ec5d7934f99fdb487a05193
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âœ… [POLITE HANGUP] Twilio TX queue empty after 0ms
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CA284a889b4fa6015b68fa480e5f3e0000
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CA284a889b4fa6015b68fa480e5f3e0000
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CA284a889b4fa6015b68fa480e5f3e0000ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1316ms - CA284a889b4fa601
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CA284a889b4fa6015b68fa480e5f3e0000" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:40030 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | INFO:     172.18.0.6:40038 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-93dbc214
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764890070.748] WS_START sid=MZ7f81eec0711c0fee889a39a1db1a3e4e call_sid=CA284a889b4fa6015b68fa480e5f3e0000 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CA284a88 (FRESH SESSION)âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | 
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 440ms (T0+442ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=56, tx_q=0) retry #0
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 1033ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1139ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CA284a889b4fa6015b68fa480e5f3e0000
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764890071.888] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1140ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | 
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=10.9, threshold=80.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 701ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 1ms (total: 1142ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764890071.891
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1142ms, T0â†’speak=1144ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCopmApF03tdBL...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCopmApF03tdBL... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 5.3s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Call log already exists for CA284a889b4fa6015b68fa480e5f3e0000
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Recording started for CA284a889b4fa6015b68fa480e5f3e0000: REa76120d109ca615821a3fb9f09c74d71
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ“ [PROMPT] Final length: 3575 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CALL FINALIZED: CAb048308f4ec5d7934f99fdb487a05193
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×©×™×—×” ×‘×ª×—×•× ×”× ×“×œ"×Ÿ, ×”×œ×§×•×— ××—×¤×© ×©×™×¨×•×ª×™ ×ª×™×•×•×š ××• ×™×™×¢×•×¥ ×‘× ×•×’×¢ ×œ×¨×›×™×©×ª × ×›×¡.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | ×”×œ×§×•×— ×œ× ×¦×™×™×Ÿ ×¤×¨×˜×™× ××“×•×™×§×™× ×œ×’×‘×™ ×¡×•×’ ×”× ×›×¡, ×”××–×•×¨ ××• ×”×ª×§×¦×™×‘, ××š ×™×© ×¦×•×¨×š ×‘××™×“×¢ × ×•×¡×£ ×›×“×™ ×œ×”××©×™×š ×‘×ª×”×œ×™×š.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×”×œ×§×•×— ××• ×××¦×¢×™ ×”×ª×§×©×¨×•×ª ×‘××”×œ×š ×”×©×™×—×”.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - ×œ× × ×§×‘×¢×” ×¤×’×™×©×” ××• ×¤×¢×•×œ×” × ×•×¡×¤×ª ×‘×©×™×—×” ×–×•.
prosaas-backend  | - ×“×—×™×¤×•×ª: ×‘×™× ×•× ×™×ª, ×™×© ×¦×•×¨×š ×‘××¢× ×” ××”×™×¨ ×›×“×™ ×œ××ª×¨ × ×›×¡×™× ××ª××™××™×.
prosaas-backend  | - ×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª: ×™×© ×œ×™×¦×•×¨ ×§×©×¨ ×¢× ×”×œ×§×•×— ×›×“×™ ×œ××¡×•×£ ×¤×¨×˜×™× × ×•×¡×¤×™× ×¢×œ ×¡×•×’ ×”× ×›×¡, ××–×•×¨ ××’×•×¨×™× ×•×ª×§×¦×™×‘.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×™×© ×œ×”×§×¤×™×“ ×¢×œ ×ª×§×©×•×¨×ª ×‘×¨×•×¨×” ×¢× ×”×œ×§×•×— ×•×œ×•×•×“× ×©×”×©××œ×•×ª ×”×‘××•×ª ×™×›×™×œ×• ××ª ×›×œ ×”×¤×¨×˜×™× ×”× ×“×¨×©×™× ×œ×”××©×š ×ª×”×œ×™×š ×¨×›×™×©×ª ×”× ×›×¡.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6936 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764890073.285 (duration: 1393ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ475a391142baaaa7d83ae12ebd17ceae rx=504 tx=383
prosaas-backend  | âœ… call_log created immediately for CA6a2dcc5b857e40a2e2aabd1501338616
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CA6a2dcc5b857e40a2e2aabd1501338616
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CA6a2dcc5b857e40a2e2aabd1501338616ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1228ms - CA6a2dcc5b857e40
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CA6a2dcc5b857e40a2e2aabd1501338616" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:37858 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:37868 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Found LAST professional in transcript: ×× ×¢×•×œ×Ÿ (pos=22)
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True'}
prosaas-backend  |    â””â”€ City from transcript (fuzzy): ×¢×™×¨ ×’× ×™× (confidence=86%)
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CAb048308f4ec5d7934f99fdb487a05193, phone=+972504294724, city=×¢×™×¨ ×’× ×™×, direction=inbound
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-53db52b4
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764890073.908] WS_START sid=MZ048635f8021ddedac551d74acc2a268f call_sid=CA6a2dcc5b857e40a2e2aabd1501338616 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CA6a2dcc (FRESH SESSION)âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | 
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×¢×™×¨ ×’× ×™×, service=×× ×¢×•×œ×Ÿ
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 611ms (T0+628ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1621ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 1.9s - now updating session
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 1003ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1113ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CA6a2dcc5b857e40a2e2aabd1501338616
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764890075.023] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | 
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1115ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 489ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1112ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764890075.026
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1112ms, T0â†’speak=1118ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCotcndfBw489y...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCotcndfBw489y... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=18.1, threshold=80.0)
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 3575 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | WS_STOP sid=MZ048635f8021ddedac551d74acc2a268f rx=85 tx=6
prosaas-backend  | ğŸ“ [SES-53db52b4] CALL ENDED - duration=1.7s, business_id=10, rx=85, tx=6
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | STREAM_ENDED call=CA6a2dcc5b857e40a2e2aabd1501338616 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:37872 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | INFO:     172.18.0.6:37882 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âš ï¸ Could not start REST API recording for CA6a2dcc5b857e40a2e2aabd1501338616: HTTP 400 error: Unable to create record: Requested resource is not eligible for recording
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | âœ… Call log already exists for CA6a2dcc5b857e40a2e2aabd1501338616
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | â„¹ï¸ Call CA6a2dcc5b857e40a2e2aabd1501338616 ended without recording (status: completed)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ“ [PROMPT] Final length: 3575 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=324.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=115, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ“Š [FINALIZE] NO USER SPEECH - skipping summary generation for CA6a2dcc5b857e40a2e2aabd1501338616
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764890076.467 (duration: 1441ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [AUDIO] 15 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | INFO:     127.0.0.1:36198 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=56, tx_q=0) retry #10
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âœ… CALL FINALIZED (no conversation): CA6a2dcc5b857e40a2e2aabd1501338616
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | WS_STOP sid=MZ7f81eec0711c0fee889a39a1db1a3e4e rx=321 tx=232
prosaas-backend  | ğŸ“ [SES-93dbc214] CALL ENDED - duration=6.4s, business_id=10, rx=321, tx=232
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | âœ… Resolved business_id=1 from to_number=+97233763805 (Business: ×¤×¨×• ×¡××¡)
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | [WA-SESSION] ğŸ“± Check #2: Found 0 stale sessions to process
prosaas-backend  | ğŸ“Š [FINALIZE] NO USER SPEECH - skipping summary generation for CA284a889b4fa6015b68fa480e5f3e0000
prosaas-backend  | âœ… call_log created immediately for CA8f10d2fcb2dd87379fe91b64a76e44a3
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972533432757, call_sid=CA8f10d2fcb2dd87379fe91b64a76e44a3
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972533432757, call_sid=CA8f10d2fcb2dd87379fe91b64a76e44a3
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context createdğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1387ms - CA8f10d2fcb2dd87
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CA8f10d2fcb2dd87379fe91b64a76e44a3" /><Parameter name="To" value="+97233763805" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:37896 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | STREAM_ENDED call=CA284a889b4fa6015b68fa480e5f3e0000 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:37908 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | INFO:     connection closed
prosaas-backend  | INFO:     172.18.0.6:37924 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… CALL FINALIZED (no conversation): CA284a889b4fa6015b68fa480e5f3e0000
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1815ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [AUDIO] 15 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 2.2s - now updating session
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 2/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | âœ… Found existing recording for CA284a889b4fa6015b68fa480e5f3e0000: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REa76120d109ca615821a3fb9f09c74d71.json
prosaas-backend  | INFO:     172.18.0.6:37938 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-97872900
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233763805'
prosaas-backend  | ğŸ¯ [T0=1764890078.487] WS_START sid=MZfaf3b247d4c38ae52adebc1b82dd93d0 call_sid=CA8f10d2fcb2dd87379fe91b64a76e44a3 from=None to=+97233763805 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CA8f10d2 (FRESH SESSION)âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233763805
prosaas-backend  | 
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | âœ… Recording queued for processing: CA284a889b4fa6015b68fa480e5f3e0000
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ048635f8021ddedac551d74acc2a268f rx=85 tx=6
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 3575 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 464ms (T0+465ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×¤×¨×• ×¡××¡ (id=1)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 977ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=10s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['preferred_time', 'name']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=1 in 1084ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=1, SID=CA8f10d2fcb2dd87379fe91b64a76e44a3
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread started
prosaas-backend  | ğŸ¯ [T1=1764890079.571] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•× ×–××ª ×”× ×¦×™×’×” ×”×“×™×’×™×˜×œ×™×ª ×©×œ ××¡×¤×¨×ª ×”×’×œ×‘×•×¢ ××™×š ××•×›×œ...' (len=62)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1085ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 621ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•× ×–××ª ×”× ×¦×™×’×” ×”×“×™×’×™×˜×œ×™×ª ×©×œ ××¡×¤×¨×ª ×”×’×œ×‘×•×¢ ××™×š ××•×›×œ...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=1)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=62 chars (direction=inbound)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1086ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764890079.574
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1086ms, T0â†’speak=1087ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCoxEumLrLLBD8...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCoxEumLrLLBD8... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… call_log created immediately for CAeece782c4afe1e4372930bf12913abf7
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAeece782c4afe1e4372930bf12913abf7
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAeece782c4afe1e4372930bf12913abf7ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1223ms - CAeece782c4afe1e
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAeece782c4afe1e4372930bf12913abf7" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:37942 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | INFO:     172.18.0.6:37948 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=27.9, threshold=83.6)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-3bfe037c
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764890080.434] WS_START sid=MZ28ff6fbfd2b59a30019a7d72d74c09a0 call_sid=CAeece782c4afe1e4372930bf12913abf7 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAeece78 (FRESH SESSION)
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELYâš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | 
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Recording started for CA8f10d2fcb2dd87379fe91b64a76e44a3: RE9dd1b6ee214191e700068c7f6c9119ee
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… Call log already exists for CA8f10d2fcb2dd87379fe91b64a76e44a3
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=40, lead_id=122, was_created=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ7f81eec0711c0fee889a39a1db1a3e4e rx=321 tx=232
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ“ [PROMPT] Final length: 5012 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 439ms (T0+440ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764890081.223 (duration: 1649ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×, ×–××ª ×”× ×¦×™×’×” ×”×“×™×’×™×˜×œ×™×ª ×©×œ ××¡×¤×¨×ª ×”×’×œ×‘×•×¢. ××™×š ××•×›×œ ×œ×¢×–×•×¨ ×œ×›×?
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 0ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×, ×–××ª ×”× ×¦×™×’×” ×”×“×™×’×™×˜×œ×™×ª ×©×œ ...'
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=10s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.4s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 0.6s - now updating session
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 959ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1063ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAeece782c4afe1e4372930bf12913abf7
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread started
prosaas-backend  | ğŸ¯ [T1=1764890081.498] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1065ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 627ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1067ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764890081.501
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1067ms, T0â†’speak=1068ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=20.5, threshold=80.0)
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=56, tx_q=0) retry #20
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=283.0 > threshold=83.6
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCoz90arLbR1IS...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCoz90arLbR1IS... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 5012 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=ed db df d8 5a, rms=546, consec_frames=4
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=fc d4 5a 68 d9, rms=569, consec_frames=5
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=6f dd 5f 5f dd, rms=368, consec_frames=6
prosaas-backend  | âœ… Updated call_log with customer_id=40
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=183, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… Call log already exists for CAeece782c4afe1e4372930bf12913abf7
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… Recording started for CAeece782c4afe1e4372930bf12913abf7: REb6702104b15d7fec1b737ad0610e30cb
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ“ [PROMPT] Final length: 3575 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764890082.925 (duration: 1424ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=23, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=255.0 > threshold=80.0
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=fe fa ee ee ed, rms=309, consec_frames=4
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=e6 e1 dd dc dc, rms=474, consec_frames=5
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=ef 78 67 5e 59, rms=268, consec_frames=6
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=327, voice_frames=0
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ”‡ [SILENCE] Max warnings exceeded - initiating polite hangup
prosaas-backend  | ğŸ”’ [BUILD 194] Silence closing - blocking future transcripts
prosaas-backend  | ğŸ”’ [BUILD 194] Blocking _send_text_to_ai - closing already sent
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.2s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1608ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 2.0s - now updating session
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=531.0 > threshold=83.6
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 3575 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=8, reason=noise)
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=285, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=32, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (950ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCp4trGTJy608u...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCp4trGTJy608u... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=515, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=56, tx_q=0) retry #30
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=fe fd fb fa fb
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=da d7 cd d2 d0
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED Hebrew: '×ª×•×“×” ×¨×‘×”'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×ª×•×“×” ×¨×‘×”' (hebrew=7, english=0)
prosaas-backend  | ğŸ’° [COST] User utterance: 5.10s (138 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×ª×•×“×” ×¨×‘×”
prosaas-backend  | âš ï¸ [BUILD 186] INCOHERENT: First response '×ª×•×“×” ×¨×‘×”' doesn't make sense after greeting
prosaas-backend  | ğŸ”„ [BUILD 186] Marked incoherent response - AI will ask for clarification
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×ª×•×“×” ×¨×‘×”...'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×ª×•×“×” ×¨×‘×”...'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 2
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×ª×•×“×” ×¨×‘×”']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 9f00b4ed...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=9f00b4ed...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 2 messages[GOODBYE CHECK] No goodbye phrase: '×ª×•×“×” ×¨×‘×”...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['preferred_time', 'name']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['preferred_time', 'name'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×, ×–××ª ×”× ×¦×™×’×” ×”×“×™×’×™×˜×œ×™×ª ×©×œ ××¡×¤×¨×ª ×”×’×œ×‘×•×¢. ××™×š ××•×›×œ ×œ×¢×–×•×¨ ×œ×›×?', 'ts': 1764890081.2233078}, {'speaker': 'user', 'text': '×ª×•×“×” ×¨×‘×”', 'ts': 1764890086.7816622}]
prosaas-backend  | 
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=d5 bb bb bb b7
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.3s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=21440 | silence_ms=516
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=9, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âš ï¸ [BUILD 178] Max hangup retries exceeded - forcing hangup
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=234, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6936 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×‘×©××—×”, ×¢×œ ××™×–×” ×©× ×œ×¨×©×•× ××ª ×”×ª×•×¨?
prosaas-backend  | â­ï¸ [LOOP GUARD] Skipped - appointment flow (has_appointment=None, is_scheduling=True)
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.62s (11 chunks)
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×‘×©××—×”, ×¢×œ ××™×–×” ×©× ×œ×¨×©×•× ××ª ×”×ª×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (1362ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCp5usZ1JeB9ZI...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCp5usZ1JeB9ZI... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=47) retry #0
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 2/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=143.0 > threshold=80.0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=7d 7b 7b 7b 7c
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=189.0 > threshold=83.6
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=42 3a 3d 3b 3c
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=73 f5 50 55 58
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=51, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.47s (9 chunks)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 200 frames (rms=33, reason=noise)
prosaas-backend  | WS_STOP sid=MZfaf3b247d4c38ae52adebc1b82dd93d0 rx=478 tx=394
prosaas-backend  | ğŸ“ [SES-97872900] CALL ENDED - duration=10.1s, business_id=1, rx=478, tx=394
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | STREAM_ENDED call=CA8f10d2fcb2dd87379fe91b64a76e44a3 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:38222 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | INFO:     172.18.0.6:38226 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨' (confidence=54%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [BUILD 193] ALLOWED: Transcript 1ms after AI (within 300ms overlap grace)
prosaas-backend  | [SILENCE GATE] âŒ REJECTED (RMS=11 < 30, frames=0): 'â€«×ª×•×“×” ×¨×‘×”.'
prosaas-backend  | âœ… Found existing recording for CA8f10d2fcb2dd87379fe91b64a76e44a3: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE9dd1b6ee214191e700068c7f6c9119ee.json
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=742, voice_frames=0
prosaas-backend  | âœ… Recording queued for processing: CA8f10d2fcb2dd87379fe91b64a76e44a3
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | INFO:     connection closed
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.5s audio, conversation #1
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=24320 | silence_ms=521
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #1
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 2/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (1616ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCp8KTNyo6z7LL...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCp8KTNyo6z7LL... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=25, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 3243ms gap between chunks #9 and #10 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=32, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×—×•×œ×•×Ÿ, × ×›×•×Ÿ?
prosaas-backend  | â„¹ï¸ [BUILD 195] Verification phrase detected but lead NOT captured yet - NOT setting pending_confirmation
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.82s (25 chunks)
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=47) retry #10
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=180.0 > threshold=80.0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 300 frames (rms=40, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=19, voice_frames=0
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ”‡ [SILENCE] Max warnings exceeded - initiating polite hangup
prosaas-backend  | ğŸ”’ [BUILD 194] Silence closing - blocking future transcripts
prosaas-backend  | ğŸ”’ [BUILD 194] Blocking _send_text_to_ai - closing already sent
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×—×•×œ×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×•×œ×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×—×•×œ×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×•×œ×•×Ÿ', 'raw_city': '×—×•×œ×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×•×œ×•×Ÿ', 'raw_city': '×—×•×œ×•×Ÿ', 'city_confidence': '100.0'}
prosaas-backend  | âœ… [CITY] Auto-accepted: '×—×•×œ×•×Ÿ' (confidence=100%)
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×—×•×œ×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×•×œ×•×Ÿ', 'raw_city': '×—×•×œ×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×—×•×œ×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×—×•×œ×•×Ÿ
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [BUILD 193] ALLOWED: Transcript 1ms after AI (within 300ms overlap grace)
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED Hebrew: '×ª×•×“×” ×¨×‘×” ×œ×›×'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×ª×•×“×” ×¨×‘×” ×œ×›×' (hebrew=10, english=0)
prosaas-backend  | ğŸ’° [COST] User utterance: 9.23s (185 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×ª×•×“×” ×¨×‘×” ×œ×›×
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×•×œ×•×Ÿ', 'raw_city': '×—×•×œ×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×—×•×œ×•×Ÿ'}
prosaas-backend  | âŒ [CITY] Rejected '×ª×•×“×”' (confidence=47%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×ª×•×“×” ×¨×‘×” ×œ×›×...'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×ª×•×“×” ×¨×‘×” ×œ×›×...'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 5
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['\u202b×ª×•×“×” ×¨×‘×”.', '×ª×•×“×” ×¨×‘×” ×œ×›×']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 4802bc97...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=4802bc97...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×ª×•×“×” ×¨×‘×” ×œ×›×...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×—×•×œ×•×Ÿ, service_type=×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×—×•×œ×•×Ÿ
prosaas-backend  | â³ [BUILD 172] Lead fields collected - waiting for customer confirmation
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 5 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '\u202b×ª×•×“×” ×¨×‘×”.', 'ts': 1764890088.8246474, 'filtered': True}, {'speaker': 'ai', 'text': '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×—×•×œ×•×Ÿ, × ×›×•×Ÿ?', 'ts': 1764890092.1499712}, {'speaker': 'user', 'text': '×ª×•×“×” ×¨×‘×” ×œ×›×', 'ts': 1764890093.765017}]
prosaas-backend  | ğŸ”‡ [SERVER_EVENT] Sent SILENTLY to AI: [SYSTEM] ×¤×¨×˜×™× × ××¡×¤×• ××‘×œ ×”×œ×§×•×— ×¢×“×™×™×Ÿ ×œ× ××™×©×¨! ×—×–×•×¨ ×¢×œ ×”×¤×¨×˜×™× ×•×©××œ '×”×× ×”×¤×¨×˜×™× × ×›×•× ×™×?' - ×”××ª×Ÿ ×œ××™×©×•×¨
prosaas-backend  | ğŸ¯ [SERVER_EVENT] Triggered response.create (lock will be cleared by response.created)
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCpC9pTZ8nxPm1...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCpC9pTZ8nxPm1... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZfaf3b247d4c38ae52adebc1b82dd93d0 rx=478 tx=394
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 2506ms gap between chunks #25 and #26 - OpenAI delay!
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 400 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××– ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×—×•×œ×•×Ÿ, × ×›×•×Ÿ? ×”×× ×”×¤×¨×˜×™× × ×›×•× ×™×?
prosaas-backend  | â„¹ï¸ [BUILD 195] Verification phrase detected but lead NOT captured yet - NOT setting pending_confirmation
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.01s (45 chunks)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… CALL FINALIZED: CA8f10d2fcb2dd87379fe91b64a76e44a3
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×©×™×—×” ×¢× ×œ×§×•×— ×¤×•×˜× ×¦×™××œ×™ ×‘×ª×—×•× ×”× ×“×œ"×Ÿ ×•×ª×™×•×•×š, ×”××¢×•× ×™×™×Ÿ ×‘×©×™×¨×•×ª×™ ×ª×™×•×•×š.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | ×”×œ×§×•×— ×œ× ×¡×™×¤×§ ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™× ×œ×’×‘×™ × ×›×¡, ××–×•×¨, ×ª×§×¦×™×‘ ××• ×“×¨×™×©×•×ª × ×•×¡×¤×•×ª. ×™×© ×¦×•×¨×š ×‘××™×“×¢ × ×•×¡×£ ×›×“×™ ×œ×”×‘×™×Ÿ ××ª ×”×¦×¨×›×™× ×”××“×•×™×§×™× ×©×œ×•.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×”×œ×§×•×— ××• ×××¦×¢×™ ×”×ª×§×©×¨×•×ª ×‘××”×œ×š ×”×©×™×—×”.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - ×œ× × ×§×‘×¢×” ×¤×’×™×©×” ××• ×¤×¢×•×œ×” × ×•×¡×¤×ª ×‘×©×™×—×” ×–×•.
prosaas-backend  | - ×“×—×™×¤×•×ª: × ××•×›×”, ××š ×™×© ×œ×¢×§×•×‘ ××—×¨×™ ×”×œ×§×•×— ×•×œ×‘×§×© ×¤×¨×˜×™× × ×•×¡×¤×™×.
prosaas-backend  | - ×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª: ×œ×™×¦×•×¨ ×§×©×¨ ×¢× ×”×œ×§×•×— ×‘×”××©×š ×›×“×™ ×œ××¡×•×£ ××™×“×¢ × ×•×¡×£ ×¢×œ ×”×¦×¨×›×™× ×©×œ×•.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ××•××œ×¥ ×œ×”×¦×™×¢ ×œ×œ×§×•×— ××¤×©×¨×•×™×•×ª ×©×•× ×•×ª ×‘×ª×—×•× ×”× ×“×œ"×Ÿ, ×›××• × ×›×¡×™× ×œ××›×™×¨×” ××• ×”×©×›×¨×”, ×‘×”×ª×× ×œ××–×•×¨ ×”××¢× ×™×™×Ÿ ××•×ª×•. ×™×© ×œ×”×“×’×™×© ××ª ×”×™×ª×¨×•× ×•×ª ×©×œ ×©×™×¨×•×ª×™ ×”×ª×™×•×•×š ×©×œ ×¤×¨×• ×¡××¡ ×›×“×™ ×œ×©×¤×¨ ××ª ×”×¡×™×›×•×™×™× ×œ×¡×’×™×¨×ª ×¢×¡×§×”.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | ğŸ“ [SMART HANGUP] === CALL ENDING ===
prosaas-backend  | ğŸ“ [SMART HANGUP] Reason: silence_timeout
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead captured: False
prosaas-backend  | ğŸ“ [SMART HANGUP] Goodbye detected: False
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead state: {'city_needs_retry': 'True'}
prosaas-backend  | ğŸ“ [SMART HANGUP] Required fields: ['city', 'service_type']
prosaas-backend  | ğŸ“ [SMART HANGUP] ===================
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ”‡ [SILENCE] Max warnings exceeded - initiating polite hangup
prosaas-backend  | ğŸ”’ [BUILD 194] Silence closing - blocking future transcripts
prosaas-backend  | ğŸ”’ [BUILD 194] Blocking _send_text_to_ai - closing already sent
prosaas-backend  | âœ… [BUILD 163] Call CA284a88... hung up successfully: silence_timeout
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 500 frames (rms=8, reason=noise)
prosaas-backend  |    - call_log.from_number: +972533432757
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972533432757
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CA8f10d2fcb2dd87379fe91b64a76e44a3, phone=+972533432757, city=N/A, direction=inbound
prosaas-backend  | [WEBHOOK] Sending call.completed to http... (attempt 1)
prosaas-backend  | [WEBHOOK] âŒ Request error on attempt 1: Invalid URL 'http': No scheme supplied. Perhaps you meant https://http?
prosaas-backend  | [WEBHOOK] Retrying in 1s...
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972533432757, city=N/A, service=N/A
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×•×œ×•×Ÿ', 'raw_city': '×—×•×œ×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×—×•×œ×•×Ÿ'}
prosaas-backend  | âŒ [CITY] Rejected '×× ×¢×•×œ×Ÿ' (confidence=59%) - ask to repeat
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×× ×¢×•×œ×Ÿ ×‘×—×•×œ×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×•×œ×•×Ÿ', 'raw_city': '×—×•×œ×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×—×•×œ×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×× ×¢×•×œ×Ÿ ×‘×—×•×œ×•×Ÿ
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '××– ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×—×•×œ×•×Ÿ, × ×›×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=47) retry #20
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=229.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=9, voice_frames=0
prosaas-backend  | [WEBHOOK] Sending call.completed to http... (attempt 2)
prosaas-backend  | [WEBHOOK] âŒ Request error on attempt 2: Invalid URL 'http': No scheme supplied. Perhaps you meant https://http?
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 600 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 12.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['preferred_time', 'name']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['preferred_time', 'name'] | Collected: []
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=15, tx_q=19) retry #0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 700 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [WEBHOOK] Sending call.completed to http... (attempt 3)
prosaas-backend  | [WEBHOOK] âŒ Request error on attempt 3: Invalid URL 'http': No scheme supplied. Perhaps you meant https://http?
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=47) retry #30
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 800 frames (rms=15, reason=noise)
prosaas-backend  | âš ï¸ [BUILD 178] Max hangup retries exceeded - forcing hangup
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=20, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=116.0 > threshold=80.0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×—×•×œ×•×Ÿ, service_type=×× ×¢×•×œ×Ÿ ×‘×—×•×œ×•×Ÿ
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1152, voice_frames=0
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=15, tx_q=19) retry #10
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=18, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (1811ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCpMajPZIOktZ1...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCpMajPZIOktZ1... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 9825ms gap between chunks #45 and #46 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=15, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [SILENCE GATE] âŒ REJECTED (RMS=15 < 30, frames=0): 'â€«×ª×•×“×” ×¨×‘×”. â€«-×ª×•×“×” ×¨×‘×”.'
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6936 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×”×‘× ×ª×™, ××– ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×ª×œ ××‘×™×‘, × ×›×•×Ÿ?
prosaas-backend  | â„¹ï¸ [BUILD 195] Verification phrase detected but lead NOT captured yet - NOT setting pending_confirmation
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.94s (60 chunks)
prosaas-backend  | INFO:     127.0.0.1:49712 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 900 frames (rms=10, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”’ [CONSISTENCY] City locked to '×× ×¢×•×œ×Ÿ' (majority 2/3)
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×× ×¢×•×œ×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×× ×¢×•×œ×Ÿ', 'raw_city': '×—×•×œ×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×—×•×œ×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×× ×¢×•×œ×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×× ×¢×•×œ×Ÿ', 'raw_city': '×× ×¢×•×œ×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×—×•×œ×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×× ×¢×•×œ×Ÿ', 'raw_city': '×× ×¢×•×œ×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×—×•×œ×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_autocorrected=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×× ×¢×•×œ×Ÿ', 'raw_city': '×× ×¢×•×œ×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×—×•×œ×•×Ÿ', 'city_autocorrected': 'True'}
prosaas-backend  | ğŸ”’ [CITY] Majority locked: '×× ×¢×•×œ×Ÿ' from ['×©×œ×•×!', '×¢×™×¨', '×—×•×œ×•×Ÿ', '×ª×•×“×”', '×× ×¢×•×œ×Ÿ', '×× ×¢×•×œ×Ÿ']
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×× ×¢×•×œ×Ÿ ×‘×ª×œ ××‘×™×‘
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×× ×¢×•×œ×Ÿ', 'raw_city': '×× ×¢×•×œ×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×ª×œ ××‘×™×‘', 'city_autocorrected': 'True'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×× ×¢×•×œ×Ÿ ×‘×ª×œ ××‘×™×‘
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×”×‘× ×ª×™, ××– ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×ª×œ ...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1000 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 2/2 after 10.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['preferred_time', 'name']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['preferred_time', 'name'] | Collected: []
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=15, tx_q=19) retry #20
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=120.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
prosaas-backend  | âœ… call_log created immediately for CAa519dbe0b588d817f0c2e60fec979d0e
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972533432757, call_sid=CAa519dbe0b588d817f0c2e60fec979d0e
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972533432757, call_sid=CAa519dbe0b588d817f0c2e60fec979d0e
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1266ms - CAa519dbe0b588d8
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAa519dbe0b588d817f0c2e60fec979d0e" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:54148 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:54160 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-dc6e21ee
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764890110.405] WS_START sid=MZ917d39d96e5f9c6e9168c82382af2af1 call_sid=CAa519dbe0b588d817f0c2e60fec979d0e from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAa519db (FRESH SESSION)
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1100 frames (rms=57, reason=noise)
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 460ms (T0+463ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=98, voice_frames=0
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 943ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1047ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAa519dbe0b588d817f0c2e60fec979d0e
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764890111.454] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | 
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1050ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=3.4, threshold=80.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 590ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 1ms (total: 1051ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764890111.458
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1051ms, T0â†’speak=1053ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCpTSJjOOgQc1E...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCpTSJjOOgQc1E... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=6966, voice_frames=0
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Call log already exists for CAa519dbe0b588d817f0c2e60fec979d0e
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Recording started for CAa519dbe0b588d817f0c2e60fec979d0e: RE1a9b29f6073f585811990d3daf01c666
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ“ [PROMPT] Final length: 3575 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=41, lead_id=123, was_created=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6936 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764890112.852 (duration: 1394ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=252.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=53, voice_frames=0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #3 (prevents 5min timeout)
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=70 70 72 72 72, rms=185, consec_frames=4
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=167.0 > threshold=80.0
prosaas-backend  | âœ… Updated call_log with customer_id=41
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=db d5 d3 d5 d6, rms=470, consec_frames=4
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=56 57 59 5b 5c, rms=293, consec_frames=5
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=293, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=29, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (2755ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCpVvh6AVCZ45m...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCpVvh6AVCZ45m... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 7728ms gap between chunks #60 and #61 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | ğŸ”‡ [BUILD 194] âŒ NOISE REJECTED: 20.0s audio â†’ '×›×Ÿ, ×××© ×œ×.' (7 chars) - too short for duration!
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.3s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×× ×¢×•×œ×Ÿ, service_type=×× ×¢×•×œ×Ÿ ×‘×ª×œ ××‘×™×‘
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×”×‘× ×ª×™, ×¡×œ×™×—×”. ××– ×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.29s (73 chunks)
prosaas-backend  | ğŸ”’ [CITY] Already locked to '×× ×¢×•×œ×Ÿ' - ignoring new input
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×”×‘× ×ª×™, ×¡×œ×™×—×”. ××– ×‘××™×–×• ×¢×™×¨ ××ª×”...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=15, tx_q=19) retry #30
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1843ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 2.2s - now updating session
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=1274, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=16, voice_frames=0
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 3575 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | âš ï¸ [BUILD 178] Max hangup retries exceeded - forcing hangup
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=134, reason=insufficient_consec_frames(1/4))
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=1356, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1200 frames (rms=449, reason=insufficient_consec_frames(1/4))
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=43, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=233.0 > threshold=80.0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=271.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=231, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=24, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | â³ [BUILD 195] Speech detected - will confirm after 600ms sustained speech...
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (925ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCpZfB8GrgoNHN...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCpZfB8GrgoNHN... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=fb fb 7e 7b 75
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=47 3f 44 3e 3f
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=ff fa 7e 7a fe
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=8140, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ›¡ï¸ [BUILD 187 GRACE] Ignoring speech_started - only 601ms since response.created (grace=1000ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.24s (5 chunks)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=66, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | âœ… [BUILD 195] SUSTAINED speech (983ms >= 600ms) - valid user input
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCpZm4B6i39bom...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCpZm4B6i39bom... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | INFO:     172.18.0.6:45332 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨' (confidence=54%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=1, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | ğŸ”„ [BUILD 193] Response cancelled (output=1)! Triggering IMMEDIATE recovery...
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [BUILD 193] ALLOWED: Transcript 1ms after AI (within 300ms overlap grace)
prosaas-backend  | âš ï¸ [BUILD 194] Allowing borderline: 4.0s â†’ 'â€«×ª×•×“×”.' (4 chars)
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED (has Hebrew): 'â€«×ª×•×“×”.'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: 'â€«×ª×•×“×”.' (hebrew=4, english=0)
prosaas-backend  | ğŸ’° [COST] User utterance: 3.95s (127 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: â€«×ª×•×“×”.
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ›¡ï¸ [BUILD 187 GRACE] Ignoring speech_started - only 698ms since response.created (grace=1000ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•
prosaas-backend  | ğŸ”’ [CITY] Already locked to '×× ×¢×•×œ×Ÿ' - ignoring new input
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=1, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | ğŸ”„ [BUILD 193] Response cancelled (output=1)! Triggering IMMEDIATE recovery...
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [BUILD 193] ALLOWED: Transcript 48ms after AI (within 300ms overlap grace)
prosaas-backend  | ğŸ”‡ [BUILD 194] âŒ NOISE REJECTED: 24.5s audio â†’ '×ª×•×“×”.' (4 chars) - too short for duration!
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected 'â€«×ª×•×“×”.' (confidence=48%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: 'â€«×ª×•×“×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: 'â€«×ª×•×“×”....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 3
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['\u202b×ª×•×“×”.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: acd5631c...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=acd5631c...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: 'â€«×ª×•×“×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | 
prosaas-backend  | ğŸ” [NLP] Conversation history has 3 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?', 'ts': 1764890112.8523915}, {'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764890117.918618}, {'speaker': 'user', 'text': '\u202b×ª×•×“×”.', 'ts': 1764890118.6464093}]
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=794, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=16, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=160.0 > threshold=80.0
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['preferred_time', 'name']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['preferred_time', 'name'] | Collected: []
prosaas-backend  | ğŸ”‡ [SILENCE] Max warnings exceeded - initiating polite hangup
prosaas-backend  | ğŸ”’ [BUILD 194] Silence closing - blocking future transcripts
prosaas-backend  | ğŸ”’ [BUILD 194] Blocking _send_text_to_ai - closing already sent
prosaas-backend  | ğŸ”„ [BUILD 192] RECOVERY: Triggering response.create NOW!
prosaas-backend  | âœ… [BUILD 192] RECOVERY SUCCESS: response.create sent!
prosaas-backend  | ğŸ”„ [BUILD 192] RECOVERY: Triggering response.create NOW!
prosaas-backend  | âœ… [BUILD 192] RECOVERY SUCCESS: response.create sent!
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=157.0 > threshold=80.0
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCpbkRkne6OxYj...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCpbkRkne6OxYj... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCpbe1W6nlIYH4...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCpbe1W6nlIYH4... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1300 frames (rms=16, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=265, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=115, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 5597ms gap between chunks #73 and #74 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 2318ms gap between chunks #5 and #6 - OpenAI delay!
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=256, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ, × ×›×•×Ÿ?
prosaas-backend  | â„¹ï¸ [BUILD 195] Verification phrase detected but lead NOT captured yet - NOT setting pending_confirmation
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.68s (17 chunks)
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=1838, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ, × ×›×•×Ÿ?
prosaas-backend  | â„¹ï¸ [BUILD 195] Verification phrase detected but lead NOT captured yet - NOT setting pending_confirmation
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.97s (89 chunks)
prosaas-backend  | ğŸ”’ [CITY] Already locked to '×× ×¢×•×œ×Ÿ' - ignoring new input
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×× ×¢×•×œ×Ÿ', 'raw_city': '×× ×¢×•×œ×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_autocorrected': 'True'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨×...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 200 frames (rms=31, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=48, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=441.0 > threshold=80.0
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=48) retry #0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=272.0 > threshold=80.0
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'raw_city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'raw_city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_confidence': '100.0'}
prosaas-backend  | âœ… [CITY] Auto-accepted: '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ' (confidence=100%)
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'raw_city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=1, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | ğŸ”„ [BUILD 193] Response cancelled (output=1)! Triggering IMMEDIATE recovery...
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCpcryd1vm953n...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCpcryd1vm953n... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ›¡ï¸ [BUILD 187 GRACE] Ignoring speech_started - only 0ms since response.created (grace=1000ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=0, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  | ğŸ”„ [BUILD 193] Response cancelled (output=0)! Triggering IMMEDIATE recovery...
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [BUILD 193] ALLOWED: Transcript 1ms after AI (within 300ms overlap grace)
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED Hebrew: '×ª××™×“ ×¤×”'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×ª××™×“ ×¤×”' (hebrew=6, english=0)
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (4090ms)
prosaas-backend  | ğŸ’° [COST] User utterance: 4.02s (205 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×ª××™×“ ×¤×”
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1400 frames (rms=8, reason=noise)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'raw_city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ'}
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âŒ [CITY] Rejected '×™×“ ×¤×”' (confidence=50%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×ª××™×“ ×¤×”...'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×ª××™×“ ×¤×”...'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 5
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['\u202b×ª×•×“×”.', '×ª××™×“ ×¤×”']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: f9e3ec57...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (acd5631c â†’ f9e3ec57) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=f9e3ec57...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×ª××™×“ ×¤×”...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ, service_type=×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | â³ [BUILD 172] Lead fields collected - waiting for customer confirmation
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 5 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '\u202b×ª×•×“×”.', 'ts': 1764890118.6464093}, {'speaker': 'ai', 'text': '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ, × ×›×•×Ÿ?', 'ts': 1764890120.8531075}, {'speaker': 'user', 'text': '×ª××™×“ ×¤×”', 'ts': 1764890122.7354147}]
prosaas-backend  | ğŸ”‡ [SERVER_EVENT] Sent SILENTLY to AI: [SYSTEM] ×¤×¨×˜×™× × ××¡×¤×• ××‘×œ ×”×œ×§×•×— ×¢×“×™×™×Ÿ ×œ× ××™×©×¨! ×—×–×•×¨ ×¢×œ ×”×¤×¨×˜×™× ×•×©××œ '×”×× ×”×¤×¨×˜×™× × ×›×•× ×™×?' - ×”××ª×Ÿ ×œ××™×©×•×¨
prosaas-backend  | â¸ï¸ [SERVER_EVENT] Skipping response.create - active: resp_CjCpcryd1vm953nYoEGKE, pending: False
prosaas-backend  | WS_STOP sid=MZ28ff6fbfd2b59a30019a7d72d74c09a0 rx=2137 tx=1408
prosaas-backend  | ğŸ“ [SES-3bfe037c] CALL ENDED - duration=42.7s, business_id=10, rx=2137, tx=1408
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CAeece782c4afe1e4372930bf12913abf7 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:41062 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | âœ… Found existing recording for CAeece782c4afe1e4372930bf12913abf7: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REb6702104b15d7fec1b737ad0610e30cb.json
prosaas-backend  | INFO:     172.18.0.6:41064 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CAeece782c4afe1e4372930bf12913abf7
prosaas-backend  | ğŸ”„ [BUILD 192] RECOVERY: Triggering response.create NOW!
prosaas-backend  | âœ… [BUILD 192] RECOVERY SUCCESS: response.create sent!
prosaas-backend  | ğŸ”„ [BUILD 192] RECOVERY: Triggering response.create NOW!
prosaas-backend  | âœ… [BUILD 192] RECOVERY SUCCESS: response.create sent!
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=31, voice_frames=0
prosaas-backend  | âŒ [REALTIME] ERROR: {'type': 'invalid_request_error', 'code': 'conversation_already_has_active_response', 'message': 'Conversation already has an active response in progress: resp_CjCpfewYgpto332wPDqhd. Wait until the response is finished before creating a new one.', 'param': None, 'event_id': None}
prosaas-backend  | [REALTIME] event: error
prosaas-backend  | âŒ [REALTIME] Error event: Conversation already has an active response in progress: resp_CjCpfewYgpto332wPDqhd. Wait until the response is finished before creating a new one.
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCpfewYgpto332...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCpfewYgpto332... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | INFO:     connection closed
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 3515ms gap between chunks #17 and #18 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 300 frames (rms=77, reason=noise)
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ, × ×›×•×Ÿ?
prosaas-backend  | â„¹ï¸ [BUILD 195] Verification phrase detected but lead NOT captured yet - NOT setting pending_confirmation
prosaas-backend  | âš ï¸ [LOOP DETECT] AI repeating! Similarity=100% with: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ, × ×›×•×Ÿ...'
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.97s (35 chunks)
prosaas-backend  | WS_STOP sid=MZ917d39d96e5f9c6e9168c82382af2af1 rx=764 tx=474
prosaas-backend  | ğŸ“ [SES-dc6e21ee] CALL ENDED - duration=15.3s, business_id=10, rx=764, tx=475
prosaas-backend  | STREAM_ENDED call=CAa519dbe0b588d817f0c2e60fec979d0e stream=N/A status=N/A
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | INFO:     172.18.0.6:41066 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CAa519dbe0b588d817f0c2e60fec979d0e: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE1a9b29f6073f585811990d3daf01c666.json
prosaas-backend  | INFO:     172.18.0.6:41072 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CAa519dbe0b588d817f0c2e60fec979d0e
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 5.3s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | âœ… [SMART HANGUP] All required fields collected: city=×× ×¢×•×œ×Ÿ, service_type=×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | INFO:     connection closed
prosaas-backend  | ğŸ”’ [CONSISTENCY] City locked to '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ' (majority 2/3)
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'raw_city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'raw_city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'raw_city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_autocorrected=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'raw_city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_autocorrected': 'True'}
prosaas-backend  | ğŸ”’ [CITY] Majority locked: '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ' from ['×©×œ×•×!', '×¢×™×¨', '\u202b×ª×•×“×”.', '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', '×™×“ ×¤×”', '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ']
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'raw_city': '×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_confidence': '100.0', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ', 'city_autocorrected': 'True'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=48) retry #10
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ28ff6fbfd2b59a30019a7d72d74c09a0 rx=2137 tx=1408
prosaas-backend  | âœ… CALL FINALIZED: CAeece782c4afe1e4372930bf12913abf7
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×
prosaas-backend  | ×”×¤× ×™×™×” ×”×™× ×‘×ª×—×•× ×©×™×¨×•×ª×™ ×”×× ×¢×•×œ× ×•×ª. ×”×œ×§×•×— ××—×¤×© ×× ×¢×•×œ×Ÿ ×‘××–×•×¨ ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×
prosaas-backend  | - **×©×™×¨×•×ª**: ×× ×¢×•×œ×Ÿ
prosaas-backend  | - **××–×•×¨**: ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—
prosaas-backend  | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×§×©×¨ ××“×•×™×§×™× ×‘××”×œ×š ×”×©×™×—×”.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘
prosaas-backend  | - **×¡×˜×˜×•×¡**: ×”×œ×§×•×— ×¢×“×™×™×Ÿ ×œ× ×§×™×‘×œ ××™×©×•×¨ ×¢×œ ×”××™×§×•× ×”××“×•×™×§ ×©×œ ×”×©×™×¨×•×ª. ×™×© ×¦×•×¨×š ×œ×•×•×“× ××ª ×”××™×“×¢.
prosaas-backend  | - **×“×—×™×¤×•×ª**: ×œ× ×¦×•×™× ×” ×“×—×™×¤×•×ª, ××š ×™×© ×œ×”× ×™×— ×©×”×©×™×¨×•×ª × ×“×¨×© ×‘×”×§×“×.
prosaas-backend  | - **×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª**: ×™×© ×œ×™×¦×•×¨ ×§×©×¨ ×¢× ×”×œ×§×•×— ×©×•×‘ ×›×“×™ ×œ×××ª ××ª ×”××™×§×•× ×”××“×•×™×§ ×•×œ×¡×¤×§ ××ª ×”×©×™×¨×•×ª ×”× ×“×¨×©.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª
prosaas-backend  | ×”×©×™×—×” ×›×œ×œ×” ×‘×œ×‘×•×œ ×‘××™×§×•×, ×™×© ×œ×”×§×¤×™×“ ×¢×œ ×‘×”×™×¨×•×ª ×‘×©×™×—×•×ª ×¢×ª×™×“×™×•×ª ×›×“×™ ×œ×× ×•×¢ ××™ ×”×‘× ×•×ª. ××•××œ×¥ ×œ×•×•×“× ××ª ×¤×¨×˜×™ ×”×œ×§×•×— ×œ×¤× ×™ ×¡×™×•× ×”×©×™×—×”.
prosaas-backend  | ğŸ¯ Intent: information_request
prosaas-backend  | ğŸ“Š Next Action: ××ª×Ÿ ××™×“×¢ ××¤×•×¨×˜
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.custom