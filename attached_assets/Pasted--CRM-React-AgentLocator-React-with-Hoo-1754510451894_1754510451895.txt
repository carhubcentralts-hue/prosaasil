## 🎯 אפיון מלא למערכת CRM מתקדמת ב־React – AgentLocator

### 🧩 מבנה כללי:

* מבוסס React (with Hooks)
* RTL מלא
* Tailwind + ShadCN UI + Lucide Icons
* CRUD מלא (צפייה, הוספה, עריכה, מחיקה)
* דשבורד, לידים, חוזים, חשבוניות, חתימות, תיעוד, וואטסאפ, משימות
* **כל רכיב פועל לפי הרשאות עסק + תפקיד משתמש**

---

## ✅ רכיבים עיקריים במערכת CRM:

### 1. לקוחות (Customers)

* טבלה עם שם, טלפון, אימייל, סטטוס, מקור, פעולות
* חיפוש / סינון לפי טקסט, תווית או סטטוס
* כפתור "הוסף לקוח"
* כפתור שליחת WhatsApp
* גישה להיסטוריית שיחות / לוג CRM אישי
* **גישה מותנית לפי business.crm\_enabled = true**

### 2. דף לקוח מתקדם (Advanced Customer View)

* מוצג בלחיצה על לקוח בטבלה
* מכיל כרטיס מידע כללי:

  * שם מלא
  * טלפון
  * אימייל
  * סטטוס לקוח
  * מקור הגעה
  * תגיות
  * תאריך יצירה / עדכון
* כפתור עליון: "שוחח עם הלקוח ב-WhatsApp"

  * שולח ישירות דרך API WhatsApp
  * מציג הודעה אוטומטית או שדה בחירה
* טאבים:

```tsx
<CRMCustomerDetails>
  <Tabs defaultValue="overview">
    <TabsList>
      <TabsTrigger value="overview">סקירה</TabsTrigger>
      <TabsTrigger value="contracts">חוזים</TabsTrigger>
      <TabsTrigger value="invoices">חשבוניות</TabsTrigger>
      <TabsTrigger value="signatures">חתימות</TabsTrigger>
      <TabsTrigger value="tasks">משימות</TabsTrigger>
      <TabsTrigger value="notes">תיעוד</TabsTrigger>
      <TabsTrigger value="whatsapp">שיחות WhatsApp</TabsTrigger>
      <TabsTrigger value="calls">שיחות מוקלטות</TabsTrigger>
    </TabsList>
    <TabsContent value="overview">...</TabsContent>
    <TabsContent value="contracts">...</TabsContent>
    <TabsContent value="invoices">...</TabsContent>
    <TabsContent value="signatures">...</TabsContent>
    <TabsContent value="tasks">...</TabsContent>
    <TabsContent value="notes">...</TabsContent>
    <TabsContent value="whatsapp">...</TabsContent>
    <TabsContent value="calls">...</TabsContent>
  </Tabs>
</CRMCustomerDetails>
```

---

## 📄 חוזים (Contracts)

* טבלה עם שם חוזה, סטטוס, תאריך חתימה
* כפתור צפייה / הורדה / שליחה ללקוח
* אינטגרציה עם חתימה דיגיטלית
* **גישה מותנית לפי business.signature\_enabled = true**

## 🧾 חשבוניות (Invoices)

* טבלת חשבוניות לפי לקוח
* סטטוס: שולם / ממתין / שגוי
* כפתור צפייה / יצירת חשבונית חדשה
* אפשרות שליחה במייל / WhatsApp
* **גישה מותנית לפי business.invoice\_enabled = true**

## ✍️ חתימות דיגיטליות

* תצוגת חתימות לפי סטטוס (נחתם, ממתין, פג תוקף)
* הצגת תצוגה מקדימה של קובץ PDF
* שליחה חוזרת + קישור חתימה

## 🧠 תיעוד פנימי

* רשימת פעולות ותגובות ידניות (כמו יומן CRM)
* כל פעולה מתווספת לפי תאריך ויוזם
* ניתן לערוך / למחוק / לתייג

## 📌 משימות

* מערכת משימות לפי לקוח
* קטגוריה (מכירות / תמיכה / גבייה)
* סטטוס (פתוחה / בטיפול / הושלמה)
* כפתור הוספת משימה / סימון כהושלמה

## 💬 WhatsApp

* תצוגת שיחה מלאה (הודעות נכנסות + יוצאות)
* שליחת הודעה מתוך דף הלקוח
* הצגת סטטוס (נמסר / נקרא)
* **גישה רק אם business.whatsapp\_enabled = true**
* ❗ כל שליחה צריכה לכלול: מזהה עסק, מזהה לקוח, תוכן הודעה
* ❗ אפשרות לבחור טמפלט או להקליד ידנית

## 📞 שיחות AI מוקלטות

* הצגת שיחות לפי call\_sid
* סיכום שיחה + תמלול + תוצאה מ־GPT
* האזנה להקלטה מתוך דף הלקוח
* **גישה רק אם business.calls\_enabled = true**

---

## 📊 Sidebar CRM

* לידים חדשים
* לקוחות פעילים
* סטטיסטיקת חוזים / חשבוניות / תשלומים
* חתימות שלא נחתמו
* וואטסאפ פתוח
* משימות פתוחות

---

## 🛡️ הרשאות + חיבורים בין רכיבים

* כל רכיב מופעל רק אם יש הרשאה ספציפית בעסק
* כל תפקיד מקבל הרשאות שונות:

  * admin: הכל פתוח + מחיקה + גישה לכל העסק
  * business: רק מה שמוגדר בעסק
  * user: קריאה בלבד / משימות בלבד
* קישור בין רכיבים:

  * מדף לקוח אפשר לעבור ל־WhatsApp, חתימות, שיחות מוקלטות, תיעוד ועוד
  * כל מעבר בין רכיבים מתבצע מתוך `<Tabs />` או כפתורי פעולה בתוך `<CustomerDetails />`
  * כל פעולה (כמו "צור חשבונית") יכולה להתבצע גם מתוך Tabs וגם מתוך Action Bar קבוע בדף

---

## 🧪 בדיקות חובה:

* כל כפתור מוביל לרכיב הנכון
* כל API מחזיר נתונים בפועל
* תיעוד לקוח שומר את הנתונים
* סטטוסים מתעדכנים (חתימות, תשלומים וכו׳)
* רק משתמשים עם הרשאות רואים את הרכיבים הרלוונטיים
* כפתור WhatsApp באמת יוצר שיחה בפועל ומדווח הצלחה או שגיאה

---

### ✅ רק כשכל אלה עובדים בפועל – המערכת CRM נחשבת מוכנה ללקוחות
