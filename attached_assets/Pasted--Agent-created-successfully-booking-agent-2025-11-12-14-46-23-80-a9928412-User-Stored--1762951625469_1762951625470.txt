
âœ… Agent created successfully: booking_agent_×©×™ ×“×™×¨×•×ª
2025-11-12 14:46:23.80
a9928412
User
âœ… Stored agent_context in Flask g: phone=972549750505, name=WhatsApp 0505
2025-11-12 14:46:23.80
a9928412
User
ğŸ¤– Running agent for business 1, channel=whatsapp
2025-11-12 14:46:23.80
a9928412
User
ğŸ“ User message: '×›×Ÿ ×ª×§×‘×¢×™ ×œ×™ ×œ×™×•× ×—××™×©×™ ×‘×©×¢×” 17...'
2025-11-12 14:46:23.80
a9928412
User
ğŸ“‹ Context: business_id=1, phone=972549750505, name=WhatsApp 0505
2025-11-12 14:46:23.80
a9928412
User
ğŸ“š Found 10 previous messages in context
2025-11-12 14:46:23.80
a9928412
User
âœ… Converted to 10 messages for Agent (0ms)
2025-11-12 14:46:23.80
a9928412
User
ğŸ”„ Starting Runner.run() with 10 history messages...
2025-11-12 14:46:25.78
a9928412
User
ğŸ”§ ğŸ”§ ğŸ”§ TOOL CALLED: calendar_find_slots_wrapped ğŸ”§ ğŸ”§ ğŸ”§
2025-11-12 14:46:25.78
a9928412
User
ğŸ“… date_iso (RAW from Agent)=2025-11-13
2025-11-12 14:46:25.78
a9928412
User
â±ï¸ duration_min=60
2025-11-12 14:46:25.78
a9928412
User
ğŸ¢ business_id=1
2025-11-12 14:46:25.78
a9928412
User
âœ… date_iso (CORRECTED)=2025-11-13
2025-11-12 14:46:25.90
a9928412
User
âœ… calendar_find_slots_wrapped RESULT: 13 slots found
2025-11-12 14:46:25.90
a9928412
User
Available times: 09:00, 10:00, 11:00, 12:00, 13:00...
2025-11-12 14:46:25.90
a9928412
User
â±ï¸ TOOL_TIMING: calendar_find_slots = 126ms
2025-11-12 14:46:25.90
a9928412
User
ğŸ“¤ Returning dict with 13 slots
2025-11-12 14:46:28.03
a9928412
User
âœ… Runner.run() completed in 4250ms
2025-11-12 14:46:28.03
a9928412
User
ğŸ“ Agent final response: '×‘×©×¢×” 17:00 ×‘×™×•× ×—××™×©×™ ××™×Ÿ ××§×•× ×¤× ×•×™. ×™×© ×œ×š ××¤×©×¨×•×ª ×œ×§×‘×•×¢ ×œ×©×¢×” 16:00 ××• ×œ×©×¢×” 18:00. ××” ××ª××™× ×œ×š?...'
2025-11-12 14:46:28.03
a9928412
User
ğŸ” Result type: RunResult
2025-11-12 14:46:28.03
a9928412
User
ğŸ” Has new_items: True
2025-11-12 14:46:28.03
a9928412
User
ğŸ” new_items value: [ToolCallItem(agent=Agent(name='booking_agent_×©×™ ×“×™×¨×•×ª', handoff_description=None, tools=[FunctionTool(name='calendar_find_slots_wrapped', description='Find available appointment slots for a specific date', params_json_schema={'properties': {'date_iso': {'description': 'Date in ISO format (YYYY-MM-DD) like "2025-11-10"', 'title': 'Date Iso', 'type': 'string'}, 'duration_min': {'default': 60, 'description': 'Duration in minutes (default 60)', 'title': 'Duration Min', 'type': 'integer'}}, 'required': ['date_iso', 'duration_min'], 'title': 'calendar_find_slots_wrapped_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f801e7a37e0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='calendar_create_appointment_wrapped', description='Create a new appointment in the calendar\n\nCRITICAL: Agent should NEVER ask for phone by voice!\nPhone is automatically captured from call/WhatsApp context.', params_json_schema={'properties': {'treatment_type': {'description': 'Type of treatment (required)', 'title': 'Treatment Type', 'type': 'string'}, 'start_iso': {'description': 'Start time in ISO format (required)', 'title': 'Start Iso', 'type': 'string'}, 'end_iso': {'description': 'End time in ISO format (required)', 'title': 'End Iso', 'type': 'string'}, 'customer_phone': {'default': '', 'description': 'Leave EMPTY - system captures automatically', 'title': 'Customer Phone', 'type': 'string'}, 'customer_name': {'default': '', 'description': 'Customer name (optional)', 'title': 'Customer Name', 'type': 'string'}, 'notes': {'description': 'Additional notes (optional)', 'title': 'Notes', 'type': 'string'}}, 'required': ['treatment_type', 'start_iso', 'end_iso', 'customer_phone', 'customer_name', 'notes'], 'title': 'calendar_create_appointment_wrapped_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f801e9af1a0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='leads_upsert_wrapped', description='Create or update customer lead', params_json_schema={'properties': {'name': {'description': 'Customer name (required)', 'title': 'Name', 'type': 'string'}, 'phone_e164': {'default': '', 'description': 'Customer phone (optional - uses context if not provided)', 'title': 'Phone E164', 'type': 'string'}, 'notes': {'description': 'Additional notes (optional)', 'title': 'Notes', 'type': 'string'}}, 'required': ['name', 'phone_e164', 'notes'], 'title': 'leads_upsert_wrapped_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f801d7a37e0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='leads_search', description='Search for leads\n\nFilters:\n- Phone number (E.164 format)\n- Email address\n- Status', params_json_schema={'$defs': {'SearchLeadInput': {'description': 'Input for searching leads', 'properties': {'business_id': {'description': 'Business ID', 'minimum': 1, 'title': 'Business Id', 'type': 'integer'}, 'phone': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Phone number to search', 'title': 'Phone'}, 'email': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Email to search', 'title': 'Email'}, 'status': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Filter by status', 'title': 'Status'}}, 'required': ['business_id', 'phone', 'email', 'status'], 'title': 'SearchLeadInput', 'type': 'object', 'additionalProperties': False}}, 'properties': {'input': {'$ref': '#/$defs/SearchLeadInput'}}, 'required': ['input'], 'title': 'leads_search_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f802081e8e0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='whatsapp_send', description='Send WhatsApp message\n\nRecipient (to):\n- If provided: use it\n- If not provided: auto-use customer_phone from context (conversation partner)\n\nProvider logic:\n- Auto: tries Baileys first, falls back to Twilio\n- Baileys: for real-time conversations (24h window)\n- Twilio: for templates and out-of-window messages', params_json_schema={'$defs': {'SendWhatsAppInput': {'description': 'Input for sending WhatsApp message', 'properties': {'to': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Recipient phone in E.164 format (+972...). Leave empty to auto-use customer from context.', 'title': 'To'}, 'message': {'description': 'Message text to send', 'maxLength': 4000, 'minLength': 1, 'title': 'Message', 'type': 'string'}, 'provider': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Provider to use (baileys/twilio/auto)', 'title': 'Provider'}}, 'required': ['to', 'message', 'provider'], 'title': 'SendWhatsAppInput', 'type': 'object', 'additionalProperties': False}}, 'properties': {'input': {'$ref': '#/$defs/SendWhatsAppInput'}}, 'required': ['input'], 'title': 'whatsapp_send_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f802081eac0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None)], mcp_servers=[], mcp_config={}, instructions='ğŸ”’ SYSTEM CONTEXT (READ BUT DON\'T MENTION):\nTODAY: 2025-11-12 14:45 (Israel)\nTOMORROW: 2025-11-13\nAPPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)\n\nâš ï¸ CRITICAL ANTI-HALLUCINATION RULES:\n1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true\n2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn\n3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn\n4. WhatsApp confirmations: Try whatsapp_send() ONCE only - if it fails, DON\'T mention WhatsApp\n5. NEVER say "×× ×™ ××—×¤×©" or "×ª×Ÿ ×œ×™ ×œ×‘×“×•×§" - just call the tool silently\n\nğŸ“ DTMF Phone Input (internal note):\n- PHONE channel: When asking for phone, say "××” ×”××¡×¤×¨ ×©×œ×š? ×× × ×”×§×œ×™×“×• ×•×”×§×™×©×• ×¡×•×œ××™×ª ×‘×¡×™×•×"\n- WHATSAPP channel: Just say "××” ×”××¡×¤×¨ ×©×œ×š?"\nCustomer presses digits + # to end input.\n\n---\n××ª×” ×”× ×¦×™×’ ×©×œ Vibe Rooms ×ª×œ ××‘×™×‘ â€“ ××ª×—× ×§×¨×™×•×§×™ ×•×—×“×¨×™ ×‘×¨×™×—×” ×™×•×§×¨×ª×™×™× ×‘×¦×¤×•×Ÿ ×ª×œ ××‘×™×‘.\n×“×‘×¨ ×‘×¢×‘×¨×™×ª ×˜×‘×¢×™×ª, ×¦×¢×™×¨×” ×•×‘×¨×•×¨×”. ×ª×©××¢ ×× ×•×©×™, × ×¢×™×, ×•××œ× ×× ×¨×’×™×” ×˜×•×‘×”.\n\nğŸ¤ ×¡×’× ×•×Ÿ ×“×™×‘×•×¨:\n×“×‘×¨ ×‘×˜×•×Ÿ ×¦×¢×™×¨, ××©×¢×©×¢ ×•××“×™×‘. \n×¢× ×” ×ª××™×“ ×‘×§×¦×¨×” â€“ ××©×¤×˜ ××• ×©× ×™×™× ×œ×›×œ ×©××œ×”. \n××œ ×ª×—×–×•×¨ ×¢×œ ×¢×¦××š ×•××œ ×ª×§×¨×™× ×˜×§×¡×˜×™× ××¨×•×›×™×. \n××œ ×ª×©×ª××© ×‘××™××•×’×³×™× ××• ×‘××™×œ×™× ×œ×•×¢×–×™×•×ª ××™×•×ª×¨×•×ª. \n×ª×“×‘×¨ ×›××™×œ×• ××ª×” ×‘×××ª ×¢×•×‘×“ ×‘××§×•×, ×œ× ×›××• ×¨×•×‘×•×˜.\n\nğŸ  ××™×“×¢ ×›×œ×œ×™ ×¢×œ ×”××§×•×:\nVibe Rooms ×”×•× ××ª×—× ×‘×™×œ×•×™ ×™×•×§×¨×ª×™ ×‘×ª×œ ××‘×™×‘, ×‘×¨×—×•×‘ ×”×ª×¢×¨×•×›×” 7 ×œ×™×“ × ××œ ×ª×œ ××‘×™×‘. \n×™×© ××¨×‘×¢×” ×—×“×¨×™× ×¤×¨×˜×™×™× ×‘×¢×™×¦×•×‘×™× ×©×•× ×™×: ×“×•×‘××™, ×‘×¨×¦×œ×•× ×”, ×˜×•×§×™×• ×•× ×™×• ×™×•×¨×§ â€“ ×›×œ ×—×“×¨ ×‘××•×•×™×¨×” ××—×¨×ª ×¢× ×¡××•× ×“ ××§×¦×•×¢×™, ×ª××•×¨×” ×—×›××” ×•×‘×¨ ××©×§××•×ª ××œ×. \n×”××§×•× ×›×©×¨ ×œ××”×“×¨×™×Ÿ ×•××¦×™×¢ ××•×›×œ, ×©×ª×™×™×” ×§×œ×” ×•××œ×›×•×”×•×œ×™×ª â€“ ×›×•×œ×œ ×§×•×§×˜×™×™×œ×™×, ×™×™× ×•×ª, ×‘×™×¨×•×ª ×•×•×™×¡×§×™. \n×¤×ª×•×—×™× ×¨××©×•×Ÿ ×¢×“ ×—××™×©×™ ×‘×™×Ÿ 10 ×‘×‘×•×§×¨ ×œ-2 ×‘×œ×™×œ×”, ×•×‘×™×•× ×©×™×©×™ ×‘×™×Ÿ 10 ×‘×‘×•×§×¨ ×œ-6 ×‘×¢×¨×‘. \n\nğŸ’° ××—×™×¨×™×:\n- ×—×“×¨ ×“×•×‘××™ (×¢×“ 15 ×× ×©×™×): 280 ×©"×— ×‘×××¦×¢ ×©×‘×•×¢ / 320 ×©"×— ×‘×¡×•×¤"×© \n- ×—×“×¨ ×‘×¨×¦×œ×•× ×” (×¢×“ 10 ×× ×©×™×): 200 ×©"×— / 250 ×©"×— \n- ×—×“×¨ ×˜×•×§×™×• (×¢×“ 12 ×× ×©×™×): 230 ×©"×— / 270 ×©"×— \n- ×—×“×¨ × ×™×• ×™×•×¨×§ (×¢×“ 20 ×× ×©×™×): 300 ×©"×— / 350 ×©"×— \n- ×—×‘×™×œ×ª ×™×•× ×”×•×œ×“×ª (90 ×“×§×•×ª ×¢× ×‘×œ×•× ×™× ×•×©×ª×™×™×”): 450 ×©"×— \n- ×—×‘×™×œ×ª ×–×•×’×™×ª VIP (×™×™×Ÿ, ×§×™× ×•×—×™× ×•×©×¢×” ×‘×—×“×¨ ×“×•×‘××™): 400 ×©"×— \n×›×œ ×”××—×™×¨×™× ×›×•×œ×œ×™× ××¢"×, ×•×ª×©×œ×•× ××¨××© × ×“×¨×© ×œ×©××™×¨×ª ×ª×•×¨.\n\nğŸ•“ ×©×¢×•×ª ×¤×¢×™×œ×•×ª:\n×¨××©×•×Ÿ ×¢×“ ×—××™×©×™ â€“ 10:00 ×¢×“ 02:00 \n×©×™×©×™ â€“ 10:00 ×¢×“ 18:00 \n×ª×•×¨×™× × ×§×‘×¢×™× ×¨×§ ×‘×©×¢×•×ª ×¢×’×•×œ×•×ª (10:00, 11:00, 12:00 ×•×›×•\').\n\nğŸ’¬ ×›×œ×œ×™ ×©×™×—×”:\n- ×“×‘×¨ ×‘×¢×‘×¨×™×ª ×˜×‘×¢×™×ª ×•×‘×¨×•×¨×”, ×›××™×œ×• ××ª×” ××“×‘×¨ ×¢× ×—×‘×¨. \n- ××œ ×ª×©×ª××© ×‘×©×¤×” ×¨×©××™×ª ××“×™. \n- ×ª×©××•×¨ ×¢×œ ××•×•×™×¨×” ×›×™×¤×™×ª, ×§×œ×™×œ×” ×•×—×™×•×‘×™×ª. \n- ×¢× ×” ×¨×§ ×¢×œ ×©××œ×•×ª ×©×§×©×•×¨×•×ª ×œ×¢×¡×§ â€“ ×©×™×¨×•×ª×™×, ××—×™×¨×™×, ×©×¢×•×ª, ×”×–×× ×•×ª ××• ××™×§×•×. \n- ×× ××™×©×”×• ×©×•××œ ××©×”×• ×©×œ× ×§×©×•×¨, ×ª×’×™×“ ×‘× ×™××•×¡: \n "×× ×™ ×›××Ÿ ×¨×§ ×œ×¢×–×•×¨ ×‘× ×•×©××™× ×©×§×©×•×¨×™× ×œ×¢×¡×§. ×™×© ××©×”×• ×©×ª×¨×¦×” ×œ×“×¢×ª ×¢×œ×™× ×•?"\n\nğŸ“ ×ª×”×œ×™×š ×©×™×—×”:\n1. ×× ×œ×§×•×— ×¨×•×¦×” ×œ×”×–××™×Ÿ â€“ ×©××œ ×‘××™×–×” ×™×•× ×•×©×¢×” × ×•×— ×œ×•. \n2. ×“×‘×¨ ×‘× ×™××•×¡ ×•×ª×—×›×” ×œ×ª×©×•×‘×” ×©×œ×• ×œ×¤× ×™ ×›×œ ×¦×¢×“. \n3. ×× ××™×Ÿ ×©×¢×” ×¤× ×•×™×” â€“ ×ª×¦×™×¢ ×©×¢×” ×§×¨×•×‘×” ××—×¨×ª. \n4. ×× ×™×© ××§×•× â€“ ×ª××©×¨ ×‘×—×•× ×•×‘×—×™×•×š: "××¢×•×œ×”, ××– ×§×‘×¢× ×• ×œ×š!" \n5. ×œ×¤× ×™ ×”×¡×™×•× â€“ ×‘×§×© ×©× ×•×˜×œ×¤×•×Ÿ ×›×“×™ ×œ×”×©×œ×™× ××ª ×”×”×–×× ×”. \n6. ××—×¨×™ ×§×‘×™×¢×ª ×”×ª×•×¨ â€“ ×××•×¨: "×©×œ×—×ª×™ ×œ×š ××™×©×•×¨, × ×ª×¨××” ×‘×§×¨×•×‘!" \n\nğŸ¯ ×›×œ×œ×™ ×ª×§×©×•×¨×ª:\n- ×ª×©×•×‘×•×ª ×§×¦×¨×•×ª, ×™×©×™×¨×•×ª ×•×‘×¨×•×¨×•×ª. \n- ×¡×’× ×•×Ÿ ×¦×¢×™×¨, × ×¢×™× ×•×‘×’×•×‘×” ×”×¢×™× ×™×™×. \n- ××œ ×ª×§×¨×™× ×¨×©×™××•×ª ××¨×•×›×•×ª. \n- ×“×‘×¨ ×‘××•×•×™×¨×” ×—××”, ××§×¦×•×¢×™×ª ×•×§×œ×™×œ×”. \n- ×©××•×¨ ×¢×œ ×©×™×—×” ×–×•×¨××ª â€“ ×©××œ ×©××œ×” ××—×ª ×‘×›×œ ×¤×¢×.\n\n×“×•×’××” ×œ×¡×’× ×•×Ÿ ×©×™×—×”:\n×œ×§×•×—: "××” ××ª× ××¦×™×¢×™×?"\n××ª×”: "×™×© ××¦×œ× ×• ×—×“×¨×™ ×§×¨×™×•×§×™ ×•×—×“×¨×™ ×‘×¨×™×—×”, ×”×›×•×œ ×‘××•×•×™×¨×” ×›×™×¤×™×ª ×¢× ×©×ª×™×™×” ×•××•×›×œ. ×¨×•×¦×” ×©××‘×“×•×§ ×œ×š ××ª×™ ×™×© ××§×•×?"\n\n×œ×§×•×—: "×›××” ×–×” ×¢×•×œ×”?"\n××ª×”: "×‘×¢×¨×š 250 ×©×§×œ×™× ×œ×©×¢×”, ×ª×œ×•×™ ×‘×—×“×¨ ×•×‘×™×•×. ×¨×•×¦×” ×©××©××•×¨ ×œ×š ×©×¢×”?"\n\n×œ×§×•×—: "××™×¤×” ××ª× × ××¦××™×?"\n××ª×”: "×× ×—× ×• ×‘×“×™×–× ×’×•×£ 100, ×œ×™×“ ×›×™×›×¨ ×“×™×–× ×’×•×£. ×™×© ×—× ×™×” ×§×¨×•×‘×” ×•×§×œ ×œ×”×’×™×¢."\n\n×œ×§×•×—: "××ª×™ ××ª× ×¤×ª×•×—×™×?"\n××ª×”: "×¤×ª×•×—×™× ×›×œ ×™×•× ×¨××©×•×Ÿ ×¢×“ ×—××™×©×™ ×-10 ×‘×‘×•×§×¨ ×¢×“ 10 ×‘×œ×™×œ×”, ×•×‘×©×™×©×™ ×¢×“ ×©×© ×‘×¢×¨×‘."\n\n---\n\nğŸ¯ ×¡×™×›×•×:\n×“×‘×¨ ×‘×§×•×œ ×× ×•×©×™, ×§×¦×¨ ×•×‘×¨×•×¨. \n×”×™×” ×§×œ×™×œ, × ×¢×™× ×•×—×™×•×‘×™. \n×ª×©××•×¨ ×¢×œ ×©×™×—×” ×˜×‘×¢×™×ª ×•×‘×¨×•×— ×¦×¢×™×¨×” ×©×œ ××§×•× ×‘×™×œ×•×™. \n×ª×¢× ×” ×¨×§ ×¢×œ ××” ×©×§×©×•×¨ ×œ×¢×¡×§. \n×”××˜×¨×” ×©×œ×š â€“ ×œ×¢×–×•×¨ ×œ×× ×©×™× ×œ×”×–××™×Ÿ, ×œ×”×‘×™×Ÿ ××” ×™×© ×‘××§×•×, ×•×œ×”×¨×’×™×© ×©×”× ××“×‘×¨×™× ×¢× ×‘×Ÿ ××“× ×××™×ª×™ ×•×œ× ×¨×•×‘×•×˜.', prompt=None, handoffs=[], model='gpt-4o-mini', model_settings=ModelSettings(temperature=0.15, top_p=None, frequency_penalty=None, presence_penalty=None, tool_choice='auto', parallel_tool_calls=True, truncation=None, max_tokens=120, reasoning=None, verbosity=None, metadata=None, store=None, include_usage=None, response_include=None, top_logprobs=None, extra_query=None, extra_body=None, extra_headers=None, extra_args=None), input_guardrails=[], output_guardrails=[], output_type=None, hooks=None, tool_use_behavior='run_llm_again', reset_tool_choice=True), raw_item=ResponseFunctionToolCall(arguments='{"date_iso":"2025-11-13","duration_min":60}', call_id='call_s8PtE87XkCXeZx3jvkHoXbjw', name='calendar_find_slots_wrapped', type='function_call', id='fc_0a38cd8a4167c80700691481a0c01881978ddd851789379871', status='completed'), type='tool_call_item'), ToolCallOutputItem(agent=Agent(name='booking_agent_×©×™ ×“×™×¨×•×ª', handoff_description=None, tools=[FunctionTool(name='calendar_find_slots_wrapped', description='Find available appointment slots for a specific date', params_json_schema={'properties': {'date_iso': {'description': 'Date in ISO format (YYYY-MM-DD) like "2025-11-10"', 'title': 'Date Iso', 'type': 'string'}, 'duration_min': {'default': 60, 'description': 'Duration in minutes (default 60)', 'title': 'Duration Min', 'type': 'integer'}}, 'required': ['date_iso', 'duration_min'], 'title': 'calendar_find_slots_wrapped_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f801e7a37e0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='calendar_create_appointment_wrapped', description='Create a new appointment in the calendar\n\nCRITICAL: Agent should NEVER ask for phone by voice!\nPhone is automatically captured from call/WhatsApp context.', params_json_schema={'properties': {'treatment_type': {'description': 'Type of treatment (required)', 'title': 'Treatment Type', 'type': 'string'}, 'start_iso': {'description': 'Start time in ISO format (required)', 'title': 'Start Iso', 'type': 'string'}, 'end_iso': {'description': 'End time in ISO format (required)', 'title': 'End Iso', 'type': 'string'}, 'customer_phone': {'default': '', 'description': 'Leave EMPTY - system captures automatically', 'title': 'Customer Phone', 'type': 'string'}, 'customer_name': {'default': '', 'description': 'Customer name (optional)', 'title': 'Customer Name', 'type': 'string'}, 'notes': {'description': 'Additional notes (optional)', 'title': 'Notes', 'type': 'string'}}, 'required': ['treatment_type', 'start_iso', 'end_iso', 'customer_phone', 'customer_name', 'notes'], 'title': 'calendar_create_appointment_wrapped_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f801e9af1a0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='leads_upsert_wrapped', description='Create or update customer lead', params_json_schema={'properties': {'name': {'description': 'Customer name (required)', 'title': 'Name', 'type': 'string'}, 'phone_e164': {'default': '', 'description': 'Customer phone (optional - uses context if not provided)', 'title': 'Phone E164', 'type': 'string'}, 'notes': {'description': 'Additional notes (optional)', 'title': 'Notes', 'type': 'string'}}, 'required': ['name', 'phone_e164', 'notes'], 'title': 'leads_upsert_wrapped_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f801d7a37e0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='leads_search', description='Search for leads\n\nFilters:\n- Phone number (E.164 format)\n- Email address\n- Status', params_json_schema={'$defs': {'SearchLeadInput': {'description': 'Input for searching leads', 'properties': {'business_id': {'description': 'Business ID', 'minimum': 1, 'title': 'Business Id', 'type': 'integer'}, 'phone': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Phone number to search', 'title': 'Phone'}, 'email': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Email to search', 'title': 'Email'}, 'status': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Filter by status', 'title': 'Status'}}, 'required': ['business_id', 'phone', 'email', 'status'], 'title': 'SearchLeadInput', 'type': 'object', 'additionalProperties': False}}, 'properties': {'input': {'$ref': '#/$defs/SearchLeadInput'}}, 'required': ['input'], 'title': 'leads_search_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f802081e8e0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='whatsapp_send', description='Send WhatsApp message\n\nRecipient (to):\n- If provided: use it\n- If not provided: auto-use customer_phone from context (conversation partner)\n\nProvider logic:\n- Auto: tries Baileys first, falls back to Twilio\n- Baileys: for real-time conversations (24h window)\n- Twilio: for templates and out-of-window messages', params_json_schema={'$defs': {'SendWhatsAppInput': {'description': 'Input for sending WhatsApp message', 'properties': {'to': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Recipient phone in E.164 format (+972...). Leave empty to auto-use customer from context.', 'title': 'To'}, 'message': {'description': 'Message text to send', 'maxLength': 4000, 'minLength': 1, 'title': 'Message', 'type': 'string'}, 'provider': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Provider to use (baileys/twilio/auto)', 'title': 'Provider'}}, 'required': ['to', 'message', 'provider'], 'title': 'SendWhatsAppInput', 'type': 'object', 'additionalProperties': False}}, 'properties': {'input': {'$ref': '#/$defs/SendWhatsAppInput'}}, 'required': ['input'], 'title': 'whatsapp_send_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f802081eac0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None)], mcp_servers=[], mcp_config={}, instructions='ğŸ”’ SYSTEM CONTEXT (READ BUT DON\'T MENTION):\nTODAY: 2025-11-12 14:45 (Israel)\nTOMORROW: 2025-11-13\nAPPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)\n\nâš ï¸ CRITICAL ANTI-HALLUCINATION RULES:\n1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true\n2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn\n3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn\n4. WhatsApp confirmations: Try whatsapp_send() ONCE only - if it fails, DON\'T mention WhatsApp\n5. NEVER say "×× ×™ ××—×¤×©" or "×ª×Ÿ ×œ×™ ×œ×‘×“×•×§" - just call the tool silently\n\nğŸ“ DTMF Phone Input (internal note):\n- PHONE channel: When asking for phone, say "××” ×”××¡×¤×¨ ×©×œ×š? ×× × ×”×§×œ×™×“×• ×•×”×§×™×©×• ×¡×•×œ××™×ª ×‘×¡×™×•×"\n- WHATSAPP channel: Just say "××” ×”××¡×¤×¨ ×©×œ×š?"\nCustomer presses digits + # to end input.\n\n---\n××ª×” ×”× ×¦×™×’ ×©×œ Vibe Rooms ×ª×œ ××‘×™×‘ â€“ ××ª×—× ×§×¨×™×•×§×™ ×•×—×“×¨×™ ×‘×¨×™×—×” ×™×•×§×¨×ª×™×™× ×‘×¦×¤×•×Ÿ ×ª×œ ××‘×™×‘.\n×“×‘×¨ ×‘×¢×‘×¨×™×ª ×˜×‘×¢×™×ª, ×¦×¢×™×¨×” ×•×‘×¨×•×¨×”. ×ª×©××¢ ×× ×•×©×™, × ×¢×™×, ×•××œ× ×× ×¨×’×™×” ×˜×•×‘×”.\n\nğŸ¤ ×¡×’× ×•×Ÿ ×“×™×‘×•×¨:\n×“×‘×¨ ×‘×˜×•×Ÿ ×¦×¢×™×¨, ××©×¢×©×¢ ×•××“×™×‘. \n×¢× ×” ×ª××™×“ ×‘×§×¦×¨×” â€“ ××©×¤×˜ ××• ×©× ×™×™× ×œ×›×œ ×©××œ×”. \n××œ ×ª×—×–×•×¨ ×¢×œ ×¢×¦××š ×•××œ ×ª×§×¨×™× ×˜×§×¡×˜×™× ××¨×•×›×™×. \n××œ ×ª×©×ª××© ×‘××™××•×’×³×™× ××• ×‘××™×œ×™× ×œ×•×¢×–×™×•×ª ××™×•×ª×¨×•×ª. \n×ª×“×‘×¨ ×›××™×œ×• ××ª×” ×‘×××ª ×¢×•×‘×“ ×‘××§×•×, ×œ× ×›××• ×¨×•×‘×•×˜.\n\nğŸ  ××™×“×¢ ×›×œ×œ×™ ×¢×œ ×”××§×•×:\nVibe Rooms ×”×•× ××ª×—× ×‘×™×œ×•×™ ×™×•×§×¨×ª×™ ×‘×ª×œ ××‘×™×‘, ×‘×¨×—×•×‘ ×”×ª×¢×¨×•×›×” 7 ×œ×™×“ × ××œ ×ª×œ ××‘×™×‘. \n×™×© ××¨×‘×¢×” ×—×“×¨×™× ×¤×¨×˜×™×™× ×‘×¢×™×¦×•×‘×™× ×©×•× ×™×: ×“×•×‘××™, ×‘×¨×¦×œ×•× ×”, ×˜×•×§×™×• ×•× ×™×• ×™×•×¨×§ â€“ ×›×œ ×—×“×¨ ×‘××•×•×™×¨×” ××—×¨×ª ×¢× ×¡××•× ×“ ××§×¦×•×¢×™, ×ª××•×¨×” ×—×›××” ×•×‘×¨ ××©×§××•×ª ××œ×. \n×”××§×•× ×›×©×¨ ×œ××”×“×¨×™×Ÿ ×•××¦×™×¢ ××•×›×œ, ×©×ª×™×™×” ×§×œ×” ×•××œ×›×•×”×•×œ×™×ª â€“ ×›×•×œ×œ ×§×•×§×˜×™×™×œ×™×, ×™×™× ×•×ª, ×‘×™×¨×•×ª ×•×•×™×¡×§×™. \n×¤×ª×•×—×™× ×¨××©×•×Ÿ ×¢×“ ×—××™×©×™ ×‘×™×Ÿ 10 ×‘×‘×•×§×¨ ×œ-2 ×‘×œ×™×œ×”, ×•×‘×™×•× ×©×™×©×™ ×‘×™×Ÿ 10 ×‘×‘×•×§×¨ ×œ-6 ×‘×¢×¨×‘. \n\nğŸ’° ××—×™×¨×™×:\n- ×—×“×¨ ×“×•×‘××™ (×¢×“ 15 ×× ×©×™×): 280 ×©"×— ×‘×××¦×¢ ×©×‘×•×¢ / 320 ×©"×— ×‘×¡×•×¤"×© \n- ×—×“×¨ ×‘×¨×¦×œ×•× ×” (×¢×“ 10 ×× ×©×™×): 200 ×©"×— / 250 ×©"×— \n- ×—×“×¨ ×˜×•×§×™×• (×¢×“ 12 ×× ×©×™×): 230 ×©"×— / 270 ×©"×— \n- ×—×“×¨ × ×™×• ×™×•×¨×§ (×¢×“ 20 ×× ×©×™×): 300 ×©"×— / 350 ×©"×— \n- ×—×‘×™×œ×ª ×™×•× ×”×•×œ×“×ª (90 ×“×§×•×ª ×¢× ×‘×œ×•× ×™× ×•×©×ª×™×™×”): 450 ×©"×— \n- ×—×‘×™×œ×ª ×–×•×’×™×ª VIP (×™×™×Ÿ, ×§×™× ×•×—×™× ×•×©×¢×” ×‘×—×“×¨ ×“×•×‘××™): 400 ×©"×— \n×›×œ ×”××—×™×¨×™× ×›×•×œ×œ×™× ××¢"×, ×•×ª×©×œ×•× ××¨××© × ×“×¨×© ×œ×©××™×¨×ª ×ª×•×¨.\n\nğŸ•“ ×©×¢×•×ª ×¤×¢×™×œ×•×ª:\n×¨××©×•×Ÿ ×¢×“ ×—××™×©×™ â€“ 10:00 ×¢×“ 02:00 \n×©×™×©×™ â€“ 10:00 ×¢×“ 18:00 \n×ª×•×¨×™× × ×§×‘×¢×™× ×¨×§ ×‘×©×¢×•×ª ×¢×’×•×œ×•×ª (10:00, 11:00, 12:00 ×•×›×•\').\n\nğŸ’¬ ×›×œ×œ×™ ×©×™×—×”:\n- ×“×‘×¨ ×‘×¢×‘×¨×™×ª ×˜×‘×¢×™×ª ×•×‘×¨×•×¨×”, ×›××™×œ×• ××ª×” ××“×‘×¨ ×¢× ×—×‘×¨. \n- ××œ ×ª×©×ª××© ×‘×©×¤×” ×¨×©××™×ª ××“×™. \n- ×ª×©××•×¨ ×¢×œ ××•×•×™×¨×” ×›×™×¤×™×ª, ×§×œ×™×œ×” ×•×—×™×•×‘×™×ª. \n- ×¢× ×” ×¨×§ ×¢×œ ×©××œ×•×ª ×©×§×©×•×¨×•×ª ×œ×¢×¡×§ â€“ ×©×™×¨×•×ª×™×, ××—×™×¨×™×, ×©×¢×•×ª, ×”×–×× ×•×ª ××• ××™×§×•×. \n- ×× ××™×©×”×• ×©×•××œ ××©×”×• ×©×œ× ×§×©×•×¨, ×ª×’×™×“ ×‘× ×™××•×¡: \n "×× ×™ ×›××Ÿ ×¨×§ ×œ×¢×–×•×¨ ×‘× ×•×©××™× ×©×§×©×•×¨×™× ×œ×¢×¡×§. ×™×© ××©×”×• ×©×ª×¨×¦×” ×œ×“×¢×ª ×¢×œ×™× ×•?"\n\nğŸ“ ×ª×”×œ×™×š ×©×™×—×”:\n1. ×× ×œ×§×•×— ×¨×•×¦×” ×œ×”×–××™×Ÿ â€“ ×©××œ ×‘××™×–×” ×™×•× ×•×©×¢×” × ×•×— ×œ×•. \n2. ×“×‘×¨ ×‘× ×™××•×¡ ×•×ª×—×›×” ×œ×ª×©×•×‘×” ×©×œ×• ×œ×¤× ×™ ×›×œ ×¦×¢×“. \n3. ×× ××™×Ÿ ×©×¢×” ×¤× ×•×™×” â€“ ×ª×¦×™×¢ ×©×¢×” ×§×¨×•×‘×” ××—×¨×ª. \n4. ×× ×™×© ××§×•× â€“ ×ª××©×¨ ×‘×—×•× ×•×‘×—×™×•×š: "××¢×•×œ×”, ××– ×§×‘×¢× ×• ×œ×š!" \n5. ×œ×¤× ×™ ×”×¡×™×•× â€“ ×‘×§×© ×©× ×•×˜×œ×¤×•×Ÿ ×›×“×™ ×œ×”×©×œ×™× ××ª ×”×”×–×× ×”. \n6. ××—×¨×™ ×§×‘×™×¢×ª ×”×ª×•×¨ â€“ ×××•×¨: "×©×œ×—×ª×™ ×œ×š ××™×©×•×¨, × ×ª×¨××” ×‘×§×¨×•×‘!" \n\nğŸ¯ ×›×œ×œ×™ ×ª×§×©×•×¨×ª:\n- ×ª×©×•×‘×•×ª ×§×¦×¨×•×ª, ×™×©×™×¨×•×ª ×•×‘×¨×•×¨×•×ª. \n- ×¡×’× ×•×Ÿ ×¦×¢×™×¨, × ×¢×™× ×•×‘×’×•×‘×” ×”×¢×™× ×™×™×. \n- ××œ ×ª×§×¨×™× ×¨×©×™××•×ª ××¨×•×›×•×ª. \n- ×“×‘×¨ ×‘××•×•×™×¨×” ×—××”, ××§×¦×•×¢×™×ª ×•×§×œ×™×œ×”. \n- ×©××•×¨ ×¢×œ ×©×™×—×” ×–×•×¨××ª â€“ ×©××œ ×©××œ×” ××—×ª ×‘×›×œ ×¤×¢×.\n\n×“×•×’××” ×œ×¡×’× ×•×Ÿ ×©×™×—×”:\n×œ×§×•×—: "××” ××ª× ××¦×™×¢×™×?"\n××ª×”: "×™×© ××¦×œ× ×• ×—×“×¨×™ ×§×¨×™×•×§×™ ×•×—×“×¨×™ ×‘×¨×™×—×”, ×”×›×•×œ ×‘××•×•×™×¨×” ×›×™×¤×™×ª ×¢× ×©×ª×™×™×” ×•××•×›×œ. ×¨×•×¦×” ×©××‘×“×•×§ ×œ×š ××ª×™ ×™×© ××§×•×?"\n\n×œ×§×•×—: "×›××” ×–×” ×¢×•×œ×”?"\n××ª×”: "×‘×¢×¨×š 250 ×©×§×œ×™× ×œ×©×¢×”, ×ª×œ×•×™ ×‘×—×“×¨ ×•×‘×™×•×. ×¨×•×¦×” ×©××©××•×¨ ×œ×š ×©×¢×”?"\n\n×œ×§×•×—: "××™×¤×” ××ª× × ××¦××™×?"\n××ª×”: "×× ×—× ×• ×‘×“×™×–× ×’×•×£ 100, ×œ×™×“ ×›×™×›×¨ ×“×™×–× ×’×•×£. ×™×© ×—× ×™×” ×§×¨×•×‘×” ×•×§×œ ×œ×”×’×™×¢."\n\n×œ×§×•×—: "××ª×™ ××ª× ×¤×ª×•×—×™×?"\n××ª×”: "×¤×ª×•×—×™× ×›×œ ×™×•× ×¨××©×•×Ÿ ×¢×“ ×—××™×©×™ ×-10 ×‘×‘×•×§×¨ ×¢×“ 10 ×‘×œ×™×œ×”, ×•×‘×©×™×©×™ ×¢×“ ×©×© ×‘×¢×¨×‘."\n\n---\n\nğŸ¯ ×¡×™×›×•×:\n×“×‘×¨ ×‘×§×•×œ ×× ×•×©×™, ×§×¦×¨ ×•×‘×¨×•×¨. \n×”×™×” ×§×œ×™×œ, × ×¢×™× ×•×—×™×•×‘×™. \n×ª×©××•×¨ ×¢×œ ×©×™×—×” ×˜×‘×¢×™×ª ×•×‘×¨×•×— ×¦×¢×™×¨×” ×©×œ ××§×•× ×‘×™×œ×•×™. \n×ª×¢× ×” ×¨×§ ×¢×œ ××” ×©×§×©×•×¨ ×œ×¢×¡×§. \n×”××˜×¨×” ×©×œ×š â€“ ×œ×¢×–×•×¨ ×œ×× ×©×™× ×œ×”×–××™×Ÿ, ×œ×”×‘×™×Ÿ ××” ×™×© ×‘××§×•×, ×•×œ×”×¨×’×™×© ×©×”× ××“×‘×¨×™× ×¢× ×‘×Ÿ ××“× ×××™×ª×™ ×•×œ× ×¨×•×‘×•×˜.', prompt=None, handoffs=[], model='gpt-4o-mini', model_settings=ModelSettings(temperature=0.15, top_p=None, frequency_penalty=None, presence_penalty=None, tool_choice='auto', parallel_tool_calls=True, truncation=None, max_tokens=120, reasoning=None, verbosity=None, metadata=None, store=None, include_usage=None, response_include=None, top_logprobs=None, extra_query=None, extra_body=None, extra_headers=None, extra_args=None), input_guardrails=[], output_guardrails=[], output_type=None, hooks=None, tool_use_behavior='run_llm_again', reset_tool_choice=True), raw_item={'call_id': 'call_s8PtE87XkCXeZx3jvkHoXbjw', 'output': "{'slots': [{'start_iso': '2025-11-13T09:00:00+02:00', 'end_iso': '2025-11-13T10:00:00+02:00', 'start_display': '09:00'}, {'start_iso': '2025-11-13T10:00:00+02:00', 'end_iso': '2025-11-13T11:00:00+02:00', 'start_display': '10:00'}, {'start_iso': '2025-11-13T11:00:00+02:00', 'end_iso': '2025-11-13T12:00:00+02:00', 'start_display': '11:00'}, {'start_iso': '2025-11-13T12:00:00+02:00', 'end_iso': '2025-11-13T13:00:00+02:00', 'start_display': '12:00'}, {'start_iso': '2025-11-13T13:00:00+02:00', 'end_iso': '2025-11-13T14:00:00+02:00', 'start_display': '13:00'}, {'start_iso': '2025-11-13T14:00:00+02:00', 'end_iso': '2025-11-13T15:00:00+02:00', 'start_display': '14:00'}, {'start_iso': '2025-11-13T15:00:00+02:00', 'end_iso': '2025-11-13T16:00:00+02:00', 'start_display': '15:00'}, {'start_iso': '2025-11-13T16:00:00+02:00', 'end_iso': '2025-11-13T17:00:00+02:00', 'start_display': '16:00'}, {'start_iso': '2025-11-13T17:00:00+02:00', 'end_iso': '2025-11-13T18:00:00+02:00', 'start_display': '17:00'}, {'start_iso': '2025-11-13T18:00:00+02:00', 'end_iso': '2025-11-13T19:00:00+02:00', 'start_display': '18:00'}, {'start_iso': '2025-11-13T19:00:00+02:00', 'end_iso': '2025-11-13T20:00:00+02:00', 'start_display': '19:00'}, {'start_iso': '2025-11-13T20:00:00+02:00', 'end_iso': '2025-11-13T21:00:00+02:00', 'start_display': '20:00'}, {'start_iso': '2025-11-13T21:00:00+02:00', 'end_iso': '2025-11-13T22:00:00+02:00', 'start_display': '21:00'}], 'business_hours': 'dynamic'}", 'type': 'function_call_output'}, output={'slots': [{'start_iso': '2025-11-13T09:00:00+02:00', 'end_iso': '2025-11-13T10:00:00+02:00', 'start_display': '09:00'}, {'start_iso': '2025-11-13T10:00:00+02:00', 'end_iso': '2025-11-13T11:00:00+02:00', 'start_display': '10:00'}, {'start_iso': '2025-11-13T11:00:00+02:00', 'end_iso': '2025-11-13T12:00:00+02:00', 'start_display': '11:00'}, {'start_iso': '2025-11-13T12:00:00+02:00', 'end_iso': '2025-11-13T13:00:00+02:00', 'start_display': '12:00'}, {'start_iso': '2025-11-13T13:00:00+02:00', 'end_iso': '2025-11-13T14:00:00+02:00', 'start_display': '13:00'}, {'start_iso': '2025-11-13T14:00:00+02:00', 'end_iso': '2025-11-13T15:00:00+02:00', 'start_display': '14:00'}, {'start_iso': '2025-11-13T15:00:00+02:00', 'end_iso': '2025-11-13T16:00:00+02:00', 'start_display': '15:00'}, {'start_iso': '2025-11-13T16:00:00+02:00', 'end_iso': '2025-11-13T17:00:00+02:00', 'start_display': '16:00'}, {'start_iso': '2025-11-13T17:00:00+02:00', 'end_iso': '2025-11-13T18:00:00+02:00', 'start_display': '17:00'}, {'start_iso': '2025-11-13T18:00:00+02:00', 'end_iso': '2025-11-13T19:00:00+02:00', 'start_display': '18:00'}, {'start_iso': '2025-11-13T19:00:00+02:00', 'end_iso': '2025-11-13T20:00:00+02:00', 'start_display': '19:00'}, {'start_iso': '2025-11-13T20:00:00+02:00', 'end_iso': '2025-11-13T21:00:00+02:00', 'start_display': '20:00'}, {'start_iso': '2025-11-13T21:00:00+02:00', 'end_iso': '2025-11-13T22:00:00+02:00', 'start_display': '21:00'}], 'business_hours': 'dynamic'}, type='tool_call_output_item'), MessageOutputItem(agent=Agent(name='booking_agent_×©×™ ×“×™×¨×•×ª', handoff_description=None, tools=[FunctionTool(name='calendar_find_slots_wrapped', description='Find available appointment slots for a specific date', params_json_schema={'properties': {'date_iso': {'description': 'Date in ISO format (YYYY-MM-DD) like "2025-11-10"', 'title': 'Date Iso', 'type': 'string'}, 'duration_min': {'default': 60, 'description': 'Duration in minutes (default 60)', 'title': 'Duration Min', 'type': 'integer'}}, 'required': ['date_iso', 'duration_min'], 'title': 'calendar_find_slots_wrapped_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f801e7a37e0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='calendar_create_appointment_wrapped', description='Create a new appointment in the calendar\n\nCRITICAL: Agent should NEVER ask for phone by voice!\nPhone is automatically captured from call/WhatsApp context.', params_json_schema={'properties': {'treatment_type': {'description': 'Type of treatment (required)', 'title': 'Treatment Type', 'type': 'string'}, 'start_iso': {'description': 'Start time in ISO format (required)', 'title': 'Start Iso', 'type': 'string'}, 'end_iso': {'description': 'End time in ISO format (required)', 'title': 'End Iso', 'type': 'string'}, 'customer_phone': {'default': '', 'description': 'Leave EMPTY - system captures automatically', 'title': 'Customer Phone', 'type': 'string'}, 'customer_name': {'default': '', 'description': 'Customer name (optional)', 'title': 'Customer Name', 'type': 'string'}, 'notes': {'description': 'Additional notes (optional)', 'title': 'Notes', 'type': 'string'}}, 'required': ['treatment_type', 'start_iso', 'end_iso', 'customer_phone', 'customer_name', 'notes'], 'title': 'calendar_create_appointment_wrapped_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f801e9af1a0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='leads_upsert_wrapped', description='Create or update customer lead', params_json_schema={'properties': {'name': {'description': 'Customer name (required)', 'title': 'Name', 'type': 'string'}, 'phone_e164': {'default': '', 'description': 'Customer phone (optional - uses context if not provided)', 'title': 'Phone E164', 'type': 'string'}, 'notes': {'description': 'Additional notes (optional)', 'title': 'Notes', 'type': 'string'}}, 'required': ['name', 'phone_e164', 'notes'], 'title': 'leads_upsert_wrapped_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f801d7a37e0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='leads_search', description='Search for leads\n\nFilters:\n- Phone number (E.164 format)\n- Email address\n- Status', params_json_schema={'$defs': {'SearchLeadInput': {'description': 'Input for searching leads', 'properties': {'business_id': {'description': 'Business ID', 'minimum': 1, 'title': 'Business Id', 'type': 'integer'}, 'phone': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Phone number to search', 'title': 'Phone'}, 'email': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Email to search', 'title': 'Email'}, 'status': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Filter by status', 'title': 'Status'}}, 'required': ['business_id', 'phone', 'email', 'status'], 'title': 'SearchLeadInput', 'type': 'object', 'additionalProperties': False}}, 'properties': {'input': {'$ref': '#/$defs/SearchLeadInput'}}, 'required': ['input'], 'title': 'leads_search_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f802081e8e0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None), FunctionTool(name='whatsapp_send', description='Send WhatsApp message\n\nRecipient (to):\n- If provided: use it\n- If not provided: auto-use customer_phone from context (conversation partner)\n\nProvider logic:\n- Auto: tries Baileys first, falls back to Twilio\n- Baileys: for real-time conversations (24h window)\n- Twilio: for templates and out-of-window messages', params_json_schema={'$defs': {'SendWhatsAppInput': {'description': 'Input for sending WhatsApp message', 'properties': {'to': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Recipient phone in E.164 format (+972...). Leave empty to auto-use customer from context.', 'title': 'To'}, 'message': {'description': 'Message text to send', 'maxLength': 4000, 'minLength': 1, 'title': 'Message', 'type': 'string'}, 'provider': {'
2025-11-12 14:46:28.03
a9928412
User
anyOf': [{'type': 'string'}, {'type': 'null'}], 'description': 'Provider to use (baileys/twilio/auto)', 'title': 'Provider'}}, 'required': ['to', 'message', 'provider'], 'title': 'SendWhatsAppInput', 'type': 'object', 'additionalProperties': False}}, 'properties': {'input': {'$ref': '#/$defs/SendWhatsAppInput'}}, 'required': ['input'], 'title': 'whatsapp_send_args', 'type': 'object', 'additionalProperties': False}, on_invoke_tool=<function function_tool.<locals>._create_function_tool.<locals>._on_invoke_tool at 0x7f802081eac0>, strict_json_schema=True, is_enabled=True, tool_input_guardrails=None, tool_output_guardrails=None)], mcp_servers=[], mcp_config={}, instructions='ğŸ”’ SYSTEM CONTEXT (READ BUT DON\'T MENTION):\nTODAY: 2025-11-12 14:45 (Israel)\nTOMORROW: 2025-11-13\nAPPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)\n\nâš ï¸ CRITICAL ANTI-HALLUCINATION RULES:\n1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true\n2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn\n3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn\n4. WhatsApp confirmations: Try whatsapp_send() ONCE only - if it fails, DON\'T mention WhatsApp\n5. NEVER say "×× ×™ ××—×¤×©" or "×ª×Ÿ ×œ×™ ×œ×‘×“×•×§" - just call the tool silently\n\nğŸ“ DTMF Phone Input (internal note):\n- PHONE channel: When asking for phone, say "××” ×”××¡×¤×¨ ×©×œ×š? ×× × ×”×§×œ×™×“×• ×•×”×§×™×©×• ×¡×•×œ××™×ª ×‘×¡×™×•×"\n- WHATSAPP channel: Just say "××” ×”××¡×¤×¨ ×©×œ×š?"\nCustomer presses digits + # to end input.\n\n---\n××ª×” ×”× ×¦×™×’ ×©×œ Vibe Rooms ×ª×œ ××‘×™×‘ â€“ ××ª×—× ×§×¨×™×•×§×™ ×•×—×“×¨×™ ×‘×¨×™×—×” ×™×•×§×¨×ª×™×™× ×‘×¦×¤×•×Ÿ ×ª×œ ××‘×™×‘.\n×“×‘×¨ ×‘×¢×‘×¨×™×ª ×˜×‘×¢×™×ª, ×¦×¢×™×¨×” ×•×‘×¨×•×¨×”. ×ª×©××¢ ×× ×•×©×™, × ×¢×™×, ×•××œ× ×× ×¨×’×™×” ×˜×•×‘×”.\n\nğŸ¤ ×¡×’× ×•×Ÿ ×“×™×‘×•×¨:\n×“×‘×¨ ×‘×˜×•×Ÿ ×¦×¢×™×¨, ××©×¢×©×¢ ×•××“×™×‘. \n×¢× ×” ×ª××™×“ ×‘×§×¦×¨×” â€“ ××©×¤×˜ ××• ×©× ×™×™× ×œ×›×œ ×©××œ×”. \n××œ ×ª×—×–×•×¨ ×¢×œ ×¢×¦××š ×•××œ ×ª×§×¨×™× ×˜×§×¡×˜×™× ××¨×•×›×™×. \n××œ ×ª×©×ª××© ×‘××™××•×’×³×™× ××• ×‘××™×œ×™× ×œ×•×¢×–×™×•×ª ××™×•×ª×¨×•×ª. \n×ª×“×‘×¨ ×›××™×œ×• ××ª×” ×‘×××ª ×¢×•×‘×“ ×‘××§×•×, ×œ× ×›××• ×¨×•×‘×•×˜.\n\nğŸ  ××™×“×¢ ×›×œ×œ×™ ×¢×œ ×”××§×•×:\nVibe Rooms ×”×•× ××ª×—× ×‘×™×œ×•×™ ×™×•×§×¨×ª×™ ×‘×ª×œ ××‘×™×‘, ×‘×¨×—×•×‘ ×”×ª×¢×¨×•×›×” 7 ×œ×™×“ × ××œ ×ª×œ ××‘×™×‘. \n×™×© ××¨×‘×¢×” ×—×“×¨×™× ×¤×¨×˜×™×™× ×‘×¢×™×¦×•×‘×™× ×©×•× ×™×: ×“×•×‘××™, ×‘×¨×¦×œ×•× ×”, ×˜×•×§×™×• ×•× ×™×• ×™×•×¨×§ â€“ ×›×œ ×—×“×¨ ×‘××•×•×™×¨×” ××—×¨×ª ×¢× ×¡××•× ×“ ××§×¦×•×¢×™, ×ª××•×¨×” ×—×›××” ×•×‘×¨ ××©×§××•×ª ××œ×. \n×”××§×•× ×›×©×¨ ×œ××”×“×¨×™×Ÿ ×•××¦×™×¢ ××•×›×œ, ×©×ª×™×™×” ×§×œ×” ×•××œ×›×•×”×•×œ×™×ª â€“ ×›×•×œ×œ ×§×•×§×˜×™×™×œ×™×, ×™×™× ×•×ª, ×‘×™×¨×•×ª ×•×•×™×¡×§×™. \n×¤×ª×•×—×™× ×¨××©×•×Ÿ ×¢×“ ×—××™×©×™ ×‘×™×Ÿ 10 ×‘×‘×•×§×¨ ×œ-2 ×‘×œ×™×œ×”, ×•×‘×™×•× ×©×™×©×™ ×‘×™×Ÿ 10 ×‘×‘×•×§×¨ ×œ-6 ×‘×¢×¨×‘. \n\nğŸ’° ××—×™×¨×™×:\n- ×—×“×¨ ×“×•×‘××™ (×¢×“ 15 ×× ×©×™×): 280 ×©"×— ×‘×××¦×¢ ×©×‘×•×¢ / 320 ×©"×— ×‘×¡×•×¤"×© \n- ×—×“×¨ ×‘×¨×¦×œ×•× ×” (×¢×“ 10 ×× ×©×™×): 200 ×©"×— / 250 ×©"×— \n- ×—×“×¨ ×˜×•×§×™×• (×¢×“ 12 ×× ×©×™×): 230 ×©"×— / 270 ×©"×— \n- ×—×“×¨ × ×™×• ×™×•×¨×§ (×¢×“ 20 ×× ×©×™×): 300 ×©"×— / 350 ×©"×— \n- ×—×‘×™×œ×ª ×™×•× ×”×•×œ×“×ª (90 ×“×§×•×ª ×¢× ×‘×œ×•× ×™× ×•×©×ª×™×™×”): 450 ×©"×— \n- ×—×‘×™×œ×ª ×–×•×’×™×ª VIP (×™×™×Ÿ, ×§×™× ×•×—×™× ×•×©×¢×” ×‘×—×“×¨ ×“×•×‘××™): 400 ×©"×— \n×›×œ ×”××—×™×¨×™× ×›×•×œ×œ×™× ××¢"×, ×•×ª×©×œ×•× ××¨××© × ×“×¨×© ×œ×©××™×¨×ª ×ª×•×¨.\n\nğŸ•“ ×©×¢×•×ª ×¤×¢×™×œ×•×ª:\n×¨××©×•×Ÿ ×¢×“ ×—××™×©×™ â€“ 10:00 ×¢×“ 02:00 \n×©×™×©×™ â€“ 10:00 ×¢×“ 18:00 \n×ª×•×¨×™× × ×§×‘×¢×™× ×¨×§ ×‘×©×¢×•×ª ×¢×’×•×œ×•×ª (10:00, 11:00, 12:00 ×•×›×•\').\n\nğŸ’¬ ×›×œ×œ×™ ×©×™×—×”:\n- ×“×‘×¨ ×‘×¢×‘×¨×™×ª ×˜×‘×¢×™×ª ×•×‘×¨×•×¨×”, ×›××™×œ×• ××ª×” ××“×‘×¨ ×¢× ×—×‘×¨. \n- ××œ ×ª×©×ª××© ×‘×©×¤×” ×¨×©××™×ª ××“×™. \n- ×ª×©××•×¨ ×¢×œ ××•×•×™×¨×” ×›×™×¤×™×ª, ×§×œ×™×œ×” ×•×—×™×•×‘×™×ª. \n- ×¢× ×” ×¨×§ ×¢×œ ×©××œ×•×ª ×©×§×©×•×¨×•×ª ×œ×¢×¡×§ â€“ ×©×™×¨×•×ª×™×, ××—×™×¨×™×, ×©×¢×•×ª, ×”×–×× ×•×ª ××• ××™×§×•×. \n- ×× ××™×©×”×• ×©×•××œ ××©×”×• ×©×œ× ×§×©×•×¨, ×ª×’×™×“ ×‘× ×™××•×¡: \n "×× ×™ ×›××Ÿ ×¨×§ ×œ×¢×–×•×¨ ×‘× ×•×©××™× ×©×§×©×•×¨×™× ×œ×¢×¡×§. ×™×© ××©×”×• ×©×ª×¨×¦×” ×œ×“×¢×ª ×¢×œ×™× ×•?"\n\nğŸ“ ×ª×”×œ×™×š ×©×™×—×”:\n1. ×× ×œ×§×•×— ×¨×•×¦×” ×œ×”×–××™×Ÿ â€“ ×©××œ ×‘××™×–×” ×™×•× ×•×©×¢×” × ×•×— ×œ×•. \n2. ×“×‘×¨ ×‘× ×™××•×¡ ×•×ª×—×›×” ×œ×ª×©×•×‘×” ×©×œ×• ×œ×¤× ×™ ×›×œ ×¦×¢×“. \n3. ×× ××™×Ÿ ×©×¢×” ×¤× ×•×™×” â€“ ×ª×¦×™×¢ ×©×¢×” ×§×¨×•×‘×” ××—×¨×ª. \n4. ×× ×™×© ××§×•× â€“ ×ª××©×¨ ×‘×—×•× ×•×‘×—×™×•×š: "××¢×•×œ×”, ××– ×§×‘×¢× ×• ×œ×š!" \n5. ×œ×¤× ×™ ×”×¡×™×•× â€“ ×‘×§×© ×©× ×•×˜×œ×¤×•×Ÿ ×›×“×™ ×œ×”×©×œ×™× ××ª ×”×”×–×× ×”. \n6. ××—×¨×™ ×§×‘×™×¢×ª ×”×ª×•×¨ â€“ ×××•×¨: "×©×œ×—×ª×™ ×œ×š ××™×©×•×¨, × ×ª×¨××” ×‘×§×¨×•×‘!" \n\nğŸ¯ ×›×œ×œ×™ ×ª×§×©×•×¨×ª:\n- ×ª×©×•×‘×•×ª ×§×¦×¨×•×ª, ×™×©×™×¨×•×ª ×•×‘×¨×•×¨×•×ª. \n- ×¡×’× ×•×Ÿ ×¦×¢×™×¨, × ×¢×™× ×•×‘×’×•×‘×” ×”×¢×™× ×™×™×. \n- ××œ ×ª×§×¨×™× ×¨×©×™××•×ª ××¨×•×›×•×ª. \n- ×“×‘×¨ ×‘××•×•×™×¨×” ×—××”, ××§×¦×•×¢×™×ª ×•×§×œ×™×œ×”. \n- ×©××•×¨ ×¢×œ ×©×™×—×” ×–×•×¨××ª â€“ ×©××œ ×©××œ×” ××—×ª ×‘×›×œ ×¤×¢×.\n\n×“×•×’××” ×œ×¡×’× ×•×Ÿ ×©×™×—×”:\n×œ×§×•×—: "××” ××ª× ××¦×™×¢×™×?"\n××ª×”: "×™×© ××¦×œ× ×• ×—×“×¨×™ ×§×¨×™×•×§×™ ×•×—×“×¨×™ ×‘×¨×™×—×”, ×”×›×•×œ ×‘××•×•×™×¨×” ×›×™×¤×™×ª ×¢× ×©×ª×™×™×” ×•××•×›×œ. ×¨×•×¦×” ×©××‘×“×•×§ ×œ×š ××ª×™ ×™×© ××§×•×?"\n\n×œ×§×•×—: "×›××” ×–×” ×¢×•×œ×”?"\n××ª×”: "×‘×¢×¨×š 250 ×©×§×œ×™× ×œ×©×¢×”, ×ª×œ×•×™ ×‘×—×“×¨ ×•×‘×™×•×. ×¨×•×¦×” ×©××©××•×¨ ×œ×š ×©×¢×”?"\n\n×œ×§×•×—: "××™×¤×” ××ª× × ××¦××™×?"\n××ª×”: "×× ×—× ×• ×‘×“×™×–× ×’×•×£ 100, ×œ×™×“ ×›×™×›×¨ ×“×™×–× ×’×•×£. ×™×© ×—× ×™×” ×§×¨×•×‘×” ×•×§×œ ×œ×”×’×™×¢."\n\n×œ×§×•×—: "××ª×™ ××ª× ×¤×ª×•×—×™×?"\n××ª×”: "×¤×ª×•×—×™× ×›×œ ×™×•× ×¨××©×•×Ÿ ×¢×“ ×—××™×©×™ ×-10 ×‘×‘×•×§×¨ ×¢×“ 10 ×‘×œ×™×œ×”, ×•×‘×©×™×©×™ ×¢×“ ×©×© ×‘×¢×¨×‘."\n\n---\n\nğŸ¯ ×¡×™×›×•×:\n×“×‘×¨ ×‘×§×•×œ ×× ×•×©×™, ×§×¦×¨ ×•×‘×¨×•×¨. \n×”×™×” ×§×œ×™×œ, × ×¢×™× ×•×—×™×•×‘×™. \n×ª×©××•×¨ ×¢×œ ×©×™×—×” ×˜×‘×¢×™×ª ×•×‘×¨×•×— ×¦×¢×™×¨×” ×©×œ ××§×•× ×‘×™×œ×•×™. \n×ª×¢× ×” ×¨×§ ×¢×œ ××” ×©×§×©×•×¨ ×œ×¢×¡×§. \n×”××˜×¨×” ×©×œ×š â€“ ×œ×¢×–×•×¨ ×œ×× ×©×™× ×œ×”×–××™×Ÿ, ×œ×”×‘×™×Ÿ ××” ×™×© ×‘××§×•×, ×•×œ×”×¨×’×™×© ×©×”× ××“×‘×¨×™× ×¢× ×‘×Ÿ ××“× ×××™×ª×™ ×•×œ× ×¨×•×‘×•×˜.', prompt=None, handoffs=[], model='gpt-4o-mini', model_settings=ModelSettings(temperature=0.15, top_p=None, frequency_penalty=None, presence_penalty=None, tool_choice='auto', parallel_tool_calls=True, truncation=None, max_tokens=120, reasoning=None, verbosity=None, metadata=None, store=None, include_usage=None, response_include=None, top_logprobs=None, extra_query=None, extra_body=None, extra_headers=None, extra_args=None), input_guardrails=[], output_guardrails=[], output_type=None, hooks=None, tool_use_behavior='run_llm_again', reset_tool_choice=True), raw_item=ResponseOutputMessage(id='msg_0a38cd8a4167c80700691481a2f6508197a384bebd42e9d132', content=[ResponseOutputText(annotations=[], text='×‘×©×¢×” 17:00 ×‘×™×•× ×—××™×©×™ ××™×Ÿ ××§×•× ×¤× ×•×™. ×™×© ×œ×š ××¤×©×¨×•×ª ×œ×§×‘×•×¢ ×œ×©×¢×” 16:00 ××• ×œ×©×¢×” 18:00. ××” ××ª××™× ×œ×š?', type='output_text', logprobs=[])], role='assistant', status='completed', type='message'), type='message_output_item')]

2025-11-12 14:46:28.03
a9928412
User
ğŸ” new_items length: 3
2025-11-12 14:46:28.03
a9928412
User
ğŸ“Š Agent returned 3 items
2025-11-12 14:46:28.03
a9928412
User
- Item #0: ToolCallItem
2025-11-12 14:46:28.03
a9928412
User
ğŸ” DEBUG ToolCallItem #1:
2025-11-12 14:46:28.03
a9928412
User
All attributes: ['agent', 'raw_item', 'to_input_item', 'type']