צודק ב־100%. 💥
מה שאמרת — בול לעניין:
צריך להפריד לגמרי בין שני רבדים שונים במערכת שלך, אחרת ה־Agent מתחיל “להתבלבל” ולהתנהג כמו בוט עם עומס יתר של חוקים סותרים.
הנה איך זה צריך להיות באמת בפרויקט שלך 👇

⸻

🎯 חלוקה נכונה (חייבת להיות ככה)

1️⃣ Prompt – התנהגות, שפה, סגנון, מסע לקוח

ה־Prompt הוא “הנשמה” של הנציג – איך הוא נשמע, איך הוא מדבר, מה הוא אומר, איך הוא בונה את התשובה.
⚠️ הוא לא אמור לדעת שום דבר טכני על calendar_find_slots או leads_upsert.
הוא רק אומר:

“בדוק אם יש מקום בשעה הזאת.”
“שלח אישור ללקוח.”
ואז AgentKit הוא זה שמבצע בפועל את הפעולה דרך הכלים.

2️⃣ AgentKit Instructions / Tool Logic – שכבת הביצוע

זו שכבת ה־API שלך – היא יודעת בדיוק:
	•	איך לקרוא את הכלים (calendar_find_slots, whatsapp_send, leads_upsert)
	•	מה הפורמט של התוצאות ({"slots": [...]})
	•	איך לפרש אותן טכנית
⚙️ פה מופיעות ההוראות שהוספת על הקריאה ל־calendar_find_slots — וזה נכון, אבל זה צריך להיות בתוך קובץ ה־tools או ה־agent_factory,
לא בתוך ה־prompt השיחתי.

⸻

✅ איך זה צריך להיות אצלך בפועל

📁 Prompt (לשיחות)

בקובץ prompt (למשל DB או business_prompt.txt):

אתה נציג שירות של Vibe Rooms תל אביב. 
דבר בעברית טבעית, תשובות קצרות וברורות (משפט או שניים). 
אל תקריא רשימות, אל תחזור על עצמך. 
אל תדבר על נושאים לא עסקיים. 
אם לקוח מבקש להזמין – שאל באיזה יום ושעה נוח לו, ואז אמור "רגע בודק" ותמתין לכלי לבדוק זמינות. 
אם אין מקום, אמור בנימוס "השעה הזאת תפוסה, אבל יש זמן אחר פנוי." 
אם יש מקום, אמור "מצוין, אפשר לקבוע על שמך?" 
אחרי קביעה, אמור "שלחתי את האישור עכשיו, נתראה בקרוב!"

כלומר — בלי שום מילים טכניות, בלי שמות כלים, בלי JSON.
זו רק האישיות והשפה שלו.

⸻

📁 AgentKit Tool Instructions (בקוד שלך)

ב־server/agents/tools_calendar.py
מוסיפים את כללי הפירוש שאתה רשמת קודם:

# tools_calendar.py

def interpret_calendar_slots(result, requested_time):
    """
    מקבל תוצאות calendar_find_slots ומחזיר טקסט פשוט לסוכן.
    """
    slots = result.get("slots", [])
    if not slots:
        return "אין זמנים פנויים."
    
    available_times = [s.get("start_display") for s in slots if s.get("start_display")]
    if requested_time in available_times:
        return f"השעה {requested_time} פנויה."
    else:
        alt = available_times[0] if available_times else None
        if alt:
            return f"השעה {requested_time} תפוסה, אבל יש פנוי ב-{alt}."
        return "אין זמינות בשעה הזאת."

ואז ה־AgentKit יודע לפרש ולהחזיר תשובה נכונה —
בלי להעמיס את הפרומפט שלך בחוקים טכניים.

⸻

🧩 למה ההפרדה הזו קריטית

רכיב	תפקיד	איפה צריך להגדיר
Prompt	איך הנציג נשמע ומדבר	DB או prompt template
AgentKit / Tools	מה המערכת עושה בפועל	קבצי Python שלך
Business Policy	הגדרות העסק (שעות, תורים, חוקים)	DB / business_settings

ברגע שהכול מעורבב (כמו שהייתה גרסה קודמת) —
ה-LLM מתבלבל בין “דבר אנושי” לבין “הוראה טכנית”,
ואז קורים הדברים שאתה רואה:
	•	חפירה בתשובות
	•	חזרה על כללים בקול
	•	ניסיון “להסביר” במקום לבצע

⸻

🧱 הנחיה למפתח שלך (מדויקת לפי הפרויקט)
	1.	נקה את הפרומפטים מכל אזכור של כלים, JSON, או תוצאות API.
השאר רק הוראות שיחה, טון, ושפה.
	2.	העבר את ההיגיון הלוגי (למשל קריאת slots, אימות טלפון, וכו׳)
לתוך קבצי tools_calendar.py, tools_leads.py, tools_whatsapp.py.
	3.	ב־agent_factory.py, תוודא שכל Tool מחזיר טקסט פשוט כמו:
"כן, השעה פנויה."
או "השעה הזאת תפוסה, יש פנוי ב-18:00."
	4.	ב־AIService או media_ws_ai.py, תשמור את השיחה אנושית בלבד – בלי תיאורים של תהליכים.
	5.	Prompt קצר וקבוע לכל עסק, מבוסס שפה ומידע עסקי (כמו שעות, מחירים, סוג השירות).

⸻

אם תרצה — אני יכול עכשיו לבנות לך את ה־מבנה הנכון של שלושת השכבות (Prompt / Tools / Policy)
כפי שהוא צריך להיות בקוד שלך, מוכן להעתקה לפרודקשן.
רוצה שאכין לך את זה?