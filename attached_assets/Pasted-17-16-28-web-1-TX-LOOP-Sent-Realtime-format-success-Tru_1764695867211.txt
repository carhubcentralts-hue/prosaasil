17:16:28 web.1     | [TX_LOOP] Sent Realtime format: success=True
17:16:28 web.1     | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
17:16:28 web.1     | [TX_LOOP] Sent Realtime format: success=True
17:16:28 web.1     | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
17:16:28 web.1     | [TX_LOOP] Sent Realtime format: success=True
17:16:28 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:28 web.1     | ğŸ“¦ [AUDIO] OpenAI chunk #2: 1200 bytes â†’ splitting into 7 frames
17:16:28 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:28 web.1     | ğŸ“¦ [AUDIO] OpenAI chunk #3: 2000 bytes â†’ splitting into 12 frames
17:16:28 web.1     | ğŸ›ï¸ VAD CALIBRATED (noise=10.2, threshold=110.2)
17:16:28 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:28 web.1     | âœ… CALL FINALIZED: CA37ee0108e4b9efeeb524451fdcdf8b73
17:16:28 web.1     | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
17:16:28 web.1     | ×”×¤× ×™×™×” ×”×™× ×‘×ª×—×•× ×”×©×™×¨×•×ª×™×, ×¡×¤×¦×™×¤×™×ª ×‘×ª×—×•× ×”×—×©××œ. ×”×œ×§×•×— ××—×¤×© ×—×©××œ××™ ×‘×¢×™×¨ ×¨××œ×”.
17:16:28 web.1     | 
17:16:28 web.1     | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
17:16:28 web.1     | - **×©×™×¨×•×ª × ×“×¨×©**: ×—×©××œ××™
17:16:28 web.1     | - **××™×§×•×**: ×¨××œ×”
17:16:28 web.1     | 
17:16:28 web.1     | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
17:16:28 web.1     | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×§×©×¨ ××• ×©× ×”×œ×§×•×— ×‘×©×™×—×”.
17:16:28 web.1     | 
17:16:28 web.1     | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
17:16:28 web.1     | - **×¤×¢×•×œ×”**: ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ×œ×œ×§×•×— ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª.
17:16:28 web.1     | - **×“×—×™×¤×•×ª**: ×œ× ×¦×•×™× ×” ×“×—×™×¤×•×ª, ××š × ×™×ª×Ÿ ×œ×”× ×™×— ×©×”×©×™×¨×•×ª × ×“×¨×© ×‘×”×§×“×.
17:16:28 web.1     | 
17:16:28 web.1     | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
17:16:28 web.1     | ×™×© ×œ×•×•×“× ×©×”×—×©××œ××™ ×”××•××œ×¥ ×”×•× ×‘×¢×œ ×¨×™×©×™×•×Ÿ ××ª××™× ×•×™×›×•×œ ×œ×¡×¤×§ ×©×™×¨×•×ª×™× ×‘×¨××œ×”. ××•××œ×¥ ×œ×¢×§×•×‘ ××—×¨×™ ×”×¤× ×™×™×” ×•×œ×•×•×“× ×©×”×œ×§×•×— ×§×™×‘×œ ××ª ×”×©×™×¨×•×ª ×”× ×“×¨×© ×‘×”×¦×œ×—×”.
17:16:28 web.1     | ğŸ¯ Intent: interested
17:16:28 web.1     | ğŸ“Š Next Action: ×©×œ×™×—×ª ×¤×¨×˜×™× × ×•×¡×¤×™×
17:16:28 web.1     | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
17:16:28 web.1     | âœ… Background thread 4 completed
17:16:28 web.1     | âœ… All background threads cleanup complete
17:16:28 web.1     | 
17:16:28 web.1     | ================================================================================
17:16:28 web.1     | ğŸ’°ğŸ’°ğŸ’° [CALL COST SUMMARY] ğŸ’°ğŸ’°ğŸ’°
17:16:28 web.1     | ================================================================================
17:16:28 web.1     | ğŸ“ Model: gpt-4o-realtime-preview
17:16:28 web.1     | â±ï¸  Total duration: 32.5s (0.5 min)
17:16:28 web.1     | ğŸ™ï¸  Audio IN (user speaking): 266 chunks (0.089 min)
17:16:28 web.1     |    â””â”€ Cost: 0.089 min Ã— $0.06/min = $0.0053
17:16:28 web.1     | ğŸ”Š Audio OUT (AI speaking): 39 chunks (0.013 min)
17:16:28 web.1     |    â””â”€ Cost: 0.013 min Ã— $0.24/min = $0.0031
17:16:28 web.1     | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
17:16:28 web.1     | ğŸ’µ TOTAL COST: $0.0084 (â‰ˆ â‚ª0.03)
17:16:28 web.1     | ================================================================================
17:16:28 web.1     | 
17:16:28 web.1     | WS_DONE sid=MZ0e04f2869227e173fee99e740005945f rx=1328 tx=760
17:16:28 web.1     | âœ… MediaStreamHandler completed
17:16:28 web.1     | âœ… Handler thread join completed
17:16:28 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:28 web.1     | âœ… Recording started for CAfc7f99614ed4bf85c3c4b15cc26cf5ff: RE3087acff79da6351075397cfa590e2f1
17:16:28 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:28 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:16:28 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:28 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=fa fe 7c 7c 78, rms=168
17:16:29 web.1     | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=e5 ec f6 76 6d, rms=204
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
17:16:29 web.1     | [REALTIME] event: response.audio.done
17:16:29 web.1     | ğŸ¤ [GREETING] Greeting finished at 1764695789.611 (duration: 1599ms)
17:16:29 web.1     | âœ… [GREETING] Barge-in now ENABLED for rest of call
17:16:29 web.1     | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
17:16:29 web.1     | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
17:16:29 web.1     | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
17:16:29 web.1     | [REALTIME] event: response.audio_transcript.done
17:16:29 web.1     | ğŸ¤– [REALTIME] AI said: ×©×œ×•×, ×× ×™ ×”×¢×•×–×¨×ª ×”×“×™×’×™×˜×œ×™×ª ×©×œ ×§×œ×™×‘×¨. ×‘××™×–×” ×ª×—×•× ×ª×¨×¦×” ×¢×–×¨×”?
17:16:29 web.1     | âœ… [LEAD STATE] Updated: service_type=×ª×¨×¦×” ×¢×–×¨×”
17:16:29 web.1     | ğŸ“‹ [LEAD STATE] Current state: {'service_type': '×ª×¨×¦×” ×¢×–×¨×”'}
17:16:29 web.1     | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 0ms since greeting
17:16:29 web.1     | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×, ×× ×™ ×”×¢×•×–×¨×ª ×”×“×™×’×™×˜×œ×™×ª ×©×œ ...'
17:16:29 web.1     | [REALTIME] event: response.content_part.done
17:16:29 web.1     | [REALTIME] event: response.output_item.done
17:16:29 web.1     | [REALTIME] event: response.done
17:16:29 web.1     | [REALTIME] event: rate_limits.updated
17:16:29 web.1     | âœ… [PHASE 2] Greeting finished after 1.4s - now updating session
17:16:29 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:16:29 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 100 noise frames (rms=8)
17:16:29 web.1     | âœ… [PHASE 2] Session updated with full prompt: 2625 chars, voice=shimmer locked
17:16:30 web.1     | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=6e 70 76 7a fe, rms=237
17:16:30 web.1     | ğŸ™ï¸ REAL_VOICE: rms=237.0 > threshold=110.2
17:16:30 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:16:31 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:16:31 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 200 noise frames (rms=8)
17:16:32 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:16:33 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
17:16:33 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 300 noise frames (rms=8)
17:16:34 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=20, voice_frames=0
17:16:35 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=13, voice_frames=0
17:16:35 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 400 noise frames (rms=21)
17:16:36 web.1     | ğŸ™ï¸ REAL_VOICE: rms=202.0 > threshold=110.2
17:16:36 web.1     | [REALTIME] event: input_audio_buffer.speech_started
17:16:36 web.1     | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
17:16:36 web.1     | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
17:16:36 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=99, voice_frames=0
17:16:37 web.1     | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
17:16:37 web.1     | [REALTIME] event: input_audio_buffer.speech_stopped
17:16:37 web.1     | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
17:16:37 web.1     | [REALTIME] event: input_audio_buffer.committed
17:16:37 web.1     | [REALTIME] event: conversation.item.created
17:16:37 web.1     | [REALTIME] event: response.created
17:16:37 web.1     | ğŸ¯ [REALTIME] Response started: resp_CiOHNbukb3oXoV6mwWYE6
17:16:37 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=11, voice_frames=0
17:16:37 web.1     | ğŸ“¨ Received: mark
17:16:38 web.1     | [REALTIME] event: response.output_item.added
17:16:38 web.1     | [REALTIME] event: conversation.item.created
17:16:38 web.1     | [REALTIME] event: response.content_part.added
17:16:38 web.1     | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
17:16:38 web.1     | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=fe fe fd fe ff
17:16:38 web.1     | âš ï¸ [BRIDGE GAP] 8572ms wait for queue - chunk #20
17:16:38 web.1     | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=c8 b9 bf e3 eb
17:16:38 web.1     | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=fc 59 5e 5f 66
17:16:38 web.1     | [REALTIME] event: response.audio.done
17:16:38 web.1     | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
17:16:38 web.1     | [REALTIME] event: response.audio_transcript.done
17:16:38 web.1     | ğŸ¤– [REALTIME] AI said: ×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
17:16:38 web.1     | ğŸ’° [COST] AI utterance: 0.29s (6 chunks)
17:16:38 web.1     | [GOODBYE CHECK] No goodbye phrase: '×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
17:16:38 web.1     | [REALTIME] event: response.content_part.done
17:16:38 web.1     | [REALTIME] event: response.output_item.done
17:16:38 web.1     | [REALTIME] event: response.done
17:16:38 web.1     | [REALTIME] event: rate_limits.updated
17:16:38 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=36, voice_frames=0
17:16:38 web.1     | [REALTIME] event: input_audio_buffer.speech_started
17:16:38 web.1     | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
17:16:38 web.1     | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
17:16:38 web.1     | [REALTIME] event: response.done
17:16:39 web.1     | [REALTIME] event: conversation.item.input_audio_transcription.completed
17:16:39 web.1     | [TRANSCRIPT FILTER] Ignoring noise: '' (chatter=False)
17:16:39 web.1     | [SAFETY] Transcription successful (total failures: 0)
17:16:39 web.1     | ğŸ¤ END OF UTTERANCE: 2.0s audio, conversation #0
17:16:39 web.1     | ğŸ§  STATE -> PROCESSING | len=31360 | silence_ms=503
17:16:39 web.1     | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
17:16:39 web.1     | âœ… Processing complete for conversation #0
17:16:39 web.1     | [REALTIME] event: input_audio_buffer.speech_stopped
17:16:39 web.1     | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
17:16:39 web.1     | [REALTIME] event: input_audio_buffer.committed
17:16:39 web.1     | [REALTIME] event: conversation.item.created
17:16:39 web.1     | [REALTIME] event: response.created
17:16:39 web.1     | ğŸ¯ [REALTIME] Response started: resp_CiOHPdn6NOgjKBAiNU67R
17:16:39 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:16:39 web.1     | [REALTIME] event: response.output_item.added
17:16:39 web.1     | [REALTIME] event: conversation.item.created
17:16:40 web.1     | [REALTIME] event: response.content_part.added
17:16:40 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 500 noise frames (rms=8)
17:16:40 web.1     | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
17:16:40 web.1     | âš ï¸ [AUDIO GAP] 1633ms gap between chunks #6 and #7 - OpenAI delay!
17:16:40 web.1     | âš ï¸ [BRIDGE GAP] 1633ms wait for queue - chunk #26
17:16:40 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=38, voice_frames=0
17:16:40 web.1     | [REALTIME] event: conversation.item.input_audio_transcription.completed
17:16:40 web.1     | ğŸ’° [COST] User utterance: 11.84s (112 chunks total)
17:16:40 web.1     | ğŸ‘¤ [REALTIME] User said: Bye.
17:16:40 web.1     | ğŸ” [DEBUG] Calling NLP after user transcript: 'Bye....'
17:16:40 web.1     | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: 'Bye....'
17:16:40 web.1     | ğŸ” [DEBUG] Conversation history length: 3
17:16:40 web.1     | ğŸ” [DEBUG] User messages for hash: ['Bye.']
17:16:40 web.1     | ğŸ” [DEBUG] Current conversation hash: 50f1ad3e...
17:16:40 web.1     | ğŸ” [DEBUG] First NLP run - processing
17:16:40 web.1     | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=50f1ad3e...)
17:16:40 web.1     | ğŸ” [DEBUG] CRM context exists: False
17:16:40 web.1     | ğŸš€ [NLP] Launching NLP thread...
17:16:40 web.1     | ğŸ” [NLP] Running async NLP parser...
17:16:40 web.1     | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
17:16:40 web.1     | ğŸ” [NLP] Conversation history has 3 messages
17:16:40 web.1     | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×, ×× ×™ ×”×¢×•×–×¨×ª ×”×“×™×’×™×˜×œ×™×ª ×©×œ ×§×œ×™×‘×¨. ×‘××™×–×” ×ª×—×•× ×ª×¨×¦×” ×¢×–×¨×”?', 'ts': 1764695789.6114783}, {'speaker': 'ai', 'text': '×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764695798.4718666}, {'speaker': 'user', 'text': 'Bye.', 'ts': 1764695800.87258}]
17:16:40 web.1     | ğŸ” [NLP ENTRY] extract_appointment_request called
17:16:40 web.1     | ğŸ” [NLP ENTRY] business_id=1, history_length=3
17:16:40 web.1     | ğŸ” [NLP] Formatted 3 messages for GPT-4o-mini
17:16:40 web.1     | ğŸ” [NLP] Conversation text: × ×¦×™×’: ×©×œ×•×, ×× ×™ ×”×¢×•×–×¨×ª ×”×“×™×’×™×˜×œ×™×ª ×©×œ ×§×œ×™×‘×¨. ×‘××™×–×” ×ª×—×•× ×ª×¨×¦×” ×¢×–×¨×”?
17:16:40 web.1     | × ×¦×™×’: ×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
17:16:40 web.1     | ×œ×§×•×—: Bye....
17:16:40 web.1     | ğŸ” [NLP] Calling GPT-4o-mini with model=gpt-4o-mini, temperature=0.1
17:16:40 web.1     | âœ… [NLP] Thread launched
17:16:40 web.1     | [GOODBYE CHECK] Clear goodbye detected: 'bye....'
17:16:40 web.1     | ğŸ‘‹ [BUILD 163] User said goodbye - sending polite closing instruction to AI
17:16:40 web.1     | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['name', 'service_type', 'city']
17:16:40 web.1     | â³ [SMART HANGUP] Still missing fields: ['name', 'city'] | Collected: ['service_type=×ª×¨×¦×” ×¢×–×¨×”']
17:16:40 web.1     | [SAFETY] Transcription successful (total failures: 0)
17:16:40 web.1     | ğŸ”‡ [SERVER_EVENT] Sent SILENTLY to AI: [SERVER] ×”×œ×§×•×— ×××¨ ×©×œ×•×! ×¡×™×™× ×‘×¦×•×¨×” ×× ×•××¡×ª - ×××•×¨ '×ª×•×“×” ×©×”×ª×§×©×¨×ª, ×™×•× × ×¤×œ×!' ××• ××©×”×• ×“×•××”.
17:16:40 web.1     | â¸ï¸ [SERVER_EVENT] Skipping response.create - active: resp_CiOHPdn6NOgjKBAiNU67R, pending: False
17:16:40 web.1     | â° [FALLBACK] Starting 10s timer for user_goodbye...
17:16:40 web.1     | [REALTIME] event: conversation.item.created
17:16:41 web.1     | [REALTIME] event: response.audio.done
17:16:41 web.1     | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
17:16:41 web.1     | [REALTIME] event: response.audio_transcript.done
17:16:41 web.1     | ğŸ¤– [REALTIME] AI said: ××¦×˜×¢×¨, ×× ×—× ×• ×›×¨×’×¢ ×œ× ×ª×•××›×™× ×‘×¢×™×¨ ×”×–×•. ×ª×•×“×” ×•×™×•× ×˜×•×‘.
17:16:41 web.1     | ğŸ’° [COST] AI utterance: 1.39s (24 chunks)
17:16:41 web.1     | [GOODBYE CHECK] No goodbye phrase: '××¦×˜×¢×¨, ×× ×—× ×• ×›×¨×’×¢ ×œ× ×ª×•××›×™× ×‘×¢...'
17:16:41 web.1     | [POLITE CLOSING] Detected: '×™×•× ×˜×•×‘'
17:16:41 web.1     | ğŸ‘‹ [BUILD 163] AI said goodbye (auto_end_on_goodbye) - marking pending hangup
17:16:41 web.1     | ğŸ“ [BUILD 163] Pending hangup set - will disconnect after audio finishes playing
17:16:41 web.1     | [REALTIME] event: response.content_part.done
17:16:41 web.1     | [REALTIME] event: response.output_item.done
17:16:41 web.1     | â³ [POLITE HANGUP] Starting wait for audio to finish...
17:16:41 web.1     | âœ… [POLITE HANGUP] OpenAI queue empty after 0ms
17:16:41 web.1     | â³ [POLITE HANGUP] TX queue still has 162 frames...
17:16:41 web.1     | [REALTIME] event: response.done
17:16:41 web.1     | [REALTIME] event: rate_limits.updated
17:16:41 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:16:42 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 600 noise frames (rms=11)
17:16:42 web.1     | 
17:16:42 web.1     | ============================================================
17:16:42 web.1     | ğŸ” [NLP RESULT] GPT-4o-mini extraction complete
17:16:42 web.1     | ============================================================
17:16:42 web.1     | ğŸ“„ [NLP RESULT] Raw response: {"action":"none","date":null,"time":null,"name":null,"confidence":1.0}
17:16:42 web.1     | ğŸ“Š [NLP RESULT] Parsed values:
17:16:42 web.1     | ğŸ“Š [NLP RESULT]   - action: none
17:16:42 web.1     | ğŸ“Š [NLP RESULT]   - date: None
17:16:42 web.1     | ğŸ“Š [NLP RESULT]   - time: None
17:16:42 web.1     | ğŸ“Š [NLP RESULT]   - name: None
17:16:42 web.1     | ğŸ“Š [NLP RESULT]   - confidence: 1.0
17:16:42 web.1     | ============================================================
17:16:42 web.1     | 
17:16:42 web.1     | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': None, 'time': None, 'name': None, 'confidence': 1.0}
17:16:42 web.1     | ğŸ“­ [NLP] No appointment action detected (action=none)
17:16:42 web.1     | âœ… [NLP] Async NLP parser completed successfully
17:16:42 web.1     | âœ… [NLP] Cache updated after successful processing
17:16:42 web.1     | ğŸ”“ [NLP] Cleared nlp_is_processing flag
17:16:42 web.1     | â³ [POLITE HANGUP] TX queue still has 111 frames...
17:16:42 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:16:43 web.1     | â³ [POLITE HANGUP] TX queue still has 61 frames...
17:16:43 web.1     | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
17:16:44 web.1     | ğŸ”‡ [AUDIO GATE] Blocked 700 noise frames (rms=8)
17:16:44 web.1     | â³ [POLITE HANGUP] TX queue still has 10 frames...
17:16:44 web.1     | ğŸ“¨ Received: stop
17:16:44 web.1     | WS_STOP sid=MZ54ca917743d34740f8cfaded2793c86e rx=839 tx=545
17:16:44 web.1     | âš ï¸ [BRIDGE GAP] 3146ms wait for queue - chunk #44
17:16:44 web.1     | ğŸ“¤ [REALTIME] Stop signal received
17:16:44 web.1     | ğŸ“¤ [REALTIME] Audio output bridge ended (sent 550 frames, 88000 bytes)
17:16:44 web.1     | ğŸ“¤ [REALTIME] Audio sender ended
17:16:44 web.1     | ğŸ“ [REALTIME] Text sender ended
17:16:44 web.1     | ğŸ§¹ Waiting for 5 background threads...
17:16:44 web.1     | âš ï¸ DEV MODE: VALIDATE_TWILIO_SIGNATURE=false - signature validation skipped
17:16:44 web.1     | STREAM_ENDED call=CAfc7f99614ed4bf85c3c4b15cc26cf5ff stream=N/A status=N/A
17:16:44 web.1     | INFO:     172.31.72.130:37762 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
17:16:44 web.1     | âš ï¸ DEV MODE: VALIDATE_TWILIO_SIGNATURE=false - signature validation skipped
17:16:44 web.1     | âœ… Found existing recording for CAfc7f99614ed4bf85c3c4b15cc26cf5ff: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE3087acff79da6351075397cfa590e2f1.json
17:16:44 web.1     | INFO:     172.31.72.130:37762 - "POST /webhook/call_status HTTP/1.1" 204 No Content
17:16:44 web.1     | âœ… Recording queued for processing: CAfc7f99614ed4bf85c3c4b15cc26cf5ff
17:16:45 web.1     | â³ [POLITE HANGUP] TX queue still has 5 frames...
17:16:45 web.1     | âŒ Receive error: (<CloseCode.NO_STATUS_RCVD: 1005>, '')
17:16:45 web.1     | ğŸ”§ receive_loop ended
17:16:45 web.1     | INFO:     connection closed
17:16:45 web.1     | ğŸ”§ send_loop ended
17:16:46 web.1     | â³ [POLITE HANGUP] TX queue still has 5 frames...
^[[B^[[B17:16:47 web.1     | â³ [POLITE HANGUP] TX queue still has 5 frames...
17:16:47 web.1     | âš ï¸ Background thread 0 still running after timeout
17:16:48 web.1     | â³ [POLITE HANGUP] TX queue still has 5 frames...
^[[B17:16:49 web.1     | â³ [POLITE HANGUP] TX queue still has 5 frames...
^[[B17:16:50 web.1     | âœ… CALL FINALIZED: CAfc7f99614ed4bf85c3c4b15cc26cf5ff
17:16:50 web.1     | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
17:16:50 web.1     | ×¤× ×™×™×” ×‘×ª×—×•× ×”× ×“×œ"×Ÿ ×•×ª×™×•×•×š.
17:16:50 web.1     | 
17:16:50 web.1     | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
17:16:50 web.1     | ×”×œ×§×•×— ×—×™×¤×© ××™×“×¢ ×¢×œ × ×›×¡×™× ×‘×¢×™×¨ ×©××™× ×” × ×ª××›×ª ×¢×œ ×™×“×™ ×”×¢×¡×§. ×œ× × ××¡×¨×• ×¤×¨×˜×™× ×¢×œ ×¡×•×’ ×”× ×›×¡, ××–×•×¨ ×¡×¤×¦×™×¤×™, ×ª×§×¦×™×‘ ××• ×“×¨×™×©×•×ª × ×•×¡×¤×•×ª.
17:16:50 web.1     | 
17:16:50 web.1     | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
17:16:50 web.1     | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×§×©×¨ ××• ×©× ×”×œ×§×•×—.
17:16:50 web.1     | 
17:16:50 web.1     | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
17:16:50 web.1     | - ×œ× × ×§×‘×¢×” ×¤×’×™×©×” ××• ×¤×¢×•×œ×” × ×•×¡×¤×ª.
17:16:50 web.1     | - ×“×—×™×¤×•×ª: × ××•×›×”, ×××—×¨ ×•×”×œ×§×•×— ×œ× ×§×™×‘×œ ××¢× ×” ×œ×©××œ×•×ª×™×•.
17:16:50 web.1     | - ×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª ××”×¢×¡×§: ×œ×©×§×•×œ ×”×¨×—×‘×ª ×”×ª××—×•×ª ×œ××–×•×¨×™× × ×•×¡×¤×™× ××• ×œ×¡×¤×§ ××™×“×¢ ×¢×œ ×¢×¨×™× × ×ª××›×•×ª.
17:16:50 web.1     | 
17:16:50 web.1     | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
17:16:50 web.1     | ×™×© ×œ×©×§×•×œ ×œ×¢×“×›×Ÿ ××ª ×”××™×“×¢ ×‘××ª×¨ ××• ×‘××¢×¨×›×•×ª ×”×ª××™×›×” ×›×“×™ ×œ×× ×•×¢ ×—×•×•×™×•×ª ×“×•××•×ª ×‘×¢×ª×™×“. ×›×“××™ ×’× ×œ×©×§×•×œ ×œ×”×¦×™×¢ ×¤×ª×¨×•× ×•×ª ×—×œ×•×¤×™×™× ×œ×œ×§×•×—×•×ª ×”×¤×•× ×™× ×××–×•×¨×™× ×œ× × ×ª××›×™×.
17:16:50 web.1     | ğŸ¯ Intent: general_inquiry
17:16:50 web.1     | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
17:16:50 web.1     | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
17:16:50 web.1     | âœ… Background thread 4 completed
17:16:50 web.1     | âœ… All background threads cleanup complete
17:16:50 web.1     | 
17:16:50 web.1     | ================================================================================
17:16:50 web.1     | ğŸ’°ğŸ’°ğŸ’° [CALL COST SUMMARY] ğŸ’°ğŸ’°ğŸ’°
17:16:50 web.1     | ================================================================================
17:16:50 web.1     | ğŸ“ Model: gpt-4o-realtime-preview
17:16:50 web.1     | â±ï¸  Total duration: 22.3s (0.4 min)
17:16:50 web.1     | ğŸ™ï¸  Audio IN (user speaking): 118 chunks (0.039 min)
17:16:50 web.1     |    â””â”€ Cost: 0.039 min Ã— $0.06/min = $0.0024
17:16:50 web.1     | ğŸ”Š Audio OUT (AI speaking): 24 chunks (0.008 min)
17:16:50 web.1     |    â””â”€ Cost: 0.008 min Ã— $0.24/min = $0.0019
17:16:50 web.1     | â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
17:16:50 web.1     | ğŸ’µ TOTAL COST: $0.0043 (â‰ˆ â‚ª0.02)
17:16:50 web.1     | ================================================================================
17:16:50 web.1     | 
17:16:50 web.1     | WS_DONE sid=MZ54ca917743d34740f8cfaded2793c86e rx=839 tx=545
17:16:50 web.1     | âœ… MediaStreamHandler completed
17:16:50 web.1     | âœ… Handler thread join completed
^[[B17:16:50 web.1     | â³ [POLITE HANGUP] TX queue still has 5 frames...
17:16:50 web.1     | âœ… [FALLBACK] pending_hangup already set - normal flow working
17:16:51 web.1     | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
^[[B^[[B^[[B17:16:53 web.1     | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
17:16:53 web.1     | ğŸ›¡ï¸ [PROTECTION] BLOCKING hangup - 5 frames in Twilio TX queue!