prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ªâ€”××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×§×¨×™×™×ª ××ª×, × ×›×•×Ÿ?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.30s (119 chunks)
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 0.6s audio, conversation #9
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=9600 | silence_ms=642
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #9
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=9, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 2700 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ”’ [CONSISTENCY] City locked to '×§×¨×™×ª ××ª×.' (majority 2/3)
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×§×¨×™×™×ª ××ª×
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ××ª×', 'raw_city': '×§×¨×™×ª ××ª×.', 'city_confidence': '91.64705882352942', 'city_autocorrected': 'True', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××ª ×’×Ÿ', 'city_needs_confirmation': 'True'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×§×¨×™×™×ª ××ª×
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ××ª×', 'raw_city': '×§×¨×™×™×ª ××ª×', 'city_confidence': '91.64705882352942', 'city_autocorrected': 'True', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××ª ×’×Ÿ', 'city_needs_confirmation': 'True'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ××ª×', 'raw_city': '×§×¨×™×™×ª ××ª×', 'city_confidence': '100.0', 'city_autocorrected': 'True', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××ª ×’×Ÿ', 'city_needs_confirmation': 'True'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_autocorrected=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ××ª×', 'raw_city': '×§×¨×™×™×ª ××ª×', 'city_confidence': '100.0', 'city_autocorrected': 'True', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×¨××ª ×’×Ÿ', 'city_needs_confirmation': 'True'}
prosaas-backend  | ğŸ”’ [CITY] Majority locked: '×§×¨×™×™×ª ××ª×' from ['×©×œ×•×!', '×—×›×, ×¤×•×¨×¥', '×¢×™×¨', '×—×›×, ×¤×•×¨×¥', '×ª×œ ××‘×™×‘', '××•×§×™×™,', '×¢×•× ×”', '×¢×–×¨×”?', '×× ×¢×•×œ×Ÿ.', '×¢×™×¨', '××˜ ×œ××˜', '×¨××ª ×’×Ÿ', '×× ×¢×•×œ×Ÿ,', '×§×¨×™×ª ××ª×.', '×§×¨×™×™×ª ××ª×']
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×§×¨×™×™×ª ××ª×
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ××ª×', 'raw_city': '×§×¨×™×™×ª ××ª×', 'city_confidence': '100.0', 'city_autocorrected': 'True', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×§×¨×™×™×ª ××ª×', 'city_needs_confirmation': 'True'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×§×¨×™×™×ª ××ª×
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ªâ€”××ª×” ×¦×¨×™×š ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=665.0 > threshold=108.0
prosaas-backend  | [PIPELINE STATUS] sent=837 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 2800 frames (rms=33, reason=noise)
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.0s audio, conversation #10
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=16320 | silence_ms=519
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #10
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjSgXf7fmNjMN11...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjSgXf7fmNjMN11... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 5063ms gap between chunks #119 and #120 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª.' (len=30)
prosaas-backend  | ğŸ”§ [BUILD 204] Vocabulary fix: '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª.' â†’ '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.' (corrections: {'×× ×¢×•×œ': '×× ×¢×•×œ×Ÿ', '×—×›×': '×× ×¢×•×œ ×—×›×', '×¤×•×¨×¥': '×¤×•×¨×¥ ×“×œ×ª×•×ª', '×“×œ×ª×•×ª': '×¤×•×¨×¥ ×“×œ×ª×•×ª'})
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥...' despite low RMS=8)
prosaas-backend  | [GIBBERISH] Detected: '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.' | Reason: repeated_pattern: '×× ×¢' x3 | Confidence: 70%
prosaas-backend  | [NOISE FILTER] âŒ REJECTED (gibberish): '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.'
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | WS_STOP sid=MZ5f70a3cb7dccbcedc3f6f5d45dae7567 rx=3928 tx=1950
prosaas-backend  | ğŸ“ [SES-7d3a1c42] CALL ENDED - duration=78.6s, business_id=10, rx=3928, tx=1950
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | STREAM_ENDED call=CAda3f54937e543006632054ee9f7aff13 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.5:42946 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | âœ… Found existing recording for CAda3f54937e543006632054ee9f7aff13: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REe5135279fd4b371a242add8324b29c31.json
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | INFO:     172.18.0.5:42956 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | âœ… Recording queued for processing: CAda3f54937e543006632054ee9f7aff13
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 11 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ××œ×™×š ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª. ×ª×•×“×” ×•×œ×”×ª×¨××•×ª.
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.43s (144 chunks)
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | ğŸ”„ [CONSISTENCY] User correction detected: '××œ×™×š' differs from locked '×§×¨×™×ª ××ª×.'
prosaas-backend  | ğŸ”“ [CONSISTENCY] City UNLOCKED from '×§×¨×™×ª ××ª×.' (reason: user_said_××œ×™×š)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ××ª×', 'raw_city': '×§×¨×™×™×ª ××ª×', 'city_confidence': '100.0', 'city_autocorrected': 'True', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×§×¨×™×™×ª ××ª×', 'city_needs_confirmation': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '××œ×™×š' (confidence=84%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] Clear goodbye detected: '××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™×...'
prosaas-backend  | âœ… [HANGUP BUILD 176] AI said goodbye with auto_end_on_goodbye=True + user interaction - disconnecting
prosaas-backend  | ğŸ“ [STATE] Transitioning ACTIVE â†’ CLOSING (reason: ai_goodbye_auto_end)
prosaas-backend  | ğŸ“ [BUILD 163] Pending hangup set - will disconnect after audio finishes playing
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 11 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | âœ… CALL FINALIZED: CAda3f54937e543006632054ee9f7aff13
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×œ×§×•×— ××—×¤×© ×©×™×¨×•×ª×™ ×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×§×¨×™×™×ª ××ª×.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | - ×¡×•×’ ×”×©×™×¨×•×ª: ×× ×¢×•×œ×Ÿ
prosaas-backend  | - ××™×§×•×: ×§×¨×™×™×ª ××ª×
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×§×©×¨ ××• ×©× ×”×œ×§×•×—.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - ×”×œ×§×•×— ×–×§×•×§ ×œ×©×™×¨×•×ª ×× ×¢×•×œ×Ÿ, ×•×”×¢×•×–×¨ ××™×©×¨ ×›×™ ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ××œ×™×• ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª.
prosaas-backend  | - ×“×—×™×¤×•×ª: ×’×‘×•×”×”, ×¢×§×‘ ×”×¦×•×¨×š ×‘×©×™×¨×•×ª ××™×™×“×™.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×™×© ×œ×•×•×“× ×©×”×× ×¢×•×œ×Ÿ ×”××•××œ×¥ ××ª××—×” ×‘×©×™×¨×•×ª×™× ×”× ×“×¨×©×™× ×•×™×›×•×œ ×œ×”×’×™×¢ ×‘××”×™×¨×•×ª ×œ×§×¨×™×™×ª ××ª×. ××•××œ×¥ ×œ×¢×§×•×‘ ××—×¨×™ ×”×¤× ×™×™×” ×•×œ×•×•×“× ×©×”×œ×§×•×— ×§×™×‘×œ ××ª ×”×©×™×¨×•×ª ×”× ×“×¨×©.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ5f70a3cb7dccbcedc3f6f5d45dae7567 rx=3928 tx=1950
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Extracted SPECIFIC service from AI confirmation: '×× ×¢×•×œ×Ÿ'
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ××ª×', 'raw_city': '×§×¨×™×™×ª ××ª×', 'city_confidence': '100.0', 'city_autocorrected': 'True', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×§×¨×™×™×ª ××ª×', 'city_needs_confirmation': 'True'}
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CAda3f54937e543006632054ee9f7aff13, phone=+972504294724, city=×§×¨×™×™×ª ××ª×, direction=inbound
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×§×¨×™×™×ª ××ª×, service=×× ×¢×•×œ×Ÿ
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | âœ… call_log created immediately for CA2d6869a0896c8a38b360a7735774617f
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CA2d6869a0896c8a38b360a7735774617f
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CA2d6869a0896c8a38b360a7735774617f
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1304ms - CA2d6869a0896c8a
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CA2d6869a0896c8a38b360a7735774617f" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.5:42960 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.5:42968 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-24721b45
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764951070.087] WS_START sid=MZ3f2dd3303faab31db395f80bf4b3d484 call_sid=CA2d6869a0896c8a38b360a7735774617f from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CA2d6869 (FRESH SESSION)
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 926ms (T0+927ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 1058ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=15s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1163ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CA2d6869a0896c8a38b360a7735774617f
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread started
prosaas-backend  | ğŸ¯ [T1=1764951071.252] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1165ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=9.2, threshold=109.2)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 241ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=coral for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | ğŸ¤ [BUILD 204] Dynamic STT prompt: '×ª××œ×œ ×¢×‘×¨×™×ª ×‘×©×™×—×” ×˜×œ×¤×•× ×™×ª. ×¢×¡×§: ×§×œ×™×‘×¨. ××™×œ×™×: ×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª. ×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.' (95 chars)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1168ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=coral
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764951071.256
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (GREETING)
prosaas-backend  | ğŸ¯ [BUILD 200] GREETING response.create sent! OpenAI time: 1168ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | [PIPELINE] LIVE AUDIO PIPELINE ACTIVE: Twilio â†’ realtime_audio_in_queue â†’ send_audio_chunk (single path)
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjSghTajzuPhVtn...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjSghTajzuPhVtn... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Call log already exists for CA2d6869a0896c8a38b360a7735774617f
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Recording started for CA2d6869a0896c8a38b360a7735774617f: REe049218ffbbfcad80df8b83b63a42e25
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ“ [PROMPT] Final length: 2367 chars
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764951072.887 (duration: 1632ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | â³ [BUILD 303] Waiting for user's first response to greeting...
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=15s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=2340.0 > threshold=109.2
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=67 60 5e 5d 5d, rms=198, consec_frames=3
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=55 ee d5 66 57, rms=256, consec_frames=3
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=1e 21 3e 5c 4f, rms=4098, consec_frames=3
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=15, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1645ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | [PIPELINE STATUS] sent=1 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 2.1s - now updating session
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated: 2367 chars, voice=coral, max_tokens=4096, stt=gpt-4o-transcribe+Hebrew
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=24, voice_frames=0
prosaas-backend  | INFO:     127.0.0.1:52182 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.1s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=17600 | silence_ms=523
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjSglA4rUmx6ZA0...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjSglA4rUmx6ZA0... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×§×œ×™×‘×¨.' (len=6)
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | INFO:     172.18.0.5:47580 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×§×œ×™×‘×¨....' despite low RMS=8)
prosaas-backend  | âœ… [BUILD 303 PATIENCE] Bypassing gibberish check for utterance #1: '×§×œ×™×‘×¨.' (hebrew_chars=5)
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED (has Hebrew): '×§×œ×™×‘×¨.'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×§×œ×™×‘×¨.' (hebrew=5, english=0)
prosaas-backend  | [STT_FINAL] '×§×œ×™×‘×¨.' (from raw: '×§×œ×™×‘×¨....')
prosaas-backend  | ğŸ’° [COST] User utterance: 1.85s (48 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×§×œ×™×‘×¨.
prosaas-backend  | âœ… [BUILD 303] First post-greeting utterance: '×§×œ×™×‘×¨....' - processing as answer to greeting question
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×™×‘×¨' (confidence=77%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×§×œ×™×‘×¨....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×§×œ×™×‘×¨....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 2
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×§×œ×™×‘×¨.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 42610002...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=42610002...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×§×œ×™×‘×¨....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...[SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | 
prosaas-backend  | ğŸ” [NLP] Conversation history has 2 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?', 'ts': 1764951072.8876889}, {'speaker': 'user', 'text': '×§×œ×™×‘×¨.', 'ts': 1764951076.3838909}]
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=e4 de e5 ea f4
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=d2 c0 cb cc ce
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=fe fe 7e 7e fd
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.40s (7 chunks)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨' (confidence=54%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 200 frames (rms=8, reason=noise)
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=424.0 > threshold=109.2
prosaas-backend  | [PIPELINE STATUS] sent=49 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=9, voice_frames=0
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 0.7s audio, conversation #1
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=10560 | silence_ms=503
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #1
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjSgpQaaHxveQ49...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjSgpQaaHxveQ49... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 2577ms gap between chunks #7 and #8 - OpenAI delay!
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª.' (len=30)
prosaas-backend  | ğŸ”§ [BUILD 204] Vocabulary fix: '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª.' â†’ '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.' (corrections: {'×× ×¢×•×œ': '×× ×¢×•×œ×Ÿ', '×—×›×': '×× ×¢×•×œ ×—×›×', '×¤×•×¨×¥': '×¤×•×¨×¥ ×“×œ×ª×•×ª', '×“×œ×ª×•×ª': '×¤×•×¨×¥ ×“×œ×ª×•×ª'})
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥...' despite low RMS=11)
prosaas-backend  | âœ… [BUILD 303 PATIENCE] Bypassing gibberish check for utterance #2: '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.' (hebrew_chars=38)
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED (has Hebrew): '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.' (hebrew=38, english=0)
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (3383ms)
prosaas-backend  | [STT_FINAL] '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.' (from raw: '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª....')
prosaas-backend  | ğŸ’° [COST] User utterance: 1.69s (94 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=9, voice_frames=0
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 300 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=104, voice_frames=0
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×—×›×, ×¤×•×¨×¥' (confidence=78%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 4
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×§×œ×™×‘×¨.', '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: f622841e...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (42610002 â†’ f622841e) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=f622841e...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 4 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×§×œ×™×‘×¨.', 'ts': 1764951076.3838909}, {'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764951077.1050086}, {'speaker': 'user', 'text': '×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ×Ÿ ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.', 'ts': 1764951079.766584}]
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | âš ï¸ [AUDIO GAP] 1660ms gap between chunks #9 and #10 - OpenAI delay!
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 11 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª ×‘×ª×œ ××‘×™×‘, × ×›×•×Ÿ?
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.71s (26 chunks)
prosaas-backend  | WS_STOP sid=MZ3f2dd3303faab31db395f80bf4b3d484 rx=590 tx=345
prosaas-backend  | ğŸ“ [SES-24721b45] CALL ENDED - duration=11.8s, business_id=10, rx=590, tx=345
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CA2d6869a0896c8a38b360a7735774617f stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.5:47586 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CA2d6869a0896c8a38b360a7735774617f: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REe049218ffbbfcad80df8b83b63a42e25.json
prosaas-backend  | INFO:     172.18.0.5:59690 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CA2d6869a0896c8a38b360a7735774617f
prosaas-backend  | INFO:     connection closed
prosaas-backend  | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
prosaas-backend  | ğŸ“ [BUILD 303] SMART HANGUP - Scheduling goodbye before disconnect...
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (SILENCE_HANDLER:[SYSTEM] ×”×©×™×—×” ××¡×ª×™×™××ª. ×××•×¨: )
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjSgty4JEqVgxZ4...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjSgty4JEqVgxZ4... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×–×¨×”' (confidence=57%) - ask to repeat
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª ×‘×ª×œ ××‘×™×‘
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª ×‘×ª×œ ××‘×™×‘'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª ×‘×ª×œ ××‘×™×‘
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¢×–×¨×” ×‘×× ×¢...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 20190ms gap between chunks #144 and #145 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 51 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | â­ï¸ [LOOP GUARD] Skipped - call is ending (closing=True, hangup=False)
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.82s (159 chunks)
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×§×¨×™×™×ª ××ª×', 'raw_city': '×§×¨×™×™×ª ××ª×', 'city_confidence': '100.0', 'city_autocorrected': 'True', 'service_type': '×× ×¢×•×œ×Ÿ ×‘×¢×™×¨ ×§×¨×™×™×ª ××ª×', 'city_needs_confirmation': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 51 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… CALL FINALIZED: CA2d6869a0896c8a38b360a7735774617f
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×”×¤× ×™×™×” ×”×™× ×‘×ª×—×•× ×”×× ×¢×•×œ× ×•×ª, ×”×œ×§×•×— ××—×¤×© ×©×™×¨×•×ª×™ ×× ×¢×•×œ×Ÿ ×‘×ª×œ ××‘×™×‘.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | ×”×œ×§×•×— ××¢×•× ×™×™×Ÿ ×‘×©×™×¨×•×ª×™× ×”×‘××™×:
prosaas-backend  | - ×× ×¢×•×œ×Ÿ
prosaas-backend  | - ×× ×¢×•×œ ×—×›×
prosaas-backend  | - ×¤×¨×™×¦×ª ×“×œ×ª×•×ª
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×©× ×”×œ×§×•×— ×œ× × ××¡×¨, ××š ×”×•× ×–×™×”×” ××ª ×¢×¦××• ×›××™ ×©×–×§×•×§ ×œ×©×™×¨×•×ª×™ ×× ×¢×•×œ×Ÿ.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - ×œ× × ×§×‘×¢×” ×¤×’×™×©×” ××• ×ª×•×¨ ×‘×©×™×—×” ×–×•.
prosaas-backend  | - ×“×—×™×¤×•×ª: ×’×‘×•×”×”, ×”×œ×§×•×— ×–×§×•×§ ×œ×©×™×¨×•×ª×™ ×× ×¢×•×œ×Ÿ ×‘××•×¤×Ÿ ××™×™×“×™.
prosaas-backend  | - ×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª: ×™×© ×œ×™×¦×•×¨ ×§×©×¨ ×¢× ×”×œ×§×•×— ×‘×”×§×“× ×”××¤×©×¨×™ ×›×“×™ ×œ×§×‘×•×¢ ××•×¢×“ ×©×™×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×—×©×•×‘ ×œ×”×“×’×™×© ××ª ×”×¦×•×¨×š ×‘×× ×¢×•×œ ×—×›×, ××” ×©××¢×™×“ ×¢×œ ×œ×§×•×— ×©××—×¤×© ×¤×ª×¨×•× ×•×ª ××ª×§×“××™×. ×™×© ×œ×”×™×¢×¨×š ×œ×¡×¤×§ ×©×™×¨×•×ª ××”×™×¨ ×•×™×¢×™×œ ×‘×ª×œ ××‘×™×‘.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ3f2dd3303faab31db395f80bf4b3d484 rx=590 tx=346
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Extracted SPECIFIC service from AI confirmation: '×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª'
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True', 'service_type': '×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª ×‘×ª×œ ××‘×™×‘'}
prosaas-backend  |    â””â”€ City from transcript (fuzzy): ×‘× ×™ ×‘×¨×§ (confidence=90%)
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CA2d6869a0896c8a38b360a7735774617f, phone=+972504294724, city=×‘× ×™ ×‘×¨×§, direction=inbound
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×‘× ×™ ×‘×¨×§, service=×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=51, tx_q=147) retry #10
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=51, tx_q=147) retry #20
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 16.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city'] | Collected: ['service_type=×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª ×‘×ª×œ ××‘×™×‘']
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (SILENCE_HANDLER:[SYSTEM] User has been silent.)
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjSh9splbGZmHa7...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjSh9splbGZmHa7... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 18361ms gap between chunks #26 and #27 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 30 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××ª×” ×¢×“×™×™×Ÿ ××™×ª×™?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.22s (31 chunks)
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 147 frames...
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×¢×“×™
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª ×‘×ª×œ ××‘×™×‘', 'city': '×¢×“×™'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×¢×“×™×™×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª ×‘×ª×œ ××‘×™×‘', 'city': '×¢×“×™', 'raw_city': '×¢×“×™×™×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=90.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª ×‘×ª×œ ××‘×™×‘', 'city': '×¢×“×™', 'raw_city': '×¢×“×™×™×Ÿ', 'city_confidence': '90.0'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_confirmation=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¢×–×¨×” ×‘×× ×¢×•×œ× ×•×ª ×‘×ª×œ ××‘×™×‘', 'city': '×¢×“×™', 'raw_city': '×¢×“×™×™×Ÿ', 'city_confidence': '90.0', 'city_needs_confirmation': 'True'}
prosaas-backend  | âš ï¸ [CITY] Needs confirmation: '×¢×“×™' (confidence=90%)
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '××ª×” ×¢×“×™×™×Ÿ ××™×ª×™?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 30 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=51, tx_q=147) retry #30
prosaas-backend  | âš ï¸ [BUILD 178] Max hangup retries exceeded - forcing hangup
prosaas-backend  | INFO:     127.0.0.1:53356 - "GET /health HTTP/1.1" 200 OK
p