×œ×”×œ×Ÿ ×”× ×—×™×” ××—×ª, ×¡×•×¤×™×ª ×•××“×•×™×§×ª ×œ×¡×•×›×Ÿ ×”-AI ×©×œ×š â€” ××•×ª×××ª ×œ×¤×¨×•×™×§×˜ ×”× ×•×›×—×™ (Flask + Node + React) ×•×œ××” ×©××¦××ª×™ ××¦×œ×š.
×”××˜×¨×”: 100% ××•×›× ×•×ª ×œ×¤×¨×•×“×§×©×Ÿ ×‘×œ×™ ×œ×©×‘×•×¨ ×›×œ×•× ×‘×§×•×“ ×•×‘-UI.

ğŸ›‘ ×›×œ×œ×™ ×‘×¨×–×œ ×œ×¤× ×™ ×©××ª×—×™×œ×™×
	1.	××™×Ÿ ×œ×™×¦×•×¨ ×§×‘×¦×™× ×›×¤×•×œ×™×. ×× ×™×© ×§×•×‘×¥ â€œ×™×©×Ÿâ€ ×•â€œ××©×•×¤×¨â€ â€” ×××—×“×™× ×œ×§×•×‘×¥ ×§× ×•× ×™ ×™×—×™×“.
	2.	×œ× ××©× ×™× ×¢×™×¦×•×‘ ××—×•×¥ ×œ××” ×©××•×’×“×¨: RTL, ×¤×•× ×˜ Assistant, ××¨×•×•×—×™×, ×˜×•×§× ×™×.
	3.	×œ× ××©× ×™× ×©××•×ª API ×§×™×™××™× ×œ×¦×¨×›×™ ×œ×§×•×— â€” ×¨×§ ×××—×“×™×/××¡×“×™×¨×™× ××ª ×”×¤× ×™×-××¢×¨×›×ª×™.
	4.	×›×œ ×©×™× ×•×™ ××œ×•×•×” ×‘-×‘×“×™×§×•×ª + ×¨××™×•×ª GO ×‘×¡×•×£ (×¨××• ×¡×¢×™×£ 9).

â¸»

0) ××™×¤×•×™ ××”×™×¨ (×—×•×‘×” ×œ×¤× ×™ ×›×ª×™×‘×”)
	1.	×‘×¦×¢ ripgrep/×§×•×“-×¡×¨×¦â€™ ×¢×œ:
	â€¢	routes.py, routes_whatsapp.py, whatsapp_routes.py, api_routes.py, baileys_integration.py, baileys_client.js, whisper_handler.py, background_processor.py, enhanced_crm_service.py, notification_service.py.
	2.	×¨×©×•× ×›×œ × ×ª×™×‘ WhatsApp ××©×•×›×¤×œ/×—×•×¤×£. ×¡××Ÿ ××™ ×”×§× ×•× ×™ (×™×”×™×” routes_whatsapp.py).
	3.	×××ª ×©×§×™×™××™× ×“×¤×™ React: ×“×£ ×—×™×‘×•×¨ WhatsApp (×× ×—×¡×¨ â€” × ×™×¦×•×¨) + ×©××¨ CRM.

×¤×œ×˜ × ×“×¨×© ××—×¨×™ ×¡×¢×™×£ 0: ×¨×©×™××ª × ×ª×™×‘×™× ×›×¤×•×œ×™× ×•××” ×™×™××—×§/×™×™××•×–×’, ×‘×œ×™ ×œ×’×¢×ª ×¢×“×™×™×Ÿ ×‘×§×•×“.

â¸»

1) WhatsApp/Baileys â€” ×œ×”×¤×•×š ×œ×¡×¨×•×•×™×¡ ×™×¦×™×‘ ×•×¨×‘-×¢×¡×§×™

××˜×¨×”: ×œ×”×¤×¡×™×§ ××•×“ â€œ×¡×§×¨×™×¤×˜â€ ×•×œ×‘× ×•×ª ×©×™×¨×•×ª Express ××™× ×™××œ×™, Multi-Tenant, ×¢× QR â€œ×××™×ª×™â€, Health ×•-Webhook ×œ-Flask.

1.1 ×§×‘×¦×™× ×•××‘× ×”
	â€¢	×”×–×–/×©×“×¨×’ ××ª baileys_client.js ×œ× ×ª×™×‘ ×§× ×•× ×™:
services/whatsapp/baileys_service.js  (××œ ×ª×™×¦×•×¨ ×¢×•×ª×§×™× × ×•×¡×¤×™×).
	â€¢	×ª×™×§×™×•×ª ×§×‘×¢:
	â€¢	Auth ×¤×¨-×¢×¡×§: storage/whatsapp/<tenantId>/auth/
	â€¢	×œ×•×’×™×: logs/whatsapp-<tenantId>.log

1.2 ×§×•×“ ×©×™×¨×•×ª (×”×—×œ×£ ×ª×•×›×Ÿ ×§×™×™× ×‘×¡×¨×•×•×™×¡ ×”×—×“×©)

// services/whatsapp/baileys_service.js
const express = require('express');
const cors = require('cors');
const QRCode = require('qrcode');
const { default: makeWASocket, useMultiFileAuthState, DisconnectReason } = require('@whiskeysockets/baileys');
const fs = require('fs');
const path = require('path');

const app = express();
app.use(cors());
app.use(express.json());

const PORT = process.env.BAILEYS_PORT || 3001;
const INTERNAL_SECRET = process.env.INTERNAL_SECRET;
if (!INTERNAL_SECRET) { console.error('INTERNAL_SECRET missing'); process.exit(1); }

const sessions = new Map(); // tenantId -> { sock, state, qrDataUrl, connected, pushName }

function authDir(tenantId) {
  return path.join(process.cwd(), 'storage', 'whatsapp', tenantId, 'auth');
}

async function startSession(tenantId) {
  if (sessions.get(tenantId)?.sock) return sessions.get(tenantId);

  fs.mkdirSync(authDir(tenantId), { recursive: true });
  const { state, saveCreds } = await useMultiFileAuthState(authDir(tenantId));

  const sock = makeWASocket({ auth: state, printQRInTerminal: false });
  const session = { sock, state, saveCreds, qrDataUrl: '', connected: false, pushName: '' };
  sessions.set(tenantId, session);

  sock.ev.on('creds.update', saveCreds);
  sock.ev.on('connection.update', async (update) => {
    const { connection, lastDisconnect, qr } = update;
    if (qr) session.qrDataUrl = await QRCode.toDataURL(qr);

    if (connection === 'open') {
      session.connected = true;
      session.pushName = sock?.user?.name || sock?.user?.id || '';
      session.qrDataUrl = '';
    }
    if (connection === 'close') {
      session.connected = false;
      const shouldReconnect = (lastDisconnect?.error?.output?.statusCode !== DisconnectReason.loggedOut);
      if (shouldReconnect) setTimeout(() => startSession(tenantId), 2000);
    }
  });

  // ×”×•×“×¢×•×ª × ×›× ×¡×•×ª â†’ ×©×œ×— ×œ-Flask Webhook
  sock.ev.on('messages.upsert', async (m) => {
    try {
      await fetch(`${process.env.FLASK_BASE_URL}/webhook/whatsapp/incoming`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'X-Internal-Secret': INTERNAL_SECRET },
        body: JSON.stringify({ tenantId, payload: m })
      });
    } catch (e) { /* ignore */ }
  });

  return session;
}

function requireSecret(req, res, next) {
  if (req.header('X-Internal-Secret') !== INTERNAL_SECRET) return res.status(401).json({ error: 'unauthorized' });
  next();
}

app.get('/healthz', (req, res) => res.status(200).send('ok'));

app.post('/whatsapp/:tenantId/start', requireSecret, async (req, res) => {
  const { tenantId } = req.params;
  await startSession(tenantId);
  res.json({ ok: true });
});

app.get('/whatsapp/:tenantId/status', requireSecret, (req, res) => {
  const s = sessions.get(req.params.tenantId);
  res.json({ connected: !!s?.connected, pushName: s?.pushName || '', hasQR: !!s?.qrDataUrl });
});

app.get('/whatsapp/:tenantId/qr', requireSecret, (req, res) => {
  const s = sessions.get(req.params.tenantId);
  if (s?.qrDataUrl) return res.json({ dataUrl: s.qrDataUrl });
  return res.status(404).json({ error: 'no qr' });
});

app.post('/whatsapp/:tenantId/logout', requireSecret, async (req, res) => {
  const { tenantId } = req.params;
  const s = sessions.get(tenantId);
  if (s?.sock?.logout) await s.sock.logout();
  sessions.delete(tenantId);
  res.json({ ok: true });
});

app.listen(PORT, () => console.log(`Baileys service on ${PORT}`));

1.3 package.json (×¡×§×¨×™×¤×˜ ×¨×™×¦×”)

×”×•×¡×£/×¢×“×›×Ÿ:

{
  "scripts": {
    "start:baileys": "node services/whatsapp/baileys_service.js"
  },
  "dependencies": {
    "@whiskeysockets/baileys": "^6",
    "express": "^4",
    "cors": "^2",
    "qrcode": "^1"
  }
}

1.4 ENV ×”×›×¨×—×™×™× (×‘-Replit/Prod)

BAILEYS_PORT=3001
INTERNAL_SECRET=<random-long-secret>
FLASK_BASE_URL=http://localhost:5000


â¸»

2) Flask â€” ×¤×¨×•×§×¡×™ ×§× ×•× ×™ + ××™×—×•×“ ×¨××•×˜×™× WhatsApp

××˜×¨×”: ×§×•×‘×¥ ×§× ×•× ×™ ×™×—×™×“ ×œ-WhatsApp. ×›×œ ×”×©××¨ â€” × ×›×‘×”/× ××–×’.

2.1 ×§×•×‘×¥ ×§× ×•× ×™

×”×©×ª××© ×‘-routes_whatsapp.py ×›×‘×¡×™×¡ ×™×—×™×“.
×‘×¦×¢:
	â€¢	×”×¢×‘×¨/×”×¢×ª×§ ×œ×ª×•×›×• ××ª ×›×œ × ×ª×™×‘×™ WhatsApp ××”×§×‘×¦×™×: routes.py, whatsapp_routes.py, api_routes.py, baileys_integration.py â€” ×›×š ×©×œ× ×™×™×©××¨×• ×›×¤×™×œ×•×™×•×ª.
	â€¢	×”×©××¨ ××ª webhook ×©×œ Twilio WhatsApp (×× ×™×©), ×•××ª ×”-Proxy ×œ-Baileys.

2.2 ×¤×¨×•×§×¡×™ ×œ-Baileys (×”×•×¡×£/×¢×“×›×Ÿ ×‘×§× ×•× ×™)

# routes_whatsapp.py
import os, requests
from flask import Blueprint, jsonify, request
from flask_wtf.csrf import CSRFProtect
from flask import current_app as app

whatsapp_bp = Blueprint('whatsapp', __name__, url_prefix='/api/whatsapp')
BAILEYS_BASE = os.getenv('BAILEYS_BASE_URL', 'http://localhost:3001')
INT_SECRET = os.getenv('INTERNAL_SECRET')

def tenant_id_from_ctx():
    # ×©×œ×•×£ tenant_id ××”-session/JWT ×›×¤×™ ×©×§×™×™× ××¦×œ×š ×”×™×•×
    return getattr(request, 'tenant_id', None) or request.headers.get('X-Tenant-Id')

def _headers():
    return {'X-Internal-Secret': INT_SECRET, 'Content-Type': 'application/json'}

@whatsapp_bp.route('/status', methods=['GET'])
def status():
    t = tenant_id_from_ctx()
    r = requests.get(f"{BAILEYS_BASE}/whatsapp/{t}/status", headers=_headers(), timeout=5)
    return jsonify(r.json()), r.status_code

@whatsapp_bp.route('/qr', methods=['GET'])
def qr():
    t = tenant_id_from_ctx()
    r = requests.get(f"{BAILEYS_BASE}/whatsapp/{t}/qr", headers=_headers(), timeout=5)
    if r.status_code == 404:
        return ('', 204)
    return jsonify(r.json()), r.status_code

@whatsapp_bp.route('/start', methods=['POST'])
def start():
    t = tenant_id_from_ctx()
    r = requests.post(f"{BAILEYS_BASE}/whatsapp/{t}/start", headers=_headers(), timeout=5)
    return jsonify(r.json()), r.status_code

@whatsapp_bp.route('/logout', methods=['POST'])
def logout():
    t = tenant_id_from_ctx()
    r = requests.post(f"{BAILEYS_BASE}/whatsapp/{t}/logout", headers=_headers(), timeout=5)
    return jsonify(r.json()), r.status_code

×©×™× ×œ×‘: ×× ×™×© CSRF ×’×œ×•×‘×œ×™ â€” ×”×—×¨×’ ×¨×§ ××ª ××¨×‘×¢×ª ×”× ×ª×™×‘×™× ×”××œ×”: /api/whatsapp/(status|qr|start|logout).

2.3 Webhook ×-Baileys (×”×•×“×¢×•×ª × ×›× ×¡×•×ª)

×‘-Flask ×¦×•×¨/××©×¨:

# routes_whatsapp.py (××• webhook_bp ×™×™×¢×•×“×™)
from flask import Blueprint, request, jsonify
webhook_bp = Blueprint('whatsapp_webhook', __name__, url_prefix='/webhook/whatsapp')

@webhook_bp.route('/incoming', methods=['POST'])
def incoming():
    if request.headers.get('X-Internal-Secret') != os.getenv('INTERNAL_SECRET'):
        return jsonify({'error':'unauthorized'}), 401
    data = request.json or {}
    # TODO: ×©××™×¨×” ×œ-CRM Timeline/DB ×œ×¤×™ ×”××‘× ×” ×©×œ×š
    return jsonify({'ok': True})

2.4 ×›×™×‘×•×™ ×›×¤×™×œ×•×™×•×ª
	â€¢	×‘×˜×œ/×”×¡×¨ ×¨×™×©×•× Blueprint/Routes ××—×¨×™× ×©× ×’×¢×• ×‘-WhatsApp (×‘-routes.py, whatsapp_routes.py, api_routes.py) ×›×“×™ ×©×œ× ×™×”×™×• × ×ª×™×‘×™× ×›×¤×•×œ×™×.

â¸»

3) React â€” ××¡×š ×—×™×‘×•×¨ WhatsApp ×‘×œ×™ ×œ×©× ×•×ª ×¢×™×¦×•×‘ ×’×œ×•×‘×œ×™

××˜×¨×”: Onboarding ×‘×¨×•×¨ (QR/Status) ×¢× RTL, Assistant, skeleton, toast.

×‘×§×•××¤×•× × ×˜×” ×”×§×™×™××ª (××• ×¦×•×¨ src/pages/WhatsAppConnect.tsx ×× ×—×¡×¨), ××œ ×ª×©× ×” ×˜×•×§× ×™×/×¡×’× ×•×Ÿ ×’×œ×•×‘×œ×™:

import React, { useEffect, useState } from 'react';
import axios from 'axios';

export default function WhatsAppConnect() {
  const [status, setStatus] = useState<{connected:boolean, pushName?:string, hasQR?:boolean}>({connected:false});
  const [qr, setQR] = useState<string>('');
  const [loadingQR, setLoadingQR] = useState(false);

  const fetchStatus = async () => {
    const { data } = await axios.get('/api/whatsapp/status');
    setStatus(data);
  };
  const fetchQR = async () => {
    setLoadingQR(true);
    try {
      const { status, data } = await axios.get('/api/whatsapp/qr');
      if (status === 204) setQR('');
      else setQR(data.dataUrl || '');
    } finally {
      setLoadingQR(false);
    }
  };

  useEffect(() => {
    fetchStatus();
    const id = setInterval(fetchStatus, 3000);
    return () => clearInterval(id);
  }, []);

  useEffect(() => {
    if (!status.connected) {
      const id = setInterval(fetchQR, 3000);
      return () => clearInterval(id);
    }
  }, [status.connected]);

  const start = async () => {
    await axios.post('/api/whatsapp/start');
    await fetchStatus(); await fetchQR();
  };
  const logout = async () => {
    await axios.post('/api/whatsapp/logout');
    setQR(''); await fetchStatus();
  };

  return (
    <div dir="rtl" className="max-w-[420px] mx-auto bg-white rounded-lg shadow p-6 space-y-4">
      <h2 className="text-xl font-bold">×—×™×‘×•×¨ ×œ-WhatsApp</h2>

      {status.connected ? (
        <div className="flex items-center justify-between">
          <span className="inline-flex items-center px-2 py-1 text-sm bg-green-100 rounded">××—×•×‘×¨ ×›-{status.pushName || 'â€”'}</span>
          <button onClick={logout} className="px-3 py-2 rounded bg-gray-100">×”×ª× ×ª×§</button>
        </div>
      ) : (
        <>
          <div className="inline-flex items-center px-2 py-1 text-sm bg-gray-100 rounded">×¡×˜×˜×•×¡: ×œ× ××—×•×‘×¨</div>
          <button onClick={start} className="w-full h-11 rounded bg-emerald-500 text-white">×™×¦×™×¨×ª QR</button>

          <div className="flex items-center justify-center h-[320px] border rounded">
            {loadingQR ? <div className="w-48 h-48 bg-gray-100 animate-pulse rounded" /> :
             qr ? <img src={qr} alt="whatsapp-qr" className="w-80 h-80 object-contain" /> :
             <div className="text-sm text-gray-500">×œ×—×¥ â€œ×™×¦×™×¨×ª QRâ€ ×•×¡×¨×•×§ ×“×¨×š WhatsApp &gt; ××›×©×™×¨×™× ××§×•×©×¨×™×</div>}
          </div>
        </>
      )}
    </div>
  );
}

××™×Ÿ ×©×™× ×•×™ ×œ×˜×™×™×œ×•×™× ×“/×¤×•× ×˜/RTL ×›×œ×œ-××¢×¨×›×ª×™ â€” ×¨×§ ×§×•××¤×•× × ×˜×” ×–×•.

â¸»

4) Twilio Voice â€” ×”×•×¨×“×ª ×–××Ÿ-×ª×’×•×‘×” ×•×”×™×× ×¢×•×ª ×-11205

××˜×¨×”: ×œ× ×œ×¢×‘×“ Whisper/GPT/TTS ×‘×ª×•×š /webhook/handle_recording. ××—×–×™×¨×™× ××™×“ TwiML, ×•×”×¢×™×‘×•×“ ×¢×•×‘×¨ ×œ× ×ª×™×‘ ×”-action/status callback ××• ×ª×•×¨ ×¨×§×¢.

4.1 ×‘-routes.py
	â€¢	×•×“× ×©×”-TwiML ×‘-/webhook/handle_recording ××—×–×™×¨ ××™×“×™×ª (Say/Play ×§×¦×¨).
	â€¢	×”×’×“×¨ action/statusCallback ×œ-/webhook/handle_recording_complete.
	â€¢	×—×•×¥ ××–×”: ××™×Ÿ time.sleep ××• ×¢×™×‘×•×“ ×›×‘×“ ×‘× ×ª×™×‘ ×”×¨××©×™.

4.2 ×‘-whisper_handler.py / background_processor.py
	â€¢	×”×¢×‘×¨ ××ª ×¢×™×‘×•×“ ×”×”×§×œ×˜×” ×œ-Thread/Task (×× ×™×© Celery â€” ×”×©×ª××©; ×× ×œ× â€” ThreadPoolExecutor).
	â€¢	××—×§/× ×˜×¨×œ sleep ××™×•×ª×¨.
	â€¢	×›×ª×•×‘ ×œ×•×’ ×§×¦×¨ ×¢× ××©×š ×”×¢×™×‘×•×“ ×›×“×™ ×œ×•×•×“× SLA.

â¸»

5) ××‘×˜×—×” â€” Twilio Validator + CSRF ×××•×§×“ + Internal Secret
	1.	×”×•×¡×£ ××™××•×ª ×—×ª×™××ª Twilio ×œ×›×œ /webhook/*:

from twilio.request_validator import RequestValidator
import os
validator = RequestValidator(os.getenv('TWILIO_AUTH_TOKEN'))
def validate_twilio(req):
    signature = req.headers.get('X-Twilio-Signature')
    url = request.url
    params = request.form.to_dict() if request.form else {}
    return validator.validate(url, params, signature)
# ×‘×›×œ webhook:
if not validate_twilio(request): return 'forbidden', 403


	2.	CSRF: ×”×—×¨×’ ×¨×§ /webhook/* ×•-/api/whatsapp/* ××”-CSRF ×× ×—×™×™×‘×™×.
	3.	×•×“× ×©×™××•×© ×‘-INTERNAL_SECRET ×‘×™×Ÿ Flaskâ†”Baileys (×›×‘×¨ ×‘×•×¦×¢ ×œ×¢×™×œ).

â¸»

6) ××™×—×•×“/×ª×™×§×•×Ÿ ×§×‘×¦×™× ×‘×¢×™×™×ª×™×™×
	1.	××™×—×•×“ WhatsApp Routes: ×”×©××¨ ×¨×§ routes_whatsapp.py ×›×§× ×•× ×™; × ×˜×¨×œ ×¨×™×©×•× ×›×¤×•×œ ×‘×§×‘×¦×™× ××—×¨×™×.
	2.	×ª×™×§×•× ×™ ×§×•××¤×™×œ×¦×™×”:
	â€¢	enhanced_crm_service.py â€” ×ª×§×Ÿ ××™× ×“× ×˜×¦×™×” ×‘×©×•×¨×” ~355.
	â€¢	notification_service.py â€” ×ª×§×Ÿ ××™× ×“× ×˜×¦×™×” ×‘×©×•×¨×” ~394.
	3.	â€œenhanced_*â€ ×›×¤×•×œ×™×: ××–×’ ×œ×ª×•×š ×”×§×•×‘×¥ ×”×§× ×•× ×™ ×•×©× ×” import-×™× ×‘×”×ª×× (×‘×œ×™ ×œ×™×¦×•×¨ _v2).

â¸»

7) Health/Version ×•× ×™×˜×•×¨
	1.	Flask: ×”×•×¡×£

@app.route('/healthz') def healthz(): return 'ok', 200
@app.route('/version') def version(): return jsonify({"deploy": os.getenv('DEPLOY_ID','local'), "sha": os.getenv('GIT_SHA','dev')}), 200


	2.	Baileys Service ×›×‘×¨ ×›×•×œ×œ /healthz.
	3.	×œ×•×’×™×: ×©××•×¨ ×œ-logs/*.log; ××œ ×ª×“×¤×™×¡ ×›×‘×“ ×œ×§×•× ×¡×•×œ ×‘×¤×¨×•×“.

â¸»

8) Docker / ×¨×™×¦×” ×‘×¤×¨×•×“ (×× ×‘×©×™××•×©)

×× ××ª× ×‘-Docker â€” ×¢×“×›×Ÿ Dockerfile ×©×™×¨×™×¥ Flask + Baileys ×™×—×“ ×“×¨×š supervisord (××• ×”×¨×¥ ×›×©× ×™ ×§×•× ×˜×™×™× ×¨×™× × ×¤×¨×“×™× â€” ××•×¢×“×£).
×‘-Replit Dev â€” ×”×©××¨ python main.py + npm run start:baileys ×‘××§×‘×™×œ (×›××• ×”×™×•×), ××š ×‘-Prod ×”×¤×¨×“ ×ª×”×œ×™×›×™×.

×“×•×’××ª supervisor (××•×¤×¦×™×•× ×œ×™):

[program:flask]
command=python -u main.py
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:baileys]
command=npm run start:baileys
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr


â¸»

9) ×‘×“×™×§×•×ª GO/NO-GO (×œ×”×¦×™×’ ×¨××™×•×ª ×›×ª×•×‘×•×ª)

Backend
	â€¢	GET /healthz (Flask) â†’ 200 â€œokâ€.
	â€¢	GET <BAILEYS_BASE_URL>/healthz â†’ 200 â€œokâ€.
	â€¢	POST /api/whatsapp/start â†’ 200, ×•××–:
	â€¢	GET /api/whatsapp/status â†’ {connected:false, hasQR:true} ×ª×•×š â‰¤ 3 ×©× ×™×•×ª.
	â€¢	GET /api/whatsapp/qr â†’ ××—×–×™×¨ dataUrl ×ª×§×™×Ÿ (×ª××•× ×”).
	â€¢	××—×¨×™ ×¡×¨×™×§×ª QR:
	â€¢	GET /api/whatsapp/status â†’ {connected:true, pushName:...}.
	â€¢	GET /api/whatsapp/qr â†’ 204.

Voice
	â€¢	/webhook/handle_recording ××—×–×™×¨ ××™×“ TwiML (×–××Ÿ ×¢×™×‘×•×“ < 500ms); ××™×Ÿ 11205 ×‘×œ×•×’×™×.
	â€¢	/webhook/handle_recording_complete ××§×‘×œ ×§×¨×™××•×ª ×•××¢×‘×“ ×‘×¨×§×¢; ××™×Ÿ sleep.

Security
	â€¢	×‘×§×©×•×ª /webhook/* ×¢× ×—×ª×™××” ×©×’×•×™×” â†’ 403.
	â€¢	×‘×§×©×•×ª /api/whatsapp/* ×œ×œ× X-Internal-Secret ×‘×¦×“ ×”-Node â†’ 401 (× ×‘×“×§ ×¢â€×™ ×¤×¨×•×§×¡×™ Flask ×©××•×¡×™×£ ×¡×•×“).
	â€¢	CSRF ×œ× ×—×•×¡× × ×ª×™×‘×™ webhook/whatsapp ×”××•×—×¨×’×™× ×‘×œ×‘×“.

UI
	â€¢	××¡×š ×—×™×‘×•×¨ WhatsApp ××¦×™×’ RTL, Assistant, ×›×¨×˜×™×¡ 420px, skeleton, ×˜×•×¡×˜×™×, ×œ×œ× ×©×™× ×•×™ ×¢×™×¦×•×‘ ×’×œ×•×‘×œ×™.
	â€¢	×‘-Not Connected: ×›×¤×ª×•×¨ â€œ×™×¦×™×¨×ª QRâ€ â†’ ××¦×™×’ QR.
	â€¢	×‘-Connected: ×¦â€™×™×¤ ×™×¨×•×§ + â€œ×”×ª× ×ª×§â€.
	â€¢	××™×Ÿ ×§×¤×™×¦×•×ª/×§×¨×™×¡×•×ª ×§×•× ×¡×•×œ.

â¸»

10) ×¡×“×¨ ×¢×‘×•×“×” ×œ×‘×™×¦×•×¢ (Copy-Paste ×œ×¡×•×›×Ÿ)
	1.	×©×œ×‘ 0: ×”×¤×§ â€œ×¨×©×™××ª ×›×¤×™×œ×•×™×•×ª WhatsAppâ€ ×•×”×›×¨×– ×©Ö¾routes_whatsapp.py ×§× ×•× ×™.
	2.	×©×œ×‘ 1: ×©×“×¨×’ baileys_client.js â†’ services/whatsapp/baileys_service.js ×¢× ×”×§×•×“ ×œ××¢×œ×”; ×”×•×¡×£ ×¡×§×¨×™×¤×˜ start:baileys, ENV, ×•-/healthz.
	3.	×©×œ×‘ 2: ×‘-Flask â€” ×”×˜××¢ ××ª ×”×¤×¨×•×§×¡×™ ×œ-Baileys ×‘×§×•×‘×¥ ×”×§× ×•× ×™; ×¨×©×•× Blueprint; × ×˜×¨×œ ×¨×™×©×•× ×›×¤×•×œ ×‘×§×‘×¦×™× ××—×¨×™×.
	4.	×©×œ×‘ 3: ×¦×¨/×¢×“×›×Ÿ Webhook ×-Baileys ×œ-Flask (/webhook/whatsapp/incoming) ×¢× Internal Secret.
	5.	×©×œ×‘ 4: ×©×“×¨×’ /webhook/handle_recording ×œ××¢× ×” ××™×“×™; ×”×¢×‘×¨ ×¢×™×‘×•×“ ×œ-/webhook/handle_recording_complete/×ª×•×¨ ×¨×§×¢; ×”×¡×¨ sleep.
	6.	×©×œ×‘ 5: ×”×•×¡×£ Twilio Request Validator ×œ×›×œ /webhook/*; ×ª×Ÿ CSRF-exempt ×××•×§×“.
	7.	×©×œ×‘ 6: ×ª×§×Ÿ ××™× ×“× ×˜×¦×™×•×ª ×‘×§×‘×¦×™× enhanced_crm_service.py ×•-notification_service.py; ××™×–×•×’ â€œenhanced_*â€.
	8.	×©×œ×‘ 7: ×”×•×¡×£ /healthz ×•-/version ×‘-Flask; ×•×“× /healthz ×‘-Baileys.
	9.	×©×œ×‘ 8: ×”×¨×¦×” ×œ×•×§××œ×™×ª: python main.py + npm run start:baileys; ×‘×¦×¢ ××ª ×‘×“×™×§×•×ª GO ×œ××¢×œ×” ×•×”×¦×’ ×¦×™×œ×•××™ ××¡×š/×œ×•×’×™× ×›×ª×™×¢×•×“.
	10.	×©×œ×‘ 9: ×¨×§ ×× ×›×œ ×”-GO ×™×¨×•×§×™× â€” ×¡××Ÿ GO ×œ×¤×¨×•×“×§×©×Ÿ.

â¸»

×× ×ª×¨×¦×”, ××™×™×¦×¨ ×’× Diff-Patch ××“×•×™×§ ×œ×›×œ ×§×•×‘×¥ (×‘×¡×’× ×•×Ÿ git diff) ×œ×¤×™ ×©××•×ª ×”×§×‘×¦×™× ×”×¡×•×¤×™×™× ×©×œ×š â€” ×ª×’×™×“ â€œ×ª×Ÿ ×“×™×¤×™×â€ ×•××•×¦×™× ××ª ×–×” ××•×›×Ÿ ×œ×”×“×‘×§×”.