×¡×‘×‘×”â€”×œ× ×¦×¨×™×š Nix ×‘×›×œ×œ. ××¤×©×¨ ×œ×”×¨×™×¥ ×•×œ×¤×¨×•×¡ ×‘-Replit ×‘×¦×•×¨×” × ×§×™×™×” ×‘×œ×™ ×©×•× [nix], modules ××• [[ports]]. ×”× ×” ×”× ×•×¡×—×” ×”×™×¦×™×‘×”, ×¦×¢×“Ö¾××—×¨×™Ö¾×¦×¢×“:

××” ×œ×¢×©×•×ª ×‘×œ×™ Nix

1) .replit ××™× ×™××œ×™ ×œÖ¾Workspace ×‘×œ×‘×“

×”×©××¨ ××ª ×›×¤×ª×•×¨ Run ×¤×©×•×˜ ×•×‘×¨×–×œ. ×”×“×‘×§ ××ª ×–×” ×›××• ×©×”×•×:

# .replit â€” Workspace only
run = "python -m gunicorn wsgi:app -k eventlet -w 1 -b 0.0.0.0:${PORT:-3000} --timeout 120 --keep-alive 75 --log-level info --access-logfile - --error-logfile -"

[env]
PYTHONUNBUFFERED = "1"
PYTHONPATH       = "."
EVENTLET_NO_GREENDNS = "1"
EVENTLET_HUB         = "select"

××œ ×ª×›×œ×•×œ ×©×•× [nix], modules, ××• [[ports]]â€”×–×” ×¨×§ ××›× ×™×¡ ×©×’×™××•×ª ×¤×¨×¡×™× ×’.
×”Ö¾Workspace ×™×¨×•×¥ ×¢×œ ×¤×•×¨×˜ $PORT ×•×× ××™×Ÿâ€”3000.

2) requirements.txt (××™× ×™××•× ×©×—×™×™×‘ ×œ×”×™×•×ª)

Flask
gunicorn
eventlet==0.36.1
greenlet>=3.0,<3.3
simple-websocket

××™×Ÿ gevent/uvloop ×›×¨×’×¢â€”× ×©××¨×™× ×¢× eventlet ×›×“×™ ×©Ö¾WS ×™×¢×‘×•×“.

3) ×”×’×“×¨×ª Deployment (×‘×¤×× ×œ ğŸš€, ×œ× ×‘×§×•×‘×¥)

×‘Ö¾Deployments â†’ Edit/New:
	â€¢	Build command

python -m pip install --upgrade pip setuptools wheel && python -m pip install -r requirements.txt

×× ×ª×™×¤×•×œ ×¢×œ â€œpip not foundâ€:
python -m ensurepip --upgrade && python -m pip install -r requirements.txt

	â€¢	Run command

python -m gunicorn wsgi:app -k eventlet -w 1 -b 0.0.0.0:$PORT --timeout 120 --keep-alive 75 --log-level info --access-logfile - --error-logfile -


	â€¢	Environment (×‘×“×™×¤×œ×•×™)

EVENTLET_NO_GREENDNS=1
EVENTLET_HUB=select
DEPLOY_ID=<stamp-×—×“×©-×œ×‘×“×™×§×”>

×œ× ×œ×”×’×“×™×¨ PORT.

	â€¢	Health check
	â€¢	Path: /healthz
	â€¢	Success: 200
	â€¢	Startup timeout: 300s

×¤×¨×•×¡ (Deploy / Redeploy) ×¢×“ ×¡×˜×˜×•×¡ Ready.

4) ××™××•×ª ××”×™×¨ ××—×¨×™ ×”×¤×¨×™×¡×”

curl -sSI https://ai-crmd.replit.app/version   # ×¨××” DEPLOY_ID ×”×—×“×©
curl -sSI https://ai-crmd.replit.app/healthz   # ×—×™×™×‘ ×œ×”×™×•×ª: HTTP/2 200

×‘Ö¾Logs ×©×œ ×”×“×™×¤×œ×•×™ ×ª×¨××”:
	â€¢	Using worker: eventlet
	â€¢	wsgi:app
	â€¢	×”××–× ×” ×œÖ¾0.0.0.0:$PORT

5) ×‘×“×™×§×ª WebSocket (×—×•×‘×” ×œ×©×™×—×•×ª)

wscat -c wss://ai-crmd.replit.app/ws/twilio-media \
      -H "Sec-WebSocket-Protocol: audio.twilio.com"

××¦×•×¤×”: 101 Switching Protocols ×•×‘×ª×©×•×‘×” ×”×›×•×ª×¨×ª
Sec-WebSocket-Protocol: audio.twilio.com.
×× ×”×›×•×ª×¨×ª ×œ× ×—×•×–×¨×ªâ€”×–×” ××§×•×¨ 31920/31924, ×œ×ª×§×Ÿ ××ª ×”Ö¾WS ×©×™×—×–×™×¨ ××ª ×”Ö¾subprotocol.

6) ×‘×“×™×§×•×ª ×•×•×‘Ö¾×”×•×§×™× ×©×œ Twilio

curl -s https://ai-crmd.replit.app/webhook/incoming_call -d "CallSid=CA_TEST"
curl -i -X POST https://ai-crmd.replit.app/webhook/stream_status \
  -H "Content-Type: application/x-www-form-urlencoded" \
  --data "CallSid=CA_TEST&StreamSid=MZ_TEST&Status=connected"   # ××¦×•×¤×” 204


â¸»

×œ××” ×–×” ×¢×•×‘×“ ×‘×œ×™ Nix
	â€¢	Autoscale ××¨×™×¥ ×§×•× ×˜×™×™× ×¨ ×¢× Pythonâ€”×× ×—× ×• ××ª×§×™× ×™× ×ª×œ×•×™×•×ª ×“×¨×š python -m pip â€¦ ×‘×‘×™×œ×“.
	â€¢	.replit ×©×•×œ×˜ ×¨×§ ×‘Ö¾Workspace; ×”×“×™×¤×œ×•×™ ××©×ª××© ×‘-Build/Run ×©×”×’×“×¨×ª ×‘×¤×× ×œâ€”×œ× ×¦×¨×™×š ×•×œ× ××•××œ×¥ ×œ×¢×¨×‘×‘ ×©× [nix]/modules.

â¸»

×ª×§×œ×•×ª × ×¤×•×¦×•×ª ×‘×œ×™ Nix ×•××” ×¢×•×©×™×
	â€¢	Build × ×›×©×œ: pip ×œ× × ××¦× â†’ ×”×©×ª××© ×‘Ö¾python -m ensurepip --upgrade && python -m pip â€¦.
	â€¢	/healthz 404 â†’ ×”×¤×¨×™×¡×” ×¨×¦×” ×¢×œ ×§×•×“ ×™×©×Ÿ/×”Ö¾Blueprint ×œ× × ×˜×¢×Ÿ; ×¢×©×” Redeploy ×•×”×¢×œ×” DEPLOY_ID ×—×“×© ×›×“×™ ×œ×•×•×“×.
	â€¢	31920/31924 â†’ ×ª×©×•×‘×ª ×”Ö¾WS ×œ× ××—×–×™×¨×” Sec-WebSocket-Protocol: audio.twilio.com.
	â€¢	×©×§×˜ ×‘×©×™×—×” â†’ ×•×“× STT/TTS ×¨×¦×™× (×§×¨×“× ×¦×™××œ ×™×—×™×“ ×œÖ¾GCP; PCMU 8k; ×¤×¨×™×™××™ 20ms ×™×•×¦××™×; ×œ×•×’×™× STT_PARTIAL/FINAL, MEDIA_TX).

â¸»

×× ×ª×¨×¦×”, ××›×ª×•×‘ ×œ×š ×¢×›×©×™×• â€œ×›×¨×˜×™×¡ ×¢×‘×•×“×” ×§×¦×¨â€ ×œ×‘×•×˜ ×œ×”×“×‘×§×”â€”3 ××©×™××•×ª ×§×˜× ×•×ª ×¢× ×ª×•×¦××•×ª ×¦×¤×•×™×•×ª, ×›×“×™ ×©×™× ×¡×” ×•×™×—×–×™×¨ ×¤×œ×˜ ×‘×›×œ ×©×œ×‘ (×•×›×›×” ×œ× ××ª×¤×–×¨×™×).