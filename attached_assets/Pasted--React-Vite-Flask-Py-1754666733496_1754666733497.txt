×¡×’×•×¨. ×”× ×” ×”×•×“×¢×” ××—×ªÖ¾×œ××—×ª ×©×ª×“×‘×™×§ ×œ×¡×•×›×Ÿ ×©×œ×š, ×›×“×™ ×©×™×¨×™××• ××ª ×”×©×¨×ª ×›××• ×©×¦×¨×™×š â€” **React (Vite) + Flask (Python)** â€” ×•×™×ª×§× ×• ×›×œ ××” ×©×—×¡×¨ ×‘×œ×™ ×œ×©×‘×•×¨ ×›×œ×•×.

---

# ğŸš¦ SAFE MODE â€“ ×”×¢×œ××ª ×”×©×¨×ª (React+Vite + Flask) ×•×ª×™×§×•×Ÿ ×—×¡×¨×™×

**×—×•×§×™×:**

* ×œ× ××©× ×™× ××¨×›×™×˜×§×˜×•×¨×”, ×œ× ××–×™×–×™× ×§×‘×¦×™×, ×œ× ××•×—×§×™× ×ª×œ×•×™×•×ª ×’×œ×•×‘×œ×™×•×ª.
* ×›×œ ×©×™× ×•×™ â†’ ×¢× ×£ ×—×“×© + PR ×¢× diff.
* ×¢×•×‘×“×™× ×¨×§ ×¢× `.venv` ×œ-Python ×•-`client/node_modules` ×œ-Node.

## 0) ×¢× ×£ ×¢×‘×•×“×” + × ×§×™×•×Ÿ

```bash
git checkout -b run/safe-start
git restore --staged . || true
git checkout -- . || true
```

## 1) ×“×¨×™×©×•×ª ×¡×‘×™×‘×” (×œ×‘×“×•×§/×œ×”×©×œ×™×)

×§×‘×¦×™× ×§×™×™××™×/×—×¡×¨×™×:

* `AgentLocator/.replit`  (×¤×§×•×“×ª run)
* `AgentLocator/server/requirements.txt`  (×ª×œ×•×™×•×ª ×©×¨×ª)
* `AgentLocator/client/package.json` + `vite.config.js`  (×¤×¨×•× ×˜ ×¢× Vite)
* `AgentLocator/server/main.py`  (×›× ×™×¡×” ×œ-Flask)

×× ×—×¡×¨ ××©×”×• ××”×¨×©×™××” â€” ×¦×•×¨ ×œ×¤×™ ×”×“×•×’×××•×ª ×‘×”××©×š.

## 2) ×”×ª×§× ×•×ª ×•×”×¨××” ××§×•××™×ª (×™×“× ×™, ×‘×“×™×§×ª ×¢×©×Ÿ)

**×˜×¨××™× ×œ A â€“ Backend**

```bash
cd AgentLocator
python3 -m venv .venv
source .venv/bin/activate
python -m pip install -U pip wheel
pip install -r server/requirements.txt   # ×× × ×›×©×œ ×¢×œ ×—×‘×™×œ×” â€“ ×“×•×•×— ×‘××§×•× â€œ×œ×¨×¤×â€ ×’×œ×•×‘×œ×™
export FLASK_APP=server/main.py
export FLASK_RUN_PORT=5000
flask run --host 0.0.0.0
# ××¦×•×¤×”: Running on http://0.0.0.0:5000/
```

**×˜×¨××™× ×œ B â€“ Frontend**

```bash
cd AgentLocator/client
npm ci
npm run dev -- --host 0.0.0.0 --port 5173
# ××¦×•×¤×”: Vite on http://localhost:5173
```

**Proxy ×œ-API ×‘×“×‘ (×× ×—×¡×¨) â€“ ×‘-`client/vite.config.js`:**

```js
export default defineConfig({
  plugins: [react()],
  server: {
    host: '0.0.0.0',
    port: Number(process.env.PORT) || 5173,
    proxy: {
      '/api': 'http://localhost:5000',
      '/webhook': 'http://localhost:5000',
      '/socket.io': { target: 'http://localhost:5000', ws: true }
    }
  }
});
```

## 3) ××•×˜×•××¦×™×” ×œ-Preview (×©×œ× ×™×™×ª×§×¢)

×‘-Replit/×¡×‘×™×‘×•×ª Preview, ××œ ×ª×¡××•×š ×¢×œ â€œnpm run devâ€ ×©×™×ª×§×¢ ×‘×œ×™ ×ª×œ×•×™×•×ª Python. ×”×•×¡×£ **×¡×§Ñ€Ğ¸Ğ¿×˜ ×”×¨××” ×‘×˜×•×—** ×©××ª×§×™×Ÿ ×ª×œ×•×™×•×ª ×•××– ××¨×™× ××ª Flask.

### 3.1 `AgentLocator/start.sh` (×—×“×©)

```bash
#!/usr/bin/env bash
set -e

# Python env
python3 -m venv .venv || true
source .venv/bin/activate
python -m pip install -U pip wheel
pip install -r server/requirements.txt

# ×”×¨× Flask (5000)
python main.py &

# ×”××ª×Ÿ ×œ×¤×•×¨×˜ 5000 ×›×“×™ ×©×”-Preview ×œ× ×™×™×ª×§×¢
python - <<'PY'
import socket,time,sys
for _ in range(120):
    try:
        s=socket.socket(); s.settimeout(1)
        s.connect(("127.0.0.1",5000)); sys.exit(0)
    except Exception: time.sleep(1)
sys.exit(1)
PY
```

```bash
chmod +x AgentLocator/start.sh
```

### 3.2 ×¢×“×›×•×Ÿ `.replit` ×œ×”×¨××” × ×§×™×™×”

×‘-`AgentLocator/.replit` ×”×—×œ×£ ×¨×§ ××ª ×©×•×¨×ª ×”-run ×•×”×’×“×¨×•×ª ×”×¤×•×¨×˜:

```
run = "bash -lc 'cd AgentLocator && ./start.sh'"
[env]
PORT = "5000"
waitForPort = 5000
[[ports]]
localPort = 5000
externalPort = 80
```

> ×¨×•×¦×” ×©×”-Preview ×™×¨×™×¥ ××ª ×”-Frontend (Vite) ×‘××§×•× Flask? ××–:
>
> ```
> run = "bash -lc 'cd AgentLocator/client && npm run dev -- --host 0.0.0.0 --port $PORT'"
> [env]
> PORT = "5173"
> waitForPort = 5173
> [[ports]] localPort = 5173; externalPort = 80
> ```
>
> ×•×‘××§×‘×™×œ ×ª×¨×™×¥ Flask ×™×“× ×™×ª/×‘×—×œ×•×Ÿ × ×•×¡×£.

## 4) ××©×ª× ×™ ×¡×‘×™×‘×” ×©×—×™×™×‘×™× (×‘×“×•×§ ×§×™×•×, ×œ× ×œ×”×§×©×™×— ×‘×§×•×“)

```
TWILIO_ACCOUNT_SID=...
TWILIO_AUTH_TOKEN=...
OPENAI_API_KEY=...
# ××•×¤×¦×™×•× ×œ×™ ×œ×¤×™×¦â€™×¨×™×:
GOOGLE_APPLICATION_CREDENTIALS=/secrets/google_tts_key.json
VAPID_PUBLIC_KEY=...
VAPID_PRIVATE_KEY=...
SECRET_KEY=...
HOST=https://your-domain.com
```

## 5) Smoke Tests (×œ×¤× ×™ ×©××›×¨×™×–×™× â€œ×¢×•×‘×“â€)

```bash
# Twilio â€“ ×¡×˜×˜×•×¡
curl -s -o /dev/null -w "%{http_code}\n" http://localhost:5000/webhook/call_status

# TwiML â€“ ×©×™×© Record ×¢× ×”×¤×¨××˜×¨×™×
curl -s -X POST http://localhost:5000/webhook/incoming_call | grep -E 'Play|Record|finishOnKey="\\*"|timeout="5"'

# CRM paginate
curl -s "http://localhost:5000/api/crm/customers?page=1&limit=25" | head
```

××¦×•×¤×”: 200 ×‘×›×œ; ×•-XML ×¢× `<Record ... finishOnKey="*" timeout="5" ...>`.

## 6) ×—×¡×¨×™× ×©×›×“××™ ×œ×”×©×œ×™× (×œ× ×œ×©×‘×•×¨!)

* **`server/requirements.txt`** â€“ ×× ×œ× × ×¢×•×œ, × ×¢×œ ×’×¨×¡××•×ª ×§×¨×™×˜×™×•×ª (××•××œ×¥, ×œ× ×—×•×‘×” ×œ×¡×™×‘×•×‘ ×¨××©×•×Ÿ):

  ```
  requests==2.32.4
  charset-normalizer==3.4.1
  urllib3==2.2.2
  google-cloud-texttospeech==2.27.0
  grpcio==1.64.0
  Flask==3.0.3
  twilio==9.2.3
  pydub==0.25.1
  SQLAlchemy==2.0.31
  ```
* **`client/vite.config.js`** â€“ ×œ×”×•×¡×™×£ `server.proxy` ×›××• ×œ××¢×œ×” ×× ×—×¡×¨.
* **Twilio Record** â€“ ×× ×—×¡×¨ `maxLength=30` ×‘-`/incoming_call`, ×œ×”×•×¡×™×£ (×‘×œ×™ ×œ×©× ×•×ª ×–×¨×™××” ××—×¨×ª).
* **AI/TTS** â€“ ×•×“× ×©×™×© `try/except` ××—×“ ×©××—×–×™×¨ ×”×•×“×¢×ª Fallback ×‘×¢×‘×¨×™×ª ×× TTS × ×•×¤×œ (×‘×œ×™ ×œ×•×œ××•×ª).

## 7) ××” ×œ× ×œ×¢×©×•×ª

* ×œ× ×œ×”×¡×™×¨/×œ×”×ª×§×™×Ÿ ×—×‘×™×œ×•×ª ×’×œ×•×‘×œ×™×•×ª ×‘-`~/.pythonlibs` / `site-packages`.
* ×œ× â€œ×œ×”××™×¨ ××ª ×”×¤×¨×•×™×§×˜ ×œ-JS ××œ×â€.
* ×œ× ×œ×©× ×•×ª ×©××•×ª ×§×‘×¦×™× ××• ××‘× ×” ×ª×™×§×™×•×ª ×§×™×™××™×.

---

## ×§×‘×œ×•×ª ×‘×¡×•×£

* ×¦×™×œ×•× ××¡×š ×©×œ ×¨×™×¦×” ××•×¦×œ×—×ª: Flask ×¢×œ `:5000` / Vite ×¢×œ `:5173`.
* ×ª×•×¦××•×ª ×©×œ ×©×œ×•×©×ª ×”-curl ×œ××¢×œ×” (200 + ×”-TwiML).
* PR ×¢× diff (×¨×§ `start.sh`, ×¢×“×›×•×Ÿ `.replit`, ×•×ª×™×§×•× ×™ proxy/×¤×¨××˜×¨×™× ×§×˜× ×™× ×× × ×•×¡×¤×•).

×× ××©×”×• × ×ª×§×¢ ×’× ××—×¨×™ ×–×”â€”×ª×’×™×“ ××™×¤×” ×–×” × ×¢×¦×¨ (×”×•×“×¢×ª ×”-Preview / ×œ×•×’×™× ×©×œ Flask/Node), ×•×× ×™ ××ª×Ÿ ×¤×™×§×¡×¨ × ×§×•×“×ª×™.
