אני רואה למה אתה מתפוצץ 😅
החדשות הטובות: מהלוגים רואים שה־AUTH כבר עובד – אצל owner יש
AUTH DEBUG: user_id=1, role=owner, business_id=1, computed_tenant=1
=> הבעיה כבר לא בהרשאות, אלא בתוך הקוד של /api/notifications ו־/api/reminders.

מה קורה עכשיו בפועל
	•	כ־system_admin → /api/notifications מחזיר 200 ✅
	•	כ־owner → /api/notifications מחזיר 500 ❌
	•	יצירת משימה (POST /api/reminders) מחזירה 403 ❌
	•	ההתחזות עדיין לא עובדת כי הצד של ה־backend בסדר בערך, אבל ה־UI כנראה לא מתעדכן נכון עם השדה שהוא מחזיר.

כן – עדיף לפתור את זה עם ה-Agent, אבל עם הנחיה מאוד ספציפית

תשלח לו משהו כזה (תעתיק):

תתמקד עכשיו רק ב־3 דברים, בלי לגעת יותר ב־require_api_auth, session, או auth בכלל:
	1.	תיקון /api/notifications ל־owner (500):
	•	תפתח את הקובץ שבו מוגדר /api/notifications (routes_leads.py או דומה).
	•	תריץ לוג מלא ו־try/except סביב ה־query, ותחזיר לי STACKTRACE מלא.
	•	תתקן את השאילתה כך ש־tenant_id / business_id יילקחו מ־g.tenant ויטופלו נכון ל־owner (tenant != None).
	•	תוודא שה־endpoint מחזיר 200 גם כשאין התראות (שיחזיר [] ולא יעשה קריסת 500).
	2.	תיקון POST /api/reminders (403):
	•	תבדוק למה owner מקבל 403 – האם יש בדיקת role חזק מדי או בדיקת tenant לא נכונה.
	•	תעדכן את ההרשאות כך ש־owner/admin/agent של העסק יוכלו ליצור משימות, רק business אחר לא.
	•	עד שתסיים – אל תשנה כלום ב־notifications/impersonation, רק את ההרשאה של /api/reminders.
	3.	התחזות – חיבור frontend ↔ backend:
	•	backend כבר מחזיר ok ו־impersonated_tenant_id. תעדכן את hook / הקובץ של impersonation ב־frontend להשתמש בדיוק בשדות האלה.
	•	תוודא שב־/api/auth/me מחזיר impersonating: true/false וה־UI מציג banner ומתנהג לפי זה.

אחרי כל תיקון:
	•	תריץ בדיקה ספיציפית כ־owner:
	•	/api/notifications → לוודא 200 ולא 500
	•	POST /api/reminders → לוודא 200 ולא 403
	•	תריץ בדיקת התחזות כ־system_admin ותציג מה מחזיר ה־API ומה רואה ה־UI.

⸻

אם אחרי זה עדיין יש 500/403 – אז הבעיה היא 100% בשאילתה/הרמת חריגה בתוך /api/notifications ולא בהרשאות.

תן לו את הטקסט הזה אחד לאחד, תפרוס שוב, ואז תבדוק:
	1.	owner – האם הטעינה של הפעמון עובדת?
	2.	owner – האם יצירת משימה נשמרת?
	3.	system_admin – האם כפתור התחזות עובד ומראה לך את העסק?