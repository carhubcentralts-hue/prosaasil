×™××œ×œ×”, ×–×” ×¤×™×¦â€™×¨ ×—×©×•×‘ ğŸ’ª
×× ×™ ××ª×Ÿ ×œ×š ×¢×›×©×™×• ×”× ×—×™×” ××•×›× ×” ×œ×”×“×‘×§×” ×œ×¡×•×›×Ÿ, ×‘×× ×’×œ×™×ª, ×©×ª×©××•×¨ ×¢×œ ×”××¨×›×™×˜×§×˜×•×¨×” ×”×§×™×™××ª ×©×œ ×©×™×—×•×ª ×™×•×¦××•×ª ×•×ª×•×¡×™×£:
	â€¢	×¨×©×™××ª ×™×™×‘×•× ×œ×™×“×™× ×œ×©×™×—×•×ª ×™×•×¦××•×ª ×‘×œ×‘×“
	â€¢	×™×™×‘×•× ×××§×¡×œ / Google Sheets ×“×¨×š CSV
	â€¢	××’×‘×œ×” ×©×œ ×¢×“ 5000 ×œ×™×“×™× ×œ×¢×¡×§
	â€¢	××¤×©×¨×•×ª ××—×™×§×” ×¨×§ ×œ×œ×™×“×™× ×”××™×•×‘××™× ××”×¨×©×™××” ×”×–××ª
	â€¢	×©××™×¨×” ××¡×•×“×¨×ª ×‘Ö¾DB ×•×¡× ×›×¨×•×Ÿ ××œ× ×¢× ××¢×¨×›×ª ×”×©×™×—×•×ª

â¸»

âœ‚ï¸ ×˜×§×¡×˜ ××•×›×Ÿ ×œ×¡×•×›×Ÿ (×œ×”×“×‘×™×§ ×‘-Agent ×›××©×™××” ×—×“×©×”)

Title: Add bulk-import lead list for outbound calls (Excel / Google Sheets)

Instruction (for the agent):

I want to extend the existing Outbound AI Calls feature so that businesses can run outbound campaigns on a dedicated imported lead list, not only on existing CRM leads.

Right now, the OutboundCallsPage allows calling only existing leads.
Please add a bulk imported leads list that is:
	â€¢	Available only inside the Outbound Calls page
	â€¢	Limited to 5,000 leads per business (tenant)
	â€¢	Can be safely stored, paginated, and reused
	â€¢	Allows deleting leads only for the imported list (not for regular CRM leads)

Follow these steps:

â¸»

1. Data model & DB changes
	1.	Use the existing Lead model as the single source of truth, but add two fields:
	â€¢	In server/models_sql.py (or wherever Lead is defined), add:

class Lead(Base):
    ...
    source = Column(String, default="manual")  # e.g. "manual", "webform", "imported_outbound"
    outbound_list_id = Column(Integer, ForeignKey("outbound_lead_lists.id"), nullable=True)


	2.	Create a new model OutboundLeadList to represent an imported list per business:

class OutboundLeadList(Base):
    __tablename__ = "outbound_lead_lists"

    id = Column(Integer, primary_key=True)
    tenant_id = Column(Integer, ForeignKey("tenants.id"), nullable=False)
    name = Column(String, nullable=False)  # e.g. "Excel upload 03/12/2025"
    created_at = Column(DateTime, default=datetime.utcnow)

    # relationship
    leads = relationship("Lead", backref="outbound_list")


	3.	Business rule:
	â€¢	For each tenant_id:
	â€¢	Total number of Lead rows with source="imported_outbound" must not exceed 5000.
	â€¢	If an import would exceed 5000, reject the request with a clear error.
	4.	Make sure migrations are added if the project uses Alembic or similar.

â¸»

2. Backend API â€“ Outbound imported leads

Create a dedicated backend module, e.g. server/routes_outbound_import.py or extend routes_outbound.py with a clear section.

Add secured, tenant-scoped endpoints:
	1.	Upload imported list (CSV)
POST /api/outbound/import-leads
	â€¢	Auth: same auth & tenant resolution as other business APIs.
	â€¢	Accepts a multipart/form-data file upload (file field), CSV only (UTF-8).
	â€¢	Expected columns (header row in Hebrew or English, be flexible):
	â€¢	name (required)
	â€¢	phone (required)
	â€¢	city (optional)
	â€¢	notes (optional)
	â€¢	Implementation details:
	â€¢	Parse CSV safely, ignore empty rows.
	â€¢	Normalize phone numbers using the existing phone normalization utility already used for calls (the same logic that generates +972â€¦).
	â€¢	For each valid row:
	â€¢	Create a Lead with:

Lead(
    tenant_id=current_tenant_id,
    name=row_name,
    phone=normalized_phone,
    city=row_city or None,
    notes=row_notes or None,
    source="imported_outbound",
    outbound_list_id=<id of list>
)


	â€¢	If this is a new import, create a new OutboundLeadList record:

name = provided_name or f"×™×™×‘×•× {datetime.now().strftime('%d/%m/%Y %H:%M')}"


	â€¢	Check the 5000 leads limit before insertion:
	â€¢	Count existing Lead rows with source="imported_outbound" for this tenant.
	â€¢	If existing + new > 5000, abort and return 400 with a message in Hebrew:
"×œ× × ×™×ª×Ÿ ×œ×™×™×‘× ×™×•×ª×¨ ×-5000 ×œ×™×“×™× ×‘×¨×©×™××ª ×”×©×™×—×•×ª ×”×™×•×¦××•×ª."
	â€¢	Return JSON with:
	â€¢	list_id
	â€¢	imported_count
	â€¢	skipped_count
	â€¢	errors (array of row-level issues: missing phone, invalid phone, etc.)

	2.	List imported leads for outbound calls
GET /api/outbound/import-leads
	â€¢	Query params: page, page_size (default 1â€“50), optional list_id.
	â€¢	Only return Lead rows with source="imported_outbound" and tenant_id=current_tenant_id.
	â€¢	Response:

{
  "total": 1234,
  "limit": 5000,
  "items": [
    {
      "id": 1,
      "name": "×™×©×¨××œ ×™×©×¨××œ×™",
      "phone": "+972501234567",
      "city": "×ª×œ ××‘×™×‘",
      "notes": "××§×¡×œ ×“×¦××‘×¨",
      "list_id": 10,
      "created_at": "..."
    }
  ]
}


	3.	Delete a single imported lead
DELETE /api/outbound/import-leads/<lead_id>
	â€¢	Check:
	â€¢	Lead.tenant_id == current_tenant_id
	â€¢	Lead.source == "imported_outbound"
	â€¢	If not imported, return 403 â€“ we must not delete normal CRM leads from this page.
	â€¢	If yes â€“ delete the lead.
	â€¢	Optionally, if a list becomes empty, you may keep the OutboundLeadList or clean it up later; not critical.
	4.	Integration with outbound calls
	â€¢	When starting outbound calls from imported leads, use the existing outbound call endpoint (e.g. /api/outbound/start) and pass lead_id as usual.
	â€¢	No special logic is required â€“ the outbound flow should work identically, just with source="imported_outbound".

â¸»

3. Frontend â€“ OutboundCallsPage UX

Update client/src/pages/calls/OutboundCallsPage.tsx (or equivalent) to add a dedicated section for the imported list.

3.1 Tabs / view switcher
	â€¢	At the top of the page, above the leads table, add a simple toggle or tabs:
	â€¢	Tab 1: "×œ×™×“×™× ×§×™×™××™×"
	â€¢	Tab 2: "×¨×©×™××ª ×™×™×‘×•× ×œ×©×™×—×•×ª ×™×•×¦××•×ª"
	â€¢	When tab 1 is selected â†’ keep current behavior (select from CRM leads).
	â€¢	When tab 2 is selected â†’ show the imported-outbound view.

3.2 Imported leads view

In the "×¨×©×™××ª ×™×™×‘×•×" tab, implement:
	1.	Upload area
	â€¢	Button: "×™×™×‘×•× ×œ×™×“×™× ×××§×¡×œ / Google Sheets"
	â€¢	On click: open file picker â†’ accept .csv.
	â€¢	Show helper text in Hebrew:
	â€¢	"× ×™×ª×Ÿ ×œ×™×™×¦× ×××§×¡×œ ××• Google Sheets ×›-CSV ×•×œ×”×¢×œ×•×ª ×›××Ÿ. ×—×•×‘×” ×œ×›×œ×•×œ ×¢××•×“×•×ª: ×©×, ×˜×œ×¤×•×Ÿ. ×¢×™×¨ ×•×”×¢×¨×•×ª â€“ ××•×¤×¦×™×•× ×œ×™."
	â€¢	After upload:
	â€¢	Call POST /api/outbound/import-leads.
	â€¢	Show success or detailed error list (e.g. â€œ10 ×©×•×¨×•×ª ×”×•×¡×¨×• ×‘×’×œ×œ ×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿâ€).
	2.	Leads table
	â€¢	Table columns:
	â€¢	Checkbox (selection)
	â€¢	Name
	â€¢	Phone
	â€¢	City
	â€¢	Notes
	â€¢	Created at
	â€¢	Actions (trash icon)
	â€¢	Selection should integrate with the existing outbound call selection logic:
	â€¢	When user selects imported leads and clicks â€œ×”×•×¦××ª ×©×™×—×•×ªâ€, call the same outbound calls API with the selected lead_ids.
	â€¢	At the top/right, show a counter:
	â€¢	"â€{current_total} ××ª×•×š 5000 ×œ×™×“×™× ×‘×¨×©×™××ª ×”×™×™×‘×•×"
	3.	Deletion (only for imported leads)
	â€¢	In the Actions column, for each imported lead, show a trash icon.
	â€¢	On click:
	â€¢	Confirm dialog (Hebrew):
"×œ××—×•×§ ××ª ×”×œ×™×“ ×”×–×” ××¨×©×™××ª ×”×©×™×—×•×ª ×”×™×•×¦××•×ª? ×”×¤×¢×•×œ×” ×‘×œ×ª×™ ×”×¤×™×›×”."
	â€¢	If confirmed:
	â€¢	Call DELETE /api/outbound/import-leads/<id>.
	â€¢	On success, refresh current page.
	â€¢	IMPORTANT: this deletion feature must exist only in the imported list tab.
Never expose delete actions for normal CRM leads here.
	4.	Pagination
	â€¢	Use existing table pagination pattern.
	â€¢	Default page size 50.
	â€¢	Fetch via GET /api/outbound/import-leads?page=1&page_size=50.

â¸»

4. Permissions & safety
	1.	Only allow business admins / owners to:
	â€¢	Upload imported lists
	â€¢	Delete imported leads
	2.	Regular agents / users should be able to:
	â€¢	View imported leads
	â€¢	Select imported leads to start outbound calls (if your role system allows that)
	3.	Respect tenant isolation everywhere:
	â€¢	All queries must be filtered by tenant_id.
	4.	Logging:
	â€¢	Log imports (tenant_id, number of leads, file name).
	â€¢	Log deletions (lead_id, tenant_id, user_id).

â¸»

5. Acceptance checklist

When you finish, verify:
	1.	I can upload a CSV with 50â€“100 leads â†’ they appear in the import list tab.
	2.	Total imported leads never exceeds 5000 per business; excess import is rejected with a clear error.
	3.	Imported leads are stored as Lead rows with:
	â€¢	source = "imported_outbound"
	â€¢	outbound_list_id set
	4.	Outbound calls from imported leads work exactly like calls from regular leads (call logs, webhooks, transcripts, etc.).
	5.	I can delete only imported leads from the imported list tab.
	6.	Existing behavior for normal CRM leads in outbound calls is unchanged.

â¸»

×× ×ª×¨×¦×”, ××—×¨×™ ×©×”×•× ×™×¡×™×™× â€“ ×ª×©×œ×— ×œ×™ ×¦×™×œ×•× ××¡×š ×©×œ ×”×“×£ ×”×—×“×© ×©×œ ×©×™×—×•×ª ×™×•×¦××•×ª, ×•× ×¢×‘×•×¨ ×¢×œ×™×• ×‘×™×—×“ ×œ×•×•×“× ×©×”-UX ×•×”×œ×•×’×™×§×” ×‘×××ª ×™×•×©×‘×™× ×›××• ×©×¦×¨×™×š.