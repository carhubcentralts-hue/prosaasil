 run: apt list --upgradable

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


  _____
 / ___/___  _  _ _____ _   ___  ___
| |   / _ \| \| |_   _/ \ | _ )/ _ \
| |__| (_) | .` | | |/ _ \| _ \ (_) |
 \____\___/|_|\_| |_/_/ \_|___/\___/

Welcome!

This server is hosted by Contabo. If you have any questions or need help,
please don't hesitate to contact us at support@contabo.com.

Last login: Fri Dec  5 23:56:37 2025 from 46.117.94.103
root@vmi2930819:~# cd /opt/prosaasil
root@vmi2930819:/opt/prosaasil# git reset --hard HEAD
HEAD is now at 457d5f35 Make AI conversation flow dynamically after user rejection
root@vmi2930819:/opt/prosaasil# git pull origin main
Username for 'https://github.com': 
Password for 'https://github.com': 
remote: Enumerating objects: 26, done.
remote: Counting objects: 100% (26/26), done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 20 (delta 13), reused 20 (delta 13), pack-reused 0 (from 0)
Unpacking objects: 100% (20/20), 8.95 KiB | 381.00 KiB/s, done.
From https://github.com/carhubcentralts-hue/prosaasil
 * branch              main       -> FETCH_HEAD
   457d5f35..107eaa5e  main       -> origin/main
Updating 457d5f35..107eaa5e
Fast-forward
 ...d--SIMPLE-MODE--1764976003055_1764976003055.txt | 288 +++++++++++++++++++++
 ...d--SIMPLE-MODE--1764976085514_1764976085514.txt | 288 +++++++++++++++++++++
 server/config/__init__.py                          |   4 +
 server/config/calls.py                             |  13 +
 server/db_migrate.py                               |  14 +
 server/media_ws_ai.py                              | 183 +++++++------
 server/models_sql.py                               |   4 +
 7 files changed, 722 insertions(+), 72 deletions(-)
 create mode 100644 attached_assets/Pasted--SIMPLE-MODE--1764976003055_1764976003055.txt
 create mode 100644 attached_assets/Pasted--SIMPLE-MODE--1764976085514_1764976085514.txt
 create mode 100644 server/config/__init__.py
 create mode 100644 server/config/calls.py
root@vmi2930819:/opt/prosaasil# docker compose down
WARN[0000] The "TWILIO_PHONE_NUMBER" variable is not set. Defaulting to a blank string. 
[+] Running 6/6
 âœ” Container prosaas-baileys   Removed                                    10.2s 
 âœ” Container prosaas-n8n       Removed                                     0.4s 
 âœ” Container prosaas-frontend  Removed                                     0.3s 
 âœ” Container prosaas-backend   Removed                                     1.0s 
 âœ” Container prosaas-db        Removed                                     0.2s 
 âœ” Network prosaasil_default   Removed                                     0.1s 
root@vmi2930819:/opt/prosaasil# docker system prune -f
Deleted build cache objects:
xjtjpbfk14h4y29sn0tltz7ja
wv94zovvrem74wfvh1geva49s
pdjhcx3r6lg8aevv7f2pqekap
kiunvlwrpa0p4gu52nab6bvcb
4w8nk9qztvvnyyd34kf018je2
vexm6fbxcsaip7cem6lj6bpyx
vpjnxg8cac6huoxnuo1racyyj
w9vs2w00o9xlhaffaznnmdxfq
ls6bwr1gjlagq1mv4ctxlumkd
ydwz3il4ezedo4d2zsbejdh8w
njwf1iqwt8x8nvrunj4i8pegj
7o3py10lnqmtq7dlbq63nb1p3
okyheen79huppmctqhc0cyucq
oc20d89j4epzxr43agp6xn14i
dmuyedgsz12dbu5ql432xmo1z
p2izc01bvesglw1geuurv8kog
s5cyj0wtiwc8rimamrkninqvs
efbnm0cpvw1f6q7exbys1aa4u
jwe7yq8e9r2kjkfpls57q3e5t
yq8v55dbvxkxxei6phzb06rrq
vde9dbgbsfriyevf70tsun9kv
3lo9lk1gxvbmihh68z5hliuy0
1r5dcqnstfh1dm9kl3ji0fw6d

Total reclaimed space: 1.546GB
root@vmi2930819:/opt/prosaasil# docker compose up --build -d
WARN[0000] The "TWILIO_PHONE_NUMBER" variable is not set. Defaulting to a blank string. 
[+] Building 85.5s (40/40) FINISHED                                             
 => [internal] load local bake definitions                                 0.0s
 => => reading from stdin 1.32kB                                           0.0s
 => [backend internal] load build definition from Dockerfile.backend       0.1s
 => => transferring dockerfile: 959B                                       0.0s
 => [frontend internal] load build definition from Dockerfile.frontend     0.1s
 => => transferring dockerfile: 900B                                       0.0s
 => [baileys internal] load build definition from Dockerfile.baileys       0.1s
 => => transferring dockerfile: 1.05kB                                     0.0s
 => [backend internal] load metadata for docker.io/library/python:3.11-sl  1.5s
 => [frontend internal] load metadata for docker.io/library/nginx:alpine   0.7s
 => [frontend internal] load metadata for docker.io/library/node:20-slim   0.8s
 => [backend internal] load .dockerignore                                  0.0s
 => => transferring context: 792B                                          0.0s
 => [baileys 1/7] FROM docker.io/library/node:20-slim@sha256:fbb357f69d05  0.1s
 => => resolve docker.io/library/node:20-slim@sha256:fbb357f69d05c9733385  0.0s
 => [frontend internal] load build context                                 0.1s
 => => transferring context: 1.33MB                                        0.0s 
 => [frontend stage-1 1/3] FROM docker.io/library/nginx:alpine@sha256:b3c  0.1s 
 => => resolve docker.io/library/nginx:alpine@sha256:b3c656d55d7ad751196f  0.0s 
 => [baileys internal] load build context                                  0.1s 
 => => transferring context: 92.53kB                                       0.1s 
 => [baileys 2/7] WORKDIR /app                                             0.0s 
 => [frontend stage-1 2/3] COPY docker/nginx.conf /etc/nginx/conf.d/defau  0.0s
 => [baileys 3/7] RUN apt-get update && apt-get install -y --no-install-r  4.7s
 => [frontend builder 3/6] COPY client/package*.json ./                    0.0s
 => [frontend builder 4/6] RUN npm install                                11.2s
 => [backend 1/9] FROM docker.io/library/python:3.11-slim@sha256:193fdd0b  0.1s
 => => resolve docker.io/library/python:3.11-slim@sha256:193fdd0bbcb3d2ae  0.0s
 => [backend internal] load build context                                  0.1s
 => => transferring context: 2.70MB                                        0.0s
 => [backend 2/9] WORKDIR /app                                             0.0s
 => [backend 3/9] RUN apt-get update && apt-get install -y --no-install-  19.9s
 => [baileys 4/7] COPY services/whatsapp/package*.json ./                  0.0s
 => [baileys 5/7] RUN npm install --omit=dev                               6.9s
 => [frontend builder 5/6] COPY client/ ./                                 0.3s
 => [frontend builder 6/6] RUN npm run build                               7.4s
 => [baileys 6/7] COPY services/whatsapp/baileys_service.js ./             0.1s
 => [baileys 7/7] RUN mkdir -p auth_info_baileys                           0.2s
 => [baileys] exporting to image                                           4.4s
 => => exporting layers                                                    3.0s
 => => exporting manifest sha256:51a4be2a6e07ec27308a2efce05a256f51f2f61c  0.0s
 => => exporting config sha256:2fffde5e8d98c89ded97a0d300700349c67acdb62f  0.0s
 => => exporting attestation manifest sha256:6c501feee63bb2737cd8ba6c515a  0.0s
 => => exporting manifest list sha256:4bac3240f0dcdd4cb3ce88a90ebb97dcf37  0.0s
 => => naming to docker.io/library/prosaasil-baileys:latest                0.0s
 => => unpacking to docker.io/library/prosaasil-baileys:latest             1.3s
 => [baileys] resolving provenance for metadata file                       0.0s
 => [frontend stage-1 3/3] COPY --from=builder /app/dist /usr/share/nginx  0.1s
 => [frontend] exporting to image                                          0.4s
 => => exporting layers                                                    0.2s
 => => exporting manifest sha256:5a53102867a9f2127a463c3e8b97f4cebbd69a91  0.0s
 => => exporting config sha256:fd74a04859675857678499c8496b9bc45dfb8e7073  0.0s
 => => exporting attestation manifest sha256:8ef098810ebb6e8c5e24c10614f4  0.0s
 => => exporting manifest list sha256:c4c587c5c5cfe543f24856d1040908de69d  0.0s
 => => naming to docker.io/library/prosaasil-frontend:latest               0.0s
 => => unpacking to docker.io/library/prosaasil-frontend:latest            0.1s
 => [frontend] resolving provenance for metadata file                      0.0s
 => [backend 4/9] COPY pyproject.toml ./                                   0.1s
 => [backend 5/9] COPY server/ ./server/                                   0.0s
 => [backend 6/9] COPY asgi.py wsgi.py run_server.py ./                    0.0s
 => [backend 7/9] RUN pip install --no-cache-dir --upgrade pip &&     pi  38.2s
 => [backend 8/9] RUN mkdir -p server/public                               0.3s
 => [backend 9/9] RUN mkdir -p storage/recordings storage/whatsapp logs    0.2s
 => [backend] exporting to image                                          24.7s
 => => exporting layers                                                   18.0s
 => => exporting manifest sha256:07d2e43e8bab50e42844b5287e58ca36e81a3478  0.0s
 => => exporting config sha256:65a2850067cd6494a4e7fdc891bf1644d9af4693f9  0.0s
 => => exporting attestation manifest sha256:6240f20af8302f88cf62c58e38c3  0.0s
 => => exporting manifest list sha256:065f6051e37e093b9a0eafbb42f88e7f9ce  0.0s
 => => naming to docker.io/library/prosaasil-backend:latest                0.0s
 => => unpacking to docker.io/library/prosaasil-backend:latest             6.6s
 => [backend] resolving provenance for metadata file                       0.0s
[+] Running 9/9
 âœ” prosaasil-baileys           Built                                       0.0s 
 âœ” prosaasil-backend           Built                                       0.0s 
 âœ” prosaasil-frontend          Built                                       0.0s 
 âœ” Network prosaasil_default   Created                                     0.0s 
 âœ” Container prosaas-db        Started                                     1.8s 
 âœ” Container prosaas-backend   Started                                     0.5s 
 âœ” Container prosaas-n8n       Started                                     0.5s 
 âœ” Container prosaas-baileys   Started                                     0.6s 
 âœ” Container prosaas-frontend  Started                                     0.6s 
root@vmi2930819:/opt/prosaasil# docker compose logs -f backend
WARN[0000] The "TWILIO_PHONE_NUMBER" variable is not set. Defaulting to a blank string. 
prosaas-backend  | INFO:     Started server process [1]
prosaas-backend  | INFO:     Waiting for application startup.
prosaas-backend  | INFO:     Application startup complete.
prosaas-backend  | INFO:     Uvicorn running on http://0.0.0.0:5000 (Press CTRL+C to quit)
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP STARTING - Preloading all services...
prosaas-backend  |   ğŸ”¥ Warming OpenAI client...
prosaas-backend  |     âœ… OpenAI client ready
prosaas-backend  |   ğŸ”¥ Warming Google TTS client...
prosaas-backend  |     âŒ TTS client failed
prosaas-backend  |   ğŸ”¥ Warming Google STT client...
prosaas-backend  |     âŒ STT client failed
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP STARTING - Preloading all services...
prosaas-backend  |   ğŸ”¥ Warming OpenAI client...
prosaas-backend  |     âœ… OpenAI client ready
prosaas-backend  |   ğŸ”¥ Warming Google TTS client...
prosaas-backend  |     âŒ TTS client failed
prosaas-backend  |   ğŸ”¥ Warming Google STT client...
prosaas-backend  |     âŒ STT client failed
prosaas-backend  | INFO:     127.0.0.1:41424 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 0 FAQs in database
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 0 FAQs in database
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 25 leads in database
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 25 leads in database
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP STARTING - Preloading all services...
prosaas-backend  |   ğŸ”¥ Warming OpenAI client...
prosaas-backend  |     âœ… OpenAI client ready
prosaas-backend  |   ğŸ”¥ Warming Google TTS client...
prosaas-backend  |     âŒ TTS client failed
prosaas-backend  |   ğŸ”¥ Warming Google STT client...
prosaas-backend  |     âŒ STT client failed
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 0 FAQs in database
prosaas-backend  | ğŸ”’ LAYER 1 (BEFORE): 25 leads in database
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ WARMUP: Pre-creating agents for active businesses...
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ WARMUP: Pre-creating agents for active businesses...
prosaas-backend  | [WA-SESSION] ğŸ“± Background processor thread started - checking every 5 minutes
prosaas-backend  | ğŸ“Š Found 2 businesses to warm up
prosaas-backend  | ğŸ“‹ PROMPT LOADING: business_id=10, channel=calls, custom_instructions provided=False
prosaas-backend  | âš ï¸ Could not load DB prompt for business=10: (psycopg2.errors.UndefinedColumn) column business_settings.call_goal does not exist
prosaas-backend  | LINE 1: ...fields AS business_settings_required_lead_fields, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | ğŸ”¨ CALLING create_booking_agent(business_id=10, channel=calls)
prosaas-backend  |   ğŸ”¥ Warming 2 active businesses (Agent Cache)...
prosaas-backend  |   ğŸ”¥ Warming 2 active businesses (Agent Cache)...
prosaas-backend  | 
prosaas-backend  | âš ï¸  NO DB prompt - using minimal fallback for ×§×œ×™×‘×¨
prosaas-backend  | 
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“œ AGENT INSTRUCTIONS (first 500 chars):
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ”’ SYSTEM CONTEXT (READ BUT DON'T MENTION):
prosaas-backend  | TODAY: 2025-12-06 01:27 (Israel)
prosaas-backend  | TOMORROW: 2025-12-07
prosaas-backend  | APPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)
prosaas-backend  | 
prosaas-backend  | âš ï¸ CRITICAL ANTI-HALLUCINATION RULES (BUILD 112):
prosaas-backend  | 1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true
prosaas-backend  | 2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn
prosaas-backend  | 3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn
prosaas-backend  | 4. ğŸ”¥ BUILD 112: 
prosaas-backend  | ...
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  | ================================================================================
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.UndefinedColumn: column business_settings.call_goal does not exist
prosaas-backend  | LINE 1: ...fields AS business_settings_required_lead_fields, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | ğŸ“… Today calculated as: 2025-12-06 (Saturday)
prosaas-backend  | ğŸ“… Tomorrow calculated as: 2025-12-07
prosaas-backend  | ================================================================================
prosaas-backend  | 
prosaas-backend  | âœ… create_booking_agent RETURNED: True
prosaas-backend  | â±ï¸  AGENT_CREATION_TIME: 238ms
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (calls)
prosaas-backend  | ğŸ“‹ PROMPT LOADING: business_id=10, channel=whatsapp, custom_instructions provided=False
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column business_settings.call_goal does not exist
prosaas-backend  | LINE 1: ...fields AS business_settings_required_lead_fields, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.UndefinedColumn: column business_settings.call_goal does not exist
prosaas-backend  | LINE 1: ...fields AS business_settings_required_lead_fields, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column business_settings.call_goal does not exist
prosaas-backend  | LINE 1: ...fields AS business_settings_required_lead_fields, business_s...
prosaas-backend  |                                                              ^
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/f405)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | âš ï¸ Could not load DB prompt for business=10: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | ğŸ”¨ CALLING create_booking_agent(business_id=10, channel=whatsapp)
prosaas-backend  | 
prosaas-backend  | âš ï¸  NO DB prompt - using minimal fallback for ×§×œ×™×‘×¨
prosaas-backend  | 
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“œ AGENT INSTRUCTIONS (first 500 chars):
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ”’ SYSTEM CONTEXT (READ BUT DON'T MENTION):
prosaas-backend  | TODAY: 2025-12-06 01:27 (Israel)
prosaas-backend  | TOMORROW: 2025-12-07
prosaas-backend  | APPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)
prosaas-backend  | 
prosaas-backend  | âš ï¸ CRITICAL ANTI-HALLUCINATION RULES (BUILD 112):
prosaas-backend  | 1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true
prosaas-backend  | 2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn
prosaas-backend  | 3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn
prosaas-backend  | 4. ğŸ”¥ BUILD 112: 
prosaas-backend  | ...
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“… Today calculated as: 2025-12-06 (Saturday)
prosaas-backend  | ğŸ“… Tomorrow calculated as: 2025-12-07
prosaas-backend  | ================================================================================
prosaas-backend  | 
prosaas-backend  | âœ… create_booking_agent RETURNED: True
prosaas-backend  | â±ï¸  AGENT_CREATION_TIME: 112ms
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (whatsapp)
prosaas-backend  | ğŸ“‹ PROMPT LOADING: business_id=1, channel=calls, custom_instructions provided=False
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | âš ï¸ Could not load DB prompt for business=1: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | ğŸ”¨ CALLING create_booking_agent(business_id=1, channel=calls)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  | 
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP COMPLETE: 0/4 agents ready in 426ms
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  | ğŸš€ System preheated - First AI response will be FAST!
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  | 
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | 
prosaas-backend  | âš ï¸  NO DB prompt - using minimal fallback for ×¤×¨×• ×¡××¡
prosaas-backend  | 
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“œ AGENT INSTRUCTIONS (first 500 chars):
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ”’ SYSTEM CONTEXT (READ BUT DON'T MENTION):
prosaas-backend  | TODAY: 2025-12-06 01:27 (Israel)
prosaas-backend  | TOMORROW: 2025-12-07
prosaas-backend  | APPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)
prosaas-backend  | 
prosaas-backend  | âš ï¸ CRITICAL ANTI-HALLUCINATION RULES (BUILD 112):
prosaas-backend  | 1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true
prosaas-backend  | 2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn
prosaas-backend  | 3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn
prosaas-backend  | 4. ğŸ”¥ BUILD 112: 
prosaas-backend  | ...
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“… Today calculated as: 2025-12-06 (Saturday)
prosaas-backend  | ğŸ“… Tomorrow calculated as: 2025-12-07
prosaas-backend  | ================================================================================
prosaas-backend  | 
prosaas-backend  | âœ… create_booking_agent RETURNED: True
prosaas-backend  | â±ï¸  AGENT_CREATION_TIME: 218ms
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (calls)
prosaas-backend  | ğŸ“‹ PROMPT LOADING: business_id=1, channel=whatsapp, custom_instructions provided=False
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | 
prosaas-backend  | The above exception was the direct cause of the following exception:
prosaas-backend  | 
prosaas-backend  | Traceback (most recent call last):
prosaas-backend  |   File "/app/server/services/lazy_services.py", line 194, in _warmup
prosaas-backend  |     settings = BusinessSettings.query.filter_by(tenant_id=business_id).first()
prosaas-backend  |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
prosaas-backend  |     return self.limit(1)._iter().first()  # type: ignore
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
prosaas-backend  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
prosaas-backend  |                                                   ^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
prosaas-backend  |     return self._execute_internal(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
prosaas-backend  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
prosaas-backend  |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
prosaas-backend  |     result = conn.execute(
prosaas-backend  |              ^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
prosaas-backend  |     return meth(
prosaas-backend  |            ^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
prosaas-backend  |     return connection._execute_clauseelement(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
prosaas-backend  | 
prosaas-backend  |     ret = self._execute_context(
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP COMPLETE: 0/4 agents ready in 432ms
prosaas-backend  |           ^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  | ğŸš€ System preheated - First AI response will be FAST!
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
prosaas-backend  | 
prosaas-backend  |     return self._exec_single_context(
prosaas-backend  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
prosaas-backend  |     self._handle_dbapi_exception(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
prosaas-backend  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
prosaas-backend  |     self.dialect.do_execute(
prosaas-backend  |   File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
prosaas-backend  |     cursor.execute(statement, parameters)
prosaas-backend  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 10, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | âœ… Service warmup thread completed
prosaas-backend  | âœ… Service warmup thread completed
prosaas-backend  | âš ï¸ Could not load DB prompt for business=1: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
prosaas-backend  | 
prosaas-backend  | [SQL: SELECT business_settings.tenant_id AS business_settings_tenant_id, business_settings.ai_prompt AS business_settings_ai_prompt, business_settings.outbound_ai_prompt AS business_settings_outbound_ai_prompt, business_settings.model AS business_settings_model, business_settings.max_tokens AS business_settings_max_tokens, business_settings.temperature AS business_settings_temperature, business_settings.phone_number AS business_settings_phone_number, business_settings.email AS business_settings_email, business_settings.address AS business_settings_address, business_settings.working_hours AS business_settings_working_hours, business_settings.timezone AS business_settings_timezone, business_settings.slot_size_min AS business_settings_slot_size_min, business_settings.allow_24_7 AS business_settings_allow_24_7, business_settings.opening_hours_json AS business_settings_opening_hours_json, business_settings.booking_window_days AS business_settings_booking_window_days, business_settings.min_notice_min AS business_settings_min_notice_min, business_settings.require_phone_before_booking AS business_settings_require_phone_before_booking, business_settings.generic_webhook_url AS business_settings_generic_webhook_url, business_settings.inbound_webhook_url AS business_settings_inbound_webhook_url, business_settings.outbound_webhook_url AS business_settings_outbound_webhook_url, business_settings.auto_end_after_lead_capture AS business_settings_auto_end_after_lead_capture, business_settings.auto_end_on_goodbye AS business_settings_auto_end_on_goodbye, business_settings.bot_speaks_first AS business_settings_bot_speaks_first, business_settings.enable_calendar_scheduling AS business_settings_enable_calendar_scheduling, business_settings.silence_timeout_sec AS business_settings_silence_timeout_sec, business_settings.silence_max_warnings AS business_settings_silence_max_warnings, business_settings.smart_hangup_enabled AS business_settings_smart_hangup_enabled, business_settings.required_lead_fields AS business_settings_required_lead_fields, business_settings.call_goal AS business_settings_call_goal, business_settings.confirm_before_hangup AS business_settings_confirm_before_hangup, business_settings.stt_vocabulary_json AS business_settings_stt_vocabulary_json, business_settings.business_context AS business_settings_business_context, business_settings.updated_by AS business_settings_updated_by, business_settings.updated_at AS business_settings_updated_at 
prosaas-backend  | FROM business_settings 
prosaas-backend  | WHERE business_settings.tenant_id = %(tenant_id_1)s 
prosaas-backend  |  LIMIT %(param_1)s]
prosaas-backend  | [parameters: {'tenant_id_1': 1, 'param_1': 1}]
prosaas-backend  | (Background on this error at: https://sqlalche.me/e/20/2j85)
prosaas-backend  | ğŸ”¨ CALLING create_booking_agent(business_id=1, channel=whatsapp)
prosaas-backend  | 
prosaas-backend  | âš ï¸  NO DB prompt - using minimal fallback for ×¤×¨×• ×¡××¡
prosaas-backend  | 
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“œ AGENT INSTRUCTIONS (first 500 chars):
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ”’ SYSTEM CONTEXT (READ BUT DON'T MENTION):
prosaas-backend  | TODAY: 2025-12-06 01:27 (Israel)
prosaas-backend  | TOMORROW: 2025-12-07
prosaas-backend  | APPOINTMENT INTERVALS: ×ª×•×¨×™× ×‘×¢×¡×§ ×”×–×” × ×™×ª× ×™× ×œ×§×‘×™×¢×” ×›×œ ×©×¢×” (60 ×“×§×•×ª)
prosaas-backend  | 
prosaas-backend  | âš ï¸ CRITICAL ANTI-HALLUCINATION RULES (BUILD 112):
prosaas-backend  | 1. NEVER say "×§×‘×¢×ª×™"/"×”×¤×’×™×©×” × ×§×‘×¢×”" UNLESS you called calendar_create_appointment() THIS turn and got ok:true
prosaas-backend  | 2. NEVER say "×ª×¤×•×¡"/"×¤× ×•×™"/"×™×© ×ª×•×¨" UNLESS you called calendar_find_slots() THIS turn
prosaas-backend  | 3. NEVER say "×©×œ×—×ª×™ ××™×©×•×¨" UNLESS you called whatsapp_send() THIS turn
prosaas-backend  | 4. ğŸ”¥ BUILD 112: 
prosaas-backend  | ...
prosaas-backend  | ================================================================================
prosaas-backend  | ğŸ“… Today calculated as: 2025-12-06 (Saturday)
prosaas-backend  | ğŸ“… Tomorrow calculated as: 2025-12-07
prosaas-backend  | ================================================================================
prosaas-backend  | 
prosaas-backend  | âœ… create_booking_agent RETURNED: True
prosaas-backend  | â±ï¸  AGENT_CREATION_TIME: 111ms
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (whatsapp)
prosaas-backend  | 
prosaas-backend  | ğŸ‰ WARMUP COMPLETE: 4 agents ready in 1604ms
prosaas-backend  |   ğŸ”¥ Warming 2 active businesses (Agent Cache)...
prosaas-backend  | ğŸ“Š Found 2 businesses to warm up
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (calls)
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (whatsapp)
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (calls)
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (whatsapp)
prosaas-backend  | 
prosaas-backend  | ğŸ‰ WARMUP COMPLETE: 4 agents ready in 2882ms
prosaas-backend  |   âœ… ×¤×¨×• ×¡××¡ (calls): 0ms
prosaas-backend  |   âœ… ×¤×¨×• ×¡××¡ (whatsapp): 0ms
prosaas-backend  |   âœ… ×§×œ×™×‘×¨ (calls): 0ms
prosaas-backend  |   âœ… ×§×œ×™×‘×¨ (whatsapp): 0ms
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ğŸ”¥ğŸ”¥ WARMUP COMPLETE: 4/4 agents ready in 525ms
prosaas-backend  | ğŸš€ System preheated - First AI response will be FAST!
prosaas-backend  | 
prosaas-backend  | âœ… Service warmup thread completed
prosaas-backend  | âœ… DATA PROTECTION: 0 FAQs preserved (no deletions)
prosaas-backend  | âœ… DATA PROTECTION: 25 leads preserved (no deletions)
prosaas-backend  | ğŸ”„ Starting admin roles migration...
prosaas-backend  | ğŸ“Š Found 1 users with legacy roles
prosaas-backend  | ğŸ“ Business admin: 'admin@shai-realestate.co.il' (ID=7): admin -> admin (business_id=1)
prosaas-backend  | 
prosaas-backend  | âœ… Successfully migrated 1 users to new role structure!
prosaas-backend  | ğŸ‘¤ Admin exists (ID=8), resetting password to 'admin123'
prosaas-backend  | âœ… Admin password reset: admin@admin.com / admin123
prosaas-backend  | ğŸ”§ Starting database initialization...
prosaas-backend  | âœ… Business exists: ×¤×¨×• ×¡××¡ (ID: 1)
prosaas-backend  | âœ… System admin user exists: admin@admin.com (ID: 8, role: system_admin, business_id: None)
prosaas-backend  | 
prosaas-backend  | ğŸ“Š Total users in database: 6
prosaas-backend  |   - User 3: manager@shai-realestate.co.il | role=agent | business_id=1
prosaas-backend  |   - User 2: business@shai-offices.co.il | role=owner | business_id=1
prosaas-backend  |   - User 7: admin@shai-realestate.co.il | role=admin | business_id=1
prosaas-backend  |   - User 10: calliber@gmail.com | role=owner | business_id=10
prosaas-backend  |   - User 8: admin@admin.com | role=system_admin | business_id=None
prosaas-backend  |   - User 9: freezeb123@gmail.com | role=owner | business_id=1
prosaas-backend  | âœ… Lead statuses exist: 4 statuses found
prosaas-backend  | âœ… FAQs table exists: 0 FAQs found across all businesses
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ WARMUP: Pre-creating agents for active businesses...
prosaas-backend  | âœ… Business settings exist (slot_size: 60min, 24/7: False)
prosaas-backend  | ğŸ‘¥ Checking user ownership...
prosaas-backend  | INFO:     172.18.0.6:54652 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” LOGIN ATTEMPT: email=calliber@gmail.com
prosaas-backend  | ğŸ”„ Starting User-to-Owner migration...
prosaas-backend  | ğŸ“Š Found 2 businesses
prosaas-backend  | âœ… Business '×¤×¨×• ×¡××¡' (ID=1) already has owner: business@shai-offices.co.il
prosaas-backend  | âœ… Business '×§×œ×™×‘×¨' (ID=10) already has owner: calliber@gmail.com
prosaas-backend  | 
prosaas-backend  | âœ… User-to-Owner migration completed!
prosaas-backend  | 
prosaas-backend  | âœ… All businesses have owners!
prosaas-backend  | âœ… User ownership check completed
prosaas-backend  | âœ… Database initialization completed successfully!
prosaas-backend  | ğŸ“§ Admin login: admin@admin.com / admin123
prosaas-backend  | ğŸ¢ Business ID: 1
prosaas-backend  | âœ… DATA PROTECTION: 0 FAQs preserved (no deletions)
prosaas-backend  | ğŸ“Š Found 2 businesses to warm up
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (calls)
prosaas-backend  | âœ… Warmed: ×§×œ×™×‘×¨ (whatsapp)
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (calls)
prosaas-backend  | âœ… Warmed: ×¤×¨×• ×¡××¡ (whatsapp)
prosaas-backend  | 
prosaas-backend  | ğŸ‰ WARMUP COMPLETE: 4 agents ready in 891ms
prosaas-backend  | âœ… DATA PROTECTION: 25 leads preserved (no deletions)
prosaas-backend  | âœ“ Found user: id=10, email=calliber@gmail.com, role=owner
prosaas-backend  | âœ“ Password hash: scrypt:32768:8:1$NwJjYhcFJjcNjejm$9cc6e19d7dbac0ba...
prosaas-backend  | âœ“ Password verification result: True
prosaas-backend  | ğŸ”„ Starting admin roles migration...
prosaas-backend  | ğŸ“Š Found 1 users with legacy roles
prosaas-backend  | ğŸ“ Business admin: 'admin@shai-realestate.co.il' (ID=7): admin -> admin (business_id=1)
prosaas-backend  | 
prosaas-backend  | âœ… Successfully migrated 1 users to new role structure!
prosaas-backend  | ğŸ” LOGIN SUCCESS: user_id=10, email=calliber@gmail.com, role=owner, business_id=10
prosaas-backend  | INFO:     172.18.0.6:54656 - "POST /api/auth/login HTTP/1.1" 200 OK
prosaas-backend  | ğŸ‘¤ Admin exists (ID=8), resetting password to 'admin123'
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… Admin password reset: admin@admin.com / admin123
prosaas-backend  | ğŸ”§ Starting database initialization...
prosaas-backend  | âœ… call_log created immediately for CA9ba29b9a961e9fcde36242afa32bec19
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CA9ba29b9a961e9fcde36242afa32bec19
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CA9ba29b9a961e9fcde36242afa32bec19
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1467ms - CA9ba29b9a961e9f
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CA9ba29b9a961e9fcde36242afa32bec19" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:33180 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:33196 - "GET /api/auth/me HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     172.18.0.6:56424 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | INFO:     172.18.0.6:56444 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-4c01f23e
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764977275.730] WS_START sid=MZcf6a2703efdae7e50f3beeb1086b1d96 call_sid=CA9ba29b9a961e9fcde36242afa32bec19 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CA9ba29b (FRESH SESSION)
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | âœ… Business exists: ×¤×¨×• ×¡××¡ (ID: 1)
prosaas-backend  | âœ… System admin user exists: admin@admin.com (ID: 8, role: system_admin, business_id: None)
prosaas-backend  | 
prosaas-backend  | ğŸ“Š Total users in database: 6
prosaas-backend  |   - User 3: manager@shai-realestate.co.il | role=agent | business_id=1
prosaas-backend  |   - User 2: business@shai-offices.co.il | role=owner | business_id=1
prosaas-backend  |   - User 7: admin@shai-realestate.co.il | role=admin | business_id=1
prosaas-backend  |   - User 10: calliber@gmail.com | role=owner | business_id=10
prosaas-backend  |   - User 8: admin@admin.com | role=system_admin | business_id=None
prosaas-backend  |   - User 9: freezeb123@gmail.com | role=owner | business_id=1
prosaas-backend  | âœ… Lead statuses exist: 4 statuses found
prosaas-backend  | âœ… FAQs table exists: 0 FAQs found across all businesses
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 479ms (T0+485ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… Business settings exist (slot_size: 60min, 24/7: False)
prosaas-backend  | ğŸ‘¥ Checking user ownership...
prosaas-backend  | ğŸ”„ Starting User-to-Owner migration...
prosaas-backend  | INFO:     172.18.0.6:56432 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ“Š Found 2 businesses
prosaas-backend  | âœ… Business '×¤×¨×• ×¡××¡' (ID=1) already has owner: business@shai-offices.co.il
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | âœ… Business '×§×œ×™×‘×¨' (ID=10) already has owner: calliber@gmail.com
prosaas-backend  | 
prosaas-backend  | âœ… User-to-Owner migration completed!
prosaas-backend  | 
prosaas-backend  | âœ… All businesses have owners!
prosaas-backend  | âœ… User ownership check completed
prosaas-backend  | âœ… Database initialization completed successfully!
prosaas-backend  | ğŸ“§ Admin login: admin@admin.com / admin123
prosaas-backend  | ğŸ¢ Business ID: 1
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 969ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=15s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | ğŸ” [BUILD 309] call_goal=lead_only, confirm_before_hangup=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1076ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CA9ba29b9a961e9fcde36242afa32bec19
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread startedğŸ¯ [T1=1764977276.808] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1078ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=9.3, threshold=109.3)
prosaas-backend  | 
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 596ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=ash for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | âœ… Call log already exists for CA9ba29b9a961e9fcde36242afa32bec19
prosaas-backend  | ğŸ¤ [BUILD 204] Dynamic STT prompt: '×ª××œ×œ ×¢×‘×¨×™×ª ×‘×©×™×—×” ×˜×œ×¤×•× ×™×ª. ×¢×¡×§: ×§×œ×™×‘×¨. ××™×œ×™×: ×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª. ×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.' (95 chars)
prosaas-backend  | âœ… Recording started for CA9ba29b9a961e9fcde36242afa32bec19: REab6a8289abe5c513bd9a9096cd651a6e
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 1059ms (total: 2134ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=ash
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764977277.870
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (GREETING)
prosaas-backend  | ğŸ¯ [BUILD 200] GREETING response.create sent! OpenAI time: 2134ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | [PIPELINE] LIVE AUDIO PIPELINE ACTIVE: Twilio â†’ realtime_audio_in_queue â†’ send_audio_chunk (single path)
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZVNst8rAe8nD9...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZVNst8rAe8nD9... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ“ [PROMPT] Final length: 2366 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ” LOGIN ATTEMPT: email=calliber@gmail.com
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… DATA PROTECTION: 0 FAQs preserved (no deletions)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764977279.746 (duration: 1876ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | â³ [BUILD 303] Waiting for user's first response to greeting...
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI speech not confirmation
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 0ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=15s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (6ms, frames=0)
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 0.8s - now updating session
prosaas-backend  | âœ… DATA PROTECTION: 25 leads preserved (no deletions)
prosaas-backend  | âœ“ Found user: id=10, email=calliber@gmail.com, role=owner
prosaas-backend  | âœ“ Password hash: scrypt:32768:8:1$NwJjYhcFJjcNjejm$9cc6e19d7dbac0ba...
prosaas-backend  | ğŸ”„ Starting admin roles migration...
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated: 2366 chars, voice=ash, max_tokens=4096, stt=gpt-4o-transcribe+Hebrew
prosaas-backend  | âœ“ Password verification result: True
prosaas-backend  | ğŸ“Š Found 1 users with legacy roles
prosaas-backend  | ğŸ“ Business admin: 'admin@shai-realestate.co.il' (ID=7): admin -> admin (business_id=1)
prosaas-backend  | 
prosaas-backend  | âœ… Successfully migrated 1 users to new role structure!
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=fe fe 7e fe fe, rms=9, consec_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=1 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=7e 7e 7e 7e fe, rms=8, consec_frames=0
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=fe 7e 7e 7e 7e, rms=8, consec_frames=0
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ” LOGIN SUCCESS: user_id=10, email=calliber@gmail.com, role=owner, business_id=10
prosaas-backend  | INFO:     172.18.0.6:56456 - "POST /api/auth/login HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | INFO:     172.18.0.6:56472 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ‘¤ Admin exists (ID=8), resetting password to 'admin123'
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | âœ… Admin password reset: admin@admin.com / admin123
prosaas-backend  | ğŸ”§ Starting database initialization...
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | INFO:     127.0.0.1:41762 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:56486 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:56502 - "GET /api/admin/businesses?pageSize=1 HTTP/1.1" 403 Forbidden
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | âœ… Business exists: ×¤×¨×• ×¡××¡ (ID: 1)
prosaas-backend  | âœ… System admin user exists: admin@admin.com (ID: 8, role: system_admin, business_id: None)
prosaas-backend  | 
prosaas-backend  | ğŸ“Š Total users in database: 6
prosaas-backend  |   - User 3: manager@shai-realestate.co.il | role=agent | business_id=1
prosaas-backend  |   - User 2: business@shai-offices.co.il | role=owner | business_id=1
prosaas-backend  |   - User 7: admin@shai-realestate.co.il | role=admin | business_id=1
prosaas-backend  |   - User 10: calliber@gmail.com | role=owner | business_id=10
prosaas-backend  |   - User 8: admin@admin.com | role=system_admin | business_id=None
prosaas-backend  |   - User 9: freezeb123@gmail.com | role=owner | business_id=1
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=152 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | âœ… Lead statuses exist: 4 statuses found
prosaas-backend  | âœ… FAQs table exists: 0 FAQs found across all businesses
prosaas-backend  | âœ… Business settings exist (slot_size: 60min, 24/7: False)
prosaas-backend  | ğŸ‘¥ Checking user ownership...
prosaas-backend  | ğŸ”„ Starting User-to-Owner migration...
prosaas-backend  | ğŸ“Š Found 2 businesses
prosaas-backend  | âœ… Business '×¤×¨×• ×¡××¡' (ID=1) already has owner: business@shai-offices.co.il
prosaas-backend  | âœ… Business '×§×œ×™×‘×¨' (ID=10) already has owner: calliber@gmail.com
prosaas-backend  | 
prosaas-backend  | âœ… User-to-Owner migration completed!
prosaas-backend  | 
prosaas-backend  | âœ… All businesses have owners!
prosaas-backend  | âœ… User ownership check completed
prosaas-backend  | âœ… Database initialization completed successfully!
prosaas-backend  | ğŸ“§ Admin login: admin@admin.com / admin123
prosaas-backend  | ğŸ¢ Business ID: 1
prosaas-backend  | INFO:     172.18.0.6:56508 - "GET /api/dashboard/stats?time_filter=today HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | WS_STOP sid=MZcf6a2703efdae7e50f3beeb1086b1d96 rx=478 tx=222
prosaas-backend  | ğŸ“ [SES-4c01f23e] CALL ENDED - duration=9.5s, business_id=10, rx=478, tx=222
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | INFO:     172.18.0.6:56516 - "GET /api/dashboard/activity?time_filter=today HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:42658 - "GET /api/auth/csrf HTTP/1.1" 200 OK
prosaas-backend  | STREAM_ENDED call=CA9ba29b9a961e9fcde36242afa32bec19 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:42668 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:42672 - "GET /api/admin/businesses?pageSize=1 HTTP/1.1" 403 Forbidden
prosaas-backend  | âœ… Found existing recording for CA9ba29b9a961e9fcde36242afa32bec19: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REab6a8289abe5c513bd9a9096cd651a6e.json
prosaas-backend  | INFO:     172.18.0.6:42686 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CA9ba29b9a961e9fcde36242afa32bec19
prosaas-backend  | ğŸ“Š [FINALIZE] NO USER SPEECH - skipping summary generation for CA9ba29b9a961e9fcde36242afa32bec19
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âœ… CALL FINALIZED (no conversation): CA9ba29b9a961e9fcde36242afa32bec19
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CAdb2cf40c0fbc056a238ba7aeed500a9a
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAdb2cf40c0fbc056a238ba7aeed500a9a
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAdb2cf40c0fbc056a238ba7aeed500a9ağŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1224ms - CAdb2cf40c0fbc05
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAdb2cf40c0fbc056a238ba7aeed500a9a" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:42696 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | INFO:     172.18.0.6:42712 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZcf6a2703efdae7e50f3beeb1086b1d96 rx=478 tx=222
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-ab5d12f1
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764977288.358] WS_START sid=MZ8ca506f0202003bdfb53297421d59396 call_sid=CAdb2cf40c0fbc056a238ba7aeed500a9a from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAdb2cf4 (FRESH SESSION)
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 814ms (T0+816ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 935ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=15s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | ğŸ” [BUILD 309] call_goal=lead_only, confirm_before_hangup=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1037ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAdb2cf40c0fbc056a238ba7aeed500a9a
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread started
prosaas-backend  | ğŸ¯ [T1=1764977289.397] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1039ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=8.0, threshold=108.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 225ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=ash for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | ğŸ¤ [BUILD 204] Dynamic STT prompt: '×ª××œ×œ ×¢×‘×¨×™×ª ×‘×©×™×—×” ×˜×œ×¤×•× ×™×ª. ×¢×¡×§: ×§×œ×™×‘×¨. ××™×œ×™×: ×× ×¢×•×œ×Ÿ, ×× ×¢×•×œ ×—×›×, ×¤×•×¨×¥ ×“×œ×ª×•×ª. ×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.' (95 chars)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1040ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=ash
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764977289.399
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (GREETING)
prosaas-backend  | ğŸ¯ [BUILD 200] GREETING response.create sent! OpenAI time: 1040ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | [PIPELINE] LIVE AUDIO PIPELINE ACTIVE: Twilio â†’ realtime_audio_in_queue â†’ send_audio_chunk (single path)
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZVZoNlPaBvvYh...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZVZoNlPaBvvYh... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… Call log already exists for CAdb2cf40c0fbc056a238ba7aeed500a9a
prosaas-backend  | âœ… Recording started for CAdb2cf40c0fbc056a238ba7aeed500a9a: RE5b1cbc4b17c245ae7c83a54a5fb1fe8a
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ“ [PROMPT] Final length: 2366 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764977290.743 (duration: 1343ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | â³ [BUILD 303] Waiting for user's first response to greeting...
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI speech not confirmation
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 0ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=15s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (8ms, frames=0)
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 0.2s - now updating session
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated: 2366 chars, voice=ash, max_tokens=4096, stt=gpt-4o-transcribe+Hebrew
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=fe fe 7e 7e fe, rms=8, consec_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=1 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=fe fe 7e 7e fe, rms=8, consec_frames=0
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=fe fe fe fe fe, rms=8, consec_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=915.0 > threshold=108.0
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 0.7s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=11200 | silence_ms=519
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=152 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=1873.0 > threshold=108.0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=4409, voice_frames=0
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 16.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | â¸ï¸ [RESPONSE GUARD] Waiting for first user utterance after greeting - skipping (SILENCE_HANDLER:[SYSTEM] User has been silent.)
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=3186, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZVhJ0j02s4kS7...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZVhJ0j02s4kS7... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=302 blocked=0 | active_response=resp_CjZVhJ0j02... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘.' (len=19)
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘....' despite low RMS=8)
prosaas-backend  | âœ… [SIMPLE_MODE] Bypassing all filters - accepting: '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘.'
prosaas-backend  | [STT_FINAL] '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘.' (from raw: '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘....')
prosaas-backend  | ğŸ’° [COST] User utterance: 6.33s (317 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘.
prosaas-backend  | âœ… [BUILD 303] First post-greeting utterance: '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘....' - processing as answer to greeting question
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¨×›×‘' (confidence=77%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 2
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 619dfd44...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=619dfd44...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 2 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?', 'ts': 1764977290.742953}, {'speaker': 'user', 'text': '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘.', 'ts': 1764977297.8726857}]
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=fc fb fd fe ff
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=53 4f 52 4d 4d
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=58 e3 b5 c1 5e
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 4800 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.01s (6 chunks)
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI asking about city
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (38ms, frames=0)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨ ××ª×”' (confidence=50%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 3.1s audio, conversation #1
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=50240 | silence_ms=2958
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #1
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=381 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=217.0 > threshold=108.0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.2s audio, conversation #2
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=19200 | silence_ms=500
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #2
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZVmNCjV88V4Vk...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZVmNCjV88V4Vk... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×§×¨×™××ª×˜×”.' (len=8)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=531 blocked=0 | active_response=resp_CjZVmNCjV8... | ai_speaking=False | barge_in=False
prosaas-backend  | [STT_REPAIRED] '×§×¨×™××ª×˜×”.' â†’ '×§×¨×™××ª ×˜×œ×¤×•×Ÿ.'
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×§×¨×™××ª ×˜×œ×¤×•×Ÿ....' despite low RMS=8)
prosaas-backend  | âœ… [SIMPLE_MODE] Bypassing all filters - accepting: '×§×¨×™××ª ×˜×œ×¤×•×Ÿ.'
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (5951ms)
prosaas-backend  | [STT_FINAL] '×§×¨×™××ª ×˜×œ×¤×•×Ÿ.' (from raw: '×§×¨×™××ª×˜×”....')
prosaas-backend  | ğŸ’° [COST] User utterance: 5.48s (543 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×§×¨×™××ª ×˜×œ×¤×•×Ÿ.
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×˜×œ×¤×•×Ÿ.' (confidence=53%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×§×¨×™××ª ×˜×œ×¤×•×Ÿ....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×§×¨×™××ª ×˜×œ×¤×•×Ÿ....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 4
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘.', '×§×¨×™××ª ×˜×œ×¤×•×Ÿ.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: c3e4afc9...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (619dfd44 â†’ c3e4afc9) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=c3e4afc9...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×§×¨×™××ª ×˜×œ×¤×•×Ÿ....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 4 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘.', 'ts': 1764977297.8726857}, {'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764977298.3513331}, {'speaker': 'user', 'text': '×§×¨×™××ª ×˜×œ×¤×•×Ÿ.', 'ts': 1764977303.8233824}]
prosaas-backend  | 
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=6f 69 6e 75 78
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=b8 b7 e8 46 3f
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=e5 c5 c4 d7 4b
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6936 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×©×™×¨×•×ª ×œ×¨×›×‘ ×‘×¢×™×¨ ×§×¨×™×™×ª ××ª×, × ×›×•×Ÿ?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.01s (24 chunks)
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (19ms, frames=0)
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×©×™×¨×•×ª ×œ×¨×›...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | [PIPELINE STATUS] sent=634 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | INFO:     172.18.0.6:56318 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=785 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=390.0 > threshold=108.0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 0.8s audio, conversation #3
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=12800 | silence_ms=520
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #3
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZVvo4skt7bGL0...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZVvo4skt7bGL0... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×›×Ÿ.' (len=3)
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 2/2 after 16.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | â¸ï¸ [RESPONSE GUARD] Waiting for first user utterance after greeting - skipping (SILENCE_HANDLER:[SYSTEM] User has been silent.)
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | [PIPELINE STATUS] sent=935 blocked=0 | active_response=resp_CjZVvo4skt... | ai_speaking=False | barge_in=False
prosaas-backend  | INFO:     172.18.0.6:56330 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:52986 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×›×Ÿ....' despite low RMS=8)
prosaas-backend  | âœ… [SIMPLE_MODE] Bypassing all filters - accepting: '×›×Ÿ.'
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (8856ms)
prosaas-backend  | [STT_FINAL] '×›×Ÿ.' (from raw: '×›×Ÿ....')
prosaas-backend  | ğŸ’° [COST] User utterance: 8.60s (938 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×›×Ÿ.
prosaas-backend  | âš ï¸ [BUILD 186] INCOHERENT: Response '×›×Ÿ.' doesn't match city question
prosaas-backend  | ğŸ”„ [BUILD 186] Marked incoherent response - AI will ask for clarification
prosaas-backend  | âœ… [BUILD 176] User CONFIRMED with '×›×Ÿ.' - verification_confirmed = True
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×›×Ÿ....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×›×Ÿ....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 6
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×× ×™ ×¦×¨×™×š ×¤×•×¨×¥ ×œ×¨×›×‘.', '×§×¨×™××ª ×˜×œ×¤×•×Ÿ.', '×›×Ÿ.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: f8d0e4ae...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (c3e4afc9 â†’ f8d0e4ae) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=f8d0e4ae...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×›×Ÿ....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=fe fe fc fd 7b
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=65 5c 55 52 4f
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=fc d5 ca c1 be
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | 
prosaas-backend  | ğŸ” [NLP] Conversation history has 6 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×§×¨×™××ª ×˜×œ×¤×•×Ÿ.', 'ts': 1764977303.8233824}, {'speaker': 'ai', 'text': '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×©×™×¨×•×ª ×œ×¨×›×‘ ×‘×¢×™×¨ ×§×¨×™×™×ª ××ª×, × ×›×•×Ÿ?', 'ts': 1764977304.0828278}, {'speaker': 'user', 'text': '×›×Ÿ.', 'ts': 1764977312.6793628}]
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking audio - AI speaking (rms=8, frames=0/5)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ××œ×™×š ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª. ×ª×•×“×” ×•×œ×”×ª×¨××•×ª.
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.51s (48 chunks)
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI speech not confirmation
prosaas-backend  | [GOODBYE CHECK] Clear goodbye detected: '××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™×...'
prosaas-backend  | âœ… [HANGUP] User confirmed all details - disconnecting
prosaas-backend  | ğŸ“ [STATE] Transitioning ACTIVE â†’ CLOSING (reason: user_verified)
prosaas-backend  | ğŸ“ [BUILD 163] Pending hangup set - will disconnect after audio finishes playing
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | âœ… [POLITE HANGUP] OpenAI queue empty after 0ms
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 283 frames...
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (6ms, frames=0)
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 233 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | INFO:     172.18.0.6:60388 - "GET /api/business/current HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 182 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=1021 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 132 frames...
prosaas-backend  | INFO:     172.18.0.6:60396 - "GET /api/business/current/prompt HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 82 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 31 frames...
prosaas-backend  | [PIPELINE STATUS] sent=1172 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | âœ… [POLITE HANGUP] Twilio TX queue empty after 5700ms
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #3 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
prosaas-backend  | ğŸ“ [BUILD 303] SMART HANGUP - Scheduling goodbye before disconnect...
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (SILENCE_HANDLER:[SYSTEM] ×”×©×™×—×” ××¡×ª×™×™××ª. ×××•×¨: )
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZW4WGyEa5jJ3y...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZW4WGyEa5jJ3y... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=ff ff ff ff 7e
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking audio - AI speaking (rms=8, frames=0/5)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=f2 cb b7 ae ad
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=4c 4b 39 3d 3f
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6400 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | âœ… [POLITE HANGUP] OpenAI queue empty after 0ms
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 151 frames...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | âš ï¸ [LOOP DETECT] AI repeating! Similarity=100% with: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?...'
prosaas-backend  | â­ï¸ [LOOP GUARD] Skipped - call is ending (closing=True, hangup=False)
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.79s (63 chunks)
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI speech not confirmation
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | âœ… [POLITE HANGUP] OpenAI queue empty after 0ms
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 151 frames...
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (9ms, frames=0)
prosaas-backend  | [PIPELINE STATUS] sent=1309 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 101 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 101 frames...
prosaas-backend  | [WA-SESSION] ğŸ“± Check #1: Found 0 stale sessions to process
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 51 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 50 frames...
prosaas-backend  | WS_STOP sid=MZ8ca506f0202003bdfb53297421d59396 rx=1822 tx=975
prosaas-backend  | ğŸ“ [SES-ab5d12f1] CALL ENDED - duration=36.4s, business_id=10, rx=1822, tx=975
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CAdb2cf40c0fbc056a238ba7aeed500a9a stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:43216 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | INFO:     172.18.0.6:43228 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CAdb2cf40c0fbc056a238ba7aeed500a9a: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE5b1cbc4b17c245ae7c83a54a5fb1fe8a.json
prosaas-backend  | âœ… Recording queued for processing: CAdb2cf40c0fbc056a238ba7aeed500a9a
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | INFO:     connection closed
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ”‡ [SILENCE] Max warnings exceeded - initiating polite hangup
prosaas-backend  | â¸ï¸ [RESPONSE GUARD] Waiting for first user utterance after greeting - skipping (SILENCE_HANDLER:[SYSTEM] User has been silent )
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=22) retry #10
prosaas-backend  | âœ… CALL FINALIZED: CAdb2cf40c0fbc056a238ba7aeed500a9a
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×”×¤× ×™×™×” ×”×™× ×‘×ª×—×•× ×©×™×¨×•×ª×™ ×”×× ×¢×•×œ× ×•×ª, ×¡×¤×¦×™×¤×™×ª ×¤×•×¨×¥ ×œ×¨×›×‘.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | - **×©×™×¨×•×ª × ×“×¨×©**: ×¤×•×¨×¥ ×œ×¨×›×‘
prosaas-backend  | - **××™×§×•×**: ×§×¨×™×™×ª ××ª×
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×œ×§×•×— ×›××• ×©× ××• ×××¦×¢×™ ×”×ª×§×©×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - **×¤×¢×•×œ×”**: ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ×œ×œ×§×•×— ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª.
prosaas-backend  | - **×“×—×™×¤×•×ª**: ×’×‘×•×”×”, ×©×›×Ÿ ××“×•×‘×¨ ×‘×©×™×¨×•×ª ×¤×•×¨×¥ ×œ×¨×›×‘.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×™×© ×œ×•×•×“× ×©×”×œ×§×•×— ××§×‘×œ ××ª ×”×©×™×¨×•×ª ×‘×”×§×“× ×”××¤×©×¨×™, ××›×™×•×•×Ÿ ×©××“×•×‘×¨ ×‘××¦×‘ ×“×—×•×£. ××•××œ×¥ ×œ×¢×§×•×‘ ××—×¨×™ ×”×¤× ×™×™×” ×•×œ×•×•×“× ×©×”×œ×§×•×— ××¨×•×¦×” ××”×©×™×¨×•×ª ×©× ×™×ª×Ÿ ×œ×•.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ8ca506f0202003bdfb53297421d59396 rx=1822 tx=975
prosaas-backend  | ğŸ“ [BUILD 303] SMART HANGUP - Scheduling goodbye before disconnect...
prosaas-backend  | â¸ï¸ [RESPONSE GUARD] Waiting for first user utterance after greeting - skipping (SILENCE_HANDLER:[SYSTEM] ×”×©×™×—×” ××¡×ª×™×™××ª. ×××•×¨: )
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Extracted SPECIFIC service from AI confirmation: '×©×™×¨×•×ª ×œ×¨×›×‘'
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True'}
prosaas-backend  |    â””â”€ City from transcript (fuzzy): ×¦×¤×•×Ÿ ×ª×œ ××‘×™×‘ (confidence=90%)
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CAdb2cf40c0fbc056a238ba7aeed500a9a, phone=+972504294724, city=×¦×¤×•×Ÿ ×ª×œ ××‘×™×‘, direction=inbound
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×¦×¤×•×Ÿ ×ª×œ ××‘×™×‘, service=×©×™×¨×•×ª ×œ×¨×›×‘
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 22 frames...
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=22) retry #20
prosaas-backend  | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
prosaas-backend  | ğŸ“ [SMART HANGUP] === CALL ENDING ===
prosaas-backend  | ğŸ“ [SMART HANGUP] Reason: silence_timeout
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead captured: False
prosaas-backend  | ğŸ“ [SMART HANGUP] Goodbye detected: False
prosaas-backend  | ğŸ“ [SMART HANGUP] Lead state: {}
prosaas-backend  | ğŸ“ [SMART HANGUP] Required fields: ['city', 'service_type']
prosaas-backend  | ğŸ“ [SMART HANGUP] ===================
prosaas-backend  | âœ… [BUILD 163] Call CA9ba29b... hung up successfully: silence_timeout
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=22) retry #30
prosaas-backend  | âš ï¸ [BUILD 178] Max hangup retries exceeded - forcing hangup
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:55154 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:36086 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | INFO:     172.18.0.6:44274 - "PUT /api/business/current/settings HTTP/1.1" 200 OK
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CA99a246f634fa49beefd623e7e7dae120
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CA99a246f634fa49beefd623e7e7dae120
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CA99a246f634fa49beefd623e7e7dae120ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1297ms - CA99a246f634fa49
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CA99a246f634fa49beefd623e7e7dae120" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:37100 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:37112 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-0345aaa8
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764977357.700] WS_START sid=MZ146caee64df1e6914b8455e3617a6e1e call_sid=CA99a246f634fa49beefd623e7e7dae120 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CA99a246 (FRESH SESSION)âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | 
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 476ms (T0+480ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 1094ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=15s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | ğŸ” [BUILD 309] call_goal=lead_only, confirm_before_hangup=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1202ms
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread started
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CA99a246f634fa49beefd623e7e7dae120
prosaas-backend  | ğŸ¯ [T1=1764977358.907] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1207ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=8.0, threshold=108.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 729ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=ash for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | âœ… Call log already exists for CA99a246f634fa49beefd623e7e7dae120
prosaas-backend  | âœ… Recording started for CA99a246f634fa49beefd623e7e7dae120: REe55c66fa59e75b7033a61c16759e34e6
prosaas-backend  | ğŸ¤ [BUILD 204] Dynamic STT prompt: '×ª××œ×œ ×¢×‘×¨×™×ª ×‘×©×™×—×” ×˜×œ×¤×•× ×™×ª. ×¢×¡×§: ×§×œ×™×‘×¨. ×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.' (57 chars)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 1150ms (total: 2355ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=ash
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764977360.060
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (GREETING)
prosaas-backend  | ğŸ¯ [BUILD 200] GREETING response.create sent! OpenAI time: 2356ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | [PIPELINE] LIVE AUDIO PIPELINE ACTIVE: Twilio â†’ realtime_audio_in_queue â†’ send_audio_chunk (single path)
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZWi8Qb42Attra...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZWi8Qb42Attra... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ“ [PROMPT] Final length: 2366 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764977361.580 (duration: 1520ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | â³ [BUILD 303] Waiting for user's first response to greeting...
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=15s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI speech not confirmation
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (13ms, frames=0)
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 0.4s - now updating session
prosaas-backend  | WS_STOP sid=MZ146caee64df1e6914b8455e3617a6e1e rx=210 tx=66
prosaas-backend  | ğŸ“ [SES-0345aaa8] CALL ENDED - duration=4.2s, business_id=10, rx=210, tx=66
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | STREAM_ENDED call=CA99a246f634fa49beefd623e7e7dae120 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:37122 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated: 2366 chars, voice=ash, max_tokens=4096, stt=gpt-4o-transcribe+Hebrew
prosaas-backend  | INFO:     172.18.0.6:37138 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | â„¹ï¸ Call CA99a246f634fa49beefd623e7e7dae120 ended without recording (status: completed)
prosaas-backend  | ğŸ“Š [FINALIZE] NO USER SPEECH - skipping summary generation for CA99a246f634fa49beefd623e7e7dae120
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âœ… CALL FINALIZED (no conversation): CA99a246f634fa49beefd623e7e7dae120
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ146caee64df1e6914b8455e3617a6e1e rx=210 tx=66
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CAf4ab1fee8fa2dcf762ac942502a796bd
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAf4ab1fee8fa2dcf762ac942502a796bd
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAf4ab1fee8fa2dcf762ac942502a796bdğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1329ms - CAf4ab1fee8fa2dc
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAf4ab1fee8fa2dcf762ac942502a796bd" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | INFO:     172.18.0.6:38662 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:38666 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-c335ba4b
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764977367.962] WS_START sid=MZ842ccc4a5ec2351c81183aa78749351f call_sid=CAf4ab1fee8fa2dcf762ac942502a796bd from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAf4ab1f (FRESH SESSION)
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 451ms (T0+452ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 1052ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=15s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | ğŸ” [BUILD 309] call_goal=lead_only, confirm_before_hangup=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1157ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAf4ab1fee8fa2dcf762ac942502a796bd
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread started
prosaas-backend  | ğŸ¯ [T1=1764977369.120] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1158ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=8.0, threshold=108.0)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 708ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=ash for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | ğŸ¤ [BUILD 204] Dynamic STT prompt: '×ª××œ×œ ×¢×‘×¨×™×ª ×‘×©×™×—×” ×˜×œ×¤×•× ×™×ª. ×¢×¡×§: ×§×œ×™×‘×¨. ×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.' (57 chars)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 0ms (total: 1160ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=ash
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764977369.124
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (GREETING)
prosaas-backend  | ğŸ¯ [BUILD 200] GREETING response.create sent! OpenAI time: 1160ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | [PIPELINE] LIVE AUDIO PIPELINE ACTIVE: Twilio â†’ realtime_audio_in_queue â†’ send_audio_chunk (single path)
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZWrWZZb28DY4T...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZWrWZZb28DY4T... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Call log already exists for CAf4ab1fee8fa2dcf762ac942502a796bd
prosaas-backend  | âœ… Recording started for CAf4ab1fee8fa2dcf762ac942502a796bd: REcc5ca6af9c4e41d5cb0f6750831a5ccf
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ“ [PROMPT] Final length: 2366 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764977370.560 (duration: 1437ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | â³ [BUILD 303] Waiting for user's first response to greeting...
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=15s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI speech not confirmation
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (12ms, frames=0)
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 0.4s - now updating session
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated: 2366 chars, voice=ash, max_tokens=4096, stt=gpt-4o-transcribe+Hebrew
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=fe fe fe 7e fe, rms=8, consec_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=1 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=7e 7e fe fe fe, rms=8, consec_frames=0
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=fe fe fe fe fe, rms=8, consec_frames=0
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:38674 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:36140 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=152 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=302 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 16.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | â¸ï¸ [RESPONSE GUARD] Waiting for first user utterance after greeting - skipping (SILENCE_HANDLER:[SYSTEM] User has been silent.)
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=270, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=270.0 > threshold=108.0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=951, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=901, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=453 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZX37FnWX0hkMN...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZX37FnWX0hkMN... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=17, voice_frames=0
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.' (len=31)
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×...' despite low RMS=29)
prosaas-backend  | âœ… [SIMPLE_MODE] Bypassing all filters - accepting: '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.'
prosaas-backend  | [STT_FINAL] '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.' (from raw: '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×...')
prosaas-backend  | ğŸ’° [COST] User utterance: 11.03s (553 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.
prosaas-backend  | âœ… [BUILD 303] First post-greeting utterance: '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×....' - processing as answer to greeting question
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=150.0 > threshold=108.0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×× ×¢×•×œ ×—×›×.' (confidence=49%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 2
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 83721d4c...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=83721d4c...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 2 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?', 'ts': 1764977370.5615962}, {'speaker': 'user', 'text': '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.', 'ts': 1764977382.406901}]
prosaas-backend  | 
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=dc d1 d4 d6 db
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=49 3d 40 40 47
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=40 30 3f 3c 2e
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 6 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.00s (6 chunks)
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI asking about city
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (11ms, frames=0)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨ ××ª×”' (confidence=50%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | [PIPELINE STATUS] sent=554 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=13, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZX6DNNteHADTP...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZX6DNNteHADTP... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 5.7s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=90880 | silence_ms=1815
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.' (len=19)
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£....' despite low RMS=8)
prosaas-backend  | âœ… [SIMPLE_MODE] Bypassing all filters - accepting: '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.'
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (2741ms)
prosaas-backend  | [STT_FINAL] '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.' (from raw: '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£....')
prosaas-backend  | ğŸ’° [COST] User utterance: 1.35s (646 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.
prosaas-backend  | ğŸ”„ [BUILD 168] User wants CORRECTION - resetting verification state
prosaas-backend  | â³ [BUILD 308] POST-REJECTION COOL-OFF - AI will wait for user to speak
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×ª××œ×œ, ×œ×' (confidence=51%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 4
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.', '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 015e6479...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (83721d4c â†’ 015e6479) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=015e6479...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£....'ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 4 messages
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | 
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.', 'ts': 1764977382.406901}, {'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764977383.1885526}, {'speaker': 'user', 'text': '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.', 'ts': 1764977385.1478899}]
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=f7 75 73 74 64
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=4b 42 68 c0 ae
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=5c 53 5b 5a 56
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking audio - AI speaking (rms=45, frames=0/5)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›× ×‘×¢×™×¨ ×—×™×¤×”, × ×›×•×Ÿ?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.64s (25 chunks)
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (21ms, frames=0)
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×”×ª×§× ×ª ×× ×¢...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=959.0 > threshold=108.0
prosaas-backend  | [PIPELINE STATUS] sent=673 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': None, 'time': None, 'name': None, 'phone': None, 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=64, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=17, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=63, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=824 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=555.0 > threshold=108.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=40, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8229, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=33, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZXFGr9hhzLFUH...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZXFGr9hhzLFUH... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | [PIPELINE STATUS] sent=974 blocked=0 | active_response=resp_CjZXFGr9hh... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=148.0 > threshold=108.0
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×œ×, ×œ× × ×›×•×Ÿ.' (len=12)
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 2/2 after 16.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | â¸ï¸ [RESPONSE GUARD] Waiting for first user utterance after greeting - skipping (SILENCE_HANDLER:[SYSTEM] User has been silent.)
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=187, voice_frames=0
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×œ×, ×œ× × ×›×•×Ÿ....' despite low RMS=14)
prosaas-backend  | âœ… [SIMPLE_MODE] Bypassing all filters - accepting: '×œ×, ×œ× × ×›×•×Ÿ.'
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (9398ms)
prosaas-backend  | [STT_FINAL] '×œ×, ×œ× × ×›×•×Ÿ.' (from raw: '×œ×, ×œ× × ×›×•×Ÿ....')
prosaas-backend  | ğŸ’° [COST] User utterance: 8.87s (1037 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×œ×, ×œ× × ×›×•×Ÿ.
prosaas-backend  | âš ï¸ [BUILD 303] NEGATIVE ANSWER detected: '×œ×, ×œ× × ×›×•×Ÿ.' - user is rejecting/correcting
prosaas-backend  | âœ… [BUILD 176] User CONFIRMED with '×œ×, ×œ× × ×›×•×Ÿ.' - verification_confirmed = True
prosaas-backend  | ğŸ”„ [BUILD 168] User wants CORRECTION - resetting verification state
prosaas-backend  | â³ [BUILD 308] POST-REJECTION COOL-OFF - AI will wait for user to speak
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '× ×›×•×Ÿ.' (confidence=48%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×œ×, ×œ× × ×›×•×Ÿ....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×œ×, ×œ× × ×›×•×Ÿ....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 6
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.', '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.', '×œ×, ×œ× × ×›×•×Ÿ.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 633b28ac...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (015e6479 â†’ 633b28ac) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=633b28ac...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×œ×, ×œ× × ×›×•×Ÿ....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.deltağŸ” [NLP] Conversation history has 6 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.', 'ts': 1764977385.1478899}, {'speaker': 'ai', 'text': '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›× ×‘×¢×™×¨ ×—×™×¤×”, × ×›×•×Ÿ?', 'ts': 1764977386.3057997}, {'speaker': 'user', 'text': '×œ×, ×œ× × ×›×•×Ÿ.', 'ts': 1764977394.5465975}]
prosaas-backend  | 
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=f8 f8 ff 7b 77
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=44 38 3c 3c 42
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=69 c4 bd b0 ac
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | â›” [BARGE-IN] User started talking while AI speaking - HARD CANCEL!
prosaas-backend  |    active_response_id=resp_CjZXFGr9hhzLFUH...
prosaas-backend  |    is_ai_speaking=True
prosaas-backend  |    âœ… Sent response.cancel to OpenAI
prosaas-backend  | ğŸ§¹ [TX_FLUSH] Flushed 73 frames (was 73, reason=BARGE_IN)
prosaas-backend  |    âœ… [BARGE-IN] Response cancelled, guards cleared, queue flushed
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××•×§×™×™, ××– ×¨×§ ××•×•×“××ª ×©×•×‘â€”
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.00s (32 chunks)
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI speech not confirmation
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '××•×§×™×™, ××– ×¨×§ ××•×•×“××ª ×©×•×‘â€”...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=1, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | âœ… [BARGE-IN] User utterance completed - barge-in ended (duration=0.2s)
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZXGAdw9fI62cZ...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZXGAdw9fI62cZ... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (206ms, frames=0)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=0, details={'type': 'cancelled', 'reason': 'client_cancelled'}
prosaas-backend  | âœ… [BUILD 200] Response lifecycle complete: resp_CjZXGAdw9fI62cZ... -> None (status=cancelled)
prosaas-backend  | ğŸ”„ [BUILD 187] Response cancelled with NO audio! Scheduling recovery...
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×‘×”×¦×œ×—×”.' (len=7)
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×‘×”×¦×œ×—×”....' despite low RMS=13)
prosaas-backend  | âœ… [SIMPLE_MODE] Bypassing all filters - accepting: '×‘×”×¦×œ×—×”.'
prosaas-backend  | [STT_FINAL] '×‘×”×¦×œ×—×”.' (from raw: '×‘×”×¦×œ×—×”....')
prosaas-backend  | ğŸ’° [COST] User utterance: 1.14s (1080 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×‘×”×¦×œ×—×”.
prosaas-backend  | âœ… [BUILD 308] User provided content - clearing cool-off flag
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×‘×”×¦×œ×—×”.' (confidence=43%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×‘×”×¦×œ×—×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×‘×”×¦×œ×—×”....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 8
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×× ×™ ×¦×¨×™×š ×‘×‘×§×©×” ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.', '×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.', '×œ×, ×œ× × ×›×•×Ÿ.', '×‘×”×¦×œ×—×”.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 7291ef79...
prosaas-backend  | â­ï¸ [NLP] BLOCKED - Another NLP thread is still processing
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×‘×”×¦×œ×—×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 8.3s audio, conversation #1
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=133120 | silence_ms=1823
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #1
prosaas-backend  | [PIPELINE STATUS] sent=1094 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=136.0 > threshold=108.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=154, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': None, 'time': None, 'name': None, 'phone': None, 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #3 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=14, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | [PIPELINE STATUS] sent=1245 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=710.0 > threshold=108.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=759, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=366, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=266, voice_frames=0
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | [PIPELINE STATUS] sent=1396 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | WS_STOP sid=MZ842ccc4a5ec2351c81183aa78749351f rx=1721 tx=539
prosaas-backend  | ğŸ“ [SES-c335ba4b] CALL ENDED - duration=34.4s, business_id=10, rx=1721, tx=539
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:51360 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | STREAM_ENDED call=CAf4ab1fee8fa2dcf762ac942502a796bd stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:34370 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | INFO:     172.18.0.6:34374 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | INFO:     127.0.0.1:32814 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | âœ… Found existing recording for CAf4ab1fee8fa2dcf762ac942502a796bd: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REcc5ca6af9c4e41d5cb0f6750831a5ccf.json
prosaas-backend  | âœ… Recording queued for processing: CAf4ab1fee8fa2dcf762ac942502a796bd
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CAe022e0a3164e314f91985c44ebc0aca2
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CAe022e0a3164e314f91985c44ebc0aca2
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CAe022e0a3164e314f91985c44ebc0aca2ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âœ… incoming_call: 1261ms - CAe022e0a3164e31
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | 
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CAe022e0a3164e314f91985c44ebc0aca2" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:34388 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | INFO:     172.18.0.6:34392 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-3c5da338
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764977405.660] WS_START sid=MZ51b2038c19282a1540bb1bfc0a7c617f call_sid=CAe022e0a3164e314f91985c44ebc0aca2 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CAe022e0 (FRESH SESSION)
prosaas-backend  | âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 518ms (T0+519ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 1116ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=15s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | ğŸ” [BUILD 309] call_goal=lead_only, confirm_before_hangup=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1227ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CAe022e0a3164e314f91985c44ebc0aca2
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread started
prosaas-backend  | ğŸ¯ [T1=1764977406.888] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1228ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progress
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=11.6, threshold=111.5)
prosaas-backend  | âœ… [PARALLEL] Business info ready! Wait time: 712ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=ash for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | ğŸ¤ [BUILD 204] Dynamic STT prompt: '×ª××œ×œ ×¢×‘×¨×™×ª ×‘×©×™×—×” ×˜×œ×¤×•× ×™×ª. ×¢×¡×§: ×§×œ×™×‘×¨. ×¨×§ ×ª××œ×œ, ×œ× ×œ×”×•×¡×™×£.' (57 chars)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 1ms (total: 1231ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=ash
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764977406.891
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (GREETING)
prosaas-backend  | ğŸ¯ [BUILD 200] GREETING response.create sent! OpenAI time: 1231ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | [PIPELINE] LIVE AUDIO PIPELINE ACTIVE: Twilio â†’ realtime_audio_in_queue â†’ send_audio_chunk (single path)
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZXSExgzg8FHPw...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZXSExgzg8FHPw... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… CALL FINALIZED: CAf4ab1fee8fa2dcf762ac942502a796bd
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×”×¤× ×™×™×” ×”×™× ×‘×ª×—×•× ×©×™×¨×•×ª×™ ×”×× ×¢×•×œ× ×•×ª, ×¡×¤×¦×™×¤×™×ª ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | ×”×œ×§×•×— ××¢×•× ×™×™×Ÿ ×‘×©×™×¨×•×ª ×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×, ××š ×œ× ×¦×™×™×Ÿ ××ª ×”×¢×™×¨ ×‘×” ×”×•× × ××¦×.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×œ×§×•×— ×›××• ×©× ××• ×××¦×¢×™ ×”×ª×§×©×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | ×œ× × ×§×‘×¢×” ×¤×’×™×©×” ××• ×ª×•×¨, ×•×”×“×—×™×¤×•×ª ×œ× ×”×•×’×“×¨×”. ×™×© ×¦×•×¨×š ×‘××¢×§×‘ × ×•×¡×£ ×›×“×™ ×œ×”×‘×™×Ÿ ××ª ××™×§×•× ×”×œ×§×•×— ×•×œ×ª×× ××ª ×”×©×™×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×™×© ×œ×•×•×“× ×¢× ×”×œ×§×•×— ××ª ×”××™×§×•× ×”××“×•×™×§ ×©×œ×• ×›×“×™ ×œ×”×¦×™×¢ ×©×™×¨×•×ª ××ª××™×. ××•××œ×¥ ×œ×—×–×•×¨ ×œ×œ×§×•×— ×¢× ×©××œ×•×ª × ×•×¡×¤×•×ª ×¢×œ ×”×¦×¨×›×™× ×©×œ×•, ×›××• ×¡×•×’ ×”×× ×¢×•×œ ×”×—×›× ×”××•×¢×“×£ ×¢×œ×™×• ××• ×ª××¨×™×š ××•×¢×“×£ ×œ×”×ª×§× ×”.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Call log already exists for CAe022e0a3164e314f91985c44ebc0aca2
prosaas-backend  | âœ… Recording started for CAe022e0a3164e314f91985c44ebc0aca2: REe78775f2afd7a3e864c0c83253295837
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ“ [PROMPT] Final length: 2366 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6400 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764977408.344 (duration: 1453ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | â³ [BUILD 303] Waiting for user's first response to greeting...
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=15s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI speech not confirmation
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 0ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (15ms, frames=0)
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ842ccc4a5ec2351c81183aa78749351f rx=1721 tx=539
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 0.4s - now updating session
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Extracted SPECIFIC service from AI confirmation: '×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×'
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True'}
prosaas-backend  |    â””â”€ City from transcript (fuzzy): ×—×™×¤×” (confidence=90%)
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CAf4ab1fee8fa2dcf762ac942502a796bd, phone=+972504294724, city=×—×™×¤×”, direction=inbound
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=5a 50 50 5d 6f, rms=615, consec_frames=1
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=615.0 > threshold=111.5
prosaas-backend  | [PIPELINE STATUS] sent=1 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=e1 de de 76 ef, rms=353, consec_frames=2
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×—×™×¤×”, service=×”×ª×§× ×ª ×× ×¢×•×œ ×—×›×
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=5e 5f 72 fa e8, rms=316, consec_frames=3
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated: 2366 chars, voice=ash, max_tokens=4096, stt=gpt-4o-transcribe+Hebrew
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ”‡ [SILENCE] Max warnings exceeded - initiating polite hangup
prosaas-backend  | â¸ï¸ [RESPONSE GUARD] Waiting for first user utterance after greeting - skipping (SILENCE_HANDLER:[SYSTEM] User has been silent )
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 0.6s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=9600 | silence_ms=952
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=130 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 15.8s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (SILENCE_HANDLER:[SYSTEM] User has been silent.)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZXXRaEN5sgWEW...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZXXRaEN5sgWEW... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”„ [BUILD 187] New response created - cancelling recovery
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=48, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=df cd dd ef eb
prosaas-backend  | ğŸ“ [BUILD 303] SMART HANGUP - Scheduling goodbye before disconnect...
prosaas-backend  | â¸ï¸ [RESPONSE GUARD] Waiting for first user utterance after greeting - skipping (SILENCE_HANDLER:[SYSTEM] ×”×©×™×—×” ××¡×ª×™×™××ª. ×××•×¨: )
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=fb f9 fb fc fc
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=d2 c1 cf c5 b8
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6936 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 12 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××ª×” ×¢×“×™×™×Ÿ ××™×ª×™? ×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.59s (44 chunks)
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI asking about city
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=509.0 > threshold=111.5
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=108, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×¢×“×™
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¢×“×™'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×¢×“×™×™×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¢×“×™', 'raw_city': '×¢×“×™×™×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=90.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¢×“×™', 'raw_city': '×¢×“×™×™×Ÿ', 'city_confidence': '90.0'}
prosaas-backend  | âœ… [CITY] Auto-accepted AND locked: '×¢×“×™' (confidence=90%)
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '××ª×” ×¢×“×™×™×Ÿ ××™×ª×™? ×‘××™×–×• ×¢×™×¨ ××ª×” ...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 12 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | [PIPELINE STATUS] sent=281 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=12, voice_frames=0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=17, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZXcSeZNe7S1ED...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZXcSeZNe7S1ED... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 6.8s audio, conversation #1
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=109440 | silence_ms=1813
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #1
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=fe ff 7d 7c 7b
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking audio - AI speaking (rms=15, frames=0/5)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=4f 4e 51 53 56
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=60 67 73 f2 e2
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª.' (len=15)
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª....' despite low RMS=17)
prosaas-backend  | âœ… [SIMPLE_MODE] Bypassing all filters - accepting: '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª.'
prosaas-backend  | [STT_FINAL] '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª.' (from raw: '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª....')
prosaas-backend  | ğŸ’° [COST] User utterance: 8.55s (399 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª.
prosaas-backend  | âœ… [BUILD 303] First post-greeting utterance: '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª....' - processing as answer to greeting question
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×ª×•×ª' (confidence=43%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 2
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 3ddf6a42...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=3ddf6a42...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 2 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?', 'ts': 1764977408.3447285}, {'speaker': 'user', 'text': '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª.', 'ts': 1764977417.233768}]
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6400 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.48s (7 chunks)
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI asking about city
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (19ms, frames=0)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨ ××ª×”' (confidence=50%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=400 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=1904.0 > threshold=111.5
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=16, voice_frames=0
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=186) retry #10
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 1.1s audio, conversation #2
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=17920 | silence_ms=500
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #2
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZXhZUS8noOJvY...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZXhZUS8noOJvY... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=13, voice_frames=0
prosaas-backend  | [PIPELINE STATUS] sent=550 blocked=0 | active_response=resp_CjZXhZUS8n... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=fc fc fd fd fd
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking audio - AI speaking (rms=19, frames=0/5)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=dd cd d4 e4 c9
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [STT_RAW] '×¢×¤×•×œ×”.' (len=6)
prosaas-backend  | [SILENCE GATE] âœ… TRUSTED (OpenAI heard '×¢×¤×•×œ×”....' despite low RMS=10)
prosaas-backend  | âœ… [SIMPLE_MODE] Bypassing all filters - accepting: '×¢×¤×•×œ×”.'
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (5864ms)
prosaas-backend  | [STT_FINAL] '×¢×¤×•×œ×”.' (from raw: '×¢×¤×•×œ×”....')
prosaas-backend  | ğŸ’° [COST] User utterance: 4.11s (554 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×¢×¤×•×œ×”.
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×¢×¤×•×œ×”
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¢×¤×•×œ×”'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×¢×¤×•×œ×”.
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¢×¤×•×œ×”', 'raw_city': '×¢×¤×•×œ×”.'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=90.36363636363637
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¢×¤×•×œ×”', 'raw_city': '×¢×¤×•×œ×”.', 'city_confidence': '90.36363636363637'}
prosaas-backend  | âœ… [CITY] Auto-accepted AND locked: '×¢×¤×•×œ×”' (confidence=90%)
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×¢×¤×•×œ×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×¢×¤×•×œ×”....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 4
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª.', '×¢×¤×•×œ×”.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 1512986d...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (3ddf6a42 â†’ 1512986d) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=1512986d...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¢×¤×•×œ×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['service_type'] | Collected: ['city=×¢×¤×•×œ×”']
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=53 e6 58 d1 c6
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.deltağŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 4 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×¦×¨×™×š ×¤×” ×¨×“×œ×ª×•×ª.', 'ts': 1764977417.233768}, {'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764977417.5614603}, {'speaker': 'user', 'text': '×¢×¤×•×œ×”.', 'ts': 1764977423.0974014}]
prosaas-backend  | 
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6400 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€“ ××ª×” ×¦×¨×™×š ×¤×¨×™×¦×ª ×“×œ×ª×•×ª ×‘×¢×™×¨ ×¢×¤×•×œ×”, × ×›×•×Ÿ?
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.11s (24 chunks)
prosaas-backend  | ğŸ›¡ï¸ [ECHO GATE] Blocking - echo decay (49ms, frames=0)
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€“ ××ª×” ×¦×¨×™×š ×¤×¨×™×¦×ª ×“×œ×ª...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 0.6s audio, conversation #3
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=9600 | silence_ms=2622
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #3
prosaas-backend  | [PIPELINE STATUS] sent=598 blocked=0 | active_response=None... | ai_speaking=False | barge_in=False
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': None, 'time': None, 'name': None, 'phone': None, 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=186) retry #20
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=136.0 > threshold=111.5
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 0.6s audio, conversation #4
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=9600 | silence_ms=560
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #4
prosaas-backend  | WS_STOP sid=MZ51b2038c19282a1540bb1bfc0a7c617f rx=1106 tx=527
prosaas-backend  | ğŸ“ [SES-3c5da338] CALL ENDED - duration=22.1s, business_id=10, rx=1106, tx=527
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CAe022e0a3164e314f91985c44ebc0aca2 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:41562 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | INFO:     172.18.0.6:41564 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CAe022e0a3164e314f91985c44ebc0aca2: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REe78775f2afd7a3e864c0c83253295837.json
prosaas-backend  | âœ… Recording queued for processing: CAe022e0a3164e314f91985c44ebc0aca2
prosaas-backend  | INFO:     connection closed
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 16.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['service_type'] | Collected: ['city=×¢×“×™']
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (SILENCE_HANDLER:[SYSTEM] User has been silent.)
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZXqz3TD3aKcPg...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZXqz3TD3aKcPg... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=186) retry #30
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=7d fd fe fd fe
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=79 75 76 76 76
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=4c d3 d6 4b 45
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 3736 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 17 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××ª×” ×¢×“×™×™×Ÿ ××™×ª×™?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.24s (49 chunks)
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI speech not confirmation
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '××ª×” ×¢×“×™×™×Ÿ ××™×ª×™?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 17 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âš ï¸ [BUILD 178] Max hangup retries exceeded - forcing hangup
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:41578 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | âœ… CALL FINALIZED: CAe022e0a3164e314f91985c44ebc0aca2
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×¤× ×™×™×” ×œ×©×™×¨×•×ª×™ ×¤×¨×™×¦×ª ×“×œ×ª×•×ª ×‘×ª×—×•× ×”×× ×¢×•×œ× ×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | - ×¡×•×’ ×”×©×™×¨×•×ª: ×¤×¨×™×¦×ª ×“×œ×ª×•×ª
prosaas-backend  | - ××™×§×•×: ×¢×¤×•×œ×”
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | - ×©× ×”×œ×§×•×—: ×œ× × ××¡×¨
prosaas-backend  | - ×××¦×¢×™ ×”×ª×§×©×¨×•×ª: ×œ× × ××¡×¨
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - ×œ× × ×§×‘×¢×” ×¤×’×™×©×” ××• ×ª×•×¨.
prosaas-backend  | - ×“×—×™×¤×•×ª: ×œ× ×¦×•×™× ×”, ××š ×™×© ×œ×”× ×™×— ×›×™ ××“×•×‘×¨ ×‘××¦×‘ ×“×—×•×£.
prosaas-backend  | - ×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª: ×™×© ×œ×™×¦×•×¨ ×§×©×¨ ×¢× ×”×œ×§×•×— ×‘×”×§×“× ×›×“×™ ×œ×§×‘×•×¢ ××•×¢×“ ×œ×‘×™×¦×•×¢ ×”×©×™×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×™×© ×œ×•×•×“× ×©×”×œ×§×•×— ××‘×™×Ÿ ××ª ×›×œ ×”×¤×¨×˜×™× ×”× ×“×¨×©×™× ×œ×¤× ×™ ×‘×™×¦×•×¢ ×”×©×™×¨×•×ª, ×›×•×œ×œ ×¢×œ×•×™×•×ª ×•×–××Ÿ ×”×’×¢×”. ××•××œ×¥ ×’× ×œ×‘×“×•×§ ×× ×™×© ×¦×•×¨×š ×‘×©×™×¨×•×ª×™× × ×•×¡×¤×™× ×›××• ×”×—×œ×¤×ª ×× ×¢×•×œ ×œ××—×¨ ×”×¤×¨×™×¦×”.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | INFO:     127.0.0.1:49696 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZ51b2038c19282a1540bb1bfc0a7c617f rx=1106 tx=527
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Extracted SPECIFIC service from AI confirmation: '×¤×¨×™×¦×ª ×“×œ×ª×•×ª'
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True', 'city': '×¢×¤×•×œ×”', 'raw_city': '×¢×¤×•×œ×”.', 'city_confidence': '90.36363636363637'}
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CAe022e0a3164e314f91985c44ebc0aca2, phone=+972504294724, city=×¢×¤×•×œ×”, direction=inbound
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×¢×¤×•×œ×”, service=×¤×¨×™×¦×ª ×“×œ×ª×•×ª
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 15.1s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['service_type'] | Collected: ['city=×¢×¤×•×œ×”']
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (SILENCE_HANDLER:[SYSTEM] User has been silent.)
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZXyxlRhxSzV1F...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZXyxlRhxSzV1F... status=in_progress modalities=['audio', 'text'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=ff 67 d9 d8 57
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=f9 f4 f4 f4 f4
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=cb c1 c7 c5 c5
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 23 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××ª×” ×¢×“×™×™×Ÿ ××™×ª×™? ×¨×§ ×¨×•×¦×” ×œ×•×•×“×. ××ª×” ×¦×¨×™×š ×¤×¨×™×¦×ª ×“×œ×ª×•×ª ×‘×¢×¤×•×œ×”, × ×›×•×Ÿ?
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.13s (47 chunks)
prosaas-backend  | ğŸ“ [BUILD 307] AI mentioned city in confirmation: '×¢×¤×•×œ×”'
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '××ª×” ×¢×“×™×™×Ÿ ××™×ª×™? ×¨×§ ×¨×•×¦×” ×œ×•×•×“×....'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 23 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 16.8s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['service_type'] | Collected: ['city=×¢×“×™']
prosaas-backend  | ğŸ¯ [BUILD 200] response.create triggered (SILENCE_HANDLER:[SYSTEM] User has been silent.)
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjZY8YXfZIqQICM...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjZY8YXfZIqQICM... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=fc fb fc fe 7e
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=fc fb fc fd fc
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=c6 b3 b8 bf b6
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6936 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 32 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××ª×” ×¢×“×™×™×Ÿ ××™×ª×™? ×× ×™ ×¨×§ ×¦×¨×™×›×” ×œ×“×¢×ª ×‘××™×–×• ×¢×™×¨.
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.80s (64 chunks)
prosaas-backend  | â­ï¸ [BUILD 307] Skipping city extraction - AI asking about city
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×¢×“×™
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¢×“×™', 'raw_city': '×¢×“×™×™×Ÿ', 'city_confidence': '90.0'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×¢×“×™×™×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¢×“×™', 'raw_city': '×¢×“×™×™×Ÿ', 'city_confidence': '90.0'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¢×“×™', 'raw_city': '×¢×“×™×™×Ÿ', 'city_confidence': '100.0'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_autocorrected=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×¢×“×™', 'raw_city': '×¢×“×™×™×Ÿ', 'city_confidence': '100.0', 'city_autocorrected': 'True'}
prosaas-backend  | ğŸ”’ [CITY] Majority locked: '×¢×“×™' from ['×× ×¢×•×œ ×—×›×.', '×¢×™×¨ ××ª×”', '×ª××œ×œ, ×œ×', '× ×›×•×Ÿ.', '×‘×”×¦×œ×—×”.', '×¢×“×™×™×Ÿ', '×¢×“×™×™×Ÿ']
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '××ª×” ×¢×“×™×™×Ÿ ××™×ª×™? ×× ×™ ×¨×§ ×¦×¨×™×›×” ×œ...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | â³ [AUDIO] 32 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
p