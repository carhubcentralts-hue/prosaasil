â±ï¸ [PHASE 1] Session configured in 0ms (total: 1201ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764876027.345
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1202ms, T0â†’speak=1203ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=12.2, threshold=112.2)
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_Cj9AJnNhLOSDDGQ...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_Cj9AJnNhLOSDDGQ... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… Recording started for CA379af4d2343cd2b3c60ff59d5a920996: RE32f76dc46d5b732b16bb3ee941d9cb71
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… Call log already exists for CA379af4d2343cd2b3c60ff59d5a920996
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | ğŸ“ [PROMPT] Final length: 2882 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5868 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764876028.733 (duration: 1388ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=135.0 > threshold=112.2
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=16 2f ad 9f a3, rms=7736, consec_frames=5
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=1e b9 9d 9c a3, rms=6829, consec_frames=6
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=3c 30 45 b2 a6, rms=2602, consec_frames=7
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=3114, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1821ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 2.2s - now updating session
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 2882 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=397, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=9, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=1688.0 > threshold=112.2
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_Cj9AOdtFiOGCK75...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_Cj9AOdtFiOGCK75... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=0, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=2755, voice_frames=0
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED Hebrew: '×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª×•×‘×™×•×ª ×”×–×”.'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª×•×‘×™×•×ª ×”×–×”.' (hebrew=32, english=0)
prosaas-backend  | ğŸ’° [COST] User utterance: 4.17s (258 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª×•×‘×™×•×ª ×”×–×”.
prosaas-backend  | âœ… [BUILD 176] User CONFIRMED with '×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª' - verification_confirmed = True
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1019, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=135, voice_frames=0
prosaas-backend  | INFO:     127.0.0.1:47686 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×›×ª×•×‘×™×•×ª' (confidence=49%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª×•×‘×™×•×ª ×”×–×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª×•×‘×™×•×ª ×”×–×”....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 2
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª×•×‘×™×•×ª ×”×–×”.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: bb81a4a1...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=bb81a4a1...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | 
prosaas-backend  | ğŸ” [NLP] Conversation history has 2 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×! ×–×” ×-××ª×¨ ×”-×× ×¢×•×œ×Ÿ. ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?', 'ts': 1764876028.7331538}, {'speaker': 'user', 'text': '×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª×•×‘×™×•×ª ×”×–×”.', 'ts': 1764876034.721733}]
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=152.0 > threshold=112.2
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_Cj9ASrtKJNP6STp...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_Cj9ASrtKJNP6STp... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=89, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=fd fd fe 7e 7e
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=3c 31 34 32 30
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=ff 7b 6f 6b 6a
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED (has Hebrew): '×™×© ×‘×‘×§×©×” ×¤×” ×¨×¦×™××ª×•×ª?'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×™×© ×‘×‘×§×©×” ×¤×” ×¨×¦×™××ª×•×ª?' (hebrew=16, english=0)
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (2616ms)
prosaas-backend  | ğŸ’° [COST] User utterance: 1.16s (373 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×™×© ×‘×‘×§×©×” ×¤×” ×¨×¦×™××ª×•×ª?
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=1348, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×‘×‘×§×©×”' (confidence=45%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×™×© ×‘×‘×§×©×” ×¤×” ×¨×¦×™××ª×•×ª?...'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×™×© ×‘×‘×§×©×” ×¤×” ×¨×¦×™××ª×•×ª?...'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 3
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª×•×‘×™×•×ª ×”×–×”.', '×™×© ×‘×‘×§×©×” ×¤×” ×¨×¦×™××ª×•×ª?']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 658963d6...
prosaas-backend  | â­ï¸ [NLP] BLOCKED - Another NLP thread is still processing
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×™×© ×‘×‘×§×©×” ×¤×” ×¨×¦×™××ª×•×ª?...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.71s (4 chunks)
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨' (confidence=54%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (800ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=1, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=1214, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=731.0 > threshold=112.2
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=308, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=64, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=7960, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=136.0 > threshold=112.2
prosaas-backend  | ğŸ¤ END OF UTTERANCE: 12.0s audio, conversation #0
prosaas-backend  | ğŸ§  STATE -> PROCESSING | len=192000 | silence_ms=0
prosaas-backend  | â­ï¸ [REALTIME] Skipping Google STT/TTS - using Realtime API only
prosaas-backend  | âœ… Processing complete for conversation #0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=158, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_Cj9AY0osWdRS335...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_Cj9AY0osWdRS335... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=0, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=34, voice_frames=0
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED (has Hebrew): '×‘×—×•×œ×•×Ÿ'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×‘×—×•×œ×•×Ÿ' (hebrew=6, english=0)
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (6710ms)
prosaas-backend  | ğŸ’° [COST] User utterance: 5.47s (706 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×‘×—×•×œ×•×Ÿ
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×—×•×œ×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×•×œ×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×—×•×œ×•×Ÿ
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×•×œ×•×Ÿ', 'raw_city': '×—×•×œ×•×Ÿ'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'city': '×—×•×œ×•×Ÿ', 'raw_city': '×—×•×œ×•×Ÿ', 'city_confidence': '100.0'}
prosaas-backend  | âœ… [CITY] Auto-accepted: '×—×•×œ×•×Ÿ' (confidence=100%)
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×‘×—×•×œ×•×Ÿ...'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×‘×—×•×œ×•×Ÿ...'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 5
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×ª×•×“×” ×¨×‘×” ×œ×›× ×•×œ×”×¦×™×’ ××ª ×”×¤×§×ª ×›×ª×•×‘×™×•×ª ×”×–×”.', '×™×© ×‘×‘×§×©×” ×¤×” ×¨×¦×™××ª×•×ª?', '×‘×—×•×œ×•×Ÿ']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 8586c0d8...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (bb81a4a1 â†’ 8586c0d8) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=8586c0d8...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...[GOODBYE CHECK] No goodbye phrase: '×‘×—×•×œ×•×Ÿ...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | 
prosaas-backend  | ğŸ” [NLP] Conversation history has 5 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×™×© ×‘×‘×§×©×” ×¤×” ×¨×¦×™××ª×•×ª?', 'ts': 1764876037.3375406}, {'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764876037.8743722}, {'speaker': 'user', 'text': '×‘×—×•×œ×•×Ÿ', 'ts': 1764876044.0475876}]
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['service_type'] | Collected: ['city=×—×•×œ×•×Ÿ']
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=55, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=300.0 > threshold=112.2
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=188, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=640, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=735, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=1302.0 > threshold=112.2
prosaas-backend  | WS_STOP sid=MZa854b8bc812c67f89eb6cb4ababe3763 rx=1113 tx=265
prosaas-backend  | ğŸ“ [SES-19bbf6c9] CALL ENDED - duration=22.4s, business_id=10, rx=1113, tx=265
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | STREAM_ENDED call=CA379af4d2343cd2b3c60ff59d5a920996 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.5:35214 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CA379af4d2343cd2b3c60ff59d5a920996: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE32f76dc46d5b732b16bb3ee941d9cb71.json
prosaas-backend  | INFO:     172.18.0.5:35216 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | âœ… Recording queued for processing: CA379af4d2343cd2b3c60ff59d5a920996
prosaas-backend  | INFO:     connection closed
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.5s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['service_type'] | Collected: ['city=×—×•×œ×•×Ÿ']
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZa854b8bc812c67f89eb6cb4ababe3763 rx=1113 tx=265
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 2/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['service_type'] | Collected: ['city=×—×•×œ×•×Ÿ']
prosaas-backend  | âœ… CALL FINALIZED: CA379af4d2343cd2b3c60ff59d5a920996
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×”×¤× ×™×™×” ×”×™× ×‘×ª×—×•× ×”× ×“×œ"×Ÿ, ×”×œ×§×•×— ××—×¤×© × ×›×¡ ×‘××–×•×¨ ×—×•×œ×•×Ÿ.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | - **××–×•×¨**: ×—×•×œ×•×Ÿ
prosaas-backend  | - **×¡×•×’ × ×›×¡**: ×œ× ×¦×•×™×Ÿ ×‘××¤×•×¨×©, ××š ×™×© ×œ×”× ×™×— ×©××“×•×‘×¨ ×‘×“×™×¨×” ××• ×‘×™×ª.
prosaas-backend  | - **×“×¨×™×©×•×ª × ×•×¡×¤×•×ª**: ×œ× × ××¡×¨×• ×¤×¨×˜×™× × ×•×¡×¤×™× ×¢×œ ×ª×§×¦×™×‘ ××• ××¡×¤×¨ ×—×“×¨×™×.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×©× ×”×œ×§×•×— ×œ× × ××¡×¨, ××š ×”×•× × ××¦× ×‘×—×•×œ×•×Ÿ.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - **×¤×¢×•×œ×” × ×“×¨×©×ª**: ×™×© ×œ×‘×¦×¢ ×—×™×¤×•×© × ×›×¡×™× ×–××™× ×™× ×‘×—×•×œ×•×Ÿ ×•×œ×”×›×™×Ÿ ×”×¦×¢×•×ª ××ª××™××•×ª.
prosaas-backend  | - **×“×—×™×¤×•×ª**: ×œ× ×¦×•×™×Ÿ, ××š ××•××œ×¥ ×œ×¤×¢×•×œ ×‘××”×™×¨×•×ª ×›×“×™ ×œ×¡×¤×§ ×©×™×¨×•×ª ××™×›×•×ª×™.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×™×© ×œ×”×§×¤×™×“ ×¢×œ ×¢×“×›×•×Ÿ ×”×œ×§×•×— ×¢× ×”×¦×¢×•×ª × ×›×¡×™× ×¨×œ×•×•× ×˜×™×™× ×•×œ×•×•×“× ×©×”×“×¨×™×©×•×ª ×©×œ×• ××•×‘× ×•×ª. ××•××œ×¥ ×’× ×œ×‘×¨×¨ ×¤×¨×˜×™× × ×•×¡×¤×™× ×¢×œ ×¡×•×’ ×”× ×›×¡ ×”××•×¢×“×£ ×•×”×ª×§×¦×™×‘ ×›×“×™ ×œ×™×™×¢×œ ××ª ×”×—×™×¤×•×©.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.