יש כאן שלוש בעיות בפריסה (לפי הסקרין):
	1.	ה-build מנסה cd baileys-service/ – אבל התיקייה לא קיימת (אצלך זה services/whatsapp או services/baileys).
	2.	ה-build מתקין npm, בזמן שה-run מריץ gunicorn (Python) – חוסר התאמה.
	3.	אין “מריץ אחד” שמרים גם Flask וגם Baileys – לכן הדיפלוימנט לא יודע מה להפעיל.

להלן הנחיה אחת-לאחת שתגרום לפריסה להצליח, בלי לשבור כלום:

⸻

A) תקן את פקודות ה-Deploy (Build/Run)

Build (מתקין תלויות בלבד)

שנה ל־:

python -m pip install --upgrade pip
pip install -r requirements.txt
# התקנת תלויות ה-Node של ה-Baileys בתיקייה הנכונה (תקן את הנתיב אם צריך)
npm ci --prefix services/whatsapp

חשוב: בלי הרצת שרתים בשלב ה-build, ורק לתיקייה שקיימת בפועל (לא baileys-service).

Run (מריץ את שני השירותים יחד)

שנה ל־:

bash ./start_all.sh


⸻

B) הוסף/עדכן start_all.sh בשורש הפרויקט

#!/usr/bin/env bash
set -euo pipefail

export PYTHONUNBUFFERED=1
export PORT="${PORT:-5000}"                   # לפלטפורמות שמצפות למשתנה PORT
export FLASK_BASE_URL="${FLASK_BASE_URL:-http://127.0.0.1:5000}"
export BAILEYS_PORT="${BAILEYS_PORT:-3300}"
# INTERNAL_SECRET צריך להיות מוגדר בסודות הדיפלוימנט

# 1) Start Baileys (תקן לנתיב הכניסה שלך)
node services/baileys/server.js &            # או: node services/whatsapp/baileys_service.js
BAI=$!

# 2) Start Flask (ה־listener היחיד החיצוני)
gunicorn -w 1 -k eventlet -b 0.0.0.0:${PORT} wsgi:app & 
FL=$!

# keep both alive and cleanly shutdown
trap 'kill -TERM $BAI $FL 2>/dev/null || true; wait || true' INT TERM
while kill -0 $BAI 2>/dev/null && kill -0 $FL 2>/dev/null; do sleep 1; done

	•	ודא שקובץ הכניסה של הנוד נכון:
אם אצלך ה־entry הוא services/baileys/server.js שמבצע require('../whatsapp/baileys_service').start() – תשאיר כך.
אם ה־entry הוא ישירות services/whatsapp/baileys_service.js – עדכן את השורה בהתאם.
	•	הפלטפורמה צריכה לראות פורט אחד פתוח (5000). Baileys מאזין פנימית ב-3300.

תן הרשאות הרצה (פעם אחת מקומית, או הוסף ל-repo):

chmod +x start_all.sh


⸻

C) ודא סודות/ENV בפריסה

ב-Deployment secrets הוסף:

INTERNAL_SECRET=<סוד ארוך זהה ל-Node ול-Flask>
BAILEYS_PORT=3300
BAILEYS_BASE_URL=http://127.0.0.1:3300
FLASK_BASE_URL=http://127.0.0.1:5000
# Twilio וכו' לפי הצורך


⸻

D) בדיקת Health אחרי עלייה (Log-based)

ב־Logs של הדיפלוימנט תראה:
	•	Gunicorn: Listening at: http://0.0.0.0:5000
	•	Baileys: listening on 0.0.0.0:3300 / [BOOT] Baileys...

ואז בדיקות מהירות (מהקונסולה של הפלטפורמה או curl מהסרוור):

curl -sS http://127.0.0.1:5000/healthz
curl -sS http://127.0.0.1:5000/api/whatsapp/status
curl -sS http://127.0.0.1:5000/api/whatsapp/qr | head -c 100; echo


⸻

E) אם אתה מעדיף Procfile במקום סקריפט

(רק אם הפלטפורמה תומכת Foreman/Honcho)
	•	Procfile:

web: gunicorn -w 1 -k eventlet -b 0.0.0.0:$PORT wsgi:app
whatsapp: node services/baileys/server.js

	•	Run command:
honcho start -f Procfile
וה-build נשאר כמו בסעיף A.

⸻

F) טעויות נפוצות שמביאות בדיוק לשגיאה שלך
	•	נתיב שגוי ב-build (cd baileys-service/) → תקן לנתיב שקיים (services/whatsapp/ או services/baileys/).
	•	הרצת שרתים ב-build → אסור; build רק מתקין.
	•	run שמפעיל רק gunicorn → Baileys לא רץ → ה-UI “טוען לנצח”.
	•	יצוא שני פורטים החוצה → הפלטפורמה מצפה לפורט אחד (5000).

⸻

בצע את A→B→C, פרסם שוב. אם עדיין נופל, הדבק כאן את ה-exact build command/run command המעודכנים וה-logs מההתחלה של ה-run, ואכוון אותך שורה-שורה.