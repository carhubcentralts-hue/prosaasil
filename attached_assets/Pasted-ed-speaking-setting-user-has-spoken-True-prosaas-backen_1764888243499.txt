ed speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | âœ… [BUILD 163] Call CAb45d83... hung up successfully: AI finished speaking politely
prosaas-backend  | WS_STOP sid=MZf86790a5c28d99e302651d0d6ec3364f rx=1940 tx=1302
prosaas-backend  | ğŸ“ [SES-d3019a02] CALL ENDED - duration=38.6s, business_id=10, rx=1940, tx=1302
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CAb45d83d3bcf3821e4a40f748f86d08ac stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:48286 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CAb45d83d3bcf3821e4a40f748f86d08ac: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/RE8687147972cc07cf8d5cca6fd7919015.json
prosaas-backend  | INFO:     172.18.0.6:48298 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CAb45d83d3bcf3821e4a40f748f86d08ac
prosaas-backend  | INFO:     connection closed
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | âœ… CALL FINALIZED: CAb45d83d3bcf3821e4a40f748f86d08ac
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×”×¤× ×™×™×” ×”×™× ×œ×©×™×¨×•×ª×™ ×¤×¨×™×¦×”, ×‘×ª×—×•× ×”×× ×¢×•×œ×™× ×•×”×“×œ×ª×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | - ×¡×•×’ ×”×©×™×¨×•×ª: ×¤×•×¨×¥ ×“×œ×ª×•×ª
prosaas-backend  | - ××™×§×•×: ×—×™×¤×”
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×œ× × ××¡×¨×• ×¤×¨×˜×™× ××™×©×™×™× ×›××• ×©× ××• ×××¦×¢×™ ×”×ª×§×©×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | - × ×§×‘×¢×” ×¤×¢×•×œ×”: ×‘×¢×œ ××§×¦×•×¢ ×™×—×–×•×¨ ×œ×œ×§×•×— ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª.
prosaas-backend  | - ×“×—×™×¤×•×ª: ×’×‘×•×”×”, ×‘×©×œ ×”×¦×•×¨×š ×”××™×™×“×™ ×‘×©×™×¨×•×ª.
prosaas-backend  | - ×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª: ×œ×•×•×“× ×©×”×¤×•×¨×¥ ×™×™×¦×•×¨ ×§×©×¨ ×¢× ×”×œ×§×•×— ×‘×”×§×“×.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×™×© ×œ×”×§×¤×™×“ ×¢×œ ×–××™× ×•×ª ×’×‘×•×”×” ×©×œ ×‘×¢×œ×™ ××§×¦×•×¢ ×‘×ª×—×•× ×”×¤×¨×™×¦×”, ×‘××™×•×—×“ ×‘××–×•×¨×™× ×¢×™×¨×•× ×™×™× ×›××• ×—×™×¤×”, ×›×“×™ ×œ×¡×¤×§ ×©×™×¨×•×ª ××”×™×¨ ×•×™×¢×™×œ ×œ×œ×§×•×—×•×ª.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Extracted SPECIFIC service from AI confirmation: '×¤×•×¨×¥ ×“×œ×ª×•×ª'
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True', 'city': '××œ×™×š', 'raw_city': '××œ×™×š', 'city_confidence': '100.0', 'service_type': '×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”', 'name': 'null', 'city_autocorrected': 'True'}
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CAb45d83d3bcf3821e4a40f748f86d08ac, phone=+972504294724, city=××œ×™×š, direction=inbound
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=××œ×™×š, service=×¤×•×¨×¥ ×“×œ×ª×•×ª
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | âœ… Background thread 4 completed
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZf86790a5c28d99e302651d0d6ec3364f rx=1940 tx=1302
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
^[[B^[[Bprosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:56956 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:34014 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:46652 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:60356 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:34810 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:44948 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:54860 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:41058 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | âœ… Resolved business_id=10 from to_number=+97233762734 (Business: ×§×œ×™×‘×¨)
prosaas-backend  | âœ… call_log created immediately for CA650b290dd12bc3c793f12e71dd4bcf61
prosaas-backend  | ğŸŸ¢ INCOMING_CALL - Starting thread to create lead for +972504294724, call_sid=CA650b290dd12bc3c793f12e71dd4bcf61
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - Starting for +972504294724, call_sid=CA650b290dd12bc3c793f12e71dd4bcf61ğŸŸ¢ INCOMING_CALL - Thread started successfully
prosaas-backend  | âš ï¸ incoming_call: 1500ms - CA650b290dd12bc3
prosaas-backend  | ğŸ”¥ TWIML_HOST=prosaas.pro
prosaas-backend  | ğŸ”¥ TWIML_WS=wss://prosaas.pro/ws/twilio-media
prosaas-backend  | ğŸ”¥ TWIML_FULL=<?xml version="1.0" encoding="UTF-8"?><Response><Connect action="https://prosaas.pro/webhook/stream_ended"><Stream url="wss://prosaas.pro/ws/twilio-media"><Parameter name="CallSid" value="CA650b290dd12bc3c793f12e71dd4bcf61" /><Parameter name="To" value="+97233762734" /></Stream></Connect></Response>
prosaas-backend  | INFO:     172.18.0.6:34380 - "POST /webhook/incoming_call HTTP/1.1" 200 OK
prosaas-backend  | 
prosaas-backend  | ğŸ”µ CREATE_LEAD_FROM_CALL - App context created
prosaas-backend  | INFO:     172.18.0.6:34394 - "WebSocket /ws/twilio-media" [accepted]
prosaas-backend  | INFO:     connection open
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ¯ AI CONVERSATION STARTED
prosaas-backend  | ğŸ”µ [CALL] run() started - waiting for START event...
prosaas-backend  | ğŸ¯ [CALL DEBUG] START EVENT RECEIVED! session=SES-1fe7d29a
prosaas-backend  | 
prosaas-backend  | ğŸ“ START EVENT (customParameters path):
prosaas-backend  |    customParams.From: None
prosaas-backend  |    customParams.CallFrom: None
prosaas-backend  |    âœ… self.phone_number set to: 'None'
prosaas-backend  |    âœ… self.to_number set to: '+97233762734'
prosaas-backend  | ğŸ¯ [T0=1764887794.255] WS_START sid=MZa460b2237af046f2aa8682ac0ffd01a6 call_sid=CA650b290dd12bc3c793f12e71dd4bcf61 from=None to=+97233762734 mode=AI
prosaas-backend  | ğŸš€ [PARALLEL] Starting OpenAI at T0+0ms (BEFORE DB query!)
prosaas-backend  | ğŸš€ [REALTIME] Thread started for call CA650b29 (FRESH SESSION)âš¡ ULTRA-FAST: ×–×™×”×•×™ ×¢×¡×§ + ×‘×¨×›×” + ×”×’×“×¨×•×ª ×‘×©××™×œ×ª×” ××—×ª: to_number=+97233762734
prosaas-backend  | 
prosaas-backend  | ğŸš€ [REALTIME] Async loop starting - connecting to OpenAI IMMEDIATELY
prosaas-backend  | â±ï¸ [PARALLEL] Client created in 0ms
prosaas-backend  | INFO:     127.0.0.1:46332 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | â±ï¸ [PARALLEL] OpenAI connected in 525ms (T0+526ms)
prosaas-backend  | â³ [PARALLEL] Waiting for business info from DB query...
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | âœ… ××¦× ×¢×¡×§: ×§×œ×™×‘×¨ (id=10)
prosaas-backend  | INFO:     172.18.0.6:34406 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] is_playing_greeting=True (early, blocking audio input)
prosaas-backend  | âš¡ BUILD 172: CallConfig loaded in 1132ms
prosaas-backend  |    bot_speaks_first=True, auto_end_goodbye=True
prosaas-backend  |    auto_end_lead=True, silence_timeout=5s
prosaas-backend  | ğŸ” [CONFIG] required_lead_fields=['city', 'service_type']
prosaas-backend  | ğŸ” [CONFIG] smart_hangup_enabled=True
prosaas-backend  | âš¡ DB QUERY: business_id=10 in 1247ms
prosaas-backend  | ğŸ”§ DB_URL_AT_WRITE: driver=postgresql, BIZ=10, SID=CA650b290dd12bc3c793f12e71dd4bcf61
prosaas-backend  | ğŸ”Š TX_LOOP_START: Audio transmission thread started
prosaas-backend  | ğŸ¯ [T1=1764887795.504] STORING GREETING FOR REALTIME!
prosaas-backend  | âœ… [REALTIME] Greeting stored: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...' (len=50)
prosaas-backend  | ğŸš€ [PARALLEL] Signaling business info ready at T0+1248ms
prosaas-backend  | ğŸ›¡ï¸ [GREETING PROTECT] Blocking audio ENQUEUE - greeting in progressâœ… [PARALLEL] Business info ready! Wait time: 723ms
prosaas-backend  | â±ï¸ [PARALLEL] Using greeting: '×©×œ×•×! ×–×” ×-××ª×¨  ×”-×× ×¢×•×œ×Ÿ ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š ?...'
prosaas-backend  | ğŸ¤ [VOICE] Using voice=shimmer for entire call (business=10)
prosaas-backend  | ğŸ¤ [GREETING] max_tokens=4096 for greeting length=50 chars (direction=inbound)
prosaas-backend  | 
prosaas-backend  | ğŸ›ï¸ VAD CALIBRATED (noise=8.0, threshold=80.0)
prosaas-backend  | â±ï¸ [PHASE 1] Session configured in 3ms (total: 1251ms)
prosaas-backend  | âœ… [REALTIME] FAST CONFIG: greeting prompt ready, voice=shimmer
prosaas-backend  | ğŸ¤ [GREETING] Bot speaks first - triggering greeting at 1764887795.507
prosaas-backend  | âœ… [BUILD 163] response.create sent! OpenAI=1251ms, T0â†’speak=1252ms
prosaas-backend  | âš ï¸ [CRM] No customer phone or lead_id - skipping lead creation
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender started
prosaas-backend  | ğŸ“¥ [REALTIME] Audio receiver started
prosaas-backend  | ğŸ“ [REALTIME] Text sender started
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCE7MCXY3WvrQq...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCE7MCXY3WvrQq... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | [TX_LOOP] Frame 0: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 1: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | [TX_LOOP] Frame 2: type=None, event=media, has_media=True
prosaas-backend  | [TX_LOOP] Sent Realtime format: success=True
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… Call log already exists for CA650b290dd12bc3c793f12e71dd4bcf61
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | âœ… CustomerIntelligence SUCCESS: customer_id=7, lead_id=79, was_created=False
prosaas-backend  | âœ… Recording started for CA650b290dd12bc3c793f12e71dd4bcf61: REb8c49b9687ae3e9ffec924fa12618b5b
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ“ [PROMPT] Final length: 4097 chars
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6400 bytes
prosaas-backend  | [GREETING] Passing greeting audio to caller (greeting_sent=True, user_has_spoken=False)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ¤ [GREETING] Greeting finished at 1764887796.801 (duration: 1294ms)
prosaas-backend  | âœ… [GREETING] Barge-in now ENABLED for rest of call
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Greeting completed - hangup blocked for 3000ms
prosaas-backend  | ğŸ“ [STATE] Transitioned WARMUP â†’ ACTIVE (greeting done)
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ, ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | âœ… Updated call_log with customer_id=7
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=389.0 > threshold=80.0
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#1, Î¼-law bytes=160, first5=f4 ee eb e9 e8, rms=204, consec_frames=4
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#2, Î¼-law bytes=160, first5=e3 df de de df, rms=180, consec_frames=5
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×©×œ×•×!' (confidence=70%) - ask to repeat
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Ignoring AI goodbye - only 1611ms since greeting
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ, ××™×–×” ×¡×•...'
prosaas-backend  | ğŸ”‡ [SILENCE] Monitor started (timeout=5s, max_warnings=2)
prosaas-backend  | â³ [PHASE 2] Waiting for greeting to finish before session.update...
prosaas-backend  | âœ… [PHASE 2] Greeting finished after 0.0s - now updating session
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ“ [INBOUND] session.update with max_tokens=4096
prosaas-backend  | âœ… [PHASE 2] Session updated with full prompt: 4097 chars, voice=shimmer locked, max_tokens=4096, transcription=Hebrew
prosaas-backend  | [REALTIME] sending audio TO OpenAI: chunk#3, Î¼-law bytes=160, first5=6b 6a 69 6a 6b, rms=226, consec_frames=4
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=43, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 100 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=12, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=100, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 200 frames (rms=48, reason=noise)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=504.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=False, waiting_for_dtmf=False, rms=3917, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=9824, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=22, voice_frames=0
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #1 (prevents 5min timeout)
prosaas-backend  | ğŸ”‡ [SILENCE] Warning 1/2 after 6.0s silence
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city', 'service_type'] | Collected: []
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCEGzvA9NDjs23...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCEGzvA9NDjs23... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=33, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#1, bytes=800, first5=c9 c8 ee 58 46
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#2, bytes=1200, first5=43 37 38 36 37
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED Hebrew: '×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª' (hebrew=16, english=0)
prosaas-backend  | ğŸ’° [COST] User utterance: 6.80s (142 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 300 frames (rms=23, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=20, voice_frames=0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True'}
prosaas-backend  | âŒ [CITY] Rejected '×œ×˜×•×ª' (confidence=47%) - ask to repeat
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×¤×•×¨×˜
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¤×•×¨×˜'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×¤×•×¨×˜
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª...'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª...'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 2
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 5285af3f...
prosaas-backend  | ğŸ” [DEBUG] First NLP run - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=5285af3f...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª...'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...â³ [SMART HANGUP] Still missing fields: ['city'] | Collected: ['service_type=×¤×•×¨×˜']
prosaas-backend  | ğŸ” [NLP] Conversation history has 2 messages
prosaas-backend  | 
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'ai', 'text': '×©×œ×•×! ×–×” ×××ª×¨ ×”×× ×¢×•×œ×Ÿ, ××™×–×” ×¡×•×’ ×©×™×¨×•×ª ××ª×” ×¦×¨×™×š?', 'ts': 1764887796.8015208}, {'speaker': 'user', 'text': '×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª', 'ts': 1764887805.2180429}]
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] got audio chunk from OpenAI: chunk#3, bytes=2000, first5=7b 79 79 78 79
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?
prosaas-backend  | ğŸ’° [COST] AI utterance: 0.70s (6 chunks)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=113.0 > threshold=80.0
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¤×•×¨×˜'}
prosaas-backend  | âŒ [CITY] Rejected '×¢×™×¨' (confidence=54%) - ask to repeat
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=30, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 400 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=165, voice_frames=0
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=142.0 > threshold=80.0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=315, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCEMJ3tKtjxtXG...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCEMJ3tKtjxtXG... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=45, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 5320ms gap between chunks #6 and #7 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 500 frames (rms=34, reason=noise)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED (has Hebrew): '×›×Ÿ ×™×¤×”.'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×›×Ÿ ×™×¤×”.' (hebrew=5, english=0)
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (6347ms)
prosaas-backend  | ğŸ’° [COST] User utterance: 2.43s (223 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×›×Ÿ ×™×¤×”.
prosaas-backend  | âœ… [BUILD 176] User CONFIRMED with '×›×Ÿ ×™×¤×”.' - verification_confirmed = True
prosaas-backend  | âœ… [LEAD STATE] Updated: city_needs_retry=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¤×•×¨×˜'}
prosaas-backend  | âŒ [CITY] Rejected '×›×Ÿ ×™×¤×”.' (confidence=83%) - ask to repeat
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×›×Ÿ ×™×¤×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×›×Ÿ ×™×¤×”....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 4
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª', '×›×Ÿ ×™×¤×”.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 30b19012...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (5285af3f â†’ 30b19012) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=30b19012...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...[GOODBYE CHECK] No goodbye phrase: '×›×Ÿ ×™×¤×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_lead_captured: required_fields from self = ['city', 'service_type']
prosaas-backend  | â³ [SMART HANGUP] Still missing fields: ['city'] | Collected: ['service_type=×¤×•×¨×˜']
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | 
prosaas-backend  | ğŸ” [NLP] Conversation history has 4 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª', 'ts': 1764887805.2180429}, {'speaker': 'ai', 'text': '×•×‘××™×–×• ×¢×™×¨ ××ª×” × ××¦×?', 'ts': 1764887805.8532655}, {'speaker': 'user', 'text': '×›×Ÿ ×™×¤×”.', 'ts': 1764887811.565087}]
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=44, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 7468 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”, × ×›×•×Ÿ?
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.08s (23 chunks)
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=378.0 > threshold=80.0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=86, voice_frames=0
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=10, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 600 frames (rms=18, reason=noise)
prosaas-backend  | ğŸ”’ [CONSISTENCY] City locked to '×›×Ÿ ×™×¤×”.' (majority 2/3)
prosaas-backend  | âœ… [LEAD STATE] Updated: city=×›×Ÿ ×™×¤×”.
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¤×•×¨×˜', 'city': '×›×Ÿ ×™×¤×”.'}
prosaas-backend  | âœ… [LEAD STATE] Updated: raw_city=×—×™×¤×”
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¤×•×¨×˜', 'city': '×›×Ÿ ×™×¤×”.', 'raw_city': '×—×™×¤×”'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_confidence=100.0
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¤×•×¨×˜', 'city': '×›×Ÿ ×™×¤×”.', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0'}
prosaas-backend  | âœ… [LEAD STATE] Updated: city_autocorrected=True
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¤×•×¨×˜', 'city': '×›×Ÿ ×™×¤×”.', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0', 'city_autocorrected': 'True'}
prosaas-backend  | ğŸ”’ [CITY] Majority locked: '×›×Ÿ ×™×¤×”.' from ['×©×œ×•×!', '×œ×˜×•×ª', '×¢×™×¨', '×›×Ÿ ×™×¤×”.', '×—×™×¤×”']
prosaas-backend  | âœ… [LEAD STATE] Updated: service_type=×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”
prosaas-backend  | ğŸ“‹ [LEAD STATE] Current state: {'city_needs_retry': 'True', 'service_type': '×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”', 'city': '×›×Ÿ ×™×¤×”.', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0', 'city_autocorrected': 'True'}
prosaas-backend  | âœ… [LEAD STATE] Extracted service_type from confirmation: ×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”
prosaas-backend  | [GOODBYE CHECK] No goodbye phrase: '×¨×§ ××•×•×“××ª â€” ××ª×” ×¦×¨×™×š ×¤×•×¨×¥ ×“×œ×ª×•...'
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ’“ WS_KEEPALIVE #2 (prevents 5min timeout)
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=16, voice_frames=0
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCERcZiHj6V4t5...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCERcZiHj6V4t5... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 4005ms gap between chunks #23 and #24 - OpenAI delay!
prosaas-backend  | ğŸ”§ [GAP RECOVERY] Inserted 25 silence frames (500ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | [SILENCE GATE] âŒ REJECTED (RMS=8 < 30, frames=0): '×ª×•×“×” ×¨×‘×”'
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 6400 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ××œ×™×š ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª. ×ª×•×“×” ×•×œ×”×ª×¨××•×ª.
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.42s (50 chunks)
prosaas-backend  | ğŸ”’ [CITY] Already locked to '×›×Ÿ ×™×¤×”.' - ignoring new input
prosaas-backend  | [GOODBYE CHECK] Clear goodbye detected: '××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™×...'
prosaas-backend  | âœ… [HANGUP] User confirmed all details - disconnecting
prosaas-backend  | ğŸ“ [STATE] Transitioning ACTIVE â†’ CLOSING (reason: user_verified)
prosaas-backend  | ğŸ“ [BUILD 163] Pending hangup set - will disconnect after audio finishes playing
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | âœ… [POLITE HANGUP] OpenAI queue empty after 0ms
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 296 frames...
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | ğŸ™ï¸ REAL_VOICE: rms=881.0 > threshold=80.0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_started
prosaas-backend  | ğŸ¤ [REALTIME] User started speaking - setting user_has_spoken=True
prosaas-backend  | âœ… [LOOP GUARD] User started speaking - resetting consecutive counter (1 -> 0)
prosaas-backend  | ğŸ¤ [BUILD 166] Noise gate BYPASSED - sending ALL audio to OpenAI
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=cancelled, output_count=1, details={'type': 'cancelled', 'reason': 'turn_detected'}
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | ğŸ”„ [BUILD 193] Response cancelled (output=1)! Triggering IMMEDIATE recovery...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=491, voice_frames=0
prosaas-backend  | ğŸ”„ [BUILD 192] Recovery skipped - user still speaking
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 245 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=17, voice_frames=0
prosaas-backend  | [REALTIME] event: input_audio_buffer.speech_stopped
prosaas-backend  | ğŸ¤ [BUILD 166] Speech ended - noise gate RE-ENABLED
prosaas-backend  | [REALTIME] event: input_audio_buffer.committed
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.created: id=resp_CjCEUs3w4xhqS7p...
prosaas-backend  | ğŸ¯ [RESPONSE.CREATED] id=resp_CjCEUs3w4xhqS7p... status=in_progress modalities=['text', 'audio'] output_format=g711_ulaw
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 700 frames (rms=98, reason=insufficient_consec_frames(0/4))
prosaas-backend  | [REALTIME] event: conversation.item.input_audio_transcription.completed
prosaas-backend  | âœ… [NOISE FILTER] ALLOWED Hebrew: '×ª×•×“×”.'
prosaas-backend  | [NOISE FILTER] âœ… ACCEPTED: '×ª×•×“×”.' (hebrew=4, english=0)
prosaas-backend  | ğŸ“ [SEGMENT MERGE] FLUSH - long pause (7623ms)
prosaas-backend  | ğŸ’° [COST] User utterance: 5.11s (413 chunks total)
prosaas-backend  | ğŸ‘¤ [REALTIME] User said: ×ª×•×“×”.
prosaas-backend  | âœ… [BUILD 176] User CONFIRMED with '×ª×•×“×”.' - verification_confirmed = True
prosaas-backend  | ğŸ”’ [CITY] Already locked to '×›×Ÿ ×™×¤×”.' - ignoring new input
prosaas-backend  | ğŸ” [DEBUG] Calling NLP after user transcript: '×ª×•×“×”....'
prosaas-backend  | ğŸ” [DEBUG] _check_appointment_confirmation called with transcript: '×ª×•×“×”....'
prosaas-backend  | ğŸ” [DEBUG] Conversation history length: 8
prosaas-backend  | ğŸ” [DEBUG] User messages for hash: ['×× ×™ ×¦×¨×™×š ×¤×•×¨×˜ ×‘×œ×˜×•×ª', '×›×Ÿ ×™×¤×”.', '×ª×•×“×” ×¨×‘×”', '×ª×•×“×”.']
prosaas-backend  | ğŸ” [DEBUG] Current conversation hash: 099edb29...
prosaas-backend  | ğŸ” [DEBUG] Hash changed (30b19012 â†’ 099edb29) - processing
prosaas-backend  | ğŸ” [NLP] âœ… WILL PROCESS new conversation state (hash=099edb29...)
prosaas-backend  | ğŸ” [DEBUG] CRM context exists: False
prosaas-backend  | [SAFETY] Transcription successful (total failures: 0)
prosaas-backend  | ğŸ” [NLP] â–¶ï¸ Analyzing conversation for appointment intent...
prosaas-backend  | ğŸ” [NLP] Conversation history has 8 messages
prosaas-backend  | ğŸ” [NLP] Last 3 messages: [{'speaker': 'user', 'text': '×ª×•×“×” ×¨×‘×”', 'ts': 1764887816.463878, 'filtered': True}, {'speaker': 'ai', 'text': '××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ××œ×™×š ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª. ×ª×•×“×” ×•×œ×”×ª×¨××•×ª.', 'ts': 1764887817.6716475}, {'speaker': 'user', 'text': '×ª×•×“×”.', 'ts': 1764887819.1881547}]
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.added
prosaas-backend  | [REALTIME] event: conversation.item.created
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.added
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1068 bytes
prosaas-backend  | ğŸ”Š [REALTIME] AI started speaking (audio.delta)
prosaas-backend  | âš ï¸ [AUDIO GAP] 1650ms gap between chunks #50 and #51 - OpenAI delay!
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 1600 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 257 frames...
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=True, user_has_spoken=True, waiting_for_dtmf=False, rms=26, voice_frames=0
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.delta
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 2668 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.delta: 5336 bytes
prosaas-backend  | ğŸ”Š [REALTIME] response.audio.done
prosaas-backend  | ğŸ”‡ [REALTIME] AI stopped speaking (response.audio.done)
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [AUDIO] 1 frames still in queue - letting them play (NO TRUNCATION)
prosaas-backend  | ğŸ”Š [REALTIME] response.audio_transcript.done
prosaas-backend  | ğŸ¤– [REALTIME] AI said: ××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ××œ×™×š ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª. ×ª×•×“×” ×•×œ×”×ª×¨××•×ª.
prosaas-backend  | âš ï¸ [LOOP DETECT] AI repeating! Similarity=100% with: '××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ××œ×™×š ×‘×“×§×•×ª ×”×§...'
prosaas-backend  | â­ï¸ [LOOP GUARD] Skipped - call is ending (closing=True, hangup=False)
prosaas-backend  | ğŸ’° [COST] AI utterance: 1.37s (76 chunks)
prosaas-backend  | ğŸ”’ [CITY] Already locked to '×›×Ÿ ×™×¤×”.' - ignoring new input
prosaas-backend  | [GOODBYE CHECK] Clear goodbye detected: '××¦×•×™×Ÿ, ×§×™×‘×œ×ª×™. ×‘×¢×œ ××§×¦×•×¢ ××ª××™×...'
prosaas-backend  | âœ… [HANGUP] User said goodbye, AI responded politely - disconnecting
prosaas-backend  | ğŸ“ [BUILD 163] Pending hangup set - will disconnect after audio finishes playing
prosaas-backend  | ğŸ”Š [REALTIME] response.content_part.done
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 469 frames...
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | âœ… [POLITE HANGUP] OpenAI queue empty after 0ms
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 469 frames...
prosaas-backend  | ğŸ”Š [REALTIME] response.output_item.done
prosaas-backend  | ğŸ”¥ [BUILD 171] AI finished speaking - cooldown started (700ms)
prosaas-backend  | â³ [POLITE HANGUP] Starting wait for audio to finish...
prosaas-backend  | âœ… [POLITE HANGUP] OpenAI queue empty after 0ms
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 469 frames...
prosaas-backend  | ğŸ”Š [REALTIME] response.done: status=completed, output_count=1, details=None
prosaas-backend  |    output[0]: type=message, content_types=['audio']
prosaas-backend  | [REALTIME] event: rate_limits.updated
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 800 frames (rms=8, reason=noise)
prosaas-backend  | ğŸ” [NLP] â—€ï¸ NLP result: {'action': 'none', 'date': 'null', 'time': 'null', 'name': 'null', 'phone': 'null', 'confidence': 0.0}
prosaas-backend  | ğŸ“­ [NLP] No appointment action detected (action=none)
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 419 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 419 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 419 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 369 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 369 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 369 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 900 frames (rms=10, reason=noise)
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 319 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 319 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 319 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:37916 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:49780 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 268 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 268 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 268 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | ğŸ”‡ [AUDIO GATE] Blocked 1000 frames (rms=8, reason=noise)
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 218 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 218 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 218 frames...
prosaas-backend  | ğŸ” [BARGE-IN DEBUG] is_ai_speaking=False, user_has_spoken=True, waiting_for_dtmf=False, rms=8, voice_frames=0
prosaas-backend  | WS_STOP sid=MZa460b2237af046f2aa8682ac0ffd01a6 rx=1585 tx=1023
prosaas-backend  | ğŸ“ [SES-1fe7d29a] CALL ENDED - duration=31.7s, business_id=10, rx=1585, tx=1023
prosaas-backend  | ğŸ“¤ [REALTIME] Audio sender ended
prosaas-backend  | ğŸ“ [REALTIME] Text sender ended
prosaas-backend  | ğŸ§¹ Waiting for 5 background threads...
prosaas-backend  | STREAM_ENDED call=CA650b290dd12bc3c793f12e71dd4bcf61 stream=N/A status=N/A
prosaas-backend  | INFO:     172.18.0.6:37930 - "POST /webhook/stream_ended HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Found existing recording for CA650b290dd12bc3c793f12e71dd4bcf61: /2010-04-01/Accounts/ACcd09431f076a309088b18ed1f286f32e/Recordings/REb8c49b9687ae3e9ffec924fa12618b5b.json
prosaas-backend  | INFO:     172.18.0.6:37932 - "POST /webhook/call_status HTTP/1.1" 204 No Content
prosaas-backend  | âœ… Recording queued for processing: CA650b290dd12bc3c793f12e71dd4bcf61
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 207 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 207 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 207 frames...
prosaas-backend  | INFO:     connection closed
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 207 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 207 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 207 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 207 frames...
prosaas-backend  | âš ï¸ Background thread 0 still running after timeout
prosaas-backend  | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=207) retry #0
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 207 frames...
prosaas-backend  | â³ [POLITE HANGUP] TX queue still has 207 frames...
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | â³ [POLITE HANGUP] Queues empty, waiting 2s for network...
prosaas-backend  | âš ï¸ Background thread 4 still running after timeout
prosaas-backend  | âœ… All background threads cleanup complete
prosaas-backend  | WS_DONE sid=MZa460b2237af046f2aa8682ac0ffd01a6 rx=1585 tx=1023
prosaas-backend  | âœ… CALL FINALIZED: CA650b290dd12bc3c793f12e71dd4bcf61
prosaas-backend  | ğŸ“ Summary: ### ×¡×•×’ ×”×¤× ×™×™×” ×•×”×ª×—×•×:
prosaas-backend  | ×”×¤× ×™×™×” ×”×™× ×‘×ª×—×•× ×©×™×¨×•×ª×™ ×¤×¨×™×¦×”, ×¡×¤×¦×™×¤×™×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™× ×¡×¤×¦×™×¤×™×™×:
prosaas-backend  | ×”×œ×§×•×— ×–×§×•×§ ×œ×©×™×¨×•×ª ×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”. ×œ× × ××¡×¨×• ×¤×¨×˜×™× × ×•×¡×¤×™× ×œ×’×‘×™ ×¡×•×’ ×”×“×œ×ª ××• ×“×—×™×¤×•×ª ×”×©×™×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¤×¨×˜×™ ×”×œ×§×•×—:
prosaas-backend  | ×œ× × ××¡×¨×• ×¤×¨×˜×™ ×œ×§×•×— ×›××• ×©× ××• ×××¦×¢×™ ×”×ª×§×©×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×¡×˜×˜×•×¡ ×•××¢×§×‘:
prosaas-backend  | ×‘×¢×œ ××§×¦×•×¢ ××ª××™× ×™×—×–×•×¨ ×œ×œ×§×•×— ×‘×“×§×•×ª ×”×§×¨×•×‘×•×ª. ×“×—×™×¤×•×ª ×”×¤× ×™×™×” ×œ× ×¦×•×™× ×”, ××š × ×™×ª×Ÿ ×œ×”× ×™×— ×©×”×™× ×’×‘×•×”×” ×œ××•×¨ ×”×¦×•×¨×š ×”××™×™×“×™ ×‘×©×™×¨×•×ª.
prosaas-backend  | 
prosaas-backend  | ### ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:
prosaas-backend  | ×™×© ×œ×•×•×“× ×©×”×× ×¢×•×œ×Ÿ ×”××™×•×¢×“ ××¦×•×™×“ ×‘×›×œ×™× ×”× ×“×¨×©×™× ×œ×¤×•×¨×¥ ×“×œ×ª×•×ª, ×•×©×”×•× ××ª×¢×“×›×Ÿ ×¢×œ ×–××™× ×•×ª×• ×‘×¢×™×¨ ×—×™×¤×”. ××•××œ×¥ ×œ×¢×§×•×‘ ××—×¨×™ ×”×¤× ×™×™×” ×•×œ×•×•×“× ×©×”×œ×§×•×— ×§×™×‘×œ ××ª ×”×©×™×¨×•×ª ×”× ×“×¨×©.
prosaas-backend  | ğŸ¯ Intent: general_inquiry
prosaas-backend  | ğŸ“Š Next Action: ××¢×§×‘ ×ª×•×š 24 ×©×¢×•×ª
prosaas-backend  | â„¹ï¸ Appointment handling: Managed by Agent during call (BUILD 119)
prosaas-backend  | ğŸ“± [WEBHOOK] Phone extraction debug:
prosaas-backend  |    - self.phone_number: None
prosaas-backend  |    - self.customer_phone_dtmf: NOT_SET
prosaas-backend  | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
prosaas-backend  | ğŸ“ [BUILD 163] Audio playback complete - triggering polite hangup now
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=207) retry #10
prosaas-backend  |    - call_log.from_number: +972504294724
prosaas-backend  |    - crm_context.customer_phone: NO_CRM
prosaas-backend  |    âœ“ Using CallLog from_number: +972504294724
prosaas-backend  | ğŸ¯ [WEBHOOK] Extracted SPECIFIC service from AI confirmation: '×¤×•×¨×¥ ×“×œ×ª×•×ª'
prosaas-backend  | ğŸ“‹ [WEBHOOK] Lead capture state: {'city_needs_retry': 'True', 'service_type': '×¤×•×¨×¥ ×“×œ×ª×•×ª ×‘×¢×™×¨ ×—×™×¤×”', 'city': '×›×Ÿ ×™×¤×”.', 'raw_city': '×—×™×¤×”', 'city_confidence': '100.0', 'city_autocorrected': 'True'}
prosaas-backend  | [WEBHOOK] ğŸ“¦ Payload built: call_id=CA650b290dd12bc3c793f12e71dd4bcf61, phone=+972504294724, city=×›×Ÿ ×™×¤×”., direction=inbound
prosaas-backend  | [WEBHOOK] Sending call.completed to http://prosaas.pro/n8n/webhook/prosaas-call-comple... (attempt 1)
prosaas-backend  | âœ… [WEBHOOK] Call completed webhook queued: phone=+972504294724, city=×›×Ÿ ×™×¤×”., service=×¤×•×¨×¥ ×“×œ×ª×•×ª
prosaas-backend  | [WEBHOOK] ğŸ”€ Following redirect to: https://prosaas.pro/n8n/webhook/prosaas-call-completed
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 2)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] Retrying in 3s...
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=207) retry #20
prosaas-backend  | ğŸ›¡ï¸ [PROTECTION] Waiting for audio (ai=False, oai_q=0, tx_q=207) retry #30
prosaas-backend  | âš ï¸ [BUILD 178] Max hangup retries exceeded - forcing hangup
prosaas-backend  | [WEBHOOK] Sending call.completed to https://prosaas.pro/n8n/webhook/prosaas-call-compl... (attempt 3)
prosaas-backend  | [WEBHOOK] âš ï¸ Response 404: {"code":404,"message":"The requested webhook \"POST prosaas-call-completed\" is not registered.","hint":"The workflow must be active for a production URL to run successfully. You can activate the work
prosaas-backend  | [WEBHOOK] âŒ Failed after 3 attempts
prosaas-backend  | INFO:     172.18.0.6:42164 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:50648 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | INFO:     127.0.0.1:32860 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:60026 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:58760 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:41618 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:52478 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:37030 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | [WA-SESSION] ğŸ“± Check #2: Found 0 stale sessions to process
prosaas-backend  | INFO:     172.18.0.6:44522 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:56752 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:53766 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:34056 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:58206 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:36706 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:40748 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:45798 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:35122 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:38204 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:48306 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:38410 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:39762 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:50416 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | INFO:     127.0.0.1:52068 - "GET /health HTTP/1.1" 200 OK
prosaas-backend  | ğŸ” AUTH DEBUG: user_id=10, role=owner, business_id=10, computed_tenant=10, impersonating=False
prosaas-backend  | ğŸ”” /api/notifications - tenant_id=10, g.tenant=10
prosaas-backend  | ğŸ”” Querying reminders for tenant_id=10, is_system_admin=False
prosaas-backend  | ğŸ”” Found 0 reminders
prosaas-backend  | INFO:     172.18.0.6:58706 - "GET /api/notifications HTTP/1.1" 200 OK
prosaas-backend  | INFO:     172.18.0.6:38842 - "GET /api/notifications HTTP/1.1" 401 Unauthorized
prosaas-backend  | INFO:     127.0.0.1:53504 - "GET /health HTTP/1.1" 200 OK
^[[B
