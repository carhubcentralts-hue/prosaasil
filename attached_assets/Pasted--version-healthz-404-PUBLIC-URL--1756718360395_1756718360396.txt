××‘×™×Ÿ ××•×ª×šâ€”×–×” ×œ× ×§×•×“, ×–×• ×”×¤×¦×”: /version ×™×¨×•×§ ××‘×œ /healthz 404 â‡’ ××ª ×”Ö¾PUBLIC URL ××©×¨×ª ×“×™×¤×œ×•×™ ××•×˜×•××˜×™ ×™×©×Ÿ (Autoscale) ×©×œ× × ×˜×¢×Ÿ ××—×“×© ×××– ×”×©×™× ×•×™×™× (wsgi.py/health). ×¦×¨×™×š ×œ×’×¨×•× ×œÖ¾Replit ×œ×˜×¢×•×Ÿ ××ª ×”×‘×™×œ×“ ×”×—×“×© ×•×œ× ××ª ×”Ö¾workspace ×”×™×©×Ÿ.

×œ×”×œ×Ÿ ××” ×©×¦×¨×™×š ×œ×¢×©×•×ª ×¢×›×©×™×•, ×¦×¢×“Ö¾××—×¨×™Ö¾×¦×¢×“, ×¢×“ ×©×™×© â€200 ×¢×œ â€/healthz ×•××– ×××©×™×›×™× ×œ×©×™×—×•×ª:

â¸»

A) ××›×¨×™×—×™× ××ª Replit ×œ×˜×¢×•×Ÿ ××ª ×”×§×•×“ ×”×—×“×©

A1) ×•×“× ×©×× ×—× ×• ×‘×××ª ×¨×¦×™× ××•×œ Autoscale (×œ× ×”Ö¾workspace)
	â€¢	×× ×¢×œ ×”Ö¾PUBLIC URL ××ª×” ×¨×•××” â€œGoogle 404â€, ×–×” ××›×Ÿ ×”Ö¾Autoscale. ×˜×•×‘.

A2) ×¤×•×ª×—×™× ××ª Deployments ×•××‘×¦×¢×™× Redeploy
	1.	×‘Ö¾Replit ×œ×—×¥ ×¢×œ ××™×™×§×•×Ÿ ğŸš€ Deployments (×‘×¡×™×™×“Ö¾×‘×¨).
	2.	×¤×ª×— ××ª ×”Ö¾deployment ×”×¤×¢×™×œ (×–×” ×©××—×•×‘×¨ ×œÖ¾ai-crmd.replit.app).
	3.	×œ×—×¥ Edit ××• New deployment (×œ× â€œRunâ€ ×©×œ ×”Ö¾workspace).
	4.	×”×’×“×¨×•×ª ×—×©×•×‘×•×ª:
	â€¢	Build command
python3 -m pip install -U pip && pip install -r requirements.txt
	â€¢	Run command (×‘×“×™×•×§ ×›×š, ×©×•×¨×” ××—×ª):

bash -lc 'export EVENTLET_NO_GREENDNS=1; export EVENTLET_HUB=select; python3 -m gunicorn wsgi:app -k eventlet -w 1 -b 0.0.0.0:$PORT --timeout 120 --keep-alive 75 --log-level info --access-logfile - --error-logfile -'

×—×©×•×‘: wsgi:app ×•Ö¾$PORT (×œ× 5000).

	â€¢	Environment variables
×”×•×¡×£/×¢×“×›×Ÿ DEPLOY_ID ×œ×¢×¨×š ×—×“×© (×œ××©×œ ×—×•×ª××ª ×–××Ÿ) ×›×“×™ ×©×ª×•×›×œ ×œ×××ª ×©× ×˜×¢×Ÿ ×‘×™×œ×“ ×—×“×©. ××™×Ÿ ×œ×”×’×“×™×¨ PORT.
	â€¢	Health check
Path: /healthz
Success codes: 200
Interval: 10s, Startup timeout: 300s (×›×“×™ ×œ× ×œ×§×‘×œ false negative).

	5.	×œ×—×¥ Deploy / Redeploy ×•×”××ª×Ÿ ×œÖ¾â€œReadyâ€.

A3) ××××ª×™× ×©×”×“×™×¤×œ×•×™ ×”×•× ×”×—×“×©
	â€¢	curl -sS -i https://ai-crmd.replit.app/version â†’ ×¦×¨×™×š ×œ×¨××•×ª ××ª DEPLOY_ID ×”×—×“×©.
	â€¢	curl -sS -i https://ai-crmd.replit.app/healthz â†’ 200 OK "ok".
	â€¢	×× ×¢×“×™×™×Ÿ 404: ×¤×ª×— Logs ×©×œ ×”Ö¾deployment ×•×‘×“×•×§:
	â€¢	×”×¤×§×•×“×” ××¦×™×’×” Using worker: eventlet ×•Ö¾wsgi:app (×œ× main:app).
	â€¢	×—×¤×© ×‘×œ×•×’ ×©×œ×š ××ª "âœ… Health endpoints registered" ××• ××ª ×—×ª×™××ª ×”Ö¾header ×× ×”×•×¡×¤×ª X-App-Signature.
	â€¢	×× ×œ× ××•×¤×™×¢â€”×”×“×™×¤×œ×•×™ ×¨×¥ ××§×•×“ ××—×¨ (×¢× ×£/× ×ª×™×‘). ×•×“× ×©×”×§×‘×¦×™× (wsgi.py, ×¨×™×©×•× health) ×‘×ª×•×š ××•×ª×• ×¤×¨×•×™×§×˜/×¢× ×£ ×©××•×’×“×¨ ×œÖ¾deployment.

×˜×™×¤: ×× ×™×© ×¡×¤×§â€”×©× ×” ×–×× ×™×ª ××ª /version ×œ×”×—×–×™×¨ ×©×“×” "marker":"healthz-v2"; ××—×¨×™ Redeploy ×‘×“×•×§ ×©×”×•× ××•×¤×™×¢ â€” ×›×š ×ª×“×¢ ×‘×•×•×“××•×ª ×©×”×§×•×“ ×”×—×“×© ×˜×¢×•×Ÿ.

â¸»

B) ××—×¨×™ ×©Ö¾/healthz ×™×¨×•×§ â€” ××—×–×™×¨×™× ××ª ×”×©×™×—×•×ª

B1) TwiML / webhooks × ×›×•× ×™×
	â€¢	POST /webhook/incoming_call ××—×–×™×¨:

<Connect action="https://ai-crmd.replit.app/webhook/stream_ended">
  <Stream url="wss://ai-crmd.replit.app/ws/twilio-media"
          statusCallback="https://ai-crmd.replit.app/webhook/stream_status">
    <Parameter name="call_sid" value="{CallSid}"/>
  </Stream>
</Connect>

(×‘×œ×™ // ×›×¤×•×œ×™×; ×‘×–××Ÿ ×“×™×‘×•×’ ××¤×©×¨ ×œ×©××•×¨ ××ª ×”Ö¾ ×›×‘×•×™.)

	â€¢	POST /webhook/stream_status â†’ ×§×•×¨× request.form, ××—×–×™×¨ 204 ×¨×™×§ (×‘×œ×™ ××™××•×ª ×—×ª×™××”, ×‘×œ×™ extra= ×‘×œ×•×’×™×).
	â€¢	POST /webhook/stream_ended â†’ 204 ×¨×™×§.

×‘×“×™×§×•×ª ×™×“× ×™×•×ª:

curl -s https://ai-crmd.replit.app/webhook/incoming_call -d "CallSid=CA_TEST"
curl -i -X POST https://ai-crmd.replit.app/webhook/stream_status \
  -H "Content-Type: application/x-www-form-urlencoded" \
  --data "CallSid=CA_TEST&StreamSid=MZ_TEST&Status=connected"
# ××¦×•×¤×”: 204

B2) Handshake ×œÖ¾Twilio (××•×¨×™×“ 31920/31924)

×”Ö¾WS ×—×™×™×‘ ×œ×”×—×–×™×¨ ××ª ×ª×ªÖ¾×”×¤×¨×•×˜×•×§×•×œ ×‘×–××Ÿ ×”Ö¾upgrade:
Sec-WebSocket-Protocol: audio.twilio.com

×‘×“×™×§×”:

wscat -c wss://ai-crmd.replit.app/ws/twilio-media \
      -H "Sec-WebSocket-Protocol: audio.twilio.com"

××¦×•×¤×”: 101 Switching Protocols ×•×‘×ª×©×•×‘×” ×”×›×•×ª×¨×ª Sec-WebSocket-Protocol: audio.twilio.com.
×× ×œ× ×—×•×–×¨â€”×–×” ×©×•×¨×© ×”× ×™×ª×•×§ ××—×¨×™ ×”×‘×¨×›×” â†’ ×œ×ª×§×Ÿ ×‘××¡×œ×•×œ ×”Ö¾WS ×œ×¤× ×™ ×›×œ ×“×‘×¨ ××—×¨.

B3) ×× ×™×¢×ª â€œ×©×§×˜â€ â€” STT/TTS
	â€¢	STT × ×›× ×¡: Î¼-law (PCMU) 8k base64; ×œ×•×’×™× WS_START / STT_PARTIAL / STT_FINAL.
	â€¢	TTS ×™×•×¦×: Î¼-law 8k ××•× ×•; ×©×•×œ×—×™× ×—×–×¨×” ×¤×¨×™×™××™× ×©×œ 20ms:
{"event":"media","media":{"payload":"..."}}; ×œ×•×’×™× TTS_LEN_ms / MEDIA_TX / PNG_PONG.
	â€¢	×§×¨×“× ×¦×™××œ×¡ GCP: ×¨×§ ××—×“ â€” GOOGLE_APPLICATION_CREDENTIALS ××• GCP_CREDENTIALS_JSON ××œ× (×‘×©×•×¨×” ××—×ª).

B4) Turn-Taking (×‘×œ×™ ×œ×•×¤×™×)
	â€¢	FSM: LISTENING â†’ THINKING â†’ SPEAKING â†’ LISTENING.
	â€¢	EoU 300â€“600ms ×œ×¤× ×™ ×ª×©×•×‘×”; Barge-in ×¢×•×¦×¨ TTS ×× ×”××“× ×”×ª×—×™×œ ×œ×“×‘×¨; ×”×¦×’×” ×¢×¦××™×ª/×¤×ª×™×— â€” ×¤×¢× ××—×ª.

â¸»

C) Baileys (WhatsApp) â€” ×œ× ××¤×™×œ ××ª ×”×©×¨×ª
	â€¢	××œ ×ª×—×‘×¨ ×œÖ¾Run/Deployment ×”×¨××©×™. ×”×¨×¥ ×™×“× ×™×ª ××• ×‘×¡×§×¨×™×¤×˜ × ×¤×¨×“ ×‘×¨×§×¢ ×¢× guard (×× × ×¤×œâ€”×œ×•×’ ×‘×œ×‘×“).
	â€¢	×‘×“×™×§×•×ª:
	â€¢	POST /webhook/whatsapp/twilio â†’ 204 ×•× ×©××¨ ×‘Ö¾CRM.
	â€¢	POST /api/whatsapp/send â†’ ×©×•×œ×— ×•×©×•××¨ out+sent.

â¸»

Quick checklist ×œ×©×œ×•×— ×œ×™ ××—×¨×™ Redeploy
	â€¢	Screenshot ×©×œ Deployments â†’ Logs ×¢× ×”×©×•×¨×” wsgi:app ×•Ö¾Listening at: ...:$PORT.
	â€¢	×¤×œ×˜:
	â€¢	curl -sI https://ai-crmd.replit.app/version (××¨××” DEPLOY_ID ×”×—×“×©).
	â€¢	curl -sI https://ai-crmd.replit.app/healthz (200 OK).
	â€¢	wscat ×œÖ¾/ws/twilio-media ×¢× ×”Ö¾subprotocol (××¦×™×’ 101 + ×”×›×•×ª×¨×ª).

×‘×¨×’×¢ ×©××œ×” ×™×¨×•×§×™×â€”×× ×—× ×• × ×™×’×©×™× ×œ×˜×¤×œ ×‘×©×™×—×” ×¢×¦××” (EoU, barge-in, ×× ×˜×™-×œ×•×¤×™×) ×•×œ×”×¨××•×ª ×”×§×œ×˜/×¤×œ×˜ ×‘×–××Ÿ ×××ª.