# ===========================================
# ProSaaS - Environment Variables Template
# ===========================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env files with real secrets!
# ===========================================

# ===========================================
# DOMAIN & PUBLIC URLS
# ===========================================
# ‚úÖ CRITICAL: Set these to your production domain (e.g., https://prosaas.pro)
PUBLIC_HOST=https://prosaas.pro
PUBLIC_BASE_URL=https://prosaas.pro

# ===========================================
# DOCKER NETWORK CONFIGURATION
# ===========================================
# Docker network name for all services
# ‚ö†Ô∏è IMPORTANT: Run scripts/ensure_docker_network.sh before docker compose up
DOCKER_NETWORK_NAME=prosaas-net

# ===========================================
# DATABASE (Docker local or managed)
# ===========================================
# For Docker local development:
POSTGRES_USER=prosaas
POSTGRES_PASSWORD=your_secure_password_here
POSTGRES_DB=prosaas
DB_PORT=5432

# For production (managed database - Railway, Neon, Supabase, etc.):
DATABASE_URL=postgresql://user:password@host:5432/database

# ===========================================
# N8N AUTOMATION PLATFORM DATABASE
# ===========================================
# n8n needs its own database configuration
# üî• IMPORTANT: Use the SAME database as DATABASE_URL or a separate n8n database
# If using the same database, copy the same credentials
N8N_DB_TYPE=postgresdb
N8N_DB_HOST=your-db-host.com
N8N_DB_PORT=5432
N8N_DB_NAME=postgres
N8N_DB_USER=your-db-user
N8N_DB_PASSWORD=your-db-password
N8N_DB_SSL=true

# N8N Encryption Keys (CRITICAL - keep these secret!)
# ‚ö†Ô∏è WARNING: NO DEFAULTS in docker-compose - these MUST be set in .env
# Generate with: python3 -c "import secrets; print(secrets.token_urlsafe(32))"
N8N_ENCRYPTION_KEY=generate-a-random-32-char-string
N8N_JWT_SECRET=generate-another-random-32-char-string

# N8N Public Configuration
# ‚ö†Ô∏è WARNING: NO DEFAULTS in docker-compose - these MUST be set in .env
# Replace with your actual domain (e.g., n8n.yourdomain.com)
N8N_HOST=n8n.prosaas.pro
N8N_PROTOCOL=https
N8N_EDITOR_BASE_URL=https://n8n.yourdomain.com
N8N_WEBHOOK_URL=https://n8n.yourdomain.com

# ===========================================
# OPENAI API
# ===========================================
OPENAI_API_KEY=sk-your-openai-api-key

# ===========================================
# TWILIO CREDENTIALS
# ===========================================
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your-twilio-auth-token
TWILIO_PHONE_NUMBER=+1234567890

# Twilio Signature Validation (set to false for testing behind proxies)
VALIDATE_TWILIO_SIGNATURE=true

# ===========================================
# WHATSAPP CONFIGURATION
# ===========================================
WHATSAPP_PROVIDER=auto
# ‚úÖ CRITICAL: For Docker deployments, use internal Docker network address
# For Docker: http://baileys:3300
# For local dev: http://127.0.0.1:3300
BAILEYS_BASE_URL=http://baileys:3300
BAILEYS_OUTBOUND_URL=http://baileys:3300/send
BAILEYS_WEBHOOK_SECRET=your-secret-token

# ‚úÖ FIX for 405: Webhook secret for external services (n8n, Zapier)
# This allows external services to send WhatsApp messages via /api/whatsapp/webhook/send
# Generate with: openssl rand -hex 32
WHATSAPP_WEBHOOK_SECRET=your-webhook-secret-generate-random-here

# ===========================================
# VOICE CALLS - OpenAI Realtime API (RECOMMENDED)
# ===========================================
# ‚úÖ USE_REALTIME_API=true ‚Üí Uses OpenAI Realtime API (no GCP needed!)
# ‚ùå USE_REALTIME_API=false ‚Üí Uses Google Cloud TTS/STT (requires GCP credentials)
USE_REALTIME_API=true

# ===========================================
# GOOGLE CLOUD SERVICES (DISABLED - Production Stability)
# ===========================================
# ‚úÖ DISABLE_GOOGLE=true ‚Üí Hard off - prevents stalls and latency issues
# ‚ö†Ô∏è Google STT/TTS is DISABLED for production stability
DISABLE_GOOGLE=true

# Legacy GCP settings (NOT USED when DISABLE_GOOGLE=true)
# GOOGLE_STT_PROJECT_ID=your-gcp-project-id
# GOOGLE_APPLICATION_CREDENTIALS=/app/credentials/gcp-credentials.json
# GCP_PROJECT_ID=your-gcp-project-id

# ===========================================
# VOICE PARAMETERS (OPTIONAL - for calls)
# ===========================================
MIN_UTT_SEC=1.5
MAX_UTT_SEC=8.0
VAD_RMS=65
BARGE_IN_VOICE_FRAMES=40
VAD_HANGOVER_MS=400
REPLY_REFRACTORY_MS=1500
TTS_SPEAKING_RATE=1.1
TTS_VOICE=he-IL-Standard-A
TTS_RATE=1.0
TTS_PITCH=0.0

# ===========================================
# FAQ FAST-PATH (Voice Calls Only)
# ===========================================
FAQ_FASTPATH_ENABLED=1
FAQ_MIN_SCORE=0.78
FAQ_CACHE_TTL_SEC=120
FAQ_EMBEDDINGS_ENABLED=1

# ===========================================
# AI & AGENTKIT
# ===========================================
AGENTS_ENABLED=1
AGENT_MAX_OUTPUT_TOKENS=160
AI_FIRST_REPLY_WORDS=24
AI_MAX_WORDS_FIRST_REPLY=24

# ===========================================
# FEATURE FLAGS (Disable unused features)
# ===========================================
# ‚ö†Ô∏è BUILD 154: Payments & Contracts currently disabled
# Set to 'true' only when these features are fully implemented
ENABLE_PAYMENTS=false
ENABLE_CONTRACTS=false

# ===========================================
# SECURITY
# ===========================================
FLASK_SECRET_KEY=your-super-secret-key
SESSION_TIMEOUT=3600
# Generate with: openssl rand -hex 32
INTERNAL_SECRET=your_internal_secret_here

# ===========================================
# SENDGRID EMAIL SERVICE
# ===========================================
# ‚úÖ ONLY SendGrid credentials in ENV - all business logic in code
# SendGrid API key for sending emails (password reset, notifications, etc.)
# Get your API key from: https://app.sendgrid.com/settings/api_keys
# NOTE: System works without SendGrid, but password reset won't send actual emails
SENDGRID_API_KEY=SG_your-sendgrid-api-key-here
MAIL_FROM_EMAIL=noreply@prosaas.pro
MAIL_FROM_NAME=PROSAAS
MAIL_REPLY_TO=support@prosaas.pro

# ===========================================
# AUTH SYSTEM CONFIGURATION
# ===========================================
# ‚úÖ All timeouts and expiry values are hardcoded in auth_service.py
# - ACCESS_TOKEN: 90 minutes
# - REFRESH_TOKEN: 24 hours (default) / 30 days (remember me)
# - IDLE_TIMEOUT: 75 minutes
# - PASSWORD_RESET: 60 minutes
# No ENV variables needed - business logic stays in code!

# ===========================================
# SERVER PORTS (Docker)
# ===========================================
BACKEND_PORT=5000
BAILEYS_PORT=3300
FRONTEND_PORT=80

# ===========================================
# ENVIRONMENT
# ===========================================
DEBUG=false
DEBUG_TX=false  # Set to true to enable TX loop diagnostics and stack traces
FLASK_ENV=production
NODE_ENV=production
PRODUCTION=1  # Set to 1 for production mode (enforces R2 storage)

# Database Migration Enforcement
# MIGRATIONS_ENFORCE=true   # Production: Server won't start if schema drift detected
# MIGRATIONS_ENFORCE=false  # Local/Debug: Allow startup with warnings
# Default: false (for backwards compatibility)
MIGRATIONS_ENFORCE=false

# Run migrations on startup (production recommended)
RUN_MIGRATIONS_ON_START=1

# ===========================================
# ATTACHMENT STORAGE - R2 Configuration (REQUIRED in Production)
# ===========================================
# ‚úÖ CRITICAL: In production, ATTACHMENT_STORAGE_DRIVER must be 'r2'
# ‚ùå Local storage is NOT allowed in production
ATTACHMENT_STORAGE_DRIVER=r2

# üîí ATTACHMENT_SECRET - MUST be changed in production!
# Generate with: python3 -c "import secrets; print(secrets.token_urlsafe(32))"
ATTACHMENT_SECRET=CHANGE_ME_TO_RANDOM_SECRET_KEY_IN_PRODUCTION

# üåê Cloudflare R2 Configuration (REQUIRED when ATTACHMENT_STORAGE_DRIVER=r2)
# Get these from: https://dash.cloudflare.com ‚Üí R2 ‚Üí Manage R2 API Tokens
R2_ACCOUNT_ID=your-cloudflare-account-id-here
R2_BUCKET_NAME=prosaas-attachment
R2_ACCESS_KEY_ID=your-r2-access-key-id-here
R2_SECRET_ACCESS_KEY=your-r2-secret-access-key-here
R2_ENDPOINT=https://your-account-id.r2.cloudflarestorage.com

# ===========================================
# IMPORTANT: R2 Storage Notes
# ===========================================
# 1. ALL file uploads (CRM, WhatsApp, Contracts) use the SAME R2 bucket
# 2. Logical separation is in the DATABASE (attachments, contract_files tables)
# 3. Physical storage is unified in R2 with different key prefixes
# 4. NO separate R2 configuration needed for contracts - they use AttachmentService
# 5. In production, if R2 is not configured, the system will FAIL (no silent fallback)

# ===========================================
# n8n WORKFLOW AUTOMATION
# ===========================================
# n8n UI will be accessible at: https://prosaas.pro/n8n
# Webhooks at: https://prosaas.pro/n8n/webhook/...

# n8n Server Settings (Docker)
N8N_PORT=5678
N8N_USER=admin
N8N_PASSWORD=your_secure_n8n_password
TZ=Asia/Jerusalem

# n8n Integration (Backend sends events to n8n)
# Set N8N_ENABLED=true to activate event sending
N8N_ENABLED=false
N8N_WEBHOOK_URL=https://prosaas.pro/n8n/webhook/your-workflow-id
N8N_WEBHOOK_SECRET=your_secret_token_here

# ===========================================
# GMAIL RECEIPTS INTEGRATION
# ===========================================
# Get these from Google Cloud Console:
# 1. Create a project at https://console.cloud.google.com
# 2. Enable Gmail API
# 3. Create OAuth 2.0 credentials (Web application)
# 4. Add redirect URI: https://prosaas.pro/api/gmail/oauth/callback

GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URI=https://prosaas.pro/api/gmail/oauth/callback

# Encryption key for storing OAuth refresh tokens (generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())")
ENCRYPTION_KEY=your-fernet-encryption-key
